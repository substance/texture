!function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return r(n?n:t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";function i(){}var r=t("substance/util/oo"),o=t("substance/util/request");i.Prototype=function(){this.readXML=function(t,e){var n=localStorage.getItem(t);return n?e(null,n):void o("GET","../data/"+t+".xml",null,e)},this.writeXML=function(t,e,n){localStorage.setItem(t,e),n(null)}},r.initClass(i),e.exports=i},{"substance/util/oo":379,"substance/util/request":381}],2:[function(t,e,n){"use strict";function i(){r.apply(this,arguments);var t=this.props.configurator;this.xmlStore=t.getXMLStore()}var r=t("substance/ui/Component"),o=t("substance/model/DocumentSession"),s=t("../../packages/author/Author"),a=t("../../packages/author/JATSTransformer");i.Prototype=function(){this.getChildContext=function(){return{xmlStore:this.xmlStore}},this.getInitialState=function(){return{documentSession:null,error:null}},this.didMount=function(){this._loadDocument(this.props.documentId)},this.willReceiveProps=function(t){t.documentId!==this.props.documentId&&(this.dispose(),this.state=this.getInitialState(),this._loadDocument(t.documentId))},this._loadDocument=function(){var t=this.props.configurator;this.xmlStore.readXML(this.props.documentId,function(e,n){if(e)return console.error(e),void this.setState({error:new Error("Loading failed")});var i=t.createImporter("jats"),r=i.importDocument(n),s=new a;r=s.fromJATS(r),window.doc=r;var c=new o(r);this.setState({documentSession:c})}.bind(this))},this.render=function(t){var e=this.props.configurator,n=t("div").addClass("sc-science-writer");return this.state.error?(n.append("ERROR: ",this.state.error.message),n):this.state.documentSession?(n.append(t(s,{documentId:this.props.documentId,documentSession:this.state.documentSession,configurator:e}).ref("publisher")),n):n}},r.extend(i),e.exports=i},{"../../packages/author/Author":385,"../../packages/author/JATSTransformer":387,"substance/model/DocumentSession":237,"substance/ui/Component":322}],3:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/util/substanceGlobals");r.DEBUG_RENDERING=!0;var o=t("../../packages/common/BasicApp"),s=t("./ScienceWriter"),a=t("./package");i.Prototype=function(){this.getDefaultState=function(){return{documentId:"kitchen-sink-author"}},this.getConfiguration=function(){return a},this.render=function(t){var e=this.state.documentId,n=t("div").append(t(s,{mode:"write",documentId:e,configurator:this.configurator}));return n}},o.extend(i),window.onload=function(){window.app=i["static"].mount(document.body)}},{"../../packages/common/BasicApp":393,"./ScienceWriter":2,"./package":4,"substance/util/substanceGlobals":382}],4:[function(t,e,n){(function(n){"use strict";var i=t("../../packages/author/package"),r=t("../ExampleXMLStore"),o=t("path");e.exports={name:"science-writer",configure:function(t){t["import"](i),t.setXMLStore(r),t.addStyle(o.join(n,"app.scss"))}}}).call(this,"/examples/science-writer")},{"../../packages/author/package":390,"../ExampleXMLStore":1,path:6}],5:[function(t,e,n){},{}],6:[function(t,e,n){(function(t){function e(t,e){for(var n=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};n.resolve=function(){for(var n="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(n=s+"/"+n,r="/"===s.charAt(0))}return n=e(i(n.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+n||"."},n.normalize=function(t){var r=n.isAbsolute(t),o="/"===s(t,-1);return t=e(i(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},n.isAbsolute=function(t){return"/"===t.charAt(0)},n.join=function(){var t=Array.prototype.slice.call(arguments,0);return n.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},n.relative=function(t,e){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=n.resolve(t).substr(1),e=n.resolve(e).substr(1);for(var r=i(t.split("/")),o=i(e.split("/")),s=Math.min(r.length,o.length),a=s,c=0;s>c;c++)if(r[c]!==o[c]){a=c;break}for(var u=[],c=a;c<r.length;c++)u.push("..");return u=u.concat(o.slice(a)),u.join("/")},n.sep="/",n.delimiter=":",n.dirname=function(t){var e=o(t),n=e[0],i=e[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},n.basename=function(t,e){var n=o(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},n.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return 0>e&&(e=t.length+e),t.substr(e,n)}}).call(this,t("_process"))},{_process:7}],7:[function(t,e,n){function i(){d&&h&&(d=!1,h.length?l=h.concat(l):f=-1,l.length&&r())}function r(){if(!d){var t=a(i);d=!0;for(var e=l.length;e;){for(h=l,l=[];++f<e;)h&&h[f].run();f=-1,e=l.length}h=null,d=!1,c(t)}}function o(t,e){this.fun=t,this.array=e}function s(){}var a,c,u=e.exports={};!function(){try{a=setTimeout}catch(t){a=function(){throw new Error("setTimeout is not defined")}}try{c=clearTimeout}catch(t){c=function(){throw new Error("clearTimeout is not defined")}}}();var h,l=[],d=!1,f=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new o(t,e)),1!==l.length||d||a(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=s,u.addListener=s,u.once=s,u.off=s,u.removeListener=s,u.removeAllListeners=s,u.emit=s,u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],8:[function(t,e,n){var i=t("./_getNative"),r=t("./_root"),o=i(r,"DataView");e.exports=o},{"./_getNative":105,"./_root":147}],9:[function(t,e,n){function i(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=t("./_hashClear"),o=t("./_hashDelete"),s=t("./_hashGet"),a=t("./_hashHas"),c=t("./_hashSet");i.prototype.clear=r,i.prototype["delete"]=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=c,e.exports=i},{"./_hashClear":112,"./_hashDelete":113,"./_hashGet":114,"./_hashHas":115,"./_hashSet":116}],10:[function(t,e,n){function i(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=t("./_listCacheClear"),o=t("./_listCacheDelete"),s=t("./_listCacheGet"),a=t("./_listCacheHas"),c=t("./_listCacheSet");i.prototype.clear=r,i.prototype["delete"]=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=c,e.exports=i},{"./_listCacheClear":132,"./_listCacheDelete":133,"./_listCacheGet":134,"./_listCacheHas":135,"./_listCacheSet":136}],11:[function(t,e,n){var i=t("./_getNative"),r=t("./_root"),o=i(r,"Map");e.exports=o},{"./_getNative":105,"./_root":147}],12:[function(t,e,n){function i(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}var r=t("./_mapCacheClear"),o=t("./_mapCacheDelete"),s=t("./_mapCacheGet"),a=t("./_mapCacheHas"),c=t("./_mapCacheSet");i.prototype.clear=r,i.prototype["delete"]=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=c,e.exports=i},{"./_mapCacheClear":137,"./_mapCacheDelete":138,"./_mapCacheGet":139,"./_mapCacheHas":140,"./_mapCacheSet":141}],13:[function(t,e,n){var i=t("./_getNative"),r=t("./_root"),o=i(r,"Promise");e.exports=o},{"./_getNative":105,"./_root":147}],14:[function(t,e,n){var i=t("./_root"),r=i.Reflect;e.exports=r},{"./_root":147}],15:[function(t,e,n){var i=t("./_getNative"),r=t("./_root"),o=i(r,"Set");e.exports=o},{"./_getNative":105,"./_root":147}],16:[function(t,e,n){function i(t){var e=-1,n=t?t.length:0;for(this.__data__=new r;++e<n;)this.add(t[e])}var r=t("./_MapCache"),o=t("./_setCacheAdd"),s=t("./_setCacheHas");i.prototype.add=i.prototype.push=o,i.prototype.has=s,e.exports=i},{"./_MapCache":12,"./_setCacheAdd":148,"./_setCacheHas":149}],17:[function(t,e,n){function i(t){this.__data__=new r(t)}var r=t("./_ListCache"),o=t("./_stackClear"),s=t("./_stackDelete"),a=t("./_stackGet"),c=t("./_stackHas"),u=t("./_stackSet");i.prototype.clear=o,i.prototype["delete"]=s,i.prototype.get=a,i.prototype.has=c,i.prototype.set=u,e.exports=i},{"./_ListCache":10,"./_stackClear":151,"./_stackDelete":152,"./_stackGet":153,"./_stackHas":154,"./_stackSet":155}],18:[function(t,e,n){var i=t("./_root"),r=i.Symbol;e.exports=r},{"./_root":147}],19:[function(t,e,n){var i=t("./_root"),r=i.Uint8Array;e.exports=r},{"./_root":147}],20:[function(t,e,n){var i=t("./_getNative"),r=t("./_root"),o=i(r,"WeakMap");e.exports=o},{"./_getNative":105,"./_root":147}],21:[function(t,e,n){function i(t,e){return t.set(e[0],e[1]),t}e.exports=i},{}],22:[function(t,e,n){function i(t,e){return t.add(e),t}e.exports=i},{}],23:[function(t,e,n){function i(t,e,n){var i=n.length;switch(i){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}e.exports=i},{}],24:[function(t,e,n){function i(t,e){for(var n=-1,i=t?t.length:0;++n<i&&e(t[n],n,t)!==!1;);return t}e.exports=i},{}],25:[function(t,e,n){function i(t,e){for(var n=-1,i=t?t.length:0,r=0,o=[];++n<i;){var s=t[n];e(s,n,t)&&(o[r++]=s)}return o}e.exports=i},{}],26:[function(t,e,n){function i(t,e){var n=t?t.length:0;return!!n&&r(t,e,0)>-1}var r=t("./_baseIndexOf");e.exports=i},{"./_baseIndexOf":49}],27:[function(t,e,n){function i(t,e,n){for(var i=-1,r=t?t.length:0;++i<r;)if(n(e,t[i]))return!0;return!1}e.exports=i},{}],28:[function(t,e,n){function i(t,e){for(var n=-1,i=t?t.length:0,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}e.exports=i},{}],29:[function(t,e,n){function i(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}e.exports=i},{}],30:[function(t,e,n){function i(t,e,n,i){var r=-1,o=t?t.length:0;for(i&&o&&(n=t[++r]);++r<o;)n=e(n,t[r],r,t);return n}e.exports=i},{}],31:[function(t,e,n){function i(t,e){for(var n=-1,i=t?t.length:0;++n<i;)if(e(t[n],n,t))return!0;return!1}e.exports=i},{}],32:[function(t,e,n){function i(t,e,n){var i=t[e];s.call(t,e)&&r(i,n)&&(void 0!==n||e in t)||(t[e]=n)}var r=t("./eq"),o=Object.prototype,s=o.hasOwnProperty;e.exports=i},{"./eq":165}],33:[function(t,e,n){function i(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}var r=t("./eq");e.exports=i},{"./eq":165}],34:[function(t,e,n){function i(t,e){return t&&r(e,o(e),t)}var r=t("./_copyObject"),o=t("./keys");e.exports=i},{"./_copyObject":88,"./keys":193}],35:[function(t,e,n){function i(t,e,n){return t===t&&(void 0!==n&&(t=n>=t?t:n),void 0!==e&&(t=t>=e?t:e)),t}e.exports=i},{}],36:[function(t,e,n){function i(t,e,n,C,w,S,E){var O;if(C&&(O=S?C(t,w,S,E):C(t)),void 0!==O)return O;if(!_(t))return t;var I=m(t);if(I){if(O=f(t),!e)return u(t,O)}else{var A=d(t),D=A==N||A==P;if(v(t))return c(t,e);if(A==T||A==b||D&&!S){if(y(t))return S?t:{};if(O=g(D?{}:t),!e)return h(t,a(O,t))}else{if(!$[A])return S?t:{};O=p(t,A,i,e)}}E||(E=new r);var M=E.get(t);if(M)return M;if(E.set(t,O),!I)var k=n?l(t):x(t);return o(k||t,function(r,o){k&&(o=r,r=t[o]),s(O,o,i(r,e,n,C,o,t,E))}),O}var r=t("./_Stack"),o=t("./_arrayEach"),s=t("./_assignValue"),a=t("./_baseAssign"),c=t("./_cloneBuffer"),u=t("./_copyArray"),h=t("./_copySymbols"),l=t("./_getAllKeys"),d=t("./_getTag"),f=t("./_initCloneArray"),p=t("./_initCloneByTag"),g=t("./_initCloneObject"),m=t("./isArray"),v=t("./isBuffer"),y=t("./_isHostObject"),_=t("./isObject"),x=t("./keys"),b="[object Arguments]",C="[object Array]",w="[object Boolean]",S="[object Date]",E="[object Error]",N="[object Function]",P="[object GeneratorFunction]",O="[object Map]",I="[object Number]",T="[object Object]",A="[object RegExp]",D="[object Set]",M="[object String]",k="[object Symbol]",L="[object WeakMap]",R="[object ArrayBuffer]",j="[object DataView]",F="[object Float32Array]",B="[object Float64Array]",H="[object Int8Array]",U="[object Int16Array]",J="[object Int32Array]",q="[object Uint8Array]",K="[object Uint8ClampedArray]",V="[object Uint16Array]",W="[object Uint32Array]",$={};$[b]=$[C]=$[R]=$[j]=$[w]=$[S]=$[F]=$[B]=$[H]=$[U]=$[J]=$[O]=$[I]=$[T]=$[A]=$[D]=$[M]=$[k]=$[q]=$[K]=$[V]=$[W]=!0,$[E]=$[N]=$[L]=!1,e.exports=i},{"./_Stack":17,"./_arrayEach":24,"./_assignValue":32,"./_baseAssign":34,"./_cloneBuffer":78,"./_copyArray":87,"./_copySymbols":89,"./_getAllKeys":100,"./_getTag":109,"./_initCloneArray":119,"./_initCloneByTag":120,"./_initCloneObject":121,"./_isHostObject":123,"./isArray":176,"./isBuffer":180,"./isObject":186,"./keys":193}],37:[function(t,e,n){function i(t){return r(t)?o(t):{}}var r=t("./isObject"),o=Object.create;e.exports=i},{"./isObject":186}],38:[function(t,e,n){function i(t,e,n,i){var l=-1,d=o,f=!0,p=t.length,g=[],m=e.length;if(!p)return g;n&&(e=a(e,c(n))),i?(d=s,f=!1):e.length>=h&&(d=u,f=!1,e=new r(e));t:for(;++l<p;){var v=t[l],y=n?n(v):v;if(v=i||0!==v?v:0,f&&y===y){for(var _=m;_--;)if(e[_]===y)continue t;g.push(v)}else d(e,y,i)||g.push(v)}return g}var r=t("./_SetCache"),o=t("./_arrayIncludes"),s=t("./_arrayIncludesWith"),a=t("./_arrayMap"),c=t("./_baseUnary"),u=t("./_cacheHas"),h=200;e.exports=i},{"./_SetCache":16,"./_arrayIncludes":26,"./_arrayIncludesWith":27,"./_arrayMap":28,"./_baseUnary":69,"./_cacheHas":73}],39:[function(t,e,n){var i=t("./_baseForOwn"),r=t("./_createBaseEach"),o=r(i);e.exports=o},{"./_baseForOwn":44,"./_createBaseEach":92}],40:[function(t,e,n){function i(t,e){var n=[];return r(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n}var r=t("./_baseEach");e.exports=i},{"./_baseEach":39}],41:[function(t,e,n){function i(t,e,n,i){for(var r=t.length,o=n+(i?1:-1);i?o--:++o<r;)if(e(t[o],o,t))return o;return-1}e.exports=i},{}],42:[function(t,e,n){function i(t,e,n,s,a){var c=-1,u=t.length;for(n||(n=o),a||(a=[]);++c<u;){var h=t[c];e>0&&n(h)?e>1?i(h,e-1,n,s,a):r(a,h):s||(a[a.length]=h)}return a}var r=t("./_arrayPush"),o=t("./_isFlattenable");e.exports=i},{"./_arrayPush":29,"./_isFlattenable":122}],43:[function(t,e,n){var i=t("./_createBaseFor"),r=i();e.exports=r},{"./_createBaseFor":93}],44:[function(t,e,n){function i(t,e){return t&&r(t,e,o)}var r=t("./_baseFor"),o=t("./keys");e.exports=i},{"./_baseFor":43,"./keys":193}],45:[function(t,e,n){function i(t,e){e=o(e,t)?[e]:r(e);for(var n=0,i=e.length;null!=t&&i>n;)t=t[s(e[n++])];return n&&n==i?t:void 0}var r=t("./_castPath"),o=t("./_isKey"),s=t("./_toKey");e.exports=i},{"./_castPath":74,"./_isKey":126,"./_toKey":158}],46:[function(t,e,n){function i(t,e,n){var i=e(t);return o(t)?i:r(i,n(t))}var r=t("./_arrayPush"),o=t("./isArray");e.exports=i},{"./_arrayPush":29,"./isArray":176}],47:[function(t,e,n){function i(t,e){return null!=t&&(s.call(t,e)||"object"==typeof t&&e in t&&null===r(t))}var r=t("./_getPrototype"),o=Object.prototype,s=o.hasOwnProperty;e.exports=i},{"./_getPrototype":106}],48:[function(t,e,n){function i(t,e){return null!=t&&e in Object(t)}e.exports=i},{}],49:[function(t,e,n){function i(t,e,n){if(e!==e)return r(t,n);for(var i=n-1,o=t.length;++i<o;)if(t[i]===e)return i;return-1}var r=t("./_indexOfNaN");e.exports=i},{"./_indexOfNaN":118}],50:[function(t,e,n){function i(t,e,n,a,c){return t===e?!0:null==t||null==e||!o(t)&&!s(e)?t!==t&&e!==e:r(t,e,i,n,a,c)}var r=t("./_baseIsEqualDeep"),o=t("./isObject"),s=t("./isObjectLike");e.exports=i},{"./_baseIsEqualDeep":51,"./isObject":186,"./isObjectLike":187}],51:[function(t,e,n){function i(t,e,n,i,m,y){var _=u(t),x=u(e),b=p,C=p;_||(b=c(t),b=b==f?g:b),x||(C=c(e),C=C==f?g:C);var w=b==g&&!h(t),S=C==g&&!h(e),E=b==C;if(E&&!w)return y||(y=new r),_||l(t)?o(t,e,n,i,m,y):s(t,e,b,n,i,m,y);if(!(m&d)){var N=w&&v.call(t,"__wrapped__"),P=S&&v.call(e,"__wrapped__");if(N||P){var O=N?t.value():t,I=P?e.value():e;return y||(y=new r),n(O,I,i,m,y)}}return E?(y||(y=new r),a(t,e,n,i,m,y)):!1}var r=t("./_Stack"),o=t("./_equalArrays"),s=t("./_equalByTag"),a=t("./_equalObjects"),c=t("./_getTag"),u=t("./isArray"),h=t("./_isHostObject"),l=t("./isTypedArray"),d=2,f="[object Arguments]",p="[object Array]",g="[object Object]",m=Object.prototype,v=m.hasOwnProperty;e.exports=i},{"./_Stack":17,"./_equalArrays":97,"./_equalByTag":98,"./_equalObjects":99,"./_getTag":109,"./_isHostObject":123,"./isArray":176,"./isTypedArray":191}],52:[function(t,e,n){function i(t,e,n,i){var c=n.length,u=c,h=!i;if(null==t)return!u;for(t=Object(t);c--;){var l=n[c];if(h&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++c<u;){l=n[c];var d=l[0],f=t[d],p=l[1];if(h&&l[2]){if(void 0===f&&!(d in t))return!1}else{var g=new r;if(i)var m=i(f,p,d,t,e,g);if(!(void 0===m?o(p,f,i,s|a,g):m))return!1}}return!0}var r=t("./_Stack"),o=t("./_baseIsEqual"),s=1,a=2;e.exports=i},{"./_Stack":17,"./_baseIsEqual":50}],53:[function(t,e,n){function i(t){if(!a(t)||s(t))return!1;var e=r(t)||o(t)?p:h;return e.test(c(t))}var r=t("./isFunction"),o=t("./_isHostObject"),s=t("./_isMasked"),a=t("./isObject"),c=t("./_toSource"),u=/[\\^$.*+?()[\]{}|]/g,h=/^\[object .+?Constructor\]$/,l=Object.prototype,d=Function.prototype.toString,f=l.hasOwnProperty,p=RegExp("^"+d.call(f).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=i},{"./_isHostObject":123,"./_isMasked":128,"./_toSource":159,"./isFunction":182,"./isObject":186}],54:[function(t,e,n){function i(t){return"function"==typeof t?t:null==t?s:"object"==typeof t?a(t)?o(t[0],t[1]):r(t):c(t)}var r=t("./_baseMatches"),o=t("./_baseMatchesProperty"),s=t("./identity"),a=t("./isArray"),c=t("./property");e.exports=i},{"./_baseMatches":58,"./_baseMatchesProperty":59,"./identity":173,"./isArray":176,"./property":201}],55:[function(t,e,n){function i(t){return r(Object(t))}var r=Object.keys;e.exports=i},{}],56:[function(t,e,n){function i(t){t=null==t?t:Object(t);var e=[];for(var n in t)e.push(n);return e}var r=t("./_Reflect"),o=t("./_iteratorToArray"),s=Object.prototype,a=r?r.enumerate:void 0,c=s.propertyIsEnumerable;a&&!c.call({valueOf:1},"valueOf")&&(i=function(t){return o(a(t))}),e.exports=i},{"./_Reflect":14,"./_iteratorToArray":131}],57:[function(t,e,n){function i(t,e){var n=-1,i=o(t)?Array(t.length):[];return r(t,function(t,r,o){i[++n]=e(t,r,o)}),i}var r=t("./_baseEach"),o=t("./isArrayLike");e.exports=i},{"./_baseEach":39,"./isArrayLike":177}],58:[function(t,e,n){function i(t){var e=o(t);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(n){return n===t||r(n,t,e)}}var r=t("./_baseIsMatch"),o=t("./_getMatchData"),s=t("./_matchesStrictComparable");e.exports=i},{"./_baseIsMatch":52,"./_getMatchData":104,"./_matchesStrictComparable":143}],59:[function(t,e,n){function i(t,e){return a(t)&&c(e)?u(h(t),e):function(n){var i=o(n,t);return void 0===i&&i===e?s(n,t):r(e,i,void 0,l|d)}}var r=t("./_baseIsEqual"),o=t("./get"),s=t("./hasIn"),a=t("./_isKey"),c=t("./_isStrictComparable"),u=t("./_matchesStrictComparable"),h=t("./_toKey"),l=1,d=2;e.exports=i},{"./_baseIsEqual":50,"./_isKey":126,"./_isStrictComparable":130,"./_matchesStrictComparable":143,"./_toKey":158,"./get":171,"./hasIn":172}],60:[function(t,e,n){function i(t,e,n){var i=-1;e=r(e.length?e:[h],c(o));var l=s(t,function(t,n,o){var s=r(e,function(e){return e(t)});return{criteria:s,index:++i,value:t}});return a(l,function(t,e){return u(t,e,n)})}var r=t("./_arrayMap"),o=t("./_baseIteratee"),s=t("./_baseMap"),a=t("./_baseSortBy"),c=t("./_baseUnary"),u=t("./_compareMultiple"),h=t("./identity");e.exports=i},{"./_arrayMap":28,"./_baseIteratee":54,"./_baseMap":57,"./_baseSortBy":66,"./_baseUnary":69,"./_compareMultiple":86,"./identity":173}],61:[function(t,e,n){function i(t,e){return t=Object(t),r(e,function(e,n){return n in t&&(e[n]=t[n]),e},{})}var r=t("./_arrayReduce");e.exports=i},{"./_arrayReduce":30}],62:[function(t,e,n){function i(t){return function(e){return null==e?void 0:e[t]}}e.exports=i},{}],63:[function(t,e,n){function i(t){return function(e){return r(e,t)}}var r=t("./_baseGet");e.exports=i},{"./_baseGet":45}],64:[function(t,e,n){function i(t,e,n,i){e=a(e,t)?[e]:o(e);for(var h=-1,l=e.length,d=l-1,f=t;null!=f&&++h<l;){var p=u(e[h]);if(c(f)){var g=n;if(h!=d){var m=f[p];g=i?i(m,p,f):void 0,void 0===g&&(g=null==m?s(e[h+1])?[]:{}:m)}r(f,p,g)}f=f[p]}return t}var r=t("./_assignValue"),o=t("./_castPath"),s=t("./_isIndex"),a=t("./_isKey"),c=t("./isObject"),u=t("./_toKey");e.exports=i},{"./_assignValue":32,"./_castPath":74,"./_isIndex":124,"./_isKey":126,"./_toKey":158,"./isObject":186}],65:[function(t,e,n){function i(t,e,n){var i=-1,r=t.length;0>e&&(e=-e>r?0:r+e),n=n>r?r:n,0>n&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(r);++i<r;)o[i]=t[i+e];return o}e.exports=i},{}],66:[function(t,e,n){function i(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}e.exports=i},{}],67:[function(t,e,n){function i(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}e.exports=i},{}],68:[function(t,e,n){function i(t){if("string"==typeof t)return t;if(o(t))return c?c.call(t):"";var e=t+"";return"0"==e&&1/t==-s?"-0":e}var r=t("./_Symbol"),o=t("./isSymbol"),s=1/0,a=r?r.prototype:void 0,c=a?a.toString:void 0;e.exports=i},{"./_Symbol":18,"./isSymbol":190}],69:[function(t,e,n){function i(t){return function(e){return t(e)}}e.exports=i},{}],70:[function(t,e,n){function i(t,e,n){var i=-1,l=o,d=t.length,f=!0,p=[],g=p;if(n)f=!1,l=s;else if(d>=h){var m=e?null:c(t);if(m)return u(m);f=!1,l=a,g=new r}else g=e?[]:p;t:for(;++i<d;){var v=t[i],y=e?e(v):v;if(v=n||0!==v?v:0,f&&y===y){for(var _=g.length;_--;)if(g[_]===y)continue t;e&&g.push(y),p.push(v)}else l(g,y,n)||(g!==p&&g.push(y),p.push(v))}return p}var r=t("./_SetCache"),o=t("./_arrayIncludes"),s=t("./_arrayIncludesWith"),a=t("./_cacheHas"),c=t("./_createSet"),u=t("./_setToArray"),h=200;e.exports=i},{"./_SetCache":16,"./_arrayIncludes":26,"./_arrayIncludesWith":27,"./_cacheHas":73,"./_createSet":96,"./_setToArray":150}],71:[function(t,e,n){function i(t,e){e=s(e,t)?[e]:o(e),t=c(t,e);var n=u(a(e));return!(null!=t&&r(t,n))||delete t[n]}var r=t("./_baseHas"),o=t("./_castPath"),s=t("./_isKey"),a=t("./last"),c=t("./_parent"),u=t("./_toKey");e.exports=i},{"./_baseHas":47,"./_castPath":74,"./_isKey":126,"./_parent":145,"./_toKey":158,"./last":195}],72:[function(t,e,n){function i(t,e){return r(e,function(e){return t[e]})}var r=t("./_arrayMap");e.exports=i},{"./_arrayMap":28}],73:[function(t,e,n){function i(t,e){return t.has(e)}e.exports=i},{}],74:[function(t,e,n){function i(t){return r(t)?t:o(t)}var r=t("./isArray"),o=t("./_stringToPath");e.exports=i},{"./_stringToPath":157,"./isArray":176}],75:[function(t,e,n){function i(t,e,n){var i=t.length;return n=void 0===n?i:n,!e&&n>=i?t:r(t,e,n)}var r=t("./_baseSlice");e.exports=i},{"./_baseSlice":65}],76:[function(t,e,n){function i(t){return t&&t.Object===Object?t:null}e.exports=i},{}],77:[function(t,e,n){function i(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}var r=t("./_Uint8Array");e.exports=i},{"./_Uint8Array":19}],78:[function(t,e,n){function i(t,e){if(e)return t.slice();var n=new t.constructor(t.length);return t.copy(n),n}e.exports=i},{}],79:[function(t,e,n){function i(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var r=t("./_cloneArrayBuffer");e.exports=i},{"./_cloneArrayBuffer":77}],80:[function(t,e,n){function i(t,e,n){var i=e?n(s(t),!0):s(t);return o(i,r,new t.constructor)}var r=t("./_addMapEntry"),o=t("./_arrayReduce"),s=t("./_mapToArray");e.exports=i},{"./_addMapEntry":21,"./_arrayReduce":30,"./_mapToArray":142}],81:[function(t,e,n){function i(t){var e=new t.constructor(t.source,r.exec(t));return e.lastIndex=t.lastIndex,e}var r=/\w*$/;e.exports=i},{}],82:[function(t,e,n){function i(t,e,n){var i=e?n(s(t),!0):s(t);return o(i,r,new t.constructor)}var r=t("./_addSetEntry"),o=t("./_arrayReduce"),s=t("./_setToArray");e.exports=i},{"./_addSetEntry":22,"./_arrayReduce":30,"./_setToArray":150}],83:[function(t,e,n){function i(t){return s?Object(s.call(t)):{}}var r=t("./_Symbol"),o=r?r.prototype:void 0,s=o?o.valueOf:void 0;e.exports=i},{"./_Symbol":18}],84:[function(t,e,n){function i(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var r=t("./_cloneArrayBuffer");e.exports=i},{"./_cloneArrayBuffer":77}],85:[function(t,e,n){function i(t,e){if(t!==e){var n=void 0!==t,i=null===t,o=t===t,s=r(t),a=void 0!==e,c=null===e,u=e===e,h=r(e);if(!c&&!h&&!s&&t>e||s&&a&&u&&!c&&!h||i&&a&&u||!n&&u||!o)return 1;if(!i&&!s&&!h&&e>t||h&&n&&o&&!i&&!s||c&&n&&o||!a&&o||!u)return-1}return 0}var r=t("./isSymbol");e.exports=i},{"./isSymbol":190}],86:[function(t,e,n){function i(t,e,n){for(var i=-1,o=t.criteria,s=e.criteria,a=o.length,c=n.length;++i<a;){var u=r(o[i],s[i]);if(u){if(i>=c)return u;var h=n[i];return u*("desc"==h?-1:1)}}return t.index-e.index}var r=t("./_compareAscending");e.exports=i},{"./_compareAscending":85}],87:[function(t,e,n){function i(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}e.exports=i},{}],88:[function(t,e,n){function i(t,e,n,i){n||(n={});for(var o=-1,s=e.length;++o<s;){var a=e[o],c=i?i(n[a],t[a],a,n,t):t[a];r(n,a,c)}return n}var r=t("./_assignValue");e.exports=i},{"./_assignValue":32}],89:[function(t,e,n){function i(t,e){return r(t,o(t),e)}var r=t("./_copyObject"),o=t("./_getSymbols");e.exports=i},{"./_copyObject":88,"./_getSymbols":107}],90:[function(t,e,n){var i=t("./_root"),r=i["__core-js_shared__"];e.exports=r},{"./_root":147}],91:[function(t,e,n){function i(t){return o(function(e,n){var i=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s=t.length>3&&"function"==typeof s?(o--,s):void 0,a&&r(n[0],n[1],a)&&(s=3>o?void 0:s,o=1),e=Object(e);++i<o;){var c=n[i];c&&t(e,c,i,s)}return e})}var r=t("./_isIterateeCall"),o=t("./rest");e.exports=i},{"./_isIterateeCall":125,"./rest":202}],92:[function(t,e,n){function i(t,e){return function(n,i){if(null==n)return n;if(!r(n))return t(n,i);for(var o=n.length,s=e?o:-1,a=Object(n);(e?s--:++s<o)&&i(a[s],s,a)!==!1;);return n}}var r=t("./isArrayLike");e.exports=i},{"./isArrayLike":177}],93:[function(t,e,n){function i(t){return function(e,n,i){for(var r=-1,o=Object(e),s=i(e),a=s.length;a--;){var c=s[t?a:++r];if(n(o[c],c,o)===!1)break}return e}}e.exports=i},{}],94:[function(t,e,n){function i(t){return function(e){e=a(e);var n=o.test(e)?s(e):void 0,i=n?n[0]:e.charAt(0),c=n?r(n,1).join(""):e.slice(1);return i[t]()+c}}var r=t("./_castSlice"),o=t("./_reHasComplexSymbol"),s=t("./_stringToArray"),a=t("./toString");e.exports=i},{"./_castSlice":75,"./_reHasComplexSymbol":146,"./_stringToArray":156,"./toString":210}],95:[function(t,e,n){function i(t){return function(e,n,i){var a=Object(e);if(n=r(n,3),!o(e))var c=s(e);var u=t(c||e,function(t,e){return c&&(e=t,t=a[e]),n(t,e,a)},i);return u>-1?e[c?c[u]:u]:void 0}}var r=t("./_baseIteratee"),o=t("./isArrayLike"),s=t("./keys");e.exports=i},{"./_baseIteratee":54,"./isArrayLike":177,"./keys":193}],96:[function(t,e,n){var i=t("./_Set"),r=t("./noop"),o=t("./_setToArray"),s=1/0,a=i&&1/o(new i([,-0]))[1]==s?function(t){return new i(t)}:r;e.exports=a},{"./_Set":15,"./_setToArray":150,"./noop":198}],97:[function(t,e,n){function i(t,e,n,i,c,u){var h=c&a,l=t.length,d=e.length;if(l!=d&&!(h&&d>l))return!1;var f=u.get(t);if(f)return f==e;var p=-1,g=!0,m=c&s?new r:void 0;for(u.set(t,e);++p<l;){var v=t[p],y=e[p];if(i)var _=h?i(y,v,p,e,t,u):i(v,y,p,t,e,u);if(void 0!==_){if(_)continue;g=!1;break}if(m){if(!o(e,function(t,e){return m.has(e)||v!==t&&!n(v,t,i,c,u)?void 0:m.add(e)})){g=!1;break}}else if(v!==y&&!n(v,y,i,c,u)){g=!1;break}}return u["delete"](t),g}var r=t("./_SetCache"),o=t("./_arraySome"),s=1,a=2;e.exports=i},{"./_SetCache":16,"./_arraySome":31}],98:[function(t,e,n){function i(t,e,n,i,r,C,S){switch(n){case b:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case x:return!(t.byteLength!=e.byteLength||!i(new o(t),new o(e)));case l:case d:return+t==+e;case f:return t.name==e.name&&t.message==e.message;case g:return t!=+t?e!=+e:t==+e;case m:case y:return t==e+"";case p:var E=a;case v:var N=C&h;if(E||(E=c),t.size!=e.size&&!N)return!1;var P=S.get(t);return P?P==e:(C|=u,S.set(t,e),s(E(t),E(e),i,r,C,S));case _:if(w)return w.call(t)==w.call(e)}return!1}var r=t("./_Symbol"),o=t("./_Uint8Array"),s=t("./_equalArrays"),a=t("./_mapToArray"),c=t("./_setToArray"),u=1,h=2,l="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Map]",g="[object Number]",m="[object RegExp]",v="[object Set]",y="[object String]",_="[object Symbol]",x="[object ArrayBuffer]",b="[object DataView]",C=r?r.prototype:void 0,w=C?C.valueOf:void 0;e.exports=i},{"./_Symbol":18,"./_Uint8Array":19,"./_equalArrays":97,"./_mapToArray":142,"./_setToArray":150}],99:[function(t,e,n){function i(t,e,n,i,a,c){var u=a&s,h=o(t),l=h.length,d=o(e),f=d.length;if(l!=f&&!u)return!1;for(var p=l;p--;){var g=h[p];if(!(u?g in e:r(e,g)))return!1}var m=c.get(t);if(m)return m==e;var v=!0;c.set(t,e);for(var y=u;++p<l;){g=h[p];var _=t[g],x=e[g];if(i)var b=u?i(x,_,g,e,t,c):i(_,x,g,t,e,c);if(!(void 0===b?_===x||n(_,x,i,a,c):b)){v=!1;break}y||(y="constructor"==g)}if(v&&!y){var C=t.constructor,w=e.constructor;C!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof C&&C instanceof C&&"function"==typeof w&&w instanceof w)&&(v=!1)}return c["delete"](t),v}var r=t("./_baseHas"),o=t("./keys"),s=2;e.exports=i},{"./_baseHas":47,"./keys":193}],100:[function(t,e,n){function i(t){return r(t,s,o)}var r=t("./_baseGetAllKeys"),o=t("./_getSymbols"),s=t("./keys");e.exports=i},{"./_baseGetAllKeys":46,"./_getSymbols":107,"./keys":193}],101:[function(t,e,n){function i(t){return r(t,s,o)}var r=t("./_baseGetAllKeys"),o=t("./_getSymbolsIn"),s=t("./keysIn");e.exports=i},{"./_baseGetAllKeys":46,"./_getSymbolsIn":108,"./keysIn":194}],102:[function(t,e,n){var i=t("./_baseProperty"),r=i("length");e.exports=r},{"./_baseProperty":62}],103:[function(t,e,n){function i(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}var r=t("./_isKeyable");e.exports=i},{"./_isKeyable":127}],104:[function(t,e,n){function i(t){for(var e=o(t),n=e.length;n--;){var i=e[n],s=t[i];e[n]=[i,s,r(s)]}return e}var r=t("./_isStrictComparable"),o=t("./keys");e.exports=i},{"./_isStrictComparable":130,"./keys":193}],105:[function(t,e,n){function i(t,e){var n=o(t,e);return r(n)?n:void 0}var r=t("./_baseIsNative"),o=t("./_getValue");e.exports=i},{"./_baseIsNative":53,"./_getValue":110}],106:[function(t,e,n){function i(t){return r(Object(t))}var r=Object.getPrototypeOf;e.exports=i},{}],107:[function(t,e,n){function i(t){return o(Object(t))}var r=t("./stubArray"),o=Object.getOwnPropertySymbols;o||(i=r),e.exports=i},{"./stubArray":205}],108:[function(t,e,n){var i=t("./_arrayPush"),r=t("./_getPrototype"),o=t("./_getSymbols"),s=Object.getOwnPropertySymbols,a=s?function(t){for(var e=[];t;)i(e,o(t)),t=r(t);return e}:o;e.exports=a},{"./_arrayPush":29,"./_getPrototype":106,"./_getSymbols":107}],109:[function(t,e,n){function i(t){return v.call(t)}var r=t("./_DataView"),o=t("./_Map"),s=t("./_Promise"),a=t("./_Set"),c=t("./_WeakMap"),u=t("./_toSource"),h="[object Map]",l="[object Object]",d="[object Promise]",f="[object Set]",p="[object WeakMap]",g="[object DataView]",m=Object.prototype,v=m.toString,y=u(r),_=u(o),x=u(s),b=u(a),C=u(c);(r&&i(new r(new ArrayBuffer(1)))!=g||o&&i(new o)!=h||s&&i(s.resolve())!=d||a&&i(new a)!=f||c&&i(new c)!=p)&&(i=function(t){
var e=v.call(t),n=e==l?t.constructor:void 0,i=n?u(n):void 0;if(i)switch(i){case y:return g;case _:return h;case x:return d;case b:return f;case C:return p}return e}),e.exports=i},{"./_DataView":8,"./_Map":11,"./_Promise":13,"./_Set":15,"./_WeakMap":20,"./_toSource":159}],110:[function(t,e,n){function i(t,e){return null==t?void 0:t[e]}e.exports=i},{}],111:[function(t,e,n){function i(t,e,n){e=c(e,t)?[e]:r(e);for(var i,d=-1,f=e.length;++d<f;){var p=l(e[d]);if(!(i=null!=t&&n(t,p)))break;t=t[p]}if(i)return i;var f=t?t.length:0;return!!f&&u(f)&&a(p,f)&&(s(t)||h(t)||o(t))}var r=t("./_castPath"),o=t("./isArguments"),s=t("./isArray"),a=t("./_isIndex"),c=t("./_isKey"),u=t("./isLength"),h=t("./isString"),l=t("./_toKey");e.exports=i},{"./_castPath":74,"./_isIndex":124,"./_isKey":126,"./_toKey":158,"./isArguments":175,"./isArray":176,"./isLength":183,"./isString":189}],112:[function(t,e,n){function i(){this.__data__=r?r(null):{}}var r=t("./_nativeCreate");e.exports=i},{"./_nativeCreate":144}],113:[function(t,e,n){function i(t){return this.has(t)&&delete this.__data__[t]}e.exports=i},{}],114:[function(t,e,n){function i(t){var e=this.__data__;if(r){var n=e[t];return n===o?void 0:n}return a.call(e,t)?e[t]:void 0}var r=t("./_nativeCreate"),o="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;e.exports=i},{"./_nativeCreate":144}],115:[function(t,e,n){function i(t){var e=this.__data__;return r?void 0!==e[t]:s.call(e,t)}var r=t("./_nativeCreate"),o=Object.prototype,s=o.hasOwnProperty;e.exports=i},{"./_nativeCreate":144}],116:[function(t,e,n){function i(t,e){var n=this.__data__;return n[t]=r&&void 0===e?o:e,this}var r=t("./_nativeCreate"),o="__lodash_hash_undefined__";e.exports=i},{"./_nativeCreate":144}],117:[function(t,e,n){function i(t){var e=t?t.length:void 0;return a(e)&&(s(t)||c(t)||o(t))?r(e,String):null}var r=t("./_baseTimes"),o=t("./isArguments"),s=t("./isArray"),a=t("./isLength"),c=t("./isString");e.exports=i},{"./_baseTimes":67,"./isArguments":175,"./isArray":176,"./isLength":183,"./isString":189}],118:[function(t,e,n){function i(t,e,n){for(var i=t.length,r=e+(n?1:-1);n?r--:++r<i;){var o=t[r];if(o!==o)return r}return-1}e.exports=i},{}],119:[function(t,e,n){function i(t){var e=t.length,n=t.constructor(e);return e&&"string"==typeof t[0]&&o.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var r=Object.prototype,o=r.hasOwnProperty;e.exports=i},{}],120:[function(t,e,n){function i(t,e,n,i){var T=t.constructor;switch(e){case _:return r(t);case l:case d:return new T(+t);case x:return o(t,i);case b:case C:case w:case S:case E:case N:case P:case O:case I:return h(t,i);case f:return s(t,i,n);case p:case v:return new T(t);case g:return a(t);case m:return c(t,i,n);case y:return u(t)}}var r=t("./_cloneArrayBuffer"),o=t("./_cloneDataView"),s=t("./_cloneMap"),a=t("./_cloneRegExp"),c=t("./_cloneSet"),u=t("./_cloneSymbol"),h=t("./_cloneTypedArray"),l="[object Boolean]",d="[object Date]",f="[object Map]",p="[object Number]",g="[object RegExp]",m="[object Set]",v="[object String]",y="[object Symbol]",_="[object ArrayBuffer]",x="[object DataView]",b="[object Float32Array]",C="[object Float64Array]",w="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",N="[object Uint8Array]",P="[object Uint8ClampedArray]",O="[object Uint16Array]",I="[object Uint32Array]";e.exports=i},{"./_cloneArrayBuffer":77,"./_cloneDataView":79,"./_cloneMap":80,"./_cloneRegExp":81,"./_cloneSet":82,"./_cloneSymbol":83,"./_cloneTypedArray":84}],121:[function(t,e,n){function i(t){return"function"!=typeof t.constructor||s(t)?{}:r(o(t))}var r=t("./_baseCreate"),o=t("./_getPrototype"),s=t("./_isPrototype");e.exports=i},{"./_baseCreate":37,"./_getPrototype":106,"./_isPrototype":129}],122:[function(t,e,n){function i(t){return o(t)||r(t)}var r=t("./isArguments"),o=t("./isArray");e.exports=i},{"./isArguments":175,"./isArray":176}],123:[function(t,e,n){function i(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(n){}return e}e.exports=i},{}],124:[function(t,e,n){function i(t,e){return e=null==e?r:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&e>t}var r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=i},{}],125:[function(t,e,n){function i(t,e,n){if(!a(n))return!1;var i=typeof e;return("number"==i?o(n)&&s(e,n.length):"string"==i&&e in n)?r(n[e],t):!1}var r=t("./eq"),o=t("./isArrayLike"),s=t("./_isIndex"),a=t("./isObject");e.exports=i},{"./_isIndex":124,"./eq":165,"./isArrayLike":177,"./isObject":186}],126:[function(t,e,n){function i(t,e){if(r(t))return!1;var n=typeof t;return"number"==n||"symbol"==n||"boolean"==n||null==t||o(t)?!0:a.test(t)||!s.test(t)||null!=e&&t in Object(e)}var r=t("./isArray"),o=t("./isSymbol"),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=i},{"./isArray":176,"./isSymbol":190}],127:[function(t,e,n){function i(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}e.exports=i},{}],128:[function(t,e,n){function i(t){return!!o&&o in t}var r=t("./_coreJsData"),o=function(){var t=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();e.exports=i},{"./_coreJsData":90}],129:[function(t,e,n){function i(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||r;return t===n}var r=Object.prototype;e.exports=i},{}],130:[function(t,e,n){function i(t){return t===t&&!r(t)}var r=t("./isObject");e.exports=i},{"./isObject":186}],131:[function(t,e,n){function i(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}e.exports=i},{}],132:[function(t,e,n){function i(){this.__data__=[]}e.exports=i},{}],133:[function(t,e,n){function i(t){var e=this.__data__,n=r(e,t);if(0>n)return!1;var i=e.length-1;return n==i?e.pop():s.call(e,n,1),!0}var r=t("./_assocIndexOf"),o=Array.prototype,s=o.splice;e.exports=i},{"./_assocIndexOf":33}],134:[function(t,e,n){function i(t){var e=this.__data__,n=r(e,t);return 0>n?void 0:e[n][1]}var r=t("./_assocIndexOf");e.exports=i},{"./_assocIndexOf":33}],135:[function(t,e,n){function i(t){return r(this.__data__,t)>-1}var r=t("./_assocIndexOf");e.exports=i},{"./_assocIndexOf":33}],136:[function(t,e,n){function i(t,e){var n=this.__data__,i=r(n,t);return 0>i?n.push([t,e]):n[i][1]=e,this}var r=t("./_assocIndexOf");e.exports=i},{"./_assocIndexOf":33}],137:[function(t,e,n){function i(){this.__data__={hash:new r,map:new(s||o),string:new r}}var r=t("./_Hash"),o=t("./_ListCache"),s=t("./_Map");e.exports=i},{"./_Hash":9,"./_ListCache":10,"./_Map":11}],138:[function(t,e,n){function i(t){return r(this,t)["delete"](t)}var r=t("./_getMapData");e.exports=i},{"./_getMapData":103}],139:[function(t,e,n){function i(t){return r(this,t).get(t)}var r=t("./_getMapData");e.exports=i},{"./_getMapData":103}],140:[function(t,e,n){function i(t){return r(this,t).has(t)}var r=t("./_getMapData");e.exports=i},{"./_getMapData":103}],141:[function(t,e,n){function i(t,e){return r(this,t).set(t,e),this}var r=t("./_getMapData");e.exports=i},{"./_getMapData":103}],142:[function(t,e,n){function i(t){var e=-1,n=Array(t.size);return t.forEach(function(t,i){n[++e]=[i,t]}),n}e.exports=i},{}],143:[function(t,e,n){function i(t,e){return function(n){return null==n?!1:n[t]===e&&(void 0!==e||t in Object(n))}}e.exports=i},{}],144:[function(t,e,n){var i=t("./_getNative"),r=i(Object,"create");e.exports=r},{"./_getNative":105}],145:[function(t,e,n){function i(t,e){return 1==e.length?t:r(t,o(e,0,-1))}var r=t("./_baseGet"),o=t("./_baseSlice");e.exports=i},{"./_baseGet":45,"./_baseSlice":65}],146:[function(t,e,n){var i="\\ud800-\\udfff",r="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",s="\\ufe0e\\ufe0f",a="\\u200d",c=RegExp("["+a+i+r+o+s+"]");e.exports=c},{}],147:[function(t,e,n){(function(n){var i=t("./_checkGlobal"),r=i("object"==typeof n&&n),o=i("object"==typeof self&&self),s=i("object"==typeof this&&this),a=r||o||s||Function("return this")();e.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_checkGlobal":76}],148:[function(t,e,n){function i(t){return this.__data__.set(t,r),this}var r="__lodash_hash_undefined__";e.exports=i},{}],149:[function(t,e,n){function i(t){return this.__data__.has(t)}e.exports=i},{}],150:[function(t,e,n){function i(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}e.exports=i},{}],151:[function(t,e,n){function i(){this.__data__=new r}var r=t("./_ListCache");e.exports=i},{"./_ListCache":10}],152:[function(t,e,n){function i(t){return this.__data__["delete"](t)}e.exports=i},{}],153:[function(t,e,n){function i(t){return this.__data__.get(t)}e.exports=i},{}],154:[function(t,e,n){function i(t){return this.__data__.has(t)}e.exports=i},{}],155:[function(t,e,n){function i(t,e){var n=this.__data__;return n instanceof r&&n.__data__.length==s&&(n=this.__data__=new o(n.__data__)),n.set(t,e),this}var r=t("./_ListCache"),o=t("./_MapCache"),s=200;e.exports=i},{"./_ListCache":10,"./_MapCache":12}],156:[function(t,e,n){function i(t){return t.match(b)}var r="\\ud800-\\udfff",o="\\u0300-\\u036f\\ufe20-\\ufe23",s="\\u20d0-\\u20f0",a="\\ufe0e\\ufe0f",c="["+r+"]",u="["+o+s+"]",h="\\ud83c[\\udffb-\\udfff]",l="(?:"+u+"|"+h+")",d="[^"+r+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",g="\\u200d",m=l+"?",v="["+a+"]?",y="(?:"+g+"(?:"+[d,f,p].join("|")+")"+v+m+")*",_=v+m+y,x="(?:"+[d+u+"?",u,f,p,c].join("|")+")",b=RegExp(h+"(?="+h+")|"+x+_,"g");e.exports=i},{}],157:[function(t,e,n){var i=t("./memoize"),r=t("./toString"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,s=/\\(\\)?/g,a=i(function(t){var e=[];return r(t).replace(o,function(t,n,i,r){e.push(i?r.replace(s,"$1"):n||t)}),e});e.exports=a},{"./memoize":197,"./toString":210}],158:[function(t,e,n){function i(t){if("string"==typeof t||r(t))return t;var e=t+"";return"0"==e&&1/t==-o?"-0":e}var r=t("./isSymbol"),o=1/0;e.exports=i},{"./isSymbol":190}],159:[function(t,e,n){function i(t){if(null!=t){try{return r.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var r=Function.prototype.toString;e.exports=i},{}],160:[function(t,e,n){var i=t("./_assignValue"),r=t("./_copyObject"),o=t("./_createAssigner"),s=t("./isArrayLike"),a=t("./_isPrototype"),c=t("./keysIn"),u=Object.prototype,h=u.propertyIsEnumerable,l=!h.call({valueOf:1},"valueOf"),d=o(function(t,e){if(l||a(e)||s(e))return void r(e,c(e),t);for(var n in e)i(t,n,e[n])});e.exports=d},{"./_assignValue":32,"./_copyObject":88,"./_createAssigner":91,"./_isPrototype":129,"./isArrayLike":177,"./keysIn":194}],161:[function(t,e,n){function i(t){return o(r(t).toLowerCase())}var r=t("./toString"),o=t("./upperFirst");e.exports=i},{"./toString":210,"./upperFirst":213}],162:[function(t,e,n){function i(t){return r(t,!1,!0)}var r=t("./_baseClone");e.exports=i},{"./_baseClone":36}],163:[function(t,e,n){function i(t){return r(t,!0,!0)}var r=t("./_baseClone");e.exports=i},{"./_baseClone":36}],164:[function(t,e,n){e.exports=t("./forEach")},{"./forEach":170}],165:[function(t,e,n){function i(t,e){return t===e||t!==t&&e!==e}e.exports=i},{}],166:[function(t,e,n){e.exports=t("./assignIn")},{"./assignIn":160}],167:[function(t,e,n){function i(t,e){var n=a(t)?r:o;return n(t,s(e,3))}var r=t("./_arrayFilter"),o=t("./_baseFilter"),s=t("./_baseIteratee"),a=t("./isArray");e.exports=i},{"./_arrayFilter":25,"./_baseFilter":40,"./_baseIteratee":54,"./isArray":176}],168:[function(t,e,n){var i=t("./_createFind"),r=t("./findIndex"),o=i(r);e.exports=o},{"./_createFind":95,"./findIndex":169}],169:[function(t,e,n){function i(t,e,n){var i=t?t.length:0;if(!i)return-1;var c=null==n?0:s(n);return 0>c&&(c=a(i+c,0)),r(t,o(e,3),c)}var r=t("./_baseFindIndex"),o=t("./_baseIteratee"),s=t("./toInteger"),a=Math.max;e.exports=i},{"./_baseFindIndex":41,"./_baseIteratee":54,"./toInteger":208}],170:[function(t,e,n){function i(t,e){var n=a(t)?r:o;return n(t,s(e,3))}var r=t("./_arrayEach"),o=t("./_baseEach"),s=t("./_baseIteratee"),a=t("./isArray");e.exports=i},{"./_arrayEach":24,"./_baseEach":39,"./_baseIteratee":54,"./isArray":176}],171:[function(t,e,n){function i(t,e,n){var i=null==t?void 0:r(t,e);return void 0===i?n:i}var r=t("./_baseGet");e.exports=i},{"./_baseGet":45}],172:[function(t,e,n){function i(t,e){return null!=t&&o(t,e,r)}var r=t("./_baseHasIn"),o=t("./_hasPath");e.exports=i},{"./_baseHasIn":48,"./_hasPath":111}],173:[function(t,e,n){function i(t){return t}e.exports=i},{}],174:[function(t,e,n){function i(t,e,n,i){t=o(t)?t:c(t),n=n&&!i?a(n):0;var h=t.length;return 0>n&&(n=u(h+n,0)),s(t)?h>=n&&t.indexOf(e,n)>-1:!!h&&r(t,e,n)>-1}var r=t("./_baseIndexOf"),o=t("./isArrayLike"),s=t("./isString"),a=t("./toInteger"),c=t("./values"),u=Math.max;e.exports=i},{"./_baseIndexOf":49,"./isArrayLike":177,"./isString":189,"./toInteger":208,"./values":214}],175:[function(t,e,n){function i(t){return r(t)&&a.call(t,"callee")&&(!u.call(t,"callee")||c.call(t)==o)}var r=t("./isArrayLikeObject"),o="[object Arguments]",s=Object.prototype,a=s.hasOwnProperty,c=s.toString,u=s.propertyIsEnumerable;e.exports=i},{"./isArrayLikeObject":178}],176:[function(t,e,n){var i=Array.isArray;e.exports=i},{}],177:[function(t,e,n){function i(t){return null!=t&&s(r(t))&&!o(t)}var r=t("./_getLength"),o=t("./isFunction"),s=t("./isLength");e.exports=i},{"./_getLength":102,"./isFunction":182,"./isLength":183}],178:[function(t,e,n){function i(t){return o(t)&&r(t)}var r=t("./isArrayLike"),o=t("./isObjectLike");e.exports=i},{"./isArrayLike":177,"./isObjectLike":187}],179:[function(t,e,n){function i(t){return t===!0||t===!1||r(t)&&a.call(t)==o}var r=t("./isObjectLike"),o="[object Boolean]",s=Object.prototype,a=s.toString;e.exports=i},{"./isObjectLike":187}],180:[function(t,e,n){var i=t("./_root"),r=t("./stubFalse"),o="object"==typeof n&&n,s=o&&"object"==typeof e&&e,a=s&&s.exports===o,c=a?i.Buffer:void 0,u=c?function(t){return t instanceof c}:r;e.exports=u},{"./_root":147,"./stubFalse":206}],181:[function(t,e,n){function i(t,e){return r(t,e)}var r=t("./_baseIsEqual");e.exports=i},{"./_baseIsEqual":50}],182:[function(t,e,n){function i(t){var e=r(t)?c.call(t):"";return e==o||e==s}var r=t("./isObject"),o="[object Function]",s="[object GeneratorFunction]",a=Object.prototype,c=a.toString;e.exports=i},{"./isObject":186}],183:[function(t,e,n){function i(t){return"number"==typeof t&&t>-1&&t%1==0&&r>=t}var r=9007199254740991;e.exports=i},{}],184:[function(t,e,n){function i(t,e){return t===e||r(t,e,o(e))}var r=t("./_baseIsMatch"),o=t("./_getMatchData");e.exports=i},{"./_baseIsMatch":52,"./_getMatchData":104}],185:[function(t,e,n){function i(t){return"number"==typeof t||r(t)&&a.call(t)==o}var r=t("./isObjectLike"),o="[object Number]",s=Object.prototype,a=s.toString;e.exports=i},{"./isObjectLike":187}],186:[function(t,e,n){function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=i},{}],187:[function(t,e,n){function i(t){return!!t&&"object"==typeof t}e.exports=i},{}],188:[function(t,e,n){function i(t){if(!s(t)||d.call(t)!=a||o(t))return!1;var e=r(t);if(null===e)return!0;var n=h.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==l}var r=t("./_getPrototype"),o=t("./_isHostObject"),s=t("./isObjectLike"),a="[object Object]",c=Object.prototype,u=Function.prototype.toString,h=c.hasOwnProperty,l=u.call(Object),d=c.toString;e.exports=i},{"./_getPrototype":106,"./_isHostObject":123,"./isObjectLike":187}],189:[function(t,e,n){function i(t){return"string"==typeof t||!r(t)&&o(t)&&c.call(t)==s}var r=t("./isArray"),o=t("./isObjectLike"),s="[object String]",a=Object.prototype,c=a.toString;e.exports=i},{"./isArray":176,"./isObjectLike":187}],190:[function(t,e,n){function i(t){return"symbol"==typeof t||r(t)&&a.call(t)==o}var r=t("./isObjectLike"),o="[object Symbol]",s=Object.prototype,a=s.toString;e.exports=i},{"./isObjectLike":187}],191:[function(t,e,n){function i(t){return o(t)&&r(t.length)&&!!T[D.call(t)]}var r=t("./isLength"),o=t("./isObjectLike"),s="[object Arguments]",a="[object Array]",c="[object Boolean]",u="[object Date]",h="[object Error]",l="[object Function]",d="[object Map]",f="[object Number]",p="[object Object]",g="[object RegExp]",m="[object Set]",v="[object String]",y="[object WeakMap]",_="[object ArrayBuffer]",x="[object DataView]",b="[object Float32Array]",C="[object Float64Array]",w="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",N="[object Uint8Array]",P="[object Uint8ClampedArray]",O="[object Uint16Array]",I="[object Uint32Array]",T={};T[b]=T[C]=T[w]=T[S]=T[E]=T[N]=T[P]=T[O]=T[I]=!0,T[s]=T[a]=T[_]=T[c]=T[x]=T[u]=T[h]=T[l]=T[d]=T[f]=T[p]=T[g]=T[m]=T[v]=T[y]=!1;var A=Object.prototype,D=A.toString;e.exports=i},{"./isLength":183,"./isObjectLike":187}],192:[function(t,e,n){function i(t){return void 0===t}e.exports=i},{}],193:[function(t,e,n){function i(t){var e=u(t);if(!e&&!a(t))return o(t);var n=s(t),i=!!n,h=n||[],l=h.length;for(var d in t)!r(t,d)||i&&("length"==d||c(d,l))||e&&"constructor"==d||h.push(d);return h}var r=t("./_baseHas"),o=t("./_baseKeys"),s=t("./_indexKeys"),a=t("./isArrayLike"),c=t("./_isIndex"),u=t("./_isPrototype");e.exports=i},{"./_baseHas":47,"./_baseKeys":55,"./_indexKeys":117,"./_isIndex":124,"./_isPrototype":129,"./isArrayLike":177}],194:[function(t,e,n){function i(t){for(var e=-1,n=a(t),i=r(t),c=i.length,h=o(t),l=!!h,d=h||[],f=d.length;++e<c;){var p=i[e];l&&("length"==p||s(p,f))||"constructor"==p&&(n||!u.call(t,p))||d.push(p)}return d}var r=t("./_baseKeysIn"),o=t("./_indexKeys"),s=t("./_isIndex"),a=t("./_isPrototype"),c=Object.prototype,u=c.hasOwnProperty;e.exports=i},{"./_baseKeysIn":56,"./_indexKeys":117,"./_isIndex":124,"./_isPrototype":129}],195:[function(t,e,n){function i(t){var e=t?t.length:0;return e?t[e-1]:void 0}e.exports=i},{}],196:[function(t,e,n){function i(t,e){var n=a(t)?r:s;return n(t,o(e,3))}var r=t("./_arrayMap"),o=t("./_baseIteratee"),s=t("./_baseMap"),a=t("./isArray");e.exports=i},{"./_arrayMap":28,"./_baseIteratee":54,"./_baseMap":57,"./isArray":176}],197:[function(t,e,n){function i(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(o);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=t.apply(this,i);return n.cache=o.set(r,s),s};return n.cache=new(i.Cache||r),n}var r=t("./_MapCache"),o="Expected a function";i.Cache=r,e.exports=i},{"./_MapCache":12}],198:[function(t,e,n){function i(){}e.exports=i},{}],199:[function(t,e,n){var i=t("./_arrayMap"),r=t("./_baseDifference"),o=t("./_baseFlatten"),s=t("./_basePick"),a=t("./_getAllKeysIn"),c=t("./rest"),u=t("./_toKey"),h=c(function(t,e){return null==t?{}:(e=i(o(e,1),u),s(t,r(a(t),e)))});e.exports=h},{"./_arrayMap":28,"./_baseDifference":38,"./_baseFlatten":42,"./_basePick":61,"./_getAllKeysIn":101,"./_toKey":158,"./rest":202}],200:[function(t,e,n){function i(t,e,n,i){return null==t?[]:(o(e)||(e=null==e?[]:[e]),n=i?void 0:n,o(n)||(n=null==n?[]:[n]),r(t,e,n))}var r=t("./_baseOrderBy"),o=t("./isArray");e.exports=i},{"./_baseOrderBy":60,"./isArray":176}],201:[function(t,e,n){function i(t){return s(t)?r(a(t)):o(t)}var r=t("./_baseProperty"),o=t("./_basePropertyDeep"),s=t("./_isKey"),a=t("./_toKey");e.exports=i},{"./_baseProperty":62,"./_basePropertyDeep":63,"./_isKey":126,"./_toKey":158}],202:[function(t,e,n){function i(t,e){if("function"!=typeof t)throw new TypeError(s);return e=a(void 0===e?t.length-1:o(e),0),function(){for(var n=arguments,i=-1,o=a(n.length-e,0),s=Array(o);++i<o;)s[i]=n[e+i];switch(e){case 0:return t.call(this,s);case 1:return t.call(this,n[0],s);case 2:return t.call(this,n[0],n[1],s)}var c=Array(e+1);for(i=-1;++i<e;)c[i]=n[i];return c[e]=s,r(t,this,c)}}var r=t("./_apply"),o=t("./toInteger"),s="Expected a function",a=Math.max;e.exports=i},{"./_apply":23,"./toInteger":208}],203:[function(t,e,n){function i(t,e,n,i){return i="function"==typeof i?i:void 0,null==t?t:r(t,e,n,i)}var r=t("./_baseSet");e.exports=i},{"./_baseSet":64}],204:[function(t,e,n){function i(t,e,n){return t=a(t),n=r(s(n),0,t.length),t.lastIndexOf(o(e),n)==n}var r=t("./_baseClamp"),o=t("./_baseToString"),s=t("./toInteger"),a=t("./toString");e.exports=i},{"./_baseClamp":35,"./_baseToString":68,"./toInteger":208,"./toString":210}],205:[function(t,e,n){function i(){return[]}e.exports=i},{}],206:[function(t,e,n){function i(){return!1}e.exports=i},{}],207:[function(t,e,n){function i(t){if(!t)return 0===t?t:0;if(t=r(t),t===o||t===-o){var e=0>t?-1:1;return e*s}return t===t?t:0}var r=t("./toNumber"),o=1/0,s=1.7976931348623157e308;e.exports=i},{"./toNumber":209}],208:[function(t,e,n){function i(t){var e=r(t),n=e%1;return e===e?n?e-n:e:0}var r=t("./toFinite");e.exports=i},{"./toFinite":207}],209:[function(t,e,n){function i(t){if("number"==typeof t)return t;if(s(t))return a;if(o(t)){var e=r(t.valueOf)?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(c,"");var n=h.test(t);return n||l.test(t)?d(t.slice(2),n?2:8):u.test(t)?a:+t}var r=t("./isFunction"),o=t("./isObject"),s=t("./isSymbol"),a=NaN,c=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,d=parseInt;e.exports=i},{"./isFunction":182,"./isObject":186,"./isSymbol":190}],210:[function(t,e,n){function i(t){return null==t?"":r(t)}var r=t("./_baseToString");e.exports=i},{"./_baseToString":68}],211:[function(t,e,n){function i(t){return t&&t.length?r(t):[]}var r=t("./_baseUniq");e.exports=i},{"./_baseUniq":70}],212:[function(t,e,n){function i(t,e){return null==t?!0:r(t,e)}var r=t("./_baseUnset");e.exports=i},{"./_baseUnset":71}],213:[function(t,e,n){var i=t("./_createCaseFirst"),r=i("toUpperCase");e.exports=r},{"./_createCaseFirst":94}],214:[function(t,e,n){function i(t){return t?r(t,o(t)):[]}var r=t("./_baseValues"),o=t("./keys");e.exports=i},{"./_baseValues":72,"./keys":193}],215:[function(t,e,n){var i=t("./_baseDifference"),r=t("./isArrayLikeObject"),o=t("./rest"),s=o(function(t,e){return r(t)?i(t,e):[]});e.exports=s},{"./_baseDifference":38,"./isArrayLikeObject":178,"./rest":202}],216:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Coordinate");i.Prototype=function(){this.isAnchor=function(){return!0}},r.extend(i),e.exports=i},{"./Coordinate":226}],217:[function(t,e,n){"use strict";function i(t){this.doc=t,this.byPath=new o.Arrays,this.byId={}}var r=t("lodash/filter"),o=t("../util/TreeIndex"),s=t("./DocumentIndex");i.Prototype=function(){this.select=function(t){return t._isContainerAnnotation},this.reset=function(t){this.byPath.clear(),this.byId={},this._initialize(t)},this.get=function(t,e){var n=this.byPath.getAll(t);return e?r(n,function(t){return t.containerId===e}):n.slice(0)},this.create=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.add(e.path,e),this.byPath.add(n.path,n),this.byId[t.id]=t},this["delete"]=function(t){var e=t.getStartAnchor(),n=t.getEndAnchor();this.byPath.remove(e.path,e),this.byPath.remove(n.path,n),delete this.byId[t.id]},this.update=function(t,e,n,i){if(this.select(t)){var r=null;if("startPath"===e[1])r=t.getStartAnchor();else{if("endPath"!==e[1])return;r=t.getEndAnchor()}this.byPath.remove(i,r),this.byPath.add(r.path,r)}}},s.extend(i),e.exports=i},{"../util/TreeIndex":369,"./DocumentIndex":233,"lodash/filter":167}],218:[function(t,e,n){"use strict";e.exports=t("./PropertyAnnotation")},{"./PropertyAnnotation":247}],219:[function(t,e,n){"use strict";function i(){this.byPath=new c,this.byType=new c}var r=t("lodash/isString"),o=t("lodash/isNumber"),s=t("lodash/map"),a=t("lodash/filter"),c=t("../util/TreeIndex"),u=t("./DocumentIndex");i.Prototype=function(){this.property="path",this.select=function(t){return Boolean(t._isPropertyAnnotation)},this.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},this.get=function(t,e,n,c){var h;return h=r(t)||1===t.length?this.byPath.getAll(t)||{}:this.byPath.get(t),h=s(h),o(e)&&(h=a(h,i.filterByRange(e,n))),c&&(h=a(h,u.filterByType(c))),h},this.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.path.concat([t.id]),t)},this["delete"]=function(t){this.byType["delete"]([t.type,t.id]),this.byPath["delete"](t.path.concat([t.id]))},this.update=function(t,e,n,i){this.select(t)&&e[1]===this.property&&(this["delete"]({id:t.id,type:t.type,path:i}),this.create(t))}},u.extend(i),i.filterByRange=function(t,e){return function(n){var i=n.startOffset,r=n.endOffset,s=r>=t;return o(e)&&(s=s&&e>=i),s}},e.exports=i},{"../util/TreeIndex":369,"./DocumentIndex":233,"lodash/filter":167,"lodash/isNumber":185,"lodash/isString":189,"lodash/map":196}],220:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./DocumentNode");r.extend(i),i["static"].isBlock=!0,e.exports=i},{"./DocumentNode":234}],221:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.document&&!this.document.isTransactionDocument&&this.document.on("document:changed",this._onChange,this)}var r=t("lodash/extend"),o=t("lodash/isNumber"),s=t("lodash/isString"),a=t("./DocumentNode"),c=t("./ParentNodeMixin"),u=t("./ContainerAddress");i.Prototype=function(){this._isContainer=!0,r(this,c),this.dispose=function(){this.document.off(this)},this.getPosition=function(t){if(this.document&&this.document.isTransactionDocument)return this.nodes.indexOf(t);var e=this._getCachedPositions(),n=e[t];return void 0===n&&(n=-1),n},this.getNodes=function(){var t=this.getDocument(),e=[];return this.nodes.forEach(function(n){var i=t.get(n);i?e.push(i):console.error("Node does not exist: ",n)}),e},this.getNodeAt=function(t){return this.getDocument().get(this.nodes[t])},this.show=function(t,e){var n=this.getDocument(),i=arguments[0];s(i)||i._isNode&&(t=i.id),o(e)||(e=this.nodes.length),n.update(this.getContentPath(),{insert:{offset:e,value:t}})},this.hide=function(t){var e=this.getDocument(),n=this.nodes.indexOf(t);n>=0&&e.update(this.getContentPath(),{"delete":{offset:n}})},this.getAddress=function(t){if(!t._isCoordinate)throw new Error("Illegal argument: Container.getAddress(coor) expects a Coordinate instance.");var e,n=t.path[0],i=this.getPosition(n);return e=t.isNodeCoordinate()?t.offset>0?Number.MAX_VALUE:0:t.offset,new u(i,e)},this.getChildrenProperty=function(){return"nodes"},this.getLength=function(){return this.nodes.length},this._onChange=function(t){t.isUpdated(this.getContentPath())&&(this.positions=null)},this._getCachedPositions=function(){if(!this.positions){var t={};this.nodes.forEach(function(e,n){t[e]=n}),this.positions=t}return this.positions},this.getContentPath=function(){return[this.id,"nodes"]}},a.extend(i),i["static"].name="container",i["static"].defineSchema({nodes:{type:["id"],"default":[]}}),Object.defineProperty(i.prototype,"length",{get:function(){return console.warn("DEPRECATED: want to get rid of unnecessary properties. Use this.getLength() instead."),this.nodes.length}}),e.exports=i},{"./ContainerAddress":222,"./DocumentNode":234,"./ParentNodeMixin":245,"lodash/extend":166,"lodash/isNumber":185,"lodash/isString":189}],222:[function(t,e,n){"use strict";function i(t,e){this.pos=t,this.offset=e}var r=t("../util/oo");i.Prototype=function(){this.isBefore=function(t,e){return e=Boolean(e),this.pos<t.pos?!0:this.pos>t.pos?!1:this.offset<t.offset?!0:this.offset>t.offset?!1:!e},this.isAfter=function(t,e){return t.isBefore(this,e)},this.isEqual=function(t){return this.pos===t.pos&&this.offset===t.offset},this.toString=function(){return[this.pos,".",this.offset].join("")}},r.initClass(i),e.exports=i},{"../util/oo":379}],223:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("lodash/isEqual"),o=t("lodash/last"),s=t("lodash/each"),a=t("../util/EventEmitter"),c=t("./DocumentNode"),u=t("./Selection"),h=t("./Anchor"),l=t("./documentHelpers");i.Prototype=function(){this._isAnnotation=!0,this._isContainerAnnotation=!0,this.getText=function(){var t=this.getDocument();return t?l.getTextForSelection(t,this.getSelection()):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),"")},this.getSelection=function(){var t=this.getDocument();return t?t.createSelection({type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),u.nullSelection())},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlighted=t,this.highlightedScope=e,this.emit("highlighted",t,e),s(this.fragments,function(n){n.emit("highlighted",t,e)}))},this.updateRange=function(t,e){if(!e.isContainerSelection())throw new Error("Cannot change to ContainerAnnotation.");r(this.startPath,e.start.path)||t.set([this.id,"startPath"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),r(this.endPath,e.end.path)||t.set([this.id,"endPath"],e.end.path),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)},this.getFragments=function(){var t=[],e=this.getDocument(),n=e.get(this.containerId),r=n.getPathRange(this.startPath,this.endPath);if(1===r.length)t.push(new i.Fragment(this,r[0],"property"));else if(r.length>1){t.push(new i.Fragment(this,r[0],"start")),t.push(new i.Fragment(this,o(r),"end"));for(var s=1;s<r.length-1;s++)t.push(new i.Fragment(this,r[s],"inner"))}return t},this.getStartAnchor=function(){return this._startAnchor||(this._startAnchor=new i.Anchor(this,"isStart")),this._startAnchor},this.getEndAnchor=function(){return this._endAnchor||(this._endAnchor=new i.Anchor(this)),this._endAnchor}},c.extend(i),i["static"].name="container-annotation",i["static"].defineSchema({containerId:"string",startPath:["string"],startOffset:"number",endPath:["string"],endOffset:"number"}),i["static"].isContainerAnnotation=!0,i.Anchor=function(t,e){a.call(this),this.type="container-annotation-anchor",this.anno=t,this.node=t,this.id=t.id,this.containerId=t.containerId,this.isStart=Boolean(e),Object.freeze(this)},i.Anchor.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getPath=function(){return this.isStart?this.node.startPath:this.node.endPath},this.getOffset=function(){return this.isStart?this.node.startOffset:this.node.endOffset}},h.extend(i.Anchor,a.prototype),Object.defineProperties(i.Anchor.prototype,{path:{get:function(){return this.getPath()}},offset:{get:function(){return this.getOffset()}}}),i.Fragment=function(t,e,n){a.call(this),this.type="container-annotation-fragment",this.anno=t,this.id=t.id,this.path=e,this.mode=n},i.Fragment.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getStartOffset=function(){return"start"===this.mode||"property"===this.mode?this.anno.startOffset:0},this.getEndOffset=function(){var t=this.anno.getDocument(),e=t.get(this.path),n=e.length;return"end"===this.mode||"property"===this.mode?this.anno.endOffset:n}},a.extend(i.Fragment),i.Fragment["static"].fragmentation=Number.MAX_VALUE,Object.defineProperties(i.Fragment.prototype,{startOffset:{get:function(){return this.getStartOffset()},set:function(){throw new Error("ContainerAnnotation.Fragment.startOffset is read-only.")}},endOffset:{get:function(){return this.getEndOffset()},set:function(){throw new Error("ContainerAnnotation.Fragment.endOffset is read-only.")}},highlighted:{get:function(){return this.anno.highlighted},set:function(){throw new Error("ContainerAnnotation.Fragment.highlighted is read-only.")}}}),e.exports=i},{"../util/EventEmitter":367,"./Anchor":216,"./DocumentNode":234,"./Selection":250,"./documentHelpers":272,"lodash/each":164,"lodash/isEqual":181,"lodash/last":195}],224:[function(t,e,n){"use strict";function i(){this.byId=new a}var r=t("lodash/isString"),o=t("lodash/map"),s=t("lodash/filter"),a=t("../util/TreeIndex"),c=t("./DocumentIndex");i.Prototype=function(){this.select=function(t){return Boolean(t._isContainerAnnotation)},this.reset=function(t){this.byId.clear(),this._initialize(t)},this.get=function(t,e){var n=o(this.byId.get(t));return r(e)&&(n=s(n,c.filterByType)),n},this.create=function(t){
this.byId.set([t.containerId,t.id],t)},this["delete"]=function(t){this.byId["delete"]([t.containerId,t.id])},this.update=function(t,e,n,i){}},c.extend(i),e.exports=i},{"../util/TreeIndex":369,"./DocumentIndex":233,"lodash/filter":167,"lodash/isString":189,"lodash/map":196}],225:[function(t,e,n){"use strict";function i(t,e,n,i,o,a,h){if(s.call(this),this.containerId=t,this.startPath=e,this.startOffset=n,this.endPath=i,this.endOffset=o,this.reverse=Boolean(a),this.surfaceId=h,!(this.containerId&&this.startPath&&r(this.startOffset)&&this.endPath&&r(this.endOffset)))throw new Error("Invalid arguments: `containerId`, `startPath`, `startOffset`, `endPath`, and `endOffset` are mandatory");this._internal.start=new c(this,"startPath","startOffset"),this._internal.end=new c(this,"endPath","endOffset"),this._internal.range=new u(this)}var r=t("lodash/isNumber"),o=t("./Coordinate"),s=t("./Selection"),a=t("./PropertySelection"),c=a.CoordinateAdapter,u=a.RangeAdapter;i.Prototype=function(){function t(t,e,n){var r=new i(t.containerId,e.path,e.offset,n.path,n.offset,!1,t.surfaceId),o=t._internal.doc;return o&&r.attach(o),r}this.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset,reverse:this.reverse,surfaceId:this.surfaceId}},this._isContainerSelection=!0,this.isContainerSelection=function(){return!0},this.getType=function(){return"container"},this.isNull=function(){return!1},this.isCollapsed=function(){return this.start.equals(this.end)},this.isReverse=function(){return this.reverse},this.equals=function(t){return s.prototype.equals.call(this,t)&&this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return["ContainerSelection(",this.containerId,", ",JSON.stringify(this.startPath),", ",this.startOffset," -> ",JSON.stringify(this.startPath),", ",this.endOffset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},this.getContainer=function(){return this._internal.container||(this._internal.container=this.getDocument().get(this.containerId)),this._internal.container},this.isInsideOf=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),i=this._range(t);return i.start.isBefore(n.start,e)&&n.end.isBefore(i.end,e)},this.contains=function(t,e){if(t.isNull())return!1;e=Boolean(e);var n=this._range(this),i=this._range(t);return n.start.isBefore(i.start,e)&&i.end.isBefore(n.end,e)},this.containsNodeFragment=function(t,e){var n=this.getContainer(),i=new o([t],0),r=n.getAddress(i),s=this._range(this),a=s.start.isBefore(r,e);return a&&(r.offset=1,a=s.end.isAfter(r,e)),a},this.overlaps=function(t){var e=this._range(this),n=this._range(t);return!(e.end.isBefore(n.start,!1)||n.end.isBefore(e.start,!1))},this.isLeftAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.start.isEqual(n.start)},this.isRightAlignedWith=function(t){var e=this._range(this),n=this._range(t);return e.end.isEqual(n.end)},this.containsNode=function(t){var e=this.getContainer(),n=e.getPosition(this.startPath[0]),i=e.getPosition(this.endPath[0]),r=e.getPosition(t);return!(n>r||r>i||n===r&&1===this.startPath.length&&this.startOffset>0||i===r&&1===this.endPath.length&&this.endOffset<1)},this.collapse=function(e){var n;return n="left"===e?this.start:this.end,t(this,n,n)},this.expand=function(e){var n,i,r=this._range(this),s=this._range(e);return n=r.start.isEqual(s.start)?new o(this.start.path,Math.min(this.start.offset,e.start.offset)):r.start.isAfter(s.start)?new o(e.start.path,e.start.offset):this.start,i=r.end.isEqual(s.end)?new o(this.end.path,Math.max(this.end.offset,e.end.offset)):r.end.isBefore(s.end,!1)?new o(e.end.path,e.end.offset):this.end,t(this,n,i)},this.truncateWith=function(e){if(e.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(e))return this;var n,i,r=this._range(this),o=this._range(e);if(o.start.isBefore(r.start,"strict")&&o.end.isBefore(r.end,"strict"))n=e.end,i=this.end;else if(r.start.isBefore(o.start,"strict")&&r.end.isBefore(o.end,"strict"))n=this.start,i=e.start;else if(r.start.isEqual(o.start)){if(!o.end.isBefore(r.end,"strict"))return s.nullSelection;n=e.end,i=this.end}else{if(!r.end.isEqual(o.end)){if(this.isInsideOf(e))return s.nullSelection;throw new Error("Could not determine coordinates for truncate. Check input")}if(!r.start.isBefore(o.start,"strict"))return s.nullSelection;n=this.start,i=e.start}return t(this,n,i)},this.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var t,e,n,i,r,o,a,c=[],u=this.getDocument(),h=this.getContainer(),l=h.getPosition(this.startPath[0]),d=h.getPosition(this.endPath[0]);if(l!==d){if(t=this.start,r=t.path,o=t.offset,n=r[0],e=u.get(n),!e)throw new Error("Node does not exist:"+n);t.isPropertyCoordinate()?(a=u.get(r),i=new s.Fragment(r,o,a.length,0===o),c.push(i)):t.isNodeCoordinate()&&0===o&&c.push(new s.NodeFragment(e.id));for(var f=l+1;d>f;f++)e=h.getChildAt(f),e.isText()?(r=[e.id,"content"],a=u.get(r),c.push(new s.Fragment(r,0,a.length,!0))):c.push(new s.NodeFragment(h.nodes[f]));if(t=this.end,r=t.path,o=t.offset,n=r[0],e=u.get(n),!e)throw new Error("Node does not exist:"+n);t.isPropertyCoordinate()?(a=u.get(r),i=new s.Fragment(r,0,o,o===a.length),c.push(i)):t.isNodeCoordinate()&&o>0&&c.push(new s.NodeFragment(e.id))}else{r=this.start.path,n=r[0],e=u.get(n);var p=this.start.isNodeCoordinate(),g=this.end.isNodeCoordinate();e.isText()?p&&g&&this.startOffset<this.endOffset?c.push(new s.NodeFragment(n)):!p&&g&&this.endOffset>0?(a=u.get(this.startPath),c.push(new s.Fragment(r,this.startOffset,a.length,0===this.startOffset))):p&&!g&&0===this.startOffset?(a=u.get(this.endPath),c.push(new s.Fragment(r,0,this.endOffset,this.endOffset===a.length))):p||g||(a=u.get(this.startPath),c.push(new s.Fragment(r,this.startOffset,this.endOffset,0===this.startOffset&&this.endOffset===a.length))):c.push(new s.NodeFragment(n))}return this._internal.fragments=c,c},this.splitIntoPropertySelections=function(){var t=[],e=this.getFragments();return e.forEach(function(e){e instanceof s.Fragment&&t.push(new a(e.path,e.startOffset,e.endOffset,!1,this.containerId,this.surfaceId))}.bind(this)),t},this._clone=function(){return new i(this.containerId,this.startPath,this.startOffset,this.endPath,this.endOffset,this.reverse,this.surfaceId)},this._range=function(t){if(t._internal.addressRange)return t._internal.addressRange;var e,n=this.getContainer(),i=n.getAddress(t.start);e=t.isCollapsed()?i:n.getAddress(t.end);var r={start:i,end:e};return t._isContainerSelection&&(t._internal.addressRange=r),r}},s.extend(i),Object.defineProperties(i.prototype,{path:{get:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},set:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead.")}},start:{get:function(){return this._internal.start},set:function(){throw new Error("ContainerSelection.prototype.start is read-only.")}},end:{get:function(){return this._internal.end},set:function(){throw new Error("ContainerSelection.prototype.end is read-only.")}},range:{get:function(){return this._internal.range},set:function(){throw new Error("ContainerSelection.prototype.range is read-only.")}}}),i.fromJSON=function(t){var e=t.containerId,n=t.startPath,r=t.endPath||t.startPath,o=t.startOffset,s=t.endOffset,a=Boolean(t.reverse),c=t.surfaceId,u=new i(e,n,o,r,s,a,c);return u},e.exports=i},{"./Coordinate":226,"./PropertySelection":248,"./Selection":250,"lodash/isNumber":185}],226:[function(t,e,n){"use strict";function i(t,e,n){if(this.path=t,this.offset=e,this.after=n,!r(t))throw new Error("Invalid arguments: path should be an array.");if(!o(e)||0>e)throw new Error("Invalid arguments: offset must be a positive number.");Object.isFrozen(t)||Object.freeze(t)}var r=t("lodash/isArray"),o=t("lodash/isNumber"),s=t("lodash/isEqual"),a=t("../util/oo");i.Prototype=function(){this._isCoordinate=!0,this.equals=function(t){return t===this||s(t.path,this.path)&&t.offset===this.offset},this.withCharPos=function(t){return new i(this.path,t)},this.getNodeId=function(){return this.path[0]},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset},this.toJSON=function(){return{path:this.path,offset:this.offset,after:this.after}},this.toString=function(){return"("+this.path.join(".")+", "+this.offset+")"},this.isPropertyCoordinate=function(){return this.path.length>1},this.isNodeCoordinate=function(){return 1===this.path.length}},a.initClass(i),e.exports=i},{"../util/oo":379,"lodash/isArray":176,"lodash/isEqual":181,"lodash/isNumber":185}],227:[function(t,e,n){"use strict";function i(t,e,n){s.call(this),this.customType=t,this.data=e,this.surfaceId=n}var r=t("lodash/cloneDeep"),o=t("lodash/isEqual"),s=t("./Selection");i.Prototype=function(){this.isCustomSelection=function(){return!0},this.getType=function(){return"custom"},this.getCustomType=function(){return this.customType},this.toJSON=function(){return{type:"custom",customType:this.customType,data:r(this.data),surfaceId:this.surfaceId}},this.toString=function(){return["CustomSelection(",this.customType,", ",JSON.stringify(this.data),")"].join("")},this.equals=function(t){return s.prototype.equals.call(this,t)&&t.isCustomSelection()&&o(this.data,t.data)}},s.extend(i),i.fromJSON=function(t){return new i(t.customType,t.data||{},t.surfaceId)},e.exports=i},{"./Selection":250,"lodash/cloneDeep":163,"lodash/isEqual":181}],228:[function(t,e,n){"use strict";function i(t){if(!t.converters)throw new Error("config.converters is mandatory");t.converters._isRegistry?this.converters=t.converters:(this.converters=new a,t.converters.forEach(function(t){var e;return e="function"==typeof t?new t:t,e.type?void this.converters.add(e.type,e):void console.error("Converter must provide the type of the associated node.",e)}.bind(this))),this.state={doc:null},this.config=r({idAttribute:"id"},t),this._el=null,this.$$=this.createElement.bind(this)}var r=t("lodash/extend"),o=t("lodash/isString"),s=t("../util/oo"),a=t("../util/Registry"),c=t("./Fragmenter"),u=t("../util/encodeXMLEntities");i.Prototype=function(){this.exportDocument=function(t){return this.convertDocument(t)},this.convertDocument=function(t){throw new Error("This method is abstract")},this.convertContainer=function(t){if(!t)throw new Error("Illegal arguments: container is mandatory.");var e=t.getDocument();this.state.doc=e;var n=[];return t.nodes.forEach(function(t){var i=e.get(t),r=this.convertNode(i);n.push(r)}.bind(this)),n},this.convertNode=function(t){o(t)?t=this.state.doc.get(t):this.state.doc=t.getDocument();var e=this.getNodeConverter(t);if(t.isPropertyAnnotation()&&(!e||!e["export"]))return this._convertPropertyAnnotation(t);e||(e=this.getDefaultBlockConverter());var n;return n=e.tagName?this.$$(e.tagName):this.$$("div"),n.attr(this.config.idAttribute,t.id),n=e["export"]?e["export"](t,n,this)||n:this.getDefaultBlockConverter()["export"](t,n,this)||n},this.convertProperty=function(t,e,n){this.initialize(t,n);var i=this.$$("div").append(this.annotatedText(e));return i.innerHTML},this.annotatedText=function(t){var e=this.state.doc,n=e.get(t),i=e.getIndex("annotations").get(t);return this._annotatedText(n,i)},this.getNodeConverter=function(t){return this.converters.get(t.type)},this.getDefaultBlockConverter=function(){throw new Error("This method is abstract.")},this.getDefaultPropertyAnnotationConverter=function(){throw new Error("This method is abstract.")},this.getDocument=function(){return this.state.doc},this.createElement=function(t){return this._el.createElement(t)},this._annotatedText=function(t,e){var n=this,i=new c;i.onText=function(t,e){t.children.push(u(e))},i.onEnter=function(t){var e=t.node;return{annotation:e,children:[]}},i.onExit=function(t,e,i){var r=e.annotation,o=n.getNodeConverter(r);o||(o=n.getDefaultPropertyAnnotationConverter());var s;s=o.tagName?this.$$(o.tagName):this.$$("span"),s.attr(this.config.idAttribute,r.id),s.append(e.children),o["export"]&&(s=o["export"](r,s,n)||s),i.children.push(s)}.bind(this);var r={children:[]};return i.start(r,t,e),r.children},this._convertPropertyAnnotation=function(t){var e=this.$$("div").append(this.annotatedText(t.path)),n=e.find("["+this.config.idAttribute+'="'+t.id+'"]');return n}},s.initClass(i),e.exports=i},{"../util/Registry":368,"../util/encodeXMLEntities":374,"../util/oo":379,"./Fragmenter":239,"lodash/extend":166,"lodash/isString":189}],229:[function(t,e,n){"use strict";function i(t){if(!t.converters)throw new Error("config.converters is mandatory");this.config=a({idAttribute:"id"},t),this.schema=t.schema,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[];var e=this.schema,n=e.getDefaultTextType();t.converters.forEach(function(t){var i;if(i="function"==typeof t?new t:t,!i.type)return void console.error("Converter must provide the type of the associated node.",i);if(!i.matchElement&&!i.tagName)return void console.error("Converter must provide a matchElement function or a tagName property.",i);i.matchElement||(i.matchElement=this._defaultElementMatcher.bind(i));var r=e.getNodeClass(i.type);return r?(this._defaultBlockConverter||n!==i.type||(this._defaultBlockConverter=i),this._allConverters.push(i),void(r["static"].isPropertyAnnotation?this._propertyAnnotationConverters.push(i):this._blockConverters.push(i))):void console.error("No node type defined for converter",i.type)}.bind(this)),this.state=new i.State}var r=t("lodash/last"),o=t("lodash/forEach"),s=t("lodash/clone"),a=t("lodash/extend"),c=t("../util/oo"),u=t("../util/createCountingIdGenerator"),h=t("../util/ArrayIterator");i.Prototype=function(){this.reset=function(){this.state.reset()},this.createDocument=function(){return this.state.doc=this._createDocument(this.config.schema),this.state.doc},this._createDocument=function(t){var e=new this.config.DocumentClass(t);return e},this.generateDocument=function(){this.state.doc||(this.state.doc=this.createDocument());var t=this.state.doc;return this._createNodes(),t},this._createNodes=function(){var t=this.state,e=t.doc;t.nodes.forEach(function(t){e.get(t.id)&&e["delete"](t.id),e.create(t)}),this._createInlineNodes()},this._createInlineNodes=function(){var t=this.state,e=t.doc;t.inlineNodes.forEach(function(t){e.get(t.id)&&e["delete"](t.id),e.create(t)})},this.convertContainer=function(t,e){var n=this.state;n.container=[],n.containerId=e;for(var i=new h(t);i.hasNext();){var r,o=i.next(),s=this._getConverterForElement(o,"block");if(s)r=this._nodeData(o,s.type),n.pushContext(o.tagName,s),r=s["import"](o,r,this)||r,n.popContext(),this._createAndShow(r);else if(o.isCommentNode());else if(o.isTextNode()){var a=o.textContent;if(/^\s*$/.exec(a))continue;i.back(),this._wrapInlineElementsIntoBlockElement(i)}else o.isElementNode()&&(i.back(),this._wrapInlineElementsIntoBlockElement(i))}var c={type:"container",id:e,nodes:this.state.container.slice(0)};return this.createNode(c),c},this.convertElement=function(t){var e,n=this.state.doc,i=this._convertElement(t);if(n)e=n.create(i);else{var r=this.schema.getNodeClass(i.type);e=new r(n,i)}return e},this._convertElement=function(t,e){var n,i=this._getConverterForElement(t,e);if(!i)throw new Error("No converter found for "+t.tagName);n=this._nodeData(t,i.type);var r=this.schema.getNodeClass(n.type);return this.state.pushContext(t.tagName,i),r["static"].isInline?this._convertInlineNode(t,n,i):r["static"].isPropertyAnnotation?this._convertPropertyAnnotation(t,n):n=i["import"](t,n,this)||n,this.state.popContext(),this.createNode(n),n},this._convertPropertyAnnotation=function(t,e){e.path=[e.id,"_content"],e._content=this.annotatedText(t,e.path),e.startOffset=0,e.endOffset=e._content.length},this._convertInlineNode=function(t,e,n){return e.path=[e.id,"content"],e._content="$",e.startOffset=0,e.endOffset=1,e=n["import"](t,e,this)},this.createNode=function(t){if(this.state.ids[t.id])throw new Error("Node with id alread exists:"+t.id);return this.state.ids[t.id]=!0,this.state.nodes.push(t),t},this.show=function(t){this.state.container.push(t.id)},this._createAndShow=function(t){this.createNode(t),this.show(t)},this._nodeData=function(t,e){var n={type:e,id:this.getIdForElement(t,e)},i=this.schema.getNodeClass(e);return o(i["static"].schema,function(t,e){var i=t.hasOwnProperty("default");i&&(n[e]=s(t["default"]))}),n},this.annotatedText=function(t,e,n){var i=this.state;if(e)n&&n.preserveWhitespace&&(i.preserveWhitespace=!0),i.stack.push({path:e,offset:0,text:""});else if(0===i.stack.length)throw new Error("Contract: DOMImporter.annotatedText() requires 'path' for non-reentrant call.",t.outerHTML);this.state.lastChar="";var r,o=t.getChildNodeIterator();return r=this._annotatedText(o),e&&(i.stack.pop(),i.preserveWhitespace=!1),r},this.plainText=function(t){var e=this.state,n=t.textContent;if(e.stack.length>0){var i=r(e.stack);i.offset+=n.length,i.text+=i.text.concat(n)}return n},this.customText=function(t){var e=this.state;if(e.stack.length>0){var n=r(e.stack);n.offset+=t.length,n.text+=n.text.concat(t)}return t},this.nextId=function(t){return this.state.uuid(t)},this.getIdForElement=function(t,e){var n=t.getAttribute(this.config.idAttribute);if(n&&!this.state.ids[n])return n;var i=t.getRoot();for(n=this.nextId(e);this.state.ids[n]||i.find("#"+n);)n=this.nextId(e);return n},this.defaultConverter=function(t,e){this.IGNORE_DEFAULT_WARNINGS||console.warn("This element is not handled by the converters you provided. This is the default implementation which just skips conversion. Override DOMImporter.defaultConverter(el, converter) to change this behavior.",t.outerHTML);var n=this.schema.getDefaultTextType(),i=this._defaultBlockConverter;if(!i)throw new Error("Could not find converter for default type ",n);var r=this._nodeData(t,n);return this.state.pushContext(t.tagName,e),r=i["import"](t,r,e)||r,this.state.popContext(),r},this._defaultElementMatcher=function(t){return t.is(this.tagName)},this._annotatedText=function(t){var e=this.state,n=r(e.stack);if(!n)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var i=t.next(),o="";if(i.isTextNode())o=this._prepareText(e,i.textContent),o.length&&(n.text=n.text.concat(o),n.offset+=o.length);else{if(i.isCommentNode())continue;if(i.isElementNode()){var s=this._getConverterForElement(i,"inline");if(!s){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",i.outerHTML),this.annotatedText(i);continue}var a=n.offset,c=s.type,u=this._nodeData(i,c);if(s["import"]){e.stack.push({path:n.path,offset:a,text:""}),e.pushContext(i.tagName,s),u=s["import"](i,u,this)||u,e.popContext();var h=this.schema.getNodeClass(c);h["static"].isInline?this.customText(""):this.annotatedText(i);var l=e.stack.pop();n.offset=l.offset,n.text=n.text.concat(l.text)}else this.annotatedText(i);var d=n.offset;u.startOffset=a,u.endOffset=d,u.path=n.path.slice(0),e.inlineNodes.push(u)}else console.warn("Unknown element type. Taking plain text.",i.outerHTML),o=this._prepareText(e,i.textContent),n.text=n.text.concat(o),n.offset+=o.length}}return n.text},this._getConverterForElement=function(t,e){var n;if("block"===e){if(!t.tagName)return null;n=this._blockConverters}else n="inline"===e?this._propertyAnnotationConverters:this._allConverters;for(var i=null,r=0;r<n.length;r++)if(this._converterCanBeApplied(n[r],t)){i=n[r];break}return i},this._converterCanBeApplied=function(t,e){return t.matchElement(e,t)},this._createElement=function(t){return this._el.createElement(t)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("div");t.hasNext();){var n=t.next(),i=this._getConverterForElement(n,"block");if(i){t.back();break}e.append(n.clone())}var r=this.defaultConverter(e,this);if(r){if(!r.type)throw new Error("Contract: DOMImporter.defaultConverter() must return a node with type.");this._createAndShow(r)}return r},this._createDefaultBlockElement=function(t){var e=this.defaultConverter(t,this);if(e){if(!e.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.",t.outerHTML);e.id=e.id||this.defaultId(t,e.type),this._createAndShow(e)}};var t=/^\s+/g,e=/^\s*/g,n=/\s+$/g,i=/\s+/g,a=" ",c=/[\t\n\r]+/g;this._prepareText=function(r,o){if(r.preserveWhitespace)return o;var s=a;return o=o.replace(c,""),o=r.lastChar===a?o.replace(e,s):o.replace(t,s),o=o.replace(n,s),(this.config.REMOVE_INNER_WS||r.removeInnerWhitespace)&&(o=o.replace(i,a)),r.lastChar=o[o.length-1]||r.lastChar,o},this._trimTextContent=function(t){var e,n,i=t.getChildNodes(),o=i[0],s=r(i);return o&&o.isTextNode()&&(e=o.textContent,n=this._trimLeft(e),o.textContent=n),s&&s.isTextNode()&&(e=s.textContent,n=this._trimRight(e),s.textContent=n),t},this._trimLeft=function(e){return e.replace(t,"")},this._trimRight=function(t){return t.replace(n,"")}},c.initClass(i),i.State=function(){this.reset()},i.State.Prototype=function(){this.reset=function(){this.preserveWhitespace=!1,this.nodes=[],this.inlineNodes=[],this.containerId=null,this.container=[],this.ids={},this.contexts=[],this.stack=[],this.lastChar="",this.skipTypes={},this.ignoreAnnotations=!1,this.uuid=u()},this.pushContext=function(t,e){this.contexts.push({tagName:t,converter:e})},this.popContext=function(){return this.contexts.pop()},this.getCurrentContext=function(){return r(this.contexts)}},c.initClass(i.State),e.exports=i},{"../util/ArrayIterator":365,"../util/createCountingIdGenerator":371,"../util/oo":379,"lodash/clone":162,"lodash/extend":166,"lodash/forEach":170,"lodash/last":195}],230:[function(t,e,n){"use strict";function i(){}var r=(t("lodash/isEqual"),t("../util/oo")),o=t("./data/ObjectOperation");i.Prototype=function(){this.shouldMerge=function(t,e){return!1},this.merge=function(t,e){var n=t.ops[0],i=e.ops[0],r=n.diff,s=i.diff,a=!1;return r.isInsert()?r.pos+r.getLength()===s.pos&&(a=n.toJSON(),a.diff.str+=s.str):r.isDelete()&&(r.pos===s.pos?(a=n.toJSON(),a.diff.str+=s.str):s.pos+s.getLength()===r.pos&&(a=n.toJSON(),a.diff=s,a.diff.str+=r.str)),a?(t.ops[0]=o.fromJSON(a),t.ops.length>1&&(t.ops=t.ops.concat(e.ops.slice(1)),t.after=e.after),!0):!1}},r.initClass(i),e.exports=i},{"../util/oo":379,"./data/ObjectOperation":267,"lodash/isEqual":181}],231:[function(t,e,n){"use strict";function i(t){if(i["super"].apply(this),this.__id__=E++,!t)throw new Error("A document needs a schema for reflection.");this.schema=t,this.nodeFactory=new y(this),this.data=new v(t,{nodeFactory:this.nodeFactory}),this.addIndex("type",l.create({property:"type"})),this.addIndex("annotations",new d),this.addIndex("container-annotations",new f),this.addIndex("container-annotation-anchors",new p),this.eventProxies={path:new m(this)},this.on("document:changed",this._updateEventProxies,this)}var r=t("lodash/isEqual"),o=t("lodash/isObject"),s=t("lodash/isArray"),a=t("lodash/isString"),c=t("lodash/each"),u=t("../util/uuid"),h=t("../util/EventEmitter"),l=t("./DocumentIndex"),d=t("./AnnotationIndex"),f=t("./ContainerAnnotationIndex"),p=t("./AnchorIndex"),g=t("./DocumentChange"),m=t("./PathEventProxy"),v=t("./data/IncrementalData"),y=t("./DocumentNodeFactory"),_=t("./Selection"),x=t("./Coordinate"),b=t("./Range"),C=t("./documentHelpers"),w=t("./JSONConverter"),S=new w,E=0;i.Prototype=function(){function e(){var e,i,c,u,h,l=t("./PropertySelection"),d=t("./ContainerSelection"),f=t("./NodeSelection"),p=this;if(1===arguments.length&&null===arguments[0])return _.nullSelection;if(arguments[0]instanceof x)return e=arguments[0],e.isNodeCoordinate()?f._createFromCoordinate(e):new l(e.path,e.offset,e.offset);if(arguments[0]instanceof b){i=arguments[0];var g=r(i.start.path,i.end.path);return g?i.start.isNodeCoordinate()?f._createFromRange(i):new l(i.start.path,i.start.offset,i.end.offset,i.reverse,i.containerId):new d(i.containerId,i.start.path,i.start.offset,i.end.path,i.end.offset,i.reverse)}return 1===arguments.length&&o(arguments[0])?n(p,arguments[0]):2===arguments.length&&s(arguments[0])?(c=arguments[0],u=arguments[1],new l(c,u,u)):3===arguments.length&&s(arguments[0])?(c=arguments[0],u=arguments[1],h=arguments[2],new l(c,u,h,u>h)):5===arguments.length&&a(arguments[0])?n(p,{type:"container",containerId:arguments[0],startPath:arguments[1],startOffset:arguments[2],endPath:arguments[3],endOffset:arguments[4]}):(console.error("Illegal arguments for Selection.create().",arguments),_.nullSelection)}function n(e,n){var r,o=t("./PropertySelection"),s=t("./ContainerSelection"),a=t("./NodeSelection"),c=t("./CustomSelection");if("property"===n.type)return null!==n.endOffset&&void 0!==n.endOffset||(n.endOffset=n.startOffset),n.hasOwnProperty("reverse")||(n.startOffset>n.endOffset?(r=n.startOffset,n.startOffset=n.endOffset,n.endOffset=r,n.reverse=!0):n.reverse=!1),new o(n.path,n.startOffset,n.endOffset,n.reverse,n.containerId,n.surfaceId);if("container"===n.type){var u=e.get(n.containerId,"strict"),h=new x(n.startPath,n.startOffset),l=new x(n.endPath,n.endOffset),d=u.getAddress(h),f=u.getAddress(l),p=n.reverse;if(!d)throw new Error("Invalid arguments for ContainerSelection: ",h.toString());if(!f)throw new Error("Invalid arguments for ContainerSelection: ",l.toString());return n.hasOwnProperty("reverse")||(p=f.isBefore(d,"strict"),p&&(r=h,h=l,l=r)),i(e,h,!0),i(e,l,!1),new s(u.id,h.path,h.offset,l.path,l.offset,p,n.surfaceId)}if("node"===n.type)return a.fromJSON(n);if("custom"===n.type)return c.fromJSON(n);throw new Error("Illegal selection type",n)}function i(t,e,n){if(!e.isNodeCoordinate()){var i=e.getNodeId(),r=t.get(i);r.isText()||(console.warn("Selecting a non-textish node partially is not supported. Select the full node."),e.path=[i],e.offset=n?0:1)}}this._isDocument=!0,this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.getNodes=function(){return this.data.nodes},this.getSchema=function(){return this.schema},this.contains=function(t){this.data.contains(t)},this.get=function(t,e){return this.data.get(t,e)},this.getNodes=function(){return this.data.getNodes()},this["import"]=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},this.create=function(t){t.id||(t.id=u(t.type));var e=this._create(t),n=new g([e],{},{});return n._extractInformation(this),this._notifyChangeListeners(n),this.data.get(t.id)},this["delete"]=function(t){var e=this.get(t),n=this._delete(t),i=new g([n],{},{});return i._extractInformation(this),this._notifyChangeListeners(i),e},this.set=function(t,e){var n=this.get(t),i=this._set(t,e),r=new g([i],{},{});return r._extractInformation(this),this._notifyChangeListeners(r),n},this.update=function(t,e){var n=this._update(t,e),i=new g([n],{},{});return i._extractInformation(this),this._notifyChangeListeners(i),n},this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.createSelection=function(){var t=e.apply(this,arguments);return t.isNull()||t.attach(this),t},this.getEventProxy=function(t){return this.eventProxies[t]},this.newInstance=function(){var t=this.constructor;return new t(this.schema)},this.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},this.getDocumentMeta=function(){return this.get("document")},this._apply=function(t){c(t.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this)),t._extractInformation(this)},this._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},this._updateEventProxies=function(t,e){c(this.eventProxies,function(n){n.onDocumentChanged(t,e,this)}.bind(this))},this.loadSeed=function(t){c(this.data.nodes,function(t){this["delete"](t.id)}.bind(this)),c(t.nodes,function(t){this.create(t)}.bind(this))},this.toJSON=function(){return S.exportDocument(this)},this.getTextForSelection=function(t){return console.warn("DEPRECATED: use docHelpers.getTextForSelection() instead."),C.getTextForSelection(this,t)},this.setText=function(t,e,n){var i,r=this.getIndex("annotations").get(t);for(i=0;i<r.length;i++)this["delete"](r[i].id);for(this.set(t,e),i=0;i<n.length;i++)this.create(n[i])},this._create=function(t){var e=this.data.create(t);return e},this._delete=function(t){var e=this.data["delete"](t);return e},this._update=function(t,e){var n=this.data.update(t,e);return n},this._set=function(t,e){var n=this.data.set(t,e);return n}},h.extend(i),e.exports=i},{"../util/EventEmitter":367,"../util/uuid":383,"./AnchorIndex":217,"./AnnotationIndex":219,"./ContainerAnnotationIndex":224,"./ContainerSelection":225,"./Coordinate":226,"./CustomSelection":227,"./DocumentChange":232,"./DocumentIndex":233,"./DocumentNodeFactory":235,"./JSONConverter":243,"./NodeSelection":244,"./PathEventProxy":246,"./PropertySelection":248,"./Range":249,"./Selection":250,"./data/IncrementalData":262,"./documentHelpers":272,"lodash/each":164,"lodash/isArray":176,"lodash/isEqual":181,"lodash/isObject":186,"lodash/isString":189}],232:[function(t,e,n){"use strict";function i(t,e,n){if(1===arguments.length&&u(arguments[0])){var i=arguments[0];this.sha=i.sha,this.timestamp=i.timestamp,this.before=i.before,this.ops=i.ops,this.info=i.info,this.after=i.after}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=m(),this.info={},this.timestamp=Date.now(),this.ops=t.slice(0),this.before=e,this.after=n}this.updated=null,this.created=null,this.deleted=null}function r(t,e){for(var n=0;n<t.ops.length;n++)for(var i=t.ops[n],r=0;r<e.ops.length;r++){var o=e.ops[r];y.transform(i,o,{inplace:!0})}t.before&&s(t.before.selection,e),t.after&&s(t.after.selection,e),e.before&&s(e.before.selection,t),e.after&&s(e.after.selection,t)}function o(t,e){h(t)||(t=[t]),h(e)||(e=[e]);for(var n=0;n<t.length;n++)for(var i=t[n],o=0;o<e.length;o++){var s=e[o];r(i,s)}}function s(t,e){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;for(var n=e.ops,i=!1,r=t.isCollapsed(),o=0;o<n.length;o++){var s=n[o];i|=a(t.start,s),r?(t.isContainerSelection()&&(t.endPath=t.startPath),t.endOffset=t.startOffset):i|=a(t.end,s)}return i}function a(t,e){if(!c(e.path,t.path))return!1;var n=!1;if("update"===e.type&&"string"===e.propertyType){var i,r=e.diff;r.isInsert()&&r.pos<=t.offset?(i=t.offset+r.str.length,t.offset=i,n=!0):r.isDelete()&&r.pos<=t.offset&&(i=Math.max(r.pos,t.offset-r.str.length),t.offset=i,n=!0)}return n}var c=t("lodash/isEqual"),u=t("lodash/isObject"),h=t("lodash/isArray"),l=t("lodash/map"),d=t("lodash/forEach"),f=t("lodash/clone"),p=t("lodash/cloneDeep"),g=t("../util/oo"),m=t("../util/uuid"),v=t("./data/OperationSerializer"),y=t("./data/ObjectOperation"),_=t("./Selection");i.Prototype=function(){this._extractInformation=function(t){function e(e){var n,i,a=e.val;switch(e.type){case"create":case"delete":a.hasOwnProperty("startOffset")&&(n=a.path||a.startPath,o[n]=!0),a.hasOwnProperty("endPath")&&(n=a.endPath,o[n]=!0);break;case"update":case"set":a=t.get(e.path[0]),a&&(i=e.path[1],a.isPropertyAnnotation()?"path"!==i&&"startOffset"!==i&&"endOffset"!==i||r[a.path[0]]||(o[a.path]=!0):a.isContainerAnnotation()&&("startPath"!==i&&"startOffset"!==i&&"endPath"!==i&&"endOffset"!==i||s.push(a)));break;default:throw new Error("Illegal state")}}for(var n=this.ops,i={},r={},o={},s=[],a=0;a<n.length;a++){var c=n[a];"create"===c.type&&(i[c.val.id]=c.val,delete r[c.val.id]),"delete"===c.type&&(delete i[c.val.id],r[c.val.id]=c.val),"set"!==c.type&&"update"!==c.type||(o[c.path]=!0),e(c)}s.forEach(function(e){for(var n=t.get(e.containerId,"strict"),i=n.getPosition(e.startPath[0]),s=n.getPosition(e.endPath[0]),a=i;s>=a;a++){var c,u=n.getChildAt(a);c=u.isText()?[u.id,"content"]:[u.id],r[u.id]||(o[c]=!0)}}),Object.keys(r).length>0&&d(o,function(t,e){var n=e.split(",")[0];
r[n]&&delete o[e]}),this.created=i,this.deleted=r,this.updated=o},this.invert=function(){var t=this.toJSON();t.ops=[];var e=t.before;t.before=t.after,t.after=e;for(var n=i.fromJSON(t),r=[],o=this.ops.length-1;o>=0;o--)r.push(this.ops[o].invert());return n.ops=r,n},this.isAffected=function(t){return this.updated[t]},this.isUpdated=this.isAffected,this.serialize=function(){var t=new v,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)},this.clone=function(){return i.fromJSON(this.toJSON())},this.toJSON=function(){var t={sha:this.sha,before:f(this.before),ops:l(this.ops,function(t){return t.toJSON()}),info:this.info,after:f(this.after)};t.after.selection=void 0,t.before.selection=void 0;var e=this.before.selection;return e&&e._isSelection&&(t.before.selection=e.toJSON()),e=this.after.selection,e&&e._isSelection&&(t.after.selection=e.toJSON()),t}},g.initClass(i),i.deserialize=function(t){var e=new v,n=JSON.parse(t);return n.ops=n.ops.map(function(t){return e.deserialize(t)}),n.before.selection&&(n.before.selection=_.fromJSON(n.before.selection)),n.after.selection&&(n.after.selection=_.fromJSON(n.after.selection)),new i(n)},i.fromJSON=function(t){var e=p(t);return e.ops=t.ops.map(function(t){return y.fromJSON(t)}),e.before.selection=_.fromJSON(t.before.selection),e.after.selection=_.fromJSON(t.after.selection),new i(e)},i.transformInplace=function(t,e){o(t,e)},i.transformSelection=function(t,e){var n=t.clone(),i=s(n,e);return i?n:t},e.exports=i},{"../util/oo":379,"../util/uuid":383,"./Selection":250,"./data/ObjectOperation":267,"./data/OperationSerializer":269,"lodash/clone":162,"lodash/cloneDeep":163,"lodash/forEach":170,"lodash/isArray":176,"lodash/isEqual":181,"lodash/isObject":186,"lodash/map":196}],233:[function(t,e,n){"use strict";function i(){}var r=t("./data/NodeIndex");r.extend(i),i.filterByType=r.filterByType,e.exports=r},{"./data/NodeIndex":265}],234:[function(t,e,n){"use strict";function i(t,e){o.call(this,e),this.document=t}var r=t("lodash/each"),o=t("./data/Node");i.Prototype=function(){function t(t){return/([a-zA-Z_0-9]+):changed/.exec(t)}this._isDocumentNode=!0;var e=i["super"].prototype;this.getDocument=function(){return this.document},this.hasParent=function(){return Boolean(this.parent)},this.getParent=function(){return this.document.get(this.parent)},this.hasChildren=function(){return!1},this.getChildIndex=function(t){return-1},this.getChildAt=function(t){return null},this.getChildCount=function(){return 0},this.getRoot=function(){for(var t=this;t.hasParent();)t=t.getParent();return t},this.getAddressablePropertyNames=function(){var t=this.constructor["static"].addressablePropertyNames;return t||[]},this.hasAddressableProperties=function(){return this.getAddressablePropertyNames().length>0},this.getPropertyNameAt=function(t){var e=this.constructor["static"].addressablePropertyNames||[];return e[t]},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},this.on=function(n,i,r){var o=t(n);if(o){var s=o[1];if(this.constructor["static"].schema[s]){var a=this.getDocument();a.getEventProxy("path").on([this.id,s],i,r)}}e.on.apply(this,arguments)},this.off=function(n,i,r){var o=this.getDocument(),s=!1;if(i?s=t(i):o.getEventProxy("path").off(n),s){var a=s[1];o.getEventProxy("path").off(n,[this.id,a],r)}e.off.apply(this,arguments)},this.connect=function(t,e){console.warn("DEPRECATED: use Node.on() instead"),r(e,function(e,n){this.on(n,e,t)}.bind(this))},this.disconnect=function(t){console.warn("DEPRECATED: use Node.off() instead"),this.off(t)},this._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},this.isBlock=function(){return this.constructor["static"].isBlock},this.isText=function(){return this.constructor["static"].isText},this.isPropertyAnnotation=function(){return this.constructor["static"].isPropertyAnnotation},this.isInline=function(){return this.constructor["static"].isInline},this.isContainerAnnotation=function(){return this.constructor["static"].isContainerAnnotation}},o.extend(i),i["static"].name="node",i["static"].isBlock=!1,i["static"].isText=!1,i["static"].isPropertyAnnotation=!1,i["static"].isContainerAnnotation=!1,i["static"].isInline=!1,e.exports=i},{"./data/Node":263,"lodash/each":164}],235:[function(t,e,n){"use strict";function i(t){this.doc=t}var r=t("../util/oo");i.Prototype=function(){this.create=function(t,e){var n=this.doc.schema.getNodeClass(t);if(!n)throw new Error("No node registered by that name: "+t);return new n(this.doc,e)}},r.initClass(i),e.exports=i},{"../util/oo":379}],236:[function(t,e,n){"use strict";function i(t,e){i["super"].call(this,t,e)}var r=t("./data/Schema"),o=t("./DocumentNode"),s=t("./Container"),a=t("./PropertyAnnotation"),c=t("./ContainerAnnotation");i.Prototype=function(){this.getDefaultTextType=function(){throw new Error("DocumentSchema.getDefaultTextType() is abstract and must be overridden.")},this.isAnnotationType=function(t){var e=this.getNodeClass(t);return e&&e.prototype._isPropertyAnnotation},this.getBuiltIns=function(){return[o,a,s,c]}},r.extend(i),e.exports=i},{"./Container":221,"./ContainerAnnotation":223,"./DocumentNode":234,"./PropertyAnnotation":247,"./data/Schema":270}],237:[function(t,e,n){"use strict";function i(t,e){i["super"].apply(this),this.__id__=f++,e=e||{},this.doc=t,this.selectionState=new l(t),this.stage=new c(this.doc,this),this.isTransacting=!1,this.doneChanges=[],this.undoneChanges=[],this._lastChange=null,this.compressor=e.compressor||new u,this.saveHandler=e.saveHandler,this.doc.on("document:changed",this.onDocumentChange,this,{priority:1e3})}var r=t("lodash/extend"),o=t("lodash/isPlainObject"),s=t("../util/oo"),a=t("../util/EventEmitter"),c=t("./TransactionDocument"),u=t("./DefaultChangeCompressor"),h=t("./Selection"),l=t("./SelectionState"),d=t("./DocumentChange"),f=0;i.Prototype=function(){this.getDocument=function(){return this.doc},this.getSelection=function(){return this.selectionState.getSelection()},this.setSelection=function(t){t&&o(t)&&(t=this.doc.createSelection(t));var e=this._setSelection(t);e&&this._triggerUpdateEvent({selection:t})},this.createSelection=function(){return this.doc.createSelection.apply(this.doc,arguments)},this.getSelectionState=function(){return this.selectionState},this.setSaveHandler=function(t){this.saveHandler=t},this.getCollaborators=function(){return null},this.canUndo=function(){return this.doneChanges.length>0},this.canRedo=function(){return this.undoneChanges.length>0},this.undo=function(){this._undoRedo("undo")},this.redo=function(){this._undoRedo("redo")},this._undoRedo=function(t){var e,n;"redo"===t?(e=this.undoneChanges,n=this.doneChanges):(e=this.doneChanges,n=this.undoneChanges);var i=e.pop();if(i){this.stage._apply(i),this.doc._apply(i);var r=i.after.selection;r&&r.attach(this.doc);var o=this._setSelection(r);n.push(i.invert());var s={change:i};o&&(s.selection=r),this._triggerUpdateEvent(s,{replay:!0})}else console.warn("No change can be %s.","undo"===t?"undone":"redone")},this.transaction=function(t,e){if(this.isTransacting)throw new Error("Nested transactions are not supported.");this.isTransacting=!0,this.stage.reset();var n=this.getSelection();e=e||{};var i=n.surfaceId,o=this.stage._transaction(function(o){o.before.selection=n;var s={selection:n},a=t(o,s)||{};n=a.selection||n,!n._isSelection||n.isNull()||n.surfaceId||(n.surfaceId=i),o.after.selection=n,r(e,o.info)});return o?(this.isTransacting=!1,this._commit(o,e),o):void(this.isTransacting=!1)},this.onDocumentChange=function(t,e){if(e&&e.session!==this){this.stage._apply(t),this._transformLocalChangeHistory(t,e);var n={change:t},i=this._transformSelection(t,e),r=this._setSelection(i);r&&(n.selection=i)}},this._setSelection=function(t){return this.selectionState.setSelection(t)},this._transformLocalChangeHistory=function(t){var e={ops:t.ops.map(function(t){return t.clone()})};d.transformInplace(e,this.doneChanges),d.transformInplace(e,this.undoneChanges)},this._transformSelection=function(t){var e=this.getSelection(),n=d.transformSelection(e,t);return n},this._commit=function(t,e){var n=this._commitChange(t),i={change:t};n&&(i.selection=this.getSelection()),this._triggerUpdateEvent(i,e)},this._commitChange=function(t){t.timestamp=Date.now(),this.doc._apply(t);var e=this._currentChange,n=!1;e&&this.compressor.shouldMerge(e,t)&&(n=this.compressor.merge(e,t)),n||(this._currentChange=t,this.doneChanges.push(t.invert())),this.undoneChanges=[];var i=t.after.selection||h.nullSelection,r=this._setSelection(i);return i.isNull()||(i.surfaceId=t.after.surfaceId),r},this.isDirty=function(){return this._dirty},this.save=function(){var t=this.getDocument(),e=this.saveHandler;if(this._dirty&&!this._isSaving)if(this._isSaving=!0,e){var n=[];e.saveDocument(t,n,function(t){this._isSaving=!1,t?console.error("Error during save"):(this._dirty=!1,this._triggerUpdateEvent({},{force:!0}))}.bind(this))}else console.error("Document saving is not handled at the moment. Make sure saveHandler instance provided to documentSession")},this._triggerUpdateEvent=function(t,e){e=e||{},e.session=this,t.change&&t.change.ops.length>0?(this.doc._notifyChangeListeners(t.change,e),this._dirty=!0):delete t.change,(Object.keys(t).length>0||e.force)&&(this.emit("update",t,e),this.emit("didUpdate",t,e))}},s.inherit(i,a),e.exports=i},{"../util/EventEmitter":367,"../util/oo":379,"./DefaultChangeCompressor":230,"./DocumentChange":232,"./Selection":250,"./SelectionState":251,"./TransactionDocument":254,"lodash/extend":166,"lodash/isPlainObject":188}],238:[function(t,e,n){"use strict";function i(){this._merge={},this._mergeComponents={},this._break={}}var r=t("../util/oo");i.Prototype=function(){this.defineMerge=function(t,e,n){return this._merge[t]||(this._merge[t]={}),this._merge[t][e]=n,this},this.canMerge=function(t,e){return this._merge[t]&&this._merge[t][e]},this.getMerger=function(t,e){return this._merge[t][e]},this.defineComponentMerge=function(t,e){this._mergeComponents[t]=e},this.canMergeComponents=function(t){return this._mergeComponents[t]},this.getComponentMerger=function(t){return this._mergeComponents[t]},this.defineBreak=function(t,e){return this._break[t]=e,this},this.canBreak=function(t){return this._break[t]},this.getBreaker=function(t){return this._break[t]}},r.initClass(i),e.exports=i},{"../util/oo":379}],239:[function(t,e,n){"use strict";function i(t){o(this,t)}var r=t("../util/oo"),o=t("lodash/extend"),s=t("lodash/each"),a=t("lodash/isString"),c=1,u=-1,h=-2;i.Prototype=function(){function t(t){var r=[],o=[];s(t,function(t){var e=t.isAnchor?t.isAnchor():!1;if(e)r.push({mode:h,pos:t.offset,id:t.id,level:i.ALWAYS_ON_TOP,type:"anchor",node:t,counter:-1,length:0});else{var n=i.NORMAL,s=t.isInline?t.isInline():!1;s?n=Number.MAX_VALUE:t.constructor["static"]&&t.constructor["static"].hasOwnProperty("fragmentation")?n=t.constructor["static"].fragmentation:t.hasOwnProperty("fragmentationHint")&&(n=t.fragmentationHint);var a=Math.min(t.startOffset,t.endOffset),l=Math.max(t.startOffset,t.endOffset),d={pos:a,mode:c,level:n,id:t.id,type:t.type,node:t,length:0,counter:-1};r.push(d),o.push({pos:l,mode:u,level:n,id:t.id,type:t.type,node:t,opener:d})}}),r.sort(e);for(var a=r.length-1;a>=0;a--)r[a].idx=a;o.sort(n);for(var l=new Array(r.length+o.length),d=0,f=0,p=0,g=r[f],m=o[p];g||m;)g&&m?m.pos<=g.pos&&m.opener!==g?(l[d]=m,p++):(l[d]=g,f++):g?(l[d]=g,f++):m&&(l[d]=m,p++),g=r[f],m=o[p],d++;return l}function e(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function n(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.pos===t.opener.pos&&e.pos===e.opener.pos?t.opener.idx<e.opener.idx?-1:1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}this.start=function(t,e,n){if(!a(e))throw new Error("Illegal argument: 'text' must be a String, but was "+e);this._start(t,e,n)},this.onText=function(t,e,n){},this.onEnter=function(t,e){return null},this.onExit=function(t,e,n){},this._enter=function(t,e){return t.counter++,this.onEnter(t,e)},this._exit=function(t,e,n){this.onExit(t,e,n)},this._createText=function(t,e,n){this.onText(t,e,n)},this._start=function(e,n,i){for(var r=t.call(this,i),o=[{context:e,entry:null}],s=0,a=0;a<r.length;a++){var l=r[a],d=n.substring(s,l.pos);d&&this._createText(o[o.length-1].context,d,l),s=l.pos;var f,p,g;if(l.mode===c||l.mode===h){for(f=1;f<o.length&&!(l.level<o[f].entry.level);f++);for(p=o.length-1;p>=f;p--)g=o[p].entry,g.length=s-g.pos,this._exit(g,o[p].context,o[p-1].context);for(o.splice(f,0,{entry:l}),p=f;p<o.length;p++)g=o[p].entry,g.pos=s,o[p].context=this._enter(g,o[p-1].context)}if(l.mode===u||l.mode===h){for(f=1;f<o.length&&o[f].entry.node!==l.node;f++);for(p=o.length-1;p>=f;p--)g=o[p].entry,g.length=s-g.pos,this._exit(g,o[p].context,o[p-1].context);for(o.splice(f,1),p=f;p<o.length;p++)g=o[p].entry,g.pos=s,o[p].context=this._enter(g,o[p-1].context)}}var m=n.substring(s);m&&this._createText(e,m)}},r.initClass(i),i.SHOULD_NOT_SPLIT=0,i.NORMAL=10,i.ANY=100,i.ALWAYS_ON_TOP=Number.MAX_VALUE,e.exports=i},{"../util/oo":379,"lodash/each":164,"lodash/extend":166,"lodash/isString":189}],240:[function(t,e,n){"use strict";function i(t){t=s({idAttribute:"data-id"},t),r.call(this,t),this._el=o.parseHTML("<html></html>")}var r=t("./DOMExporter"),o=t("../ui/DefaultDOMElement"),s=t("lodash/extend"),a=t("lodash/each"),c=t("lodash/isBoolean"),u=t("lodash/isNumber"),h=t("lodash/isString");i.Prototype=function(){this.exportDocument=function(t){var e=o.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)};var t={tagName:"span","export":function(t,e){e.tagName="span",e.attr("data-type",t.type);var n=t.toJSON();a(n,function(t,n){"id"!==n&&"type"!==n&&(h(t)||u(t)||c(t))&&e.attr("data-"+n,t)})}},e={"export":function(t,e,n){e.attr("data-type",t.type);var i=t.toJSON();a(i,function(i,r){if("id"!==r&&"type"!==r){var o=n.$$("div").attr("property",r);"string"===t.getPropertyType(r)&&i?o.append(n.annotatedText([t.id,r])):o.text(i),e.append(o)}})}};this.getDefaultBlockConverter=function(){return e},this.getDefaultPropertyAnnotationConverter=function(){return t}},r.extend(i),e.exports=i},{"../ui/DefaultDOMElement":328,"./DOMExporter":228,"lodash/each":164,"lodash/extend":166,"lodash/isBoolean":179,"lodash/isNumber":185,"lodash/isString":189}],241:[function(t,e,n){"use strict";function i(t){t=s({idAttribute:"data-id"},t),r.call(this,t),this._el=o.parseHTML("<html></html>")}var r=t("./DOMImporter"),o=t("../ui/DefaultDOMElement"),s=t("lodash/extend");i.Prototype=function(){this.importDocument=function(t){this.reset();var e=o.parseHTML(t);return this.convertDocument(e),this.generateDocument(),this.state.doc},this.convertDocument=function(t){throw new Error("This method is abstract")}},r.extend(i),e.exports=i},{"../ui/DefaultDOMElement":328,"./DOMImporter":229,"lodash/extend":166}],242:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./PropertyAnnotation");r.extend(i),i["static"].isInline=!0,e.exports=i},{"./PropertyAnnotation":247}],243:[function(t,e,n){"use strict";function i(){}var r=t("lodash/isArray"),o=t("lodash/each"),s=t("../util/oo");i.Prototype=function(){this.importDocument=function(t,e){if(!e.schema||!r(e.nodes))throw new Error("Invalid JSON format.");var n=t.getSchema();if(n.name!==e.schema.name)throw new Error("Incompatible schema.");n.version!==e.schema.version&&console.error("Different schema version. Conversion might be problematic.");var i=e.nodes;return t["import"](function(t){o(i,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)})}),t},this.exportDocument=function(t){var e=t.getSchema(),n={schema:{name:e.name,version:e.version},nodes:[]};return o(t.getNodes(),function(t){t._isDocumentNode&&n.nodes.push(t.toJSON())}),n}},s.initClass(i),e.exports=i},{"../util/oo":379,"lodash/each":164,"lodash/isArray":176}],244:[function(t,e,n){"use strict";function i(t,e,n,i,s){if(o.call(this),!r(t))throw new Error("'containerId' is mandatory.");if(!r(e))throw new Error("'nodeId' is mandatory.");if(["full","before","after"].indexOf(n)<0)throw new Error("'mode' is mandatory.");this.containerId=t,this.nodeId=e,this.mode=n,this.reverse=Boolean(i),this.surfaceId=s}var r=t("lodash/isString"),o=t("./Selection"),s=t("./Coordinate");i.Prototype=function(){this._isNodeSelection=!0;var t=i["super"].prototype;this.equals=function(e){return t.call(this,e)&&this.nodeId===e.nodeId&&this.mode===e.mode},this.isNodeSelection=function(){return!0},this.getType=function(){return"node"},this.getNodeId=function(){return this.nodeId},this.isFull=function(){return"full"===this.mode},this.isBefore=function(){return"before"===this.mode},this.isAfter=function(){return"after"===this.mode},this.isCollapsed=function(){return"full"!==this.mode},this.toJSON=function(){return{containerId:this.containerId,nodeId:this.nodeId,mode:this.mode,reverse:this.reverse,surfaceId:this.surfaceId}},this.toString=function(){return["NodeSelection(",this.containerId,".",this.nodeId,", ",this.mode,", ",this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},this.collapse=function(t){if("left"===t)return this.isBefore()?this:new i(this.containerId,this.nodeId,"before",this.reverse,this.surfaceId);if("right"===t)return this.isAfter()?this:new i(this.containerId,this.nodeId,"after",this.reverse,this.surfaceId);throw new Error("'direction' must be either 'left' or 'right'")},this._getCoordinate=function(){return"before"===this.mode?new s([this.nodeId],0):"after"===this.mode?new s([this.nodeId],1):void 0}},o.extend(i),i.fromJSON=function(t){return new i(t.containerId,t.nodeId,t.mode,t.reverse)},i._createFromRange=function(t){var e,n=t.containerId,r=t.start.getNodeId(),o=t.start.offset,s=t.end.offset,a=t.reverse;return e=o===s?0===o?"before":"after":"full",new i(n,r,e,a)},i._createFromCoordinate=function(t){var e=t.containerId,n=t.getNodeId(),r=0===t.offset?"before":"after";return new i(e,n,r,!1)},e.exports=i},{"./Coordinate":226,"./Selection":250,"lodash/isString":189}],245:[function(t,e,n){"use strict";var i={hasChildren:function(){return!0},getChildrenProperty:function(){throw new Error("ParentNodeMixin.getChildrenProperty is abstract and must be implemented in "+this.constructor.name+".")},getChildIndex:function(t){return this[this.getChildrenProperty()].indexOf(t.id)},getChildren:function(){var t=this.getDocument(),e=this[this.getChildrenProperty()];return e.map(function(e){return t.get(e)})},getChildAt:function(t){var e=this[this.getChildrenProperty()];if(0>t||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},getChildCount:function(){return this[this.getChildrenProperty()].length},getAddressablePropertyNames:function(){return[this.getChildrenProperty()]}};e.exports=i},{}],246:[function(t,e,n){"use strict";function i(t){this.listeners=new c.Arrays,this._list=[],this.doc=t}var r=t("lodash/forEach"),o=t("lodash/isEqual"),s=t("lodash/isArray"),a=t("../util/oo"),c=t("../util/TreeIndex");i.Prototype=function(){this.on=function(t,e,n){this._add(n,t,e)},this.off=function(t,e,n){this._remove(t,e,n)},this.connect=function(t,e,n){console.warn("DEPRECATED: use proxy.on(path, this.onPropertyChange, this) instead"),this.on(e,n,t)},this.disconnect=function(t){console.warn("DEPRECATED: use proxy.off(this) instead"),this.off(t)},this.onDocumentChanged=function(t,e,n){if(0!==this._list.length){var i=this.listeners;r(t.updated,function(o,a){var c=i.get(a.split(","));s(c)&&(c=c.slice(0)),r(c,function(i){i.method.call(i.listener,t,e,n)})})}},this._add=function(t,e,n){if(!n)throw new Error("Invalid argument: expected function but got "+n);var i={listener:t,path:e,method:n};this.listeners.add(e,i),this._list.push(i)},this._remove=function(t,e,n){for(var i=0;i<this._list.length;i++){var r=this._list[i],s=(!e||o(r.path,e))&&(!t||r.listener===t)&&(!n||r.method!==n);if(s){var a=this._list[i];this._list.splice(i,1),this.listeners.remove(a.path,a)}}}},a.initClass(i),e.exports=i},{"../util/TreeIndex":369,"../util/oo":379,"lodash/forEach":170,"lodash/isArray":176,"lodash/isEqual":181}],247:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("lodash/isEqual"),o=t("./DocumentNode");i.Prototype=function(){this._isAnnotation=!0,this._isPropertyAnnotation=!0,this.getText=function(){var t=this.getDocument();if(!t)return console.warn("Trying to use an PropertyAnnotation which is not attached to the document."),"";var e=t.get(this.path);return e.substring(this.startOffset,this.endOffset)},this.canSplit=function(){return!0},this.isAnchor=function(){return!1},this.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset})},this.updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Cannot change to ContainerAnnotation.");r(this.startPath,e.start.path)||t.set([this.id,"path"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)}},o.extend(i),i["static"].name="annotation",i["static"].defineSchema({path:["string"],startOffset:"number",endOffset:"number",_content:{type:"string",optional:!0}}),i["static"].isPropertyAnnotation=!0,Object.defineProperties(i.prototype,{startPath:{get:function(){return this.path}},endPath:{get:function(){return this.path}}}),e.exports=i},{"./DocumentNode":234,"lodash/isEqual":181}],248:[function(t,e,n){"use strict";function i(t,e,n,i,s,u){if(c.call(this),this.path=t,this.startOffset=e,this.endOffset=n,this.reverse=Boolean(i),this.containerId=s,this.surfaceId=u,!t||!a(e))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this._internal.start=new r(this,"path","startOffset"),this._internal.end=new r(this,"path","endOffset"),this._internal.range=new o(this)}function r(t,e,n){this._sel=t,this._pathProp=e,this._offsetProp=n,Object.freeze(this)}function o(t){this._sel=t,this.start=t.start,this.end=t.end,Object.freeze(this)}var s=t("lodash/isEqual"),a=t("lodash/isNumber"),c=t("./Selection"),u=t("./Coordinate"),h=t("./Range");i.Prototype=function(){this.toJSON=function(){return{type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset,reverse:this.reverse,containerId:this.containerId,surfaceId:this.surfaceId}},this.isPropertySelection=function(){return!0},this.getType=function(){return"property"},this.isNull=function(){return!1},this.isCollapsed=function(){return this.startOffset===this.endOffset},this.isReverse=function(){return this.reverse},this.equals=function(t){return c.prototype.equals.call(this,t)&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return["PropertySelection(",JSON.stringify(this.path),", ",this.startOffset," -> ",this.endOffset,this.reverse?", reverse":"",this.surfaceId?", "+this.surfaceId:"",")"].join("")},this.collapse=function(t){var e;return e="left"===t?this.startOffset:this.endOffset,this.createWithNewRange(e,e)},this.getRange=function(){return this.range},this.getPath=function(){return this.path},this.getNodeId=function(){return this.path[0]},this.getStartOffset=function(){return this.startOffset},this.getEndOffset=function(){return this.endOffset},this.isInsideOf=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.contains(this,e):e?s(this.path,t.path)&&this.startOffset>t.startOffset&&this.endOffset<t.endOffset:s(this.path,t.path)&&this.startOffset>=t.startOffset&&this.endOffset<=t.endOffset},this.contains=function(t,e){return t.isNull()?!1:t.isInsideOf(this,e)},this.overlaps=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.overlaps(this):s(this.path,t.path)?e?!(this.startOffset>=t.endOffset||this.endOffset<=t.startOffset):!(this.startOffset>t.endOffset||this.endOffset<t.startOffset):!1},this.isRightAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isRightAlignedWith(this):s(this.path,t.path)&&this.endOffset===t.endOffset},this.isLeftAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isLeftAlignedWith(this):s(this.path,t.path)&&this.startOffset===t.startOffset},this.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!s(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.startOffset,t.startOffset),n=Math.max(this.endOffset,t.endOffset);return this.createWithNewRange(e,n)},this.truncateWith=function(t){if(t.isNull())return this;if(t.isInsideOf(this,"strict"))throw new Error("Can not truncate with a contained selections");if(!this.overlaps(t))return this;var e,n;if(t.isPropertySelection())e=t.startOffset,n=t.endOffset;else{if(!t.isContainerSelection())return this;e=s(t.startPath,this.path)?t.startOffset:this.startOffset,n=s(t.endPath,this.path)?t.endOffset:this.endOffset}var i,r;if(this.startOffset>e&&this.endOffset>n)i=n,r=this.endOffset;else if(this.startOffset<e&&this.endOffset<n)i=this.startOffset,r=e;else if(this.startOffset===e){if(this.endOffset<=n)return c.nullSelection;i=n,r=this.endOffset}else{if(this.endOffset!==n){if(t.contains(this))return c.nullSelection;throw new Error("Illegal state.")}if(this.startOffset>=e)return c.nullSelection;i=this.startOffset,r=e}return this.createWithNewRange(i,r)},this.createWithNewRange=function(t,e){var n=new i(this.path,t,e,!1,this.containerId,this.surfaceId),r=this._internal.doc;return r&&n.attach(r),n},this.getFragments=function(){if(this._internal.fragments)return this._internal.fragments;var t;return t=this.isCollapsed()?[new c.Cursor(this.path,this.startOffset)]:[new c.Fragment(this.path,this.startOffset,this.endOffset)],this._internal.fragments=t,t},this._clone=function(){return new i(this.path,this.startOffset,this.endOffset,this.reverse,this.containerId,this.surfaceId)}},c.extend(i),Object.defineProperties(i.prototype,{start:{get:function(){return this._internal.start},set:function(){throw new Error("PropertySelection.prototype.start is read-only.")},enumerable:!1},end:{get:function(){return this._internal.end},set:function(){throw new Error("PropertySelection.prototype.end is read-only.")},enumerable:!1},range:{get:function(){return this._internal.range},set:function(){throw new Error("PropertySelection.prototype.range is read-only.")},enumerable:!1},startPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1},endPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1}}),i.fromJSON=function(t){var e=t.path,n=t.startOffset,r=t.hasOwnProperty("endOffset")?t.endOffset:t.startOffset,o=t.reverse,s=t.containerId,a=t.surfaceId;return new i(e,n,r,o,s,a)},u.extend(r),Object.defineProperties(r.prototype,{path:{get:function(){return this._sel[this._pathProp]},set:function(t){this._sel[this._pathProp]=t}},offset:{get:function(){return this._sel[this._offsetProp]},set:function(t){this._sel[this._offsetProp]=t}}}),i.CoordinateAdapter=r,h.extend(o),Object.defineProperties(o.prototype,{reverse:{get:function(){return this._sel.reverse},set:function(t){this._sel.reverse=t}},containerId:{get:function(){return this._sel.containerId},set:function(t){this._sel.containerId=t}},surfaceId:{get:function(){return this._sel.surfaceId},set:function(t){this._sel.surfaceId=t}}}),i.RangeAdapter=o,e.exports=i},{"./Coordinate":226,"./Range":249,"./Selection":250,"lodash/isEqual":181,"lodash/isNumber":185}],249:[function(t,e,n){"use strict";function i(t,e,n,i){this.start=t,this.end=e,this.reverse=Boolean(n),this.containerId=i}var r=t("../util/oo");i.Prototype=function(){this._isRange=!0,this.isCollapsed=function(){return this.start.equals(this.end)},this.equals=function(t){return this===t?!0:this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.isReverse=function(){return this.reverse},this.toString=function(){var t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("(reverse)"),t.join("")}},r.initClass(i),e.exports=i},{"../util/oo":379}],250:[function(t,e,n){"use strict";function i(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null}var r=t("../util/oo"),o=t("../util/EventEmitter"),s=t("./Anchor");i.Prototype=function(){this._isSelection=!0,this.clone=function(){var t=this._clone();return this._internal.doc&&t.attach(this._internal.doc),t},this.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},this.isAttached=function(){return Boolean(this._internal.doc)},this.attach=function(t){return this._internal.doc=t,this},this.isNull=function(){return!1},this.isPropertySelection=function(){return!1},this.isContainerSelection=function(){return!1},this.isNodeSelection=function(){return!1},this.isCustomSelection=function(){return!1},this.isCollapsed=function(){return!0},this.isReverse=function(){return!1},this.getType=function(){throw new Error("Selection.getType() is abstract.")},this.equals=function(t){return this===t?!0:t?this.isNull()!==t.isNull()?!1:this.getType()===t.getType():!1},this.toString=function(){return"null"},this.toJSON=function(){throw new Error("This method is abstract.")},this.getFragments=function(){return[]}},r.initClass(i),i.NullSelection=function(){i.call(this)},i.NullSelection.Prototype=function(){this.isNull=function(){return!0},this.getType=function(){return"null"},this.toJSON=function(){return null},this.clone=function(){return this}},i.extend(i.NullSelection),i.nullSelection=Object.freeze(new i.NullSelection),i.fromJSON=function(e){if(!e)return i.nullSelection;var n=e.type;switch(n){case"property":var r=t("./PropertySelection");return r.fromJSON(e);case"container":var o=t("./ContainerSelection");return o.fromJSON(e);case"node":var s=t("./NodeSelection");return s.fromJSON(e);case"custom":var a=t("./CustomSelection");return a.fromJSON(e);default:return i.nullSelection}},i.create=function(){throw new Error("Selection.create() has been removed as it is not possible to create selections consistently without looking into the document.")},i.Fragment=function(t,e,n,i){o.call(this),this.type="selection-fragment",this.path=t,this.startOffset=e,this.endOffset=n||e,this.full=Boolean(i)},i.Fragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1},this.isPropertyFragment=function(){return!0},this.isNodeFragment=function(){return!1},this.isFull=function(){return this.full},this.isPartial=function(){return!this.full},this.getNodeId=function(){return this.path[0]}},o.extend(i.Fragment),i.NodeFragment=function(t){o.call(this),this.type="node-fragment",this.nodeId=t,this.path=[t]},i.NodeFragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1},this.isPropertyFragment=function(){return!1},this.isNodeFragment=function(){return!0},this.isFull=function(){return!0},this.isPartial=function(){return!1},this.getNodeId=function(){return this.nodeId}},o.extend(i.NodeFragment),i.Cursor=function(t,e){s.call(this,t,e),this.type="cursor"},i.Cursor.Prototype=function(){this.isPropertyFragment=function(){return!1},this.isNodeFragment=function(){return!1}},s.extend(i.Cursor),e.exports=i},{"../util/EventEmitter":367,"../util/oo":379,"./Anchor":216,"./ContainerSelection":225,"./CustomSelection":227,"./NodeSelection":244,"./PropertySelection":248}],251:[function(t,e,n){"use strict";function i(t){this.document=t,this.selection=s.nullSelection,this._state={},this._resetState()}var r=t("../util/oo"),o=t("../util/TreeIndex"),s=t("./Selection"),a=t("./documentHelpers");i.Prototype=function(){this.setSelection=function(t){return t?t.attach(this.document):t=s.nullSelection,this._deriveState(t),
this.selection=t,!0},this.getSelection=function(){return this.selection},this.getAnnotationsForType=function(t){var e=this._state;return e.annosByType?e.annosByType.get(t)||[]:[]},this.isInlineNodeSelection=function(){return this._state.isInlineNodeSelection},this._deriveState=function(t){var e=this.document;this._resetState();var n=this._state,i=new o.Arrays,r=a.getPropertyAnnotationsForSelection(e,t);r.forEach(function(t){i.add(t.type,t)}),1===r.length&&r[0].isInline()&&(n.isInlineNodeSelection=r[0].getSelection().equals(t));var s=t.containerId;if(s){var c=a.getContainerAnnotationsForSelection(e,t,s);c.forEach(function(t){i.add(t.type,t)})}n.annosByType=i},this._resetState=function(){return this._state={annosByType:null,isNodeSelection:!1,nodeId:null,nodeSelectionMode:"",isInlineNodeSelection:!1},this._state}},r.initClass(i),e.exports=i},{"../util/TreeIndex":369,"../util/oo":379,"./Selection":250,"./documentHelpers":272}],252:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./TextNode");r.extend(i),i["static"].isBlock=!0,e.exports=i},{"./TextNode":253}],253:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./DocumentNode");i.Prototype=function(){this.getTextPath=function(){return[this.id,"content"]},this.getText=function(){return this.content},this.isEmpty=function(){return!this.content}},r.extend(i),i["static"].name="text",i["static"].isText=!0,i["static"].defineSchema({content:"text"}),e.exports=i},{"./DocumentNode":234}],254:[function(t,e,n){"use strict";function i(t,e){this.__id__="TX_"+d++,this.schema=t.schema,this.nodeFactory=new l(this),this.data=new h(this.schema,{nodeFactory:this.nodeFactory}),this.document=t,this.session=e,this.ops=[],this.before={},s(t.data.indexes,function(t,e){this.data.addIndex(e,t.clone())}.bind(this)),this.loadSeed(t.toJSON())}var r=t("lodash/isFunction"),o=t("lodash/extend"),s=t("lodash/each"),a=t("../util/uuid"),c=t("./Document"),u=t("./DocumentChange"),h=t("./data/IncrementalData"),l=t("./DocumentNodeFactory"),d=0;i.Prototype=function(){this.reset=function(){this.ops=[],this.before={}},this.create=function(t){t.id||(t.id=a(t.type));var e=this.data.create(t);if(e)return this.ops.push(e),this.data.get(t.id)},this["delete"]=function(t){var e=this.data["delete"](t);if(e)return this.ops.push(e),e},this.set=function(t,e){var n=this.data.set(t,e);if(n)return this.ops.push(n),n},this.update=function(t,e){var n=this.data.update(t,e);if(n)return this.ops.push(n),n},this.cancel=function(){this._cancelTransaction()},this.getOperations=function(){return this.ops},this._apply=function(t){t.ops.forEach(function(t){this.data.apply(t)}.bind(this))},this._transaction=function(t){if(!r(t))throw new Error("Document.transaction() requires a transformation function.");this._startTransaction();try{if(t(this,{}),!this._isCancelled)return this._saveTransaction()}finally{this._isSaved||this.cancel(),this.session.isTransacting=!1}},this._startTransaction=function(){this.before={},this.after={},this.info={},this._isCancelled=!1,this._isSaved=!1,this.document.emit("transaction:started",this)},this._saveTransaction=function(){if(!this._isCancelled){var t,e=this.before,n=o({},e,this.after),i=this.ops;return i.length>0&&(t=new u(i,e,n)),this._isSaved=!0,this.reset(),t}},this._cancelTransaction=function(){for(var t=this.ops.length-1;t>=0;t--)this.data.apply(this.ops[t].invert());this._isCancelled=!0,this.reset()},this.newInstance=function(){return this.document.newInstance()},this.isTransactionDocument=!0},c.extend(i),e.exports=i},{"../util/uuid":383,"./Document":231,"./DocumentChange":232,"./DocumentNodeFactory":235,"./data/IncrementalData":262,"lodash/each":164,"lodash/extend":166,"lodash/isFunction":182}],255:[function(t,e,n){"use strict";function i(t){t=s({idAttribute:"id"},t),r.call(this,t),this._el=o.parseXML("<dummy></dummy>")}var r=t("./DOMExporter"),o=t("../ui/DefaultDOMElement"),s=t("lodash/extend"),a=t("lodash/each"),c=t("lodash/isBoolean"),u=t("lodash/isNumber"),h=t("lodash/isString");i.Prototype=function(){var t={tagName:"annotation","export":function(t,e){e.attr("type",t.type);var n=t.toJSON();a(n,function(t,n){"id"!==n&&"type"!==n&&(h(t)||u(t)||c(t))&&e.attr(n,t)})}},e={tagName:"block","export":function(t,e,n){e.attr("type",t.type);var i=t.toJSON();a(i,function(i,r){if("id"!==r&&"type"!==r){var o=n.$$(r);"string"===t.getPropertyType(r)?o.append(n.annotatedText([t.id,r])):o.text(i),e.append(o)}})}};this.getDefaultBlockConverter=function(){return e},this.getDefaultPropertyAnnotationConverter=function(){return t}},r.extend(i),e.exports=i},{"../ui/DefaultDOMElement":328,"./DOMExporter":228,"lodash/each":164,"lodash/extend":166,"lodash/isBoolean":179,"lodash/isNumber":185,"lodash/isString":189}],256:[function(t,e,n){"use strict";function i(t){t=s({idAttribute:"id"},t),r.call(this,t),this._el=o.parseXML("<dummy></dummy>")}var r=t("./DOMImporter"),o=t("../ui/DefaultDOMElement"),s=t("lodash/extend");i.Prototype=function(){this.importDocument=function(t){this.reset();var e=o.parseXML(t);this.convertDocument(e);var n=this.generateDocument();return n}},r.extend(i),e.exports=i},{"../ui/DefaultDOMElement":328,"./DOMImporter":229,"lodash/extend":166}],257:[function(t,e,n){"use strict";var i=t("lodash/each"),r=t("lodash/uniq"),o=t("../util/uuid"),s=function(t,e,n){if(n){var r=t.getIndex("annotations"),o=r.get(e.path);i(o,function(i){var r=e.offset,o=i.startOffset,s=i.endOffset,a=o,c=s;(o>r||r===o)&&(a+=n),(s>r||r===s&&!i.isInline())&&(c+=n),a!==o&&t.set([i.id,"startOffset"],a),c!==s&&t.set([i.id,"endOffset"],c)}),r=t.getIndex("container-annotation-anchors");var s=r.get(e.path);i(s,function(i){var r=e.offset,o=i.offset,s=!1;if((o>r||r===o&&!e.after)&&(o+=n,s=!0),s){var a=i.isStart?"startOffset":"endOffset";t.set([i.id,a],o)}})}},a=function(t,e,n,o){if(n!==o){var s=t.getIndex("annotations"),a=s.get(e),c=o-n;i(a,function(e){var i=n,r=o,s=e.startOffset,a=e.endOffset,u=s,h=a;s>=r?(u-=c,h-=c,t.set([e.id,"startOffset"],u),t.set([e.id,"endOffset"],h)):(s>=i&&(u=s-Math.min(r-i,s-i)),a>=i&&(h=a-Math.min(r-i,a-i)),s!==a&&u===h?t["delete"](e.id):(s!==u&&t.set([e.id,"startOffset"],u),a!==h&&t.set([e.id,"endOffset"],h)))}),s=t.getIndex("container-annotation-anchors");var u=s.get(e),h=[];i(u,function(e){h.push(e.id);var i=n,r=o,s=e.offset,a=!1;if(s>=r)s-=c,a=!0;else if(s>=i){var u=s-Math.min(r-i,s-i);s!==u&&(s=u,a=!0)}if(a){var l=e.isStart?"startOffset":"endOffset";t.set([e.id,l],s)}}),i(r(h),function(e){var n=t.get(e),i=n.getSelection();i.isCollapsed()&&t["delete"](e)})}},c=function(t,e,n,s,a){var c=t.getIndex("annotations"),u=c.get(e,n);i(u,function(e){var i,r,c=n>e.startOffset&&n<e.endOffset,u=e.startOffset,h=e.endOffset;if(c){if(e.canSplit()){var l=e.toJSON();l.id=o(e.type+"_"),l.startOffset=a,l.endOffset=a+e.endOffset-n,l.path=s,t.create(l)}i=e.startOffset,r=n,r===i?t["delete"](e.id):(i!==u&&t.set([e.id,"startOffset"],i),r!==h&&t.set([e.id,"endOffset"],r))}else e.startOffset>=n&&(i=a+e.startOffset-n,r=a+e.endOffset-n,t.set([e.id,"path"],s),t.set([e.id,"startOffset"],i),t.set([e.id,"endOffset"],r))}),c=t.getIndex("container-annotation-anchors");var h=c.get(e),l=[];i(h,function(e){l.push(e.id);var i=e.offset;if(i>=n){var r=e.isStart?"startPath":"endPath",o=e.isStart?"startOffset":"endOffset";t.set([e.id,r],s),t.set([e.id,o],a+e.offset-n)}}),i(r(l),function(e){var n=t.get(e),i=n.getSelection();i.isCollapsed()&&t["delete"](e)})};e.exports={insertedText:s,deletedText:a,transferAnnotations:c}},{"../util/uuid":383,"lodash/each":164,"lodash/uniq":211}],258:[function(t,e,n){"use strict";function i(t){if(h.call(this),!t||!t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==d){if(this.type!==p&&this.type!==f)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!a(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}}function r(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function o(t,e){return t.pos===e.pos?(e.type=d,void(t.type=d)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function s(t,e){if(t.type===f){var n=t;t=e,e=n}t.pos<=e.pos?e.pos+=1:t.pos-=1}var a=t("lodash/isNumber"),c=t("lodash/isEqual"),u=t("lodash/cloneDeep"),h=t("./Operation"),l=t("./Conflict"),d="NOP",f="delete",p="insert";i.fromJSON=function(t){return new i(t)},i.Prototype=function(){this._isArrayOperation=!0,this.apply=function(t){if(this.type===d)return t;if(this.type===p){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!c(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},this.clone=function(){var t={type:this.type,pos:this.pos,val:u(this.val)};return new i(t)},this.invert=function(){var t=this.toJSON();return this.type===d?t.type=d:this.type===p?t.type=f:t.type=p,new i(t)},this.hasConflict=function(t){return i.hasConflict(this,t)},this.toJSON=function(){var t={type:this.type};return this.type===d?t:(t.pos=this.pos,t.val=u(this.val),t)},this.isInsert=function(){return this.type===p},this.isDelete=function(){return this.type===f},this.getOffset=function(){return this.pos},this.getValue=function(){return this.val},this.isNOP=function(){return this.type===d},this.toString=function(){return["(",this.isInsert()?p:f,",",this.getOffset(),",'",this.getValue(),"')"].join("")}},h.extend(i);var g=function(t,e){return t.type===d||e.type===d?!1:t.type===p&&e.type===p?t.pos===e.pos:!1},m=function(t,e,n){if(n=n||{},n["no-conflict"]&&g(t,e))throw new l(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===d||e.type===d||(t.type===p&&e.type===p?r(t,e):t.type===f&&e.type===f?o(t,e):s(t,e)),[t,e]};i.transform=m,i.hasConflict=g,i.Insert=function(t,e){return new i({type:p,pos:t,val:e})},i.Delete=function(t,e){return new i({type:f,pos:t,val:e})},i.NOP=d,i.DELETE=f,i.INSERT=p,e.exports=i},{"./Conflict":259,"./Operation":268,"lodash/cloneDeep":163,"lodash/isEqual":181,"lodash/isNumber":185}],259:[function(t,e,n){"use strict";function i(t,e){Error.call(this,"Conflict: "+JSON.stringify(t)+" vs "+JSON.stringify(e)),this.a=t,this.b=e}i.prototype=Error.prototype,e.exports=i},{}],260:[function(t,e,n){"use strict";function i(t,e){c.call(this),e=e||{},this.schema=t,this.nodes=new u,this.indexes={},this.options=e||{},this.nodeFactory=e.nodeFactory||new h(t.nodeRegistry),this.__QUEUE_INDEXING__=!1,this.queue=[]}var r=t("lodash/isArray"),o=t("lodash/isString"),s=t("lodash/each"),a=t("lodash/cloneDeep"),c=t("../../util/EventEmitter"),u=t("./DataObject"),h=t("./NodeFactory");i.Prototype=function(){this.contains=function(t){return Boolean(this.nodes[t])},this.get=function(t,e){if(!t)throw new Error("Path or id required");var n=this.nodes.get(t);if(e&&void 0===n)throw o(t)?new Error("Could not find node with id '"+t+"'."):new Error("Property for path '"+t+"' us undefined.");return n},this.getNodes=function(){return this.nodes},this.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var n={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},this["delete"]=function(t){var e=this.nodes[t];e.dispose(),delete this.nodes[t];var n={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),e},this.set=function(t,e){var n=this.get(t[0]),i=this.nodes.get(t);this.nodes.set(t,e);var r={type:"set",node:n,path:t,newValue:e,oldValue:i};return this.__QUEUE_INDEXING__?this.queue.push(r):this._updateIndexes(r),i},this.update=function(t,e){var n,i=this.nodes.get(t);if(e.isOperation)n=e.apply(i);else{var s,a,c,u;if(o(i))if(e["delete"])s=e["delete"].start,a=e["delete"].end,n=i.split("").splice(s,a-s).join("");else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));c=e.insert.offset,u=e.insert.value,n=[i.substring(0,c),u,i.substring(c)].join("")}else{if(!r(i))throw new Error("Diff is not supported:",JSON.stringify(e));if(n=i.slice(0),e["delete"])c=e["delete"].offset,n.splice(c,1);else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));c=e.insert.offset,u=e.insert.value,n.splice(c,0,u)}}}this.nodes.set(t,n);var h=this.get(t[0]),l={type:"update",node:h,path:t,newValue:n,oldValue:i};return this.__QUEUE_INDEXING__?this.queue.push(l):this._updateIndexes(l),i},this.toJSON=function(){return{schema:[this.schema.id,this.schema.version],nodes:a(this.nodes)}},this.reset=function(){this.nodes.clear()},this.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},this.getIndex=function(t){return this.indexes[t]},this._updateIndexes=function(t){t&&!this.__QUEUE_INDEXING__&&s(this.indexes,function(e){e.select(t.node)&&(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),e[t.type](t.node,t.path,t.newValue,t.oldValue))})},this._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},this._startIndexing=function(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var t=this.queue.shift();this._updateIndexes(t)}}},c.extend(i),e.exports=i},{"../../util/EventEmitter":367,"./DataObject":261,"./NodeFactory":264,"lodash/cloneDeep":163,"lodash/each":164,"lodash/isArray":176,"lodash/isString":189}],261:[function(t,e,n){"use strict";function i(t){t&&(this.__root__=t)}var r=t("lodash/isString"),o=t("lodash/isArray"),s=t("lodash/get"),a=t("lodash/setWith"),c=t("lodash/unset"),u=t("../../util/oo");i.Prototype=function(){this._isDataObject=!0,this.getRoot=function(){return this.__root__?this.__root__:this},this.get=function(t){if(t){if(r(t))return this.getRoot()[t];if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!o(t))throw new Error("Illegal argument for DataObject.get()");return s(this.getRoot(),t)}},this.set=function(t,e){if(!t)throw new Error("Illegal argument: DataObject.set(>path<, value) - path is mandatory.");r(t)?this.getRoot()[t]=e:a(this.getRoot(),t,e)},this["delete"]=function(t){if(r(t))delete this.getRoot()[t];else if(1===t.length)delete this.getRoot()[t[0]];else{var e=c(this.getRoot(),t);if(!e)throw new Error("Could not delete property at path"+t)}},this.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]}},u.initClass(i),e.exports=i},{"../../util/oo":379,"lodash/get":171,"lodash/isArray":176,"lodash/isString":189,"lodash/setWith":203,"lodash/unset":212}],262:[function(t,e,n){"use strict";function i(t,e){i["super"].call(this,t,e)}var r=t("lodash/isString"),o=t("lodash/isArray"),s=t("lodash/cloneDeep"),a=t("./Data"),c=t("./ObjectOperation"),u=t("./ArrayOperation"),h=t("./TextOperation");i.Prototype=function(){var t=i["super"].prototype;this.create=function(t){var e=c.Create([t.id],t);return this.apply(e),e},this["delete"]=function(t){var e=null,n=this.get(t);if(n){var i=n.toJSON();e=c.Delete([t],i),this.apply(e)}return e},this.update=function(t,e){var n=this._getDiffOp(t,e),i=c.Update(t,n);return this.apply(i),i},this.set=function(t,e){var n=this.get(t),i=c.Set(t,n,e);return this.apply(i),i},this.apply=function(e){if(e.type!==c.NOP){if(e.type===c.CREATE)t.create.call(this,s(e.val));else if(e.type===c.DELETE)t["delete"].call(this,e.val.id);else if(e.type===c.UPDATE){var n=this.get(e.path),i=e.diff;if("array"===e.propertyType)i._isArrayOperation||(i=u.fromJSON(i)),i.apply(n);else{if("string"!==e.propertyType)throw new Error("Unsupported type for operational update.");i._isTextOperation||(i=h.fromJSON(i));var r=i.apply(n);t.set.call(this,e.path,r)}}else{if(e.type!==c.SET)throw new Error("Illegal state.");t.set.call(this,e.path,e.val)}this.emit("operation:applied",e,this)}},this._getDiffOp=function(t,e){var n=null;if(e.isOperation)n=e;else{var i,s,a,c,l=this.get(t);if(null===l||void 0===l)throw new Error("Property has not been initialized: "+JSON.stringify(t));r(l)?e["delete"]?(i=e["delete"].start,s=e["delete"].end,n=h.Delete(i,l.substring(i,s))):e.insert&&(a=e.insert.offset,c=e.insert.value,n=h.Insert(a,c)):o(l)&&(e["delete"]?(a=e["delete"].offset,n=u.Delete(a,l[a])):e.insert&&(a=e.insert.offset,c=e.insert.value,n=u.Insert(a,c)))}if(!n)throw new Error("Unsupported diff: "+JSON.stringify(e));return n}},a.extend(i),e.exports=i},{"./ArrayOperation":258,"./Data":260,"./ObjectOperation":267,"./TextOperation":271,"lodash/cloneDeep":163,"lodash/isArray":176,"lodash/isString":189}],263:[function(t,e,n){"use strict";function i(t){y.call(this);var e=this.constructor;if(!e["static"].name)throw new Error('Every NodeClass must provide a static property "name".');var n=e["static"].schema;for(var i in n)if(n.hasOwnProperty(i)){var r=n[i],o=void 0!==t[i],s=r.hasOwnProperty("default"),a=r.optional;if(!a&&!s&&!o)throw new Error("Property "+i+" is mandatory for node type "+this.type);o?this[i]=u(r,t[i]):s&&(this[i]=g(u(r,r["default"])))}}function r(t,e){var n=o(e);if(t["static"].schema=a(t,n),t["static"].defaultProps=c(t),!t["static"].hasOwnProperty("addressablePropertyNames")){var i=[];m(t["static"].schema,function(t,e){"string"===t.type&&t.addressable===!0&&i.push(e)}),t["static"].addressablePropertyNames=i}}function o(t){var e={};return m(t,function(t,n){(d(t)||f(t))&&(t={type:t}),t=s(t),t.name=n,e[n]=t}),e}function s(t){var e=t;return f(t.type)&&"array"!==t[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string",addressable:!0,"default":""}),e}function a(t,e){for(var n=[e],i=t;i;){var r=Object.getPrototypeOf(i.prototype);if(!r)break;i=r.constructor,i&&i["static"]&&i["static"].schema&&n.unshift(i["static"].schema)}return n.unshift({}),v.apply(null,n)}function c(t){var e=t["static"].unfoldedSchema,n={};return m(e,function(t,e){t.hasOwnProperty("default")&&(n[e]=t["default"])}),n}function u(t,e){var n;if(n=f(t.type)?"array":t.type,null===e){if(t.notNull)throw new Error("Value for property "+t.name+" is null.");return e}if(void 0===e)throw new Error("Value for property "+t.name+" is undefined.");if("string"===n&&!d(e)||"boolean"===n&&!h(e)||"number"===n&&!l(e)||"array"===n&&!f(e)||"id"===n&&!d(e)||"object"===n&&!p(e))throw new Error("Illegal value type for property "+t.name+": expected "+n+", was "+typeof e);return e}var h=t("lodash/isBoolean"),l=t("lodash/isNumber"),d=t("lodash/isString"),f=t("lodash/isArray"),p=t("lodash/isObject"),g=t("lodash/cloneDeep"),m=t("lodash/each"),v=t("lodash/extend"),y=t("../../util/EventEmitter");i.Prototype=function(){this._isNode=!0,this.dispose=function(){},this.isInstanceOf=function(t){return i.isInstanceOf(this.constructor,t)},this.getTypeNames=function(){for(var t=[],e=this.constructor["static"];e&&"node"!==e.name;)t.push(e.name),e=Object.getPrototypeOf(e);return t},this.getPropertyType=function(t){var e=this.constructor["static"].schema;return e[t].type},this.toJSON=function(){var t={type:this.constructor["static"].name};return m(this.constructor["static"].schema,function(e,n){t[e.name]=this[n]}.bind(this)),t}},y.extend(i),i["static"].name="node",i["static"].defineSchema=function(t){var e=this.__class__;r(e,t)},i["static"].defineSchema({id:"string"}),Object.defineProperty(i.prototype,"type",{configurable:!1,get:function(){return this.constructor["static"].name},set:function(){throw new Error('Property "type" is read-only.')}}),i.isInstanceOf=function(t,e){for(var n=t["static"];n&&"node"!==n.name;){if(n&&n.name===e)return!0;n=Object.getPrototypeOf(n)}return!1},i["static"].isInstanceOf=i.isInstanceOf,e.exports=i},{"../../util/EventEmitter":367,"lodash/cloneDeep":163,"lodash/each":164,"lodash/extend":166,"lodash/isArray":176,"lodash/isBoolean":179,"lodash/isNumber":185,"lodash/isObject":186,"lodash/isString":189}],264:[function(t,e,n){"use strict";function i(t){this.nodeRegistry=t}var r=t("../../util/oo");i.Prototype=function(){this.create=function(t,e){var n=this.nodeRegistry.get(t);if(!n)throw new Error("No Node registered by that name: "+t);return new n(e)}},r.initClass(i),e.exports=i},{"../../util/oo":379}],265:[function(t,e,n){"use strict";function i(){this.index=new c}var r=t("../../util/oo"),o=t("lodash/isArray"),s=t("lodash/each"),a=t("lodash/extend"),c=t("../../util/TreeIndex");i.Prototype=function(){this.get=function(t){return this.index.get(t)||{}},this.getAll=function(t){return this.index.getAll(t)},this.property="id",this.select=function(t){return this.type?t.isInstanceOf(this.type):!0},this.create=function(t){var e=t[this.property];o(e)||(e=[e]),s(e,function(e){this.index.set([e,t.id],t)}.bind(this))},this["delete"]=function(t){var e=t[this.property];o(e)||(e=[e]),s(e,function(e){this.index["delete"]([e,t.id])}.bind(this))},this.update=function(t,e,n,i){if(this.select(t)&&e[1]===this.property){var r=i;o(r)||(r=[r]),s(r,function(e){this.index["delete"]([e,t.id])}.bind(this)),r=n,o(r)||(r=[r]),s(r,function(e){this.index.set([e,t.id],t)}.bind(this))}},this.set=function(t,e,n,i){this.update(t,e,n,i)},this.reset=function(t){this.index.clear(),this._initialize(t)},this.clone=function(){var t=this.constructor,e=new t;return e},this._initialize=function(t){s(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))}},r.initClass(i),i.create=function(t){var e=a(new i,t);return e.clone=function(){return i.create(t)},e},i.filterByType=function(t){return function(e){return e.isInstanceOf(t)}},e.exports=i},{"../../util/TreeIndex":369,"../../util/oo":379,"lodash/each":164,"lodash/extend":166,"lodash/isArray":176}],266:[function(t,e,n){"use strict";function i(){r.call(this)}var r=t("../../util/Registry");i.Prototype=function(){this.register=function(t){var e=t["static"]&&t["static"].name;if("string"!=typeof e||""===e)throw new Error("Node names must be strings and must not be empty");if(!t.prototype._isNode)throw new Error("Nodes must be subclasses of Substance.Data.Node");if(this.contains(e))throw new Error("Node class is already registered: "+e);this.add(e,t)}},r.extend(i),e.exports=i},{"../../util/Registry":368}],267:[function(t,e,n){"use strict";function i(t){if(c.call(this),!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==d){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===f||this.type===p){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===g){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff._isTextOperation)this.propertyType="string";else{if(!t.diff._isArrayOperation)throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="array"}}else{if(this.type!==m)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}}var r=t("lodash/isString"),o=t("lodash/isEqual"),s=t("lodash/cloneDeep"),a=t("./DataObject"),c=t("./Operation"),u=t("./TextOperation"),h=t("./ArrayOperation"),l=t("./Conflict"),d="NOP",f="create",p="delete",g="update",m="set";i.fromJSON=function(t){if(t=s(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=u.fromJSON(t.diff);break;case"array":t.diff=h.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new i(t);return e},i.Prototype=function(){this._isObjectOperation=!0,this.apply=function(t){if(this.type===d)return t;var e;if(e=t._isDataObject?t:new a(t),this.type===f)return e.set(this.path,s(this.val)),t;if(this.type===p)e["delete"](this.path,"strict");else if(this.type===g){var n,i=this.diff,r=e.get(this.path);n=i._isArrayOperation?i.apply(r):i.apply(r),e.set(this.path,n)}else e.set(this.path,s(this.val));return t},this.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=s(this.val)),this.diff&&(t.diff=this.diff.clone()),new i(t)},this.isNOP=function(){return this.type===d?!0:this.type===g?this.diff.isNOP():void 0},this.isCreate=function(){return this.type===f},this.isDelete=function(){return this.type===p},this.isUpdate=function(t){return t?this.type===g&&this.propertyType===t:this.type===g},this.isSet=function(){return this.type===m},this.invert=function(){if(this.type===d)return new i({type:d});var t=new i(this);if(this.type===f)t.type=p;else if(this.type===p)t.type=f;else if(this.type===g){var e;e=this.diff._isTextOperation?u.fromJSON(this.diff.toJSON()).invert():h.fromJSON(this.diff.toJSON()).invert(),t.diff=e}else t.val=this.original,t.original=this.val;return t},this.hasConflict=function(t){return i.hasConflict(this,t)},this.toJSON=function(){if(this.type===d)return{type:d};var t={type:this.type,path:this.path};return this.type===f||this.type===p?t.val=this.val:this.type===g?(this.diff._isArrayOperation?t.propertyType="array":t.propertyType="string",t.diff=this.diff.toJSON()):(t.val=this.val,t.original=this.original),t},this.getType=function(){return this.type},this.getPath=function(){return this.path},this.getValue=function(){return this.val},this.getOldValue=function(){return this.original},this.getValueOp=function(){return this.diff},this.toString=function(){switch(this.type){case f:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case p:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case g:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case m:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("");case d:return"NOP";default:throw new Error("Invalid type")}}},c.extend(i);var v=function(t,e){return t.type===d||e.type===d?!1:o(t.path,e.path)},y=function(t,e){t.type=d,e.type=d},_=function(){throw new Error("Can not transform two concurring creates of the same property")},x=function(){throw new Error("Illegal state: can not create and delete a value at the same time.")},b=function(t,e,n){if(t.type!==p)return b(e,t,!0);var i;i="string"===e.propertyType?u.fromJSON(e.diff):h.fromJSON(e.diff),n?(t.val=i.apply(t.val),e.type=d):(t.type=d,e.type=f,e.val=i.apply(t.val))},C=function(){throw new Error("Can not transform a concurring create and update of the same property")},w=function(t,e){var n,i,r;"string"===e.propertyType?(n=u.fromJSON(t.diff),i=u.fromJSON(e.diff),r=u.transform(n,i,{inplace:!0})):(n=h.fromJSON(t.diff),i=h.fromJSON(e.diff),r=h.transform(n,i,{inplace:!0})),t.diff=r[0],e.diff=r[1]},S=function(){throw new Error("Illegal state: can not create and set a value at the same time.")},E=function(t,e,n){return t.type!==p?E(e,t,!0):void(n?(t.val=e.val,e.type=d):(t.type=d,e.type=f,e.original=void 0))},N=function(){throw new Error("Unresolvable conflict: update + set.")},P=function(t,e){t.type=d,e.original=t.val},O=0,I=1,T=2,A=4,D=8,M={};M[d]=O,M[f]=I,M[p]=T,M[g]=A,M[m]=D;var k=[];k[T|T]=y,k[T|I]=x,k[T|A]=b,k[I|I]=_,k[I|A]=C,k[A|A]=w,k[I|D]=S,k[T|D]=E,k[A|D]=N,k[D|D]=P;var L=function(t,e,n){if(n=n||{},n["no-conflict"]&&v(t,e))throw new l(t,e);if(n.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var i=o(t.path,e.path);return i&&k[M[t.type]|M[e.type]](t,e),[t,e]};i.transform=L,i.hasConflict=v,i.Create=function(t,e){var n;return n=r(t)?[t]:t,new i({type:f,path:n,val:e})},i.Delete=function(t,e){var n;return n=r(t)?[t]:t,new i({type:p,path:n,val:e})},i.Update=function(t,e){return new i({type:g,path:t,diff:e})},i.Set=function(t,e,n){return new i({type:m,path:t,val:s(n),original:s(e)})},i.NOP=d,i.CREATE=f,i.DELETE=p,i.UPDATE=g,i.SET=m,e.exports=i},{"./ArrayOperation":258,"./Conflict":259,"./DataObject":261,"./Operation":268,"./TextOperation":271,"lodash/cloneDeep":163,"lodash/isEqual":181,"lodash/isString":189}],268:[function(t,e,n){"use strict";function i(){}var r=t("../../util/oo");i.Prototype=function(){this.isOperation=!0},r.initClass(i),e.exports=i},{"../../util/oo":379}],269:[function(t,e,n){"use strict";function i(){this.SEPARATOR="	"}function r(t,e){o(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1}var o=t("lodash/isArray"),s=t("lodash/isNumber"),a=t("lodash/isObject"),c=t("../../util/oo"),u=t("./ObjectOperation"),h=t("./TextOperation"),l=t("./ArrayOperation");i.Prototype=function(){this.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},this.serializePrimitiveOp=function(t){var e=[];if(t._isTextOperation)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else{if(!t._isArrayOperation)throw new Error("Unsupported operation type.");t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val)}return e},this.deserialize=function(t,e){e||(e=new r(t,this.SEPARATOR));var n,i,o,s,a,c=e.getString();switch(c){case"c":i=e.getPath(),o=e.getObject(),n=u.Create(i,o);break;case"d":i=e.getPath(),o=e.getObject(),n=u.Delete(i,o);break;case"s":i=e.getPath(),o=e.getAny(),s=e.getAny(),n=u.Set(i,s,o);break;case"u":i=e.getPath(),a=this.deserializePrimitiveOp(t,e),n=u.Update(i,a);break;default:throw new Error("Illegal type for ObjectOperation: "+c)}return n},this.deserializePrimitiveOp=function(t,e){e||(e=new r(t,this.SEPARATOR));var n,i,o,s=e.getString();switch(s){case"t+":i=e.getNumber(),o=e.getString(),n=h.Insert(i,o);break;case"t-":i=e.getNumber(),o=e.getString(),n=h.Delete(i,o);break;case"a+":i=e.getNumber(),o=e.getAny(),n=l.Insert(i,o);break;case"a-":i=e.getNumber(),o=e.getAny(),n=l.Delete(i,o);break;default:throw new Error("Unsupported operation type: "+s)}return n}},c.initClass(i),r.Prototype=function(){this.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},this.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},this.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=s(e)?e:parseInt(this.tokens[this.pos],10)}catch(n){this.error("expected number")}},this.getObject=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=a(e)?e:JSON.parse(this.tokens[this.pos])}catch(n){this.error("expected object")}},this.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},this.getPath=function(){var t=this.getString();return t.split(".")}},c.initClass(r),i.Tokenizer=r,e.exports=i},{"../../util/oo":379,"./ArrayOperation":258,"./ObjectOperation":267,"./TextOperation":271,"lodash/isArray":176,"lodash/isNumber":185,"lodash/isObject":186}],270:[function(t,e,n){"use strict";function i(t,e){this.name=t,this.version=e,this.nodeRegistry=new s,this.tocTypes=[],this.addNodes(this.getBuiltIns())}var r=t("lodash/each"),o=t("../../util/oo"),s=t("./NodeRegistry"),a=t("./Node");i.Prototype=function(){this.addNodes=function(t){t&&r(t,function(t){t.prototype._isNode?this.addNode(t):console.error("Illegal node class: ",t)}.bind(this))},this.addNode=function(t){this.nodeRegistry.register(t),t["static"].tocType&&this.tocTypes.push(t["static"].name)},this.getNodeClass=function(t){return this.nodeRegistry.get(t)},this.getBuiltIns=function(){return[]},this.isInstanceOf=function(t,e){var n=this.getNodeClass(t);return n?a["static"].isInstanceOf(n,e):!1},this.each=function(){this.nodeRegistry.each.apply(this.nodeRegistry,arguments)},this.getTocTypes=function(){return this.tocTypes},this.getDefaultTextType=function(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")},this.getNodeSchema=function(t){var e=this.getNodeClass(t);return e?e["static"].schema:(console.error("Unknown node type ",t),null)}},o.initClass(i),e.exports=i},{"../../util/oo":379,"./Node":263,
"./NodeRegistry":266,"lodash/each":164}],271:[function(t,e,n){"use strict";function i(t){if(h.call(this),!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!c(this.str))throw new Error("Illegal argument: expecting string.");if(!u(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}function r(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function o(t,e,n){if(t.pos>e.pos)return o(e,t,!n);if(t.pos===e.pos&&t.str.length>e.str.length)return o(e,t,!n);if(e.pos<t.pos+t.str.length){var i=e.pos-t.pos,r=t.str.length-i,s=i+e.str.length;t.str=t.str.slice(0,i)+t.str.slice(s),e.str=e.str.slice(r),e.pos-=i}else e.pos-=t.str.length}function s(t,e){if(t.type===f)return s(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var n=t.pos-e.pos;e.str=e.str.slice(0,n)+t.str+e.str.slice(n),t.str=""}}var a,c=t("lodash/isString"),u=t("lodash/isNumber"),h=t("./Operation"),l=t("./Conflict"),d="insert",f="delete";i.fromJSON=function(t){return new i(t)},i.Prototype=function(){this._isTextOperation=!0,this.apply=function(t){if(this.isEmpty())return t;if(this.type===d){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},this.clone=function(){return new i(this)},this.isNOP=function(){return"NOP"===this.type||0===this.str.length},this.isInsert=function(){return this.type===d},this.isDelete=function(){return this.type===f},this.getLength=function(){return this.str.length},this.invert=function(){var t={type:this.isInsert()?f:d,pos:this.pos,str:this.str};return new i(t)},this.hasConflict=function(t){return a(this,t)},this.isEmpty=function(){return 0===this.str.length},this.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},this.toString=function(){return["(",this.isInsert()?d:f,",",this.pos,",'",this.str,"')"].join("")}},h.extend(i),a=function(t,e){if(t.type===d&&e.type===d)return t.pos===e.pos;if(t.type===f&&e.type===f)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var n,i;return t.type===f?(n=t,i=e):(n=e,i=t),i.pos>=n.pos&&i.pos<n.pos+n.str.length};var p=function(t,e,n){if(n=n||{},n["no-conflict"]&&a(t,e))throw new l(t,e);return n.inplace||(t=t.clone(),e=e.clone()),t.type===d&&e.type===d?r(t,e):t.type===f&&e.type===f?o(t,e,!0):s(t,e),[t,e]};i.transform=function(){return p.apply(null,arguments)},i.Insert=function(t,e){return new i({type:d,pos:t,str:e})},i.Delete=function(t,e){return new i({type:f,pos:t,str:e})},i.INSERT=d,i.DELETE=f,e.exports=i},{"./Conflict":259,"./Operation":268,"lodash/isNumber":185,"lodash/isString":189}],272:[function(t,e,n){"use strict";var i=t("lodash/isString"),r=t("lodash/filter"),o=t("./DocumentIndex"),s=t("./Selection"),a={};a.isContainerAnnotation=function(t,e){var n=t.getSchema();return n.isInstanceOf(e,"container-annotation")},a.getPropertyAnnotationsForSelection=function(t,e,n){if(n=n||{},!e.isPropertySelection())return[];var i=t.getIndex("annotations").get(e.path,e.startOffset,e.endOffset);return n.type&&(i=r(i,o.filterByType(n.type))),i},a.getContainerAnnotationsForSelection=function(t,e,n,i){if(!n)throw new Error("'containerId' is required.");i=i||{};var o=t.getIndex("container-annotations"),s=o.get(n,i.type);return s=r(s,function(t){return e.overlaps(t.getSelection())})},a.getAnnotationsForSelection=function(t,e,n,i){var r,o=a.isContainerAnnotation(t,n);if(o){var s=t.get(i,"strict");r=a.getContainerAnnotationsForSelection(t,e,s,{type:n})}else r=a.getPropertyAnnotationsForSelection(t,e,{type:n});return r},a.getTextForSelection=function(t,e){var n;if(!e||e.isNull())return"";if(e.isPropertySelection())return n=t.get(e.start.path),n.substring(e.start.offset,e.end.offset);if(e.isContainerSelection()){var r=[],o=e.getFragments();return o.forEach(function(e){if(e instanceof s.Fragment){var n=t.get(e.path);i(n)&&r.push(n.substring(e.startOffset,e.endOffset))}}),r.join("\n")}},e.exports=a},{"./DocumentIndex":233,"./Selection":250,"lodash/filter":167,"lodash/isString":189}],273:[function(t,e,n){"use strict";function i(t,e){if(!e.selection)throw new Error("Argument 'selection' is mandatory.");if(!e.containerId)throw new Error("Argument 'containerId' is mandatory.");e.selection.isCollapsed()||(e=a(t,e));var n=e.selection;if(n.isNodeSelection())return n.isFull()?e:o(t,e);var i=t.get(n.start.path[0]),s=e.editingBehavior;if(s&&s.canBreak(i.type)){var c=s.getBreaker(i.type);return c.call(c,t,e)}return i.isText()?r(t,e):(console.info("Breaking is not supported for node type %s.",i.type),e)}function r(t,e){var n=e.selection,i=e.containerId;if(!n.isPropertySelection())throw new Error("Expected property selection.");var r,o=n.path,a=n.startOffset,u=t.get(o[0]),h=u.getText(),l=t.get(i),d=l.getPosition(u.id),f=s(u.type),p=[f,"content"];return 0===a?(r=t.create({id:f,type:u.type,content:""}),l.show(f,d),n=t.createSelection(o,0)):(r=u.toJSON(),r.id=f,r.content=h.substring(a),a===h.length&&(r.type=t.getSchema().getDefaultTextType()),t.create(r),a<h.length&&(c.transferAnnotations(t,o,a,[f,"content"],0),t.update(o,{"delete":{start:a,end:h.length}})),l.show(f,d+1),n=t.createSelection(p,0)),e.selection=n,e.node=r,e}function o(t,e){var n=e.selection,i=e.containerId;if(!n)throw new Error("Illegal argument: selection is mandatory.");if(!i)throw new Error("Illegal argument: containerId is mandatory.");if(!n.isNodeSelection())throw new Error("Illegal argument: selection should be a NodeSelection");var r,o=t.get(i),s=n.getNodeId(),a=o.getPosition(s),c=t.getSchema().getDefaultTextType(),u=t.create({type:c,content:""});return n.isBefore()?(o.show(u.id,a),r=n):(o.show(u.id,a+1),r=t.createSelection([u.id,"content"],0)),e.selection=r,e.node=u,e}var s=t("../../util/uuid"),a=t("./deleteSelection"),c=t("../annotationHelpers");e.exports=i},{"../../util/uuid":383,"../annotationHelpers":257,"./deleteSelection":278}],274:[function(t,e,n){"use strict";function i(t,e){var n=e.selection;if(!n||!n._isSelection)throw new Error("'selection' is mandatory.");return n.isNull()||n.isCollapsed()?e.doc=null:n.isPropertySelection()?e.doc=r(t,n):n.isContainerSelection()?e.doc=o(t,n):n.isNodeSelection()?e.doc=s(t,n):(console.error("Copy is not yet supported for selection type."),e.doc=null),e}function r(t,e){var n=t.newInstance(),i=e.start.path,r=e.start.offset,o=e.end.offset,s=t.get(i),a=n.get(d);a||(a=n.create({type:"container",id:d,nodes:[]})),n.create({type:t.schema.getDefaultTextType(),id:f,content:s.substring(r,o)}),a.show(f);var h=t.getIndex("annotations").get(i,r,o);return u(h,function(t){var e=c(t.toJSON());e.path=[f,"content"],e.startOffset=Math.max(r,t.startOffset)-r,e.endOffset=Math.min(o,t.endOffset)-r,n.create(e)}),n}function o(t,e){var n=t.newInstance(),i=t.get(e.containerId),r=n.create({type:"container",id:d,nodes:[]}),o=e.getFragments();if(0===o.length)return n;for(var s={},c=0;c<o.length;c++){var u=o[c],f=u.getNodeId(),p=t.get(f);s[f]||(a(n,p,i,s),r.show(f))}var g,m,v,y=o[0],_=h(o);return y.isPropertyFragment()&&(g=y.path,m=y.startOffset,v=t.get(g),n.update(g,{"delete":{start:0,end:m}}),l.deletedText(n,g,0,m)),_.isPropertyFragment()&&(g=_.path,m=_.endOffset,v=t.get(g),n.update(g,{"delete":{start:m,end:v.length}}),l.deletedText(n,g,m,v.length)),n}function s(t,e){var n=t.newInstance(),i=t.get(e.containerId),r=n.create({type:"container",id:d,nodes:[]}),o=e.getNodeId(),s=t.get(o);return a(n,s,i,{}),r.show(s.id),n}function a(t,e,n,i){if(e.hasChildren()){var r=e.getChildren();r.forEach(function(e){a(t,e,n,i)})}i[e.id]=t.create(e.toJSON());var o=t.getIndex("annotations"),s=o.get([e.id]);u(s,function(e){t.create(c(e.toJSON()))})}var c=t("lodash/cloneDeep"),u=t("lodash/each"),h=t("lodash/last"),l=t("../annotationHelpers"),d="clipboard_content",f="clipboard_property";i.CLIPBOARD_CONTAINER_ID=d,i.CLIPBOARD_PROPERTY_ID=f,e.exports=i},{"../annotationHelpers":257,"lodash/cloneDeep":163,"lodash/each":164,"lodash/last":195}],275:[function(t,e,n){"use strict";function i(t,e){var n=e.selection;if(!n)throw new Error("selection is required.");var i=e.annotationType,s=e.annotationData,c=e.node;if(!c&&i&&(console.warn('DEPRECATED: Use node: {type: "strong"} instead of annotationType: "strong"'),c={type:i},o(c,s)),!c)throw new Error("node is required");if(!n.isPropertySelection()&&!n.isContainerSelection()||n.isCollapsed())throw new Error("Invalid selection for createAnnotation");if(n.isContainerSelection()&&e.splitContainerSelections)return r(t,e);if(a.isContainerAnnotation(t,c.type))c.startPath=n.startPath,c.endPath=n.endPath,c.containerId=n.containerId;else{if(!n.isPropertySelection())throw new Error("Illegal state: can not apply ContainerSelection");c.path=n.path}return c.startOffset=n.startOffset,c.endOffset=n.endOffset,e.result=t.create(c),e}function r(t,e){var n,i=e.selection,r=e.node;i.isPropertySelection()?n=[]:i.isContainerSelection()&&(n=i.splitIntoPropertySelections());for(var a=0;a<n.length;a++){var c={id:s(r.type)};o(c,r),c.path=n[a].getPath(),c.startOffset=n[a].startOffset,c.endOffset=n[a].endOffset,t.create(c)}}var o=t("lodash/extend"),s=t("../../util/uuid"),a=t("../documentHelpers");e.exports=i},{"../../util/uuid":383,"../documentHelpers":272,"lodash/extend":166}],276:[function(t,e,n){"use strict";function i(t,e){var n=e.selection;if(!n.isPropertySelection())throw new Error("Expecting a property selection.");var i,r,c=e.direction,u=e.containerId,h=n.path,l=t.get(h);if(0===n.startOffset&&"left"===c||n.startOffset===l.length&&"right"===c){if(u){var d=s(t,o({},e,{selection:n,containerId:u,path:n.path,direction:c}));e.selection=d.selection}}else{i="left"===c?n.startOffset-1:n.startOffset,r=i+1;var f=t.update(n.path,{"delete":{start:i,end:r}});a(t,{op:f}),e.selection=t.createSelection(n.path,i)}return e}function r(t,e){var n=e.selection;if(!n.isNodeSelection())throw new Error("Expecting a node selection.");var i,r,o=e.direction,s=e.containerId,a=n.getNodeId(),u=t.get(s);if(n.isFull()||n.isBefore()&&"right"===o||n.isAfter()&&"left"===o)return c(t,{nodeId:a,containerId:s});if(n.isBefore()&&"left"===o){if(i=u.getPosition(a),i>0){var h=u.getNodeAt(i-1);h.isText()&&(r=h.getText(),0===r.length?c(t,{nodeId:h.id,containerId:s}):n=t.createSelection(h.getTextPath(),r.length))}}else if(n.isAfter()&&"right"===o&&(i=u.getPosition(a),i<u.getLength()-1)){var l=u.getNodeAt(i+1);l.isText()&&l.isEmpty()&&c(t,{nodeId:l.id,containerId:s})}return{selection:n}}var o=t("lodash/extend"),s=t("./merge"),a=t("./updateAnnotations"),c=t("./deleteNode"),u=function(t,e){var n=e.selection;if(!n)throw new Error("'selection' is mandatory.");if(!n.isCollapsed())throw new Error('selection must be collapsed for transformation "deleteCharacter"');return n.isPropertySelection()?i(t,e):n.isNodeSelection()?r(t,e):(console.warn("'deleteChar' can not be used with the given selection",n.toString()),e)};e.exports=u},{"./deleteNode":277,"./merge":284,"./updateAnnotations":289,"lodash/extend":166}],277:[function(t,e,n){"use strict";function i(t,e){var n=e.nodeId;if(!n)throw new Error("Parameter `nodeId` is mandatory.");var r=t.get(n);if(!r)throw new Error("Invalid 'nodeId'. Node does not exist.");var o,s,a=e.containerId,c=t.getIndex("annotations").get(n);for(s=0;s<c.length;s++)t["delete"](c[s].id);var u=t.getIndex("container-annotation-anchors").get(n);for(s=0;s<u.length;s++){var h=u[s];if(o=t.get(h.containerId),t.get(h.id)){var l,d,f=o.getPosition(h.path[0]);if(h.isStart)if(f<o.getLength()-1){var p=o.getChildAt(f+1);l=p.isText()?[p.id,"content"]:[p.id],t.set([h.id,"startPath"],l),t.set([h.id,"startOffset"],0)}else t["delete"](h.id);else if(f>0){var g=o.getChildAt(f-1);g.isText()?(l=[g.id,"content"],d=t.get(l).length):(l=[g.id],d=1),t.set([h.id,"endPath"],l),t.set([h.id,"endOffset"],d)}else t["delete"](h.id)}}return a&&(o=t.get(a),o.hide(n)),r.hasChildren()&&r.getChildren().forEach(function(e){i(t,{nodeId:e.id})}),t["delete"](n),e}e.exports=i},{}],278:[function(t,e,n){"use strict";function i(t,e){var n=e.selection;return n.isCollapsed()||(n.isPropertySelection()?e=r(t,e):n.isContainerSelection()?e=o(t,e):n.isNodeSelection()&&(e=s(t,e))),e}function r(t,e){var n=e.selection,i=n.path,r=n.startOffset,o=n.endOffset,s=t.update(i,{"delete":{start:r,end:o}});return d(t,{op:s}),e.selection=t.createSelection(i,r),e}function o(t,e){var n=e.selection,i=n.containerId,o=t.get(i),s=o.getPosition(n.start.path[0]),d=n.getFragments();if(0===d.length)return e;for(var f,p,g=null,m=0;m<d.length;m++){var v=d[m];if(v.isPropertyFragment())if(v.isPartial())g||(g={path:v.path,offset:v.startOffset}),r(t,{selection:v});else{var y=v.path[0];h(t,a({},e,{nodeId:y,containerId:o.id}))}else v.isNodeFragment()&&h(t,a({},e,{nodeId:v.nodeId,containerId:o.id}))}return g?e.selection=t.createSelection(g.path,g.offset):(p=t.getSchema().getDefaultTextType(),f={type:p,id:u(p),content:""},t.create(f),o.show(f.id,s),e.selection=t.createSelection([f.id,"content"],0)),d.length>1&&d[0].isPartial()&&c(d).isPartial()&&l(t,a({},e,{selection:e.selection,containerId:i,path:n.endPath,direction:"left"})),0===o.nodes.length&&(p=t.getSchema().getDefaultTextType(),f={type:p,id:u(p),content:""},t.create(f),o.show(f.id,0),e.selection=t.createSelection([f.id,"content"],0)),e}function s(t,e){var n=e.selection;if(!n||!n.isNodeSelection())throw new Error("'sel' must be a NodeSelection");if(!n.isFull())return e;var i=n.getNodeId(),r=n.containerId,o=t.get(r),s=o.getPosition(i);h(t,{nodeId:i,containerId:r});var a=t.create({type:t.getSchema().getDefaultTextType(),content:""});return o.show(a.id,s),{selection:t.createSelection([a.id,"content"],0)}}var a=t("lodash/extend"),c=t("lodash/last"),u=t("../../util/uuid"),h=t("./deleteNode"),l=t("./merge"),d=t("./updateAnnotations");e.exports=i},{"../../util/uuid":383,"./deleteNode":277,"./merge":284,"./updateAnnotations":289,"lodash/extend":166,"lodash/last":195}],279:[function(t,e,n){"use strict";function i(t,e){var n=e.selection,i=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!i||!i._isAnnotation)throw new Error('Argument "anno" is required.');var r=i.getSelection(),o=r.expand(n);return i.updateRange(t,o),e.result=i,e}e.exports=i},{}],280:[function(t,e,n){"use strict";function i(t,e){var n=e.annos;if(!o(n)||n.length<2)throw new Error("fuseAnnotation(): at least two annotations are necessary.");var i,a;return n.forEach(function(t,e){if(0===e)i=t.getSelection(),a=t.type;else{if(t.type!==a)throw new Error("fuseAnnotation(): all annotations must be of the same type.");i=i.expand(t.getSelection())}}),r(n,function(e){t["delete"](e.id)}),e.selection=i,e.node={type:a},s(t,e)}var r=t("lodash/each"),o=t("lodash/isArray"),s=t("./createAnnotation");e.exports=i},{"./createAnnotation":275,"lodash/each":164,"lodash/isArray":176}],281:[function(t,e,n){"use strict";function i(t,e){var n=r(t,{selection:e.selection,text:"\ufeff"}),i=t.createSelection({type:"property",path:n.selection.path,startOffset:n.selection.startOffset-1,endOffset:n.selection.endOffset});return e.node=e.node,e.selection=i,e=o(t,e)}var r=t("./insertText"),o=t("./createAnnotation");e.exports=i},{"./createAnnotation":275,"./insertText":283}],282:[function(t,e,n){"use strict";function i(t,e){var n=e.selection,i=e.node;if(!e.containerId)throw new Error("containerId is mandatory");if(!e.selection)throw new Error("selection is mandatory");if(!e.node)throw new Error("node is mandatory");var a,c=e.containerId,u=t.get(c);n.isCollapsed()||(a=r(t,e),n=a.selection),a=o(t,e),n=a.selection,i.id||(i.id=s(i.type)),t.get(i.id)||(i=t.create(i)),i=t.get(i.id);var h=u.getPosition(n.start.getNodeId());return u.show(i.id,h),i.isText()?e.selection=t.createSelection({type:"property",path:[i.id,"content"],startOffset:0}):e.selection=t.createSelection({type:"container",containerId:c,startPath:[i.id],startOffset:0,endPath:[i.id],endOffset:1}),e}var r=t("./deleteSelection"),o=t("./breakNode"),s=t("../../util/uuid");e.exports=i},{"../../util/uuid":383,"./breakNode":273,"./deleteSelection":278}],283:[function(t,e,n){"use strict";var i=t("./replaceText"),r=t("./updateAnnotations"),o=function(t,e){var n=e.selection,o=e.text;if(!n)throw new Error("Argument `selection` is mandatory for transformation `insertText`.");if(!o)throw new Error("Argument `text` is mandatory for transformation `insertText`.");if(!n.isPropertySelection()&&!n.isContainerSelection())return console.error("Selection must be a Property- or ContainerSelection."),e;if(!n.isCollapsed())return i(t,e);void 0===t.get(n.startPath)&&t.set(n.startPath,"");var s=t.update(n.startPath,{insert:{offset:n.startOffset,value:o}});return r(t,{op:s}),e.selection=t.createSelection(n.startPath,n.startOffset+o.length),e};e.exports=o},{"./replaceText":286,"./updateAnnotations":289}],284:[function(t,e,n){"use strict";function i(t,e){var n=e.firstNodeId,i=e.secondNodeId,o=t.get(n),a=t.get(i),c=r(e.editingBehavior,o,a);return c?c(t,s({},e,{containerId:e.containerId,first:o,second:a})):e}function r(t,e,n){if(t){if(t.canMerge(e.type,n.type))return t.getMerger(e.type,n.type);if(e.isInstanceOf("text")&&t.canMerge("textish",n.type))return t.getMerger("textish",n.type);if(n.isInstanceOf("text")&&t.canMerge(e.type,"textish"))return t.getMerger(e.type,"textish")}return e.isInstanceOf("text")&&n.isInstanceOf("text")?o:(console.info("No merge behavior defined for %s <- %s",e.type,n.type),null)}function o(t,e){var n,i=e.containerId,r=e.first,o=e.second,s=t.get(i),c=r.getTextPath(),u=r.getText(),h=u.length,l=o.getTextPath(),d=o.getText();return 0===h?(s.hide(c[0]),t["delete"](c[0]),n=t.createSelection({type:"property",path:l,startOffset:0})):(t.update(c,{insert:{offset:h,value:d}}),a.transferAnnotations(t,l,0,c,h),s.hide(l[0]),t["delete"](l[0]),n=t.createSelection({type:"property",path:c,startOffset:h})),e.selection=n,e}var s=t("lodash/extend"),a=t("../annotationHelpers"),c=t("./deleteNode"),u=function(t,e){var n=e.containerId,r=e.path,o=e.direction;if(!n||!r||!o)throw new Error("Insufficient arguments! mandatory fields: `containerId`, `path`, `direction`");var a,u=t.get(n),h=r[0],l=t.get(h),d=u.getPosition(h),f=u.getLength();if("right"===o&&f-1>d){var p=u.nodes[d+1],g=t.get(p);l.isText()&&0===l.getText().length?(c(t,{nodeId:h,containerId:n}),g.isText()?e.selection=t.createSelection(p,0):e.selection=t.createSelection({type:"node",nodeId:p,containerId:n,mode:"full"})):(a=i(t,s({},e,{containerId:n,firstNodeId:h,secondNodeId:p})),e.selection=a.selection)}else if("left"===o&&d>0){var m=u.nodes[d-1],v=t.get(m);l.isText()&&0===l.getText().length?(c(t,{nodeId:h,containerId:n}),v.isText()?e.selection=t.createSelection(v.getTextPath(),v.getText().length):e.selection=t.createSelection({type:"node",nodeId:m,containerId:n,mode:"full"})):(a=i(t,s({},e,{containerId:n,firstNodeId:m,secondNodeId:h})),e.selection=a.selection)}return e};e.exports=u},{"../annotationHelpers":257,"./deleteNode":277,"lodash/extend":166}],285:[function(t,e,n){"use strict";function i(t,e){var n,i=t.getSchema().getDefaultTextType(),r=e.text.split(/\s*\n\s*\n/),o=t.newInstance(),s=o.create({type:"container",id:p,nodes:[]});if(1===r.length)n=o.create({id:g,type:i,content:r[0]}),s.show(n.id);else for(var a=0;a<r.length;a++)n=o.create({id:u(i),type:i,content:r[a]}),s.show(n.id);return o}function r(t,e){var n=e.doc,i=e.selection,r=n.get(p).nodes,o=[r[0],"content"],s=n.get(o),a=n.getIndex("annotations").get(o),l=i.start.path,d=i.start.offset;return t.update(l,{insert:{offset:d,value:s}}),h.insertedText(t,i.start,s.length),i=t.createSelection({type:"property",path:i.start.path,startOffset:i.start.offset+s.length}),c(a,function(e){var n=e.toJSON();n.path=l.slice(0),n.startOffset+=d,n.endOffset+=d,t.get(n.id)&&(n.id=u(n.type)),t.create(n)}),e.selection=i,e}function o(t,e){var n,i=e.doc,r=e.containerId,o=e.selection,c=t.get(r),h=o.start.path,l=c.getPosition(o.start.getNodeId()),d=t.get(h);if(d.length===o.start.offset)n=l+1;else{var g=f(t,e);o=g.selection,n=l+1}0>n&&console.error("Could not find insertion position in ContainerNode.");for(var m=i.get(p).nodes,v=i.getIndex("annotations"),y=[],_=0;_<m.length;_++){var x=m[_],b=s(t,i.get(x));c.show(b.id,n++),y.push(b);for(var C=v.get(x),w=0;w<C.length;w++){var S=C[w].toJSON();b.id!==x&&(S.path[0]=b.id),t.get(S.id)&&(S.id=u(S.type)),t.create(S)}}if(0===y.length)return e;var E=y[0],N=a(y);return e.selection=t.createSelection({type:"container",containerId:r,startPath:[E.id],startOffset:0,endPath:[N.id],endOffset:1}),e}function s(t,e){var n=e.id,i=e.toJSON();if(t.get(n)&&(i.id=u(e.type)),e.hasChildren())for(var r=e.getChildren(),o=i[e.getChildrenProperty()],a=0;a<r.length;a++){var c=s(t,r[a]);o[a]=c.id}return t.create(i)}var a=t("lodash/last"),c=t("lodash/each"),u=t("../../util/uuid"),h=t("../annotationHelpers"),l=t("./deleteSelection"),d=t("./insertText"),f=t("./breakNode"),p=t("./copySelection").CLIPBOARD_CONTAINER_ID,g=t("./copySelection").CLIPBOARD_PROPERTY_ID,m=function(t,e){if(e.text=e.text||"",e.selection.isNull())return console.error("Can not paste, without selection."),e;var n=Boolean(e.containerId),s=e.doc;if(!s){if(!n)return d(t,e);e.doc=s=i(t,e)}if(!e.selection.isCollapsed()){var a=l(t,e);e.selection=a.selection}var c=s.get(p).nodes,u=t.getSchema();if(c.length>0){var h=s.get(c[0]);u.isInstanceOf(h.type,"text")&&(e=r(t,e),c.shift()),c.length>0&&(e=o(t,e))}return e};e.exports=m},{"../../util/uuid":383,"../annotationHelpers":257,"./breakNode":273,"./copySelection":274,"./deleteSelection":278,"./insertText":283,"lodash/each":164,"lodash/last":195}],286:[function(t,e,n){"use strict";function i(t,e){return r(t,e)}function r(t,e){var n=s(t,o({},e,{direction:"right"})),i=n.selection;if(!i.isPropertySelection())throw new Error("Invalid state.");var r=e.text,c=t.update(i.path,{insert:{offset:i.startOffset,value:r}});return a(t,{op:c}),e.selection=t.createSelection(i.path,i.startOffset+r.length),e}var o=t("lodash/extend"),s=t("./deleteSelection"),a=t("./updateAnnotations");e.exports=i},{"./deleteSelection":278,"./updateAnnotations":289,"lodash/extend":166}],287:[function(t,e,n){"use strict";function i(t,e){var n=e.selection;if(!n.isPropertySelection())return console.error("Selection must be a PropertySelection."),e;var i=n.path,c=i[0],u=e.data,h=t.get(c);if(!h.isInstanceOf("text"))return console.warn("Trying to use switchTextType on a non text node. Skipping."),e;var l=r({id:o(u.type),type:u.type,content:h.content},u),d=[l.id,"content"];l=t.create(l),s.transferAnnotations(t,i,0,d,0);var f=t.get(e.containerId),p=f.getPosition(c);return p>=0&&(f.hide(c),f.show(l.id,p)),a(t,{nodeId:h.id}),e.selection=t.createSelection(d,n.startOffset,n.endOffset),e.node=l,e}var r=t("lodash/extend"),o=t("../../util/uuid"),s=t("../annotationHelpers"),a=t("./deleteNode");e.exports=i},{"../../util/uuid":383,"../annotationHelpers":257,"./deleteNode":277,"lodash/extend":166}],288:[function(t,e,n){"use strict";function i(t,e){var n=e.selection,i=e.anno;if(!n||!n._isSelection)throw new Error('Argument "selection" is required.');if(!i||!i._isAnnotation)throw new Error('Argument "anno" is required.');var r=i.getSelection(),o=r.truncateWith(n);return i.updateRange(t,o),e.result=i,e}e.exports=i},{}],289:[function(t,e,n){"use strict";function i(t,e){var n=e.op;if(!n.isUpdate())throw new Error("Only text updates are supported.");var i=n.diff;return i.isInsert()?r(t,e):i.isDelete()?o(t,e):e}function r(t,e){var n=e.op,i=n.diff;return s.insertedText(t,new a(n.path,i.pos),i.getLength(),e.ignoredAnnotations),e}function o(t,e){var n=e.op,i=n.diff;return s.deletedText(t,n.path,i.pos,i.pos+i.getLength(),e.replaceTextSupport),e}var s=t("../annotationHelpers"),a=t("../Coordinate");e.exports=i},{"../Coordinate":226,"../annotationHelpers":257}],290:[function(t,e,n){(function(n){"use strict";e.exports={name:"base",configure:function(e,i){e.addCommand(t("./SwitchTextTypeCommand")),e.addCommand(t("./UndoCommand")),e.addCommand(t("./RedoCommand")),e.addTool(t("./UndoTool")),e.addTool(t("./RedoTool")),e.addTool(t("./SwitchTextTypeTool")),e.addIcon("undo",{fontawesome:"fa-undo"}),e.addIcon("redo",{fontawesome:"fa-repeat"}),e.addIcon("edit",{fontawesome:"fa-cog"}),e.addIcon("delete",{fontawesome:"fa-times"}),e.addIcon("expand",{fontawesome:"fa-arrows-h"}),e.addIcon("truncate",{fontawesome:"fa-arrows-h"}),i.noBaseStyles||e.addStyle(n,"..","..","styles","base","_all"),e.addStyle(n,"_base.scss"),e.addStyle(n,"..","..","styles","components","_all"),e.addLabel("undo",{en:"Undo",de:"Rckgngig"}),e.addLabel("redo",{en:"Redo",de:"Wiederherstellen"}),e.addLabel("container-selection",{en:"Container",de:"Container"}),e.addLabel("container",{en:"Container",de:"Container"}),e.addLabel("insert-container",{en:"Insert Container",de:"Container einfgen"})}}}).call(this,"/node_modules/substance/packages/base")},{"./RedoCommand":291,"./RedoTool":292,"./SwitchTextTypeCommand":293,"./SwitchTextTypeTool":294,"./UndoCommand":295,"./UndoTool":296}],291:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Command");i.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession;return{disabled:!n.canRedo(),active:!1}},this.execute=function(t,e){var n=e.documentSession;return n.canRedo()?(n.redo(),!0):!1}},r.extend(i),i["static"].name="redo",e.exports=i},{"../../ui/Command":320}],292:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Tool");r.extend(i),i["static"].name="redo",e.exports=i},{"../../ui/Tool":359}],293:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("../../ui/Command"),o=t("lodash/isMatch"),s=t("lodash/find"),a=t("lodash/clone");i.Prototype=function(){this.getTextTypes=function(t){var e=t.surfaceManager.getFocusedSurface();return e&&e.isContainerEditor()?e.getTextTypes():[]},this.getTextType=function(t,e){var n=this.getTextTypes(t);return s(n,function(t){return t.name===e})},this.getCurrentTextType=function(t,e){var n,i=this.getTextTypes(t);return i.forEach(function(t){var i=a(t.data);delete i.type,o(e,i)&&e.type===t.data.type&&(n=t)}),n},this.getCommandState=function(t,e){var n,i=e.documentSession.getDocument(),r=e.documentSession.getSelection(),o=e.surfaceManager.getFocusedSurface(),s={disabled:!1,textTypes:this.getTextTypes(e)};if(o&&o.isEnabled()&&!r.isNull())if(r.isContainerSelection())s.disabled=!0,s.currentTextType={name:"container-selection"};else if(r.isPropertySelection()){var a=r.getPath();n=i.get(a[0]),n&&(n.isText()&&n.isBlock()&&(s.currentTextType=this.getCurrentTextType(e,n)),s.currentTextType||(s.currentTextType={name:[n.type,a[1]].join(".")},s.disabled=!0))}else r.isNodeSelection()?(n=i.get(r.getNodeId()),s.currentTextType={name:n.type},s.disabled=!0):r.isCustomSelection()&&(s.currentTextType={name:"custom"},s.disabled=!0);else s.disabled=!0;return s},this.execute=function(t,e){var n=this.getTextType(e,t.textType),i=n.data,r=e.surfaceManager.getFocusedSurface();return r?(r.transaction(function(t,e){return e.data=i,r.switchType(t,e)}),i):void console.warn("No focused surface. Stopping command execution.")}},r.extend(i),i["static"].name="switch-text-type",e.exports=i},{"../../ui/Command":320,"lodash/clone":162,"lodash/find":168,"lodash/isMatch":184}],294:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this._navIdx=-1}var r=t("lodash/each"),o=t("../../ui/Tool"),s=t("../../util/keys");i.Prototype=function(){var t=i["super"].prototype;this.didMount=function(){t.didMount.call(this),this._focusToggle()},this.render=function(t){var e=this.context.labelProvider,n="No selection";this.props.currentTextType&&(n=this.props.currentTextType.name);var i=t("div").addClass("sc-switch-text-type"),o=t("button").ref("toggle").addClass("se-toggle").attr("title",e.getLabel("switch_text")).append(e.getLabel(n)).on("click",this.toggleAvailableTextTypes);if(this.props.disabled||!this.props.currentTextType?(i.addClass("sm-disabled"),o.attr("tabindex",-1)):o.attr("tabindex",1),i.append(o),this.state.open){i.addClass("sm-open");var s=t("div").addClass("se-options").ref("options");r(this.props.textTypes,function(n){var i=t("button").addClass("se-option sm-"+n.name).attr("data-type",n.name).append(e.getLabel(n.name)).on("click",this.handleClick);s.append(i)}.bind(this)),i.append(s),i.on("keydown",this.onKeydown)}return i},this.didUpdate=function(){this._focusToggle()},this._focusToggle=function(){this.state.open&&this.refs.toggle.focus()},this.executeCommand=function(t){this.context.commandManager.executeCommand("switch-text-type",{textType:t})},this.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},this.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},this.onKeydown=function(t){var e=!1;switch(t.keyCode){case s.UP:this._nav(-1),e=!0;break;case s.DOWN:this._nav(1),e=!0;break;case s.ESCAPE:this.toggleDropdown(),e=!0}e&&(t.preventDefault(),t.stopPropagation())},this.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.toggleDropdown()},this.toggleDropdown=function(){this._navIdx=-1,this.extendState({open:!this.state.open})},this._nav=function(t){if(this._navIdx+=t,this._navIdx=Math.max(0,this._navIdx),this._navIdx=Math.min(this._getOptionsCount()-1,this._navIdx),this._navIdx>=0){var e=this.refs.options.children[this._navIdx];e.focus()}},this._getOptionsCount=function(){return this.refs.options.children.length}},o.extend(i),i["static"].name="switch-text-type",e.exports=i},{"../../ui/Tool":359,"../../util/keys":377,"lodash/each":164}],295:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Command");i.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession;return{disabled:!n.canUndo(),active:!1}},this.execute=function(t,e){var n=e.documentSession;return n.canUndo()?(n.undo(),!0):!1}},r.extend(i),i["static"].name="undo",e.exports=i},{"../../ui/Command":320}],296:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Tool");r.extend(i),i["static"].name="undo",e.exports=i},{"../../ui/Tool":359}],297:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/TextBlockComponent");i.Prototype=function(){var t=i["super"].prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sc-heading sm-level-"+this.props.node.level)}},r.extend(i),e.exports=i},{"../../ui/TextBlockComponent":356}],298:[function(t,e,n){"use strict";e.exports={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},"import":function(t,e,n){e.level=Number(t.tagName[1]),e.content=n.annotatedText(t,[e.id,"content"])},"export":function(t,e,n){e.tagName="h"+t.level,e.append(n.annotatedText([t.id,"content"]))}}},{}],299:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../model/InlineNode");i.Prototype=function(){this.getWrappedNode=function(){return this.getDocument().get(this.wrappedNode)}},r.extend(i),i["static"].name="inline-wrapper",i["static"].defineSchema({wrappedNode:"id"}),e.exports=i},{"../../model/InlineNode":242}],300:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/InlineNodeComponent");i.Prototype=function(){this.getClassNames=function(){return"sc-inline-wrapper sc-inline-node"},this.renderContent=function(t){var e,n=this.props.node,i=n.getDocument(),r=i.get(n.wrappedNode);if(r){var o=this.context.componentRegistry,s=o.get(r.type);s?e=t(s,{disabled:this.isDisabled(),node:r}).ref("wrappedNode"):console.error("No component registered for node type"+r.type);
}else console.error("Could not find wrapped node: "+n.wrappedNode);return e}},r.extend(i),e.exports=i},{"../../ui/InlineNodeComponent":337}],301:[function(t,e,n){"use strict";e.exports={type:"inline-wrapper",matchElement:function(t,e){var n=e._getConverterForElement(t,"block");return Boolean(n)},"import":function(t,e,n){e.id=n.nextId("inline-wrapper");var i=n.state;i.popElementContext(),i.pushElementContext(i.getCurrentElementContext().tagName),e.wrappedNode=n.convertElement(t).id},"export":function(t,e,n){return n.convertNode(t.wrappedNode)}}},{}],302:[function(t,e,n){(function(n){"use strict";var i=t("./InlineWrapper"),r=t("./InlineWrapperComponent"),o=t("./InlineWrapperConverter");e.exports={name:"inline-wrapper",configure:function(t,e){t.addNode(i),t.addComponent(i["static"].name,r),t.addStyle(n+"/_inline-wrapper.scss"),e.converters&&e.converters.forEach(function(e){t.addConverter(e,o)})}}}).call(this,"/node_modules/substance/packages/inline-wrapper")},{"./InlineWrapper":299,"./InlineWrapperComponent":300,"./InlineWrapperConverter":301}],303:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Component"),o=t("lodash/clone"),s=t("../../ui/Prompt");i.Prototype=function(){this.getUrlPath=function(){var t=this.constructor["static"].urlPropertyPath;return[this.props.node.id].concat(t)},this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-edit-link-tool"),r=this.getUrlPath();return i.append(t(s).append(t(s.Input,{type:"url",path:r,placeholder:"Paste or type a link url"}),t(s.Separator),t(s.Link,{name:"open-link",href:n.get(r),title:this.getLabel("open-link")}),t(s.Action,{name:"delete",title:this.getLabel("delete")}).on("click",this.onDelete))),i},this.onDelete=function(t){t.preventDefault();var e=this.props.node,n=this.context.surfaceManager,i=n.getFocusedSurface();i.transaction(function(t,n){return t["delete"](e.id),n})}},r.extend(i),i["static"].urlPropertyPath=["url"],i["static"].name="edit-link",i["static"].getProps=function(t){return"edit"===t.link.mode?o(t.link):void 0},e.exports=i},{"../../ui/Component":322,"../../ui/Prompt":344,"lodash/clone":162}],304:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/AnnotationCommand");i.Prototype=function(){this.getAnnotationData=function(){return{url:""}},this.canFuse=function(){return!1},this.canEdit=function(t,e){return 1===t.length},this.canDelete=function(t,e){return!1}},r.extend(i),i["static"].name="link",e.exports=i},{"../../ui/AnnotationCommand":312}],305:[function(t,e,n){"use strict";e.exports={name:"persistence",configure:function(e){e.addCommand(t("./SaveCommand")),e.addTool(t("./SaveTool")),e.addIcon("save",{fontawesome:"fa-save"}),e.addLabel("save",{en:"Save",de:"Speichern"})}}},{"./SaveCommand":306,"./SaveTool":307}],306:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Command");i.Prototype=function(){this.getCommandState=function(t,e){var n=e.documentSession.isDirty();return{disabled:!n,active:!1}},this.execute=function(t,e){var n=e.documentSession;return n.save(),{status:"saving-process-started"}}},r.extend(i),i["static"].name="save",e.exports=i},{"../../ui/Command":320}],307:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/Tool");r.extend(i),i["static"].name="save",e.exports=i},{"../../ui/Tool":359}],308:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/AbstractEditor"),o=t("../../ui/ContainerEditor"),s=t("../../ui/SplitPane"),a=t("../../ui/ScrollPane"),c=t("./ProseEditorOverlay");i.Prototype=function(){this.willUpdateState=function(t){this.handleStateUpdate(t)},this.render=function(t){var e=t("div").addClass("sc-prose-editor"),n=this._renderToolbar(t),i=this._renderEditor(t),r=t(a,{scrollbarType:"substance",scrollbarPosition:"right",overlay:c}).append(i).ref("contentPanel");return e.append(t(s,{splitType:"horizontal"}).append(n,r)),e},this._renderToolbar=function(t){var e=this.props.configurator,n=e.getToolbarClass(),i=this.commandManager.getCommandStates();return t(n,{commandStates:i}).ref("toolbar")},this._renderEditor=function(t){var e=this.props.configurator;return t(o,{disabled:this.props.disabled,documentSession:this.documentSession,node:this.doc.get("body"),commands:e.getSurfaceCommandNames(),textTypes:e.getTextTypes()}).ref("body")},this.getToolbar=function(){return this.refs.toolbar}},r.extend(i),e.exports=i},{"../../ui/AbstractEditor":310,"../../ui/ContainerEditor":324,"../../ui/ScrollPane":348,"../../ui/SplitPane":351,"./ProseEditorOverlay":309}],309:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../../ui/DefaultOverlay");i.Prototype=function(){this.getClassNames=function(){return"sc-prose-editor-overlay"}},r.extend(i),e.exports=i},{"../../ui/DefaultOverlay":330}],310:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this._initialize(this.props)}var r=t("./Component"),o=t("./CommandManager"),s=t("./SurfaceManager"),a=t("./MacroManager"),c=t("./GlobalEventHandler");i.Prototype=function(){this.didMount=function(){this.documentSession.on("didUpdate",this._documentSessionUpdated,this)},this.willReceiveProps=function(t){var e=t.documentSession,n=e&&e!==this.documentSession;n&&(this._dispose(),this._initialize(t))},this.dispose=function(){this._dispose()},this._dispose=function(){this.surfaceManager.dispose(),this.commandManager.dispose(),this.globalEventHandler.dispose(),this.documentSession.off(this),this.empty()},this.getChildContext=function(){return{controller:this,iconProvider:this.iconProvider,documentSession:this.documentSession,doc:this.doc,componentRegistry:this.componentRegistry,surfaceManager:this.surfaceManager,commandManager:this.commandManager,toolRegistry:this.toolRegistry,labelProvider:this.labelProvider,converterRegistry:this.converterRegistry,globalEventHandler:this.globalEventHandler,editingBehavior:this.editingBehavior}},this._initialize=function(t){var e=t.configurator,n=e.getCommands();if(!t.documentSession)throw new Error("DocumentSession instance required");this.documentSession=t.documentSession,this.doc=this.documentSession.getDocument(),this.saveHandler=e.getSaveHandler(),this.documentSession.setSaveHandler(this.saveHandler),this.componentRegistry=e.getComponentRegistry(),this.toolRegistry=e.getToolRegistry(),this.surfaceManager=new s(this.documentSession),this.fileClient=e.getFileClient(),this.commandManager=new o(this.getCommandContext(),n),this.macroManager=new a(this.getMacroContext(),e.getMacros()),this.iconProvider=e.getIconProvider(),this.converterRegistry=e.getConverterRegistry(),this.globalEventHandler=new c(this.documentSession,this.surfaceManager),this.editingBehavior=e.getEditingBehavior(),this.labelProvider=e.getLabelProvider()},this.getCommandContext=function(){return{documentSession:this.documentSession,surfaceManager:this.surfaceManager,fileClient:this.fileClient,saveHandler:this.saveHandler,converterRegistry:this.converterRegistry}},this.getMacroContext=function(){return{documentSession:this.documentSession,surfaceManager:this.surfaceManager}},this.getToolbar=function(){throw new Error("This method is abstract.")},this._documentSessionUpdated=function(){var t=this.getToolbar();if(t){var e=this.commandManager.getCommandStates();this.refs.toolbar.setProps({commandStates:e})}}},r.extend(i),e.exports=i},{"./CommandManager":321,"./Component":322,"./GlobalEventHandler":335,"./MacroManager":340,"./SurfaceManager":353}],311:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../model/Fragmenter"),o=t("./Component"),s=t("./AnnotationComponent"),a=t("./InlineNodeComponent");i.Prototype=function(){this.render=function(t){var e=this._renderContent(t).addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"});return e},this.getText=function(){return this.getDocument().get(this.props.path)||""},this.getAnnotations=function(){return this.getDocument().getIndex("annotations").get(this.props.path)},this._renderContent=function(t){var e=this.getText(),n=this.getAnnotations(),i=t(this.props.tagName||"span");if(n&&n.length>0){var o=new r({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this,t),onExit:this._finishFragment.bind(this)});o.start(i,e,n)}else i.append(e);return i},this._renderTextNode=function(t,e){e&&e.length>0&&t.append(e)},this._renderFragment=function(t,e){var n=this.getDocument(),i=this.getComponentRegistry(),r=e.node;if("container-annotation-fragment"===r.type)return t(s,{doc:n,node:r}).addClass("se-annotation-fragment").addClass(r.anno.getTypeNames().join(" ").replace(/_/g,"-"));if("container-annotation-anchor"===r.type)return t(s,{doc:n,node:r}).addClass("se-anchor").addClass(r.anno.getTypeNames().join(" ").replace(/_/g,"-")).addClass(r.isStart?"start-anchor":"end-anchor");var o=i.get(r.type)||s;!r.constructor["static"].isInline||o["static"].isCustom||o.prototype._isInlineNodeComponent||(o=a);var c=t(o,{doc:n,node:r});return c},this._finishFragment=function(t,e,n){n.append(e)},this.getDocument=function(){return this.props.doc||this.context.doc},this.getComponentRegistry=function(){return this.props.componentRegistry||this.context.componentRegistry}},o.extend(i),e.exports=i},{"../model/Fragmenter":239,"./AnnotationComponent":313,"./Component":322,"./InlineNodeComponent":337}],312:[function(t,e,n){"use strict";function i(){r.call(this)}var r=t("./Command"),o=t("../model/transform/createAnnotation"),s=t("../model/transform/fuseAnnotation"),a=t("../model/transform/expandAnnotation"),c=t("../model/transform/truncateAnnotation");i.Prototype=function(){this.getAnnotationType=function(){var t=this.constructor["static"].annotationType||this.constructor["static"].name;if(t)return t;throw new Error("Contract: AnnotationCommand.static.annotationType should be associated to a document annotation type.")},this.getAnnotationData=function(){return{}},this.isDisabled=function(t){return!(t&&!t.isNull()&&t.isAttached()&&!t.isCustomSelection()&&!t.isNodeSelection()&&!t.isContainerSelection())},this.canEdit=function(t,e){return!1},this.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},this.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},this.canDelete=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.isInsideOf(n)},this.canExpand=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return e.overlaps(n)&&!e.isInsideOf(n)},this.canTruncate=function(t,e){if(1!==t.length)return!1;var n=t[0].getSelection();return(e.isLeftAlignedWith(n)||e.isRightAlignedWith(n))&&!e.contains(n)&&!e.isCollapsed()},this.getCommandState=function(t,e){e=e||{};var n=this._getSelection(t);if(this.isDisabled(n))return{disabled:!0};var i=this._getAnnotationsForSelection(t,e),r={disabled:!1,active:!1,mode:null};return this.canCreate(i,n)?r.mode="create":this.canFuse(i,n)?r.mode="fusion":this.canTruncate(i,n)?(r.active=!0,r.mode="truncate"):this.canExpand(i,n)?r.mode="expand":this.canEdit(i,n)?(r.mode="edit",r.node=i[0],r.active=!0):this.canDelete(i,n)?(r.active=!0,r.mode="delete"):r.disabled=!0,r},this.execute=function(t,e){if(t=t||{},t.selection=this._getSelection(t),t.disabled)return!1;var n=t.mode;switch(n){case"create":return this.executeCreate(t,e);case"fuse":return this.executeFuse(t,e);case"truncate":return this.executeTruncate(t,e);case"expand":return this.executeExpand(t,e);case"edit":return this.executeEdit(t,e);case"delete":return this.executeDelete(t,e);default:return console.warn("Command.execute(): unknown mode",n),!1}},this.executeCreate=function(t,e){var n=this._getAnnotationsForSelection(t,e);this._checkPrecondition(t,e,n,this.canCreate);var i=this._applyTransform(t,e,function(e){return t.node=this.getAnnotationData(),t.node.type=this.getAnnotationType(),o(e,t)}.bind(this));return{mode:"create",anno:i}},this.executeFuse=function(t,e){var n=this._getAnnotationsForSelection(t,e);this._checkPrecondition(t,e,n,this.canFuse);var i=this._applyTransform(t,e,function(t){var e=s(t,{annos:n});return{result:e.node}});return{mode:"fuse",anno:i}},this.executeTruncate=function(t,e){var n=this._getAnnotationsForSelection(t,e),i=n[0];return this._checkPrecondition(t,e,n,this.canTruncate),this._applyTransform(t,e,function(e){return c(e,{selection:t.selection,anno:i})}),{mode:"truncate",anno:i}},this.executeExpand=function(t,e){var n=this._getAnnotationsForSelection(t,e),i=n[0];return this._checkPrecondition(t,e,n,this.canExpand),this._applyTransform(t,e,function(e){a(e,{selection:t.selection,anno:i})}),{mode:"expand",anno:i}},this.executeEdit=function(t,e){var n=this._getAnnotationsForSelection(t,e);return this._checkPrecondition(t,e,n,this.canEdit),{mode:"edit",anno:n[0],readyOnly:!0}},this.executeDelete=function(t,e){var n=this._getAnnotationsForSelection(t,e),i=n[0];return this._checkPrecondition(t,e,n,this.canDelete),this._applyTransform(t,e,function(t){return t["delete"](i.id)}),{mode:"delete",annoId:i.id}},this._checkPrecondition=function(t,e,n,i){var r=this._getSelection(t);if(!i.call(this,n,r))throw new Error("AnnotationCommand: can't execute command for selection "+r.toString())},this._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.getAnnotationType())},this._applyTransform=function(t,e,n){var i=this._getSelection(t),r=this._getDocumentSession(t,e),o=t.surface;t.selection=i;var s;return i.isNull()?void 0:(r.transaction(function(e){e.before.selection=i,o&&(e.before.surfaceId=o.getId());var r=n(e,t);return r&&(s=r.result),r}),s)}},r.extend(i),e.exports=i},{"../model/transform/createAnnotation":275,"../model/transform/expandAnnotation":279,"../model/transform/fuseAnnotation":280,"../model/transform/truncateAnnotation":288,"./Command":320}],313:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.didMount=function(){var t=this.props.node;t.on("highlighted",this.onHighlightedChanged,this)},this.dispose=function(){var t=this.props.node;t.off(this)},this.render=function(t){var e=t("span").attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&e.addClass("sm-highlighted"),e.append(this.props.children),e},this.getClassNames=function(){return"sc-"+this.props.node.type},this.onHighlightedChanged=function(){this.props.node.highlighted?this.el.addClass("sm-highlighted"):this.el.removeClass("sm-highlighted")}},r.extend(i),e.exports=i},{"./Component":322}],314:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Tool");i.Prototype=function(){var t=i["super"].prototype;this.render=function(e){var n=t.render.call(this,e);return n.addClass("sm-annotation-tool"),n},this.renderButton=function(e){var n=t.renderButton.call(this,e);return n.append(this.renderMode(e)),n},this.renderMode=function(t){var e=this.props.mode,n=t("div").addClass("se-mode"),i=this.context.iconProvider.renderIcon(t,e);return i&&n.append(i),n}},r.extend(i),e.exports=i},{"./Tool":359}],315:[function(t,e,n){"use strict";function i(t){console.assert(t instanceof window.Node,"Expecting native DOM node."),this.el=t,t._wrapper=this,this.eventListeners=[],this.htmlProps={}}function r(t){console.assert(t instanceof window.Node&&3===t.nodeType,"Expecting native TextNode."),this.el=t,t._wrapper=this}function o(){this.el=window,window.__BrowserDOMElementWrapper__=this,this.eventListeners=[]}var s=t("lodash/isString"),a=t("lodash/isNumber"),c=t("../util/oo"),u=t("./DOMElement"),h=t("./DelegatedEvent"),l=window.Element.prototype,d=l.matches||l.matchesSelector||l.msMatchesSelector||l.webkitMatchesSelector;i.Prototype=function(){this._isBrowserDOMElement=!0,this.getNativeElement=function(){return this.el},this.hasClass=function(t){return this.el.classList.contains(t)},this.addClass=function(t){return this.el.classList.add(t),this},this.removeClass=function(t){return this.el.classList.remove(t),this},this.getClasses=function(){return this.el.className},this.setClasses=function(t){return this.el.className=t,this},this.getAttribute=function(t){return this.el.getAttribute(t)},this.setAttribute=function(t,e){return this.el.setAttribute(t,e),this},this.removeAttribute=function(t){return this.el.removeAttribute(t),this},this.getAttributes=function(){for(var t={},e=this.el.attributes,n=e.length,i=0;n>i;i++){var r=e.item(i);t[r.name]=r.value}return t},this.getProperty=function(t){return this.el[t]},this.setProperty=function(t,e){return this.htmlProps[t]=e,this.el[t]=e,this},this.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},this.getTagName=function(){return this.el.tagName?this.el.tagName.toLowerCase():void 0},this.setTagName=function(t){var e,n=i.createElement(t),r=this.el.attributes,o=r.length;for(e=0;o>e;e++){var s=r.item(e);n.setAttribute(s.name,s.value)}for(var a in this.htmlProps)this.htmlProps.hasOwnProperty(a)&&(n[a]=this.htmlProps[a]);return this.eventListeners.forEach(function(t){n.addEventListener(t.eventName,t.handler,t.capture)}),this._replaceNativeEl(n),this},this.getId=function(){return this.el.id},this.setId=function(t){return this.el.id=t,this},this.getValue=function(){return this.el.value},this.setValue=function(t){return this.el.value=t,this},this.getStyle=function(t){var e=this.getComputedStyle();return e[t]||this.el.style[t]},this.getComputedStyle=function(){return window.getComputedStyle(this.el)};var t={top:!0,bottom:!0,left:!0,right:!0,height:!0,width:!0};this.setStyle=function(e,n){return t[e]&&a(n)&&(n+="px"),this.el.style[e]=n,this},this.getTextContent=function(){return this.el.textContent},this.setTextContent=function(t){return this.el.textContent=t,this},this.getInnerHTML=function(){var t=this.el.innerHTML;if(!s(t)){for(var e=this.el.ownerDocument.createDocumentFragment(),n=this.el.firstChild;n;n=n.nextSibling)e.appendChild(n.cloneNode(!0));var i=new window.XMLSerializer;t=i.serializeToString(e)}return t},this.setInnerHTML=function(t){return this.el.innerHTML=t,this},this.getOuterHTML=function(){var t=this.el.outerHTML;if(!s(t)){var e=new window.XMLSerializer;t=e.serializeToString(this.el)}return t},this.addEventListener=function(t,e,n){var i;return i=1===arguments.length&&arguments[0]?arguments[0]:new u.EventListener(t,e,n),i.options.selector&&!i.__hasEventDelegation__&&(i.handler=this._delegatedHandler(i),i.__hasEventDelegation__=!0),this.el.addEventListener(i.eventName,i.handler,i.capture),i._el=this,this.eventListeners.push(i),this},this._delegatedHandler=function(t){var e=t.handler,n=t.context,i=t.options.selector,r=this.getNativeElement();return function(t){for(var o=t.target;o;){if(d.call(o,i)){e(new h(n,t.target,t));break}if(o===r)break;o=o.parentNode}}},this.removeEventListener=function(t,e){var n=null,i=-1;return i=u._findEventListenerIndex(this.eventListeners,t,e),n=this.eventListeners[i],i>-1&&(this.eventListeners.splice(i,1),n._el=null,this.el.removeEventListener(n.eventName,n.handler)),this},this.removeAllEventListeners=function(){for(var t=0;t<this.eventListeners.length;t++){var e=this.eventListeners[t];e._el=null,this.el.removeEventListener(e.eventName,e.handler)}this.eventListeners=[]},this.getEventListeners=function(){return this.eventListeners},this.getChildCount=function(){return this.el.childNodes.length},this.getChildNodes=function(){for(var t=[],e=this.el.firstChild;e;e=e.nextSibling)t.push(i.wrapNativeElement(e));return t},this.getChildren=function(){for(var t=[],e=this.el.firstChild;e;e=e.nextSibling)e.nodeType===window.Node.ELEMENT_NODE&&t.push(i.wrapNativeElement(e));return t},this.getChildAt=function(t){return i.wrapNativeElement(this.el.childNodes[t])},this.getChildIndex=function(t){if(!t._isBrowserDOMElement)throw new Error("Expecting a BrowserDOMElement instance.");return Array.prototype.indexOf.call(this.el.childNodes,t.el)},this.getFirstChild=function(){var t=this.el.firstChild;return t?i.wrapNativeElement(t):null},this.getLastChild=function(){var t=this.el.lastChild;return t?i.wrapNativeElement(t):null},this.getNextSibling=function(){var t=this.el.nextSibling;return t?i.wrapNativeElement(t):null},this.getPreviousSibling=function(){var t=this.el.previousSibling;return t?i.wrapNativeElement(t):null},this.isTextNode=function(){return this.el.nodeType===window.Node.TEXT_NODE},this.isElementNode=function(){return this.el.nodeType===window.Node.ELEMENT_NODE},this.isCommentNode=function(){return this.el.nodeType===window.Node.COMMENT_NODE},this.isDocumentNode=function(){return this.el.nodeType===window.Node.DOCUMENT_NODE},this.clone=function(){var t=this.el.cloneNode(!0);return i.wrapNativeElement(t)},this.createElement=function(t){var e=this.el.ownerDocument.createElement(t);return i.wrapNativeElement(e)},this.createTextNode=function(t){var e=this.el.ownerDocument.createTextNode(t);return i.wrapNativeElement(e)},this.is=function(t){var e=this.el;return this.isElementNode()?d.call(e,t):!1},this.getParent=function(){var t=this.el.parentNode;return t?i.wrapNativeElement(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=t.parentNode;return i.wrapNativeElement(t)},this.find=function(t){var e=null;return this.el.querySelector&&(e=this.el.querySelector(t)),e?i.wrapNativeElement(e):null},this.findAll=function(t){var e=[];return this.el.querySelectorAll&&(e=this.el.querySelectorAll(t)),Array.prototype.map.call(e,function(t){return i.wrapNativeElement(t)})},this._normalizeChild=function(t){if(t instanceof window.Node){if(t._wrapper)return t;t=i.wrapNativeElement(t)}if(s(t)&&(t=this.createTextNode(t)),!t||!t._isBrowserDOMElement)throw new Error("Illegal child type.");return t.el._wrapper||(t.el._wrapper=t),console.assert(t.el._wrapper===t,"Expecting a backlink between native element and CheerioDOMElement"),t.getNativeElement()},this.appendChild=function(t){var e=this._normalizeChild(t);return this.el.appendChild(e),this},this.insertAt=function(t,e){var n=this._normalizeChild(e),i=this.el.childNodes;return t>=i.length?this.el.appendChild(n):this.el.insertBefore(n,i[t]),this},this.insertBefore=function(t,e){if(!e||!e._isBrowserDOMElement)throw new Error('insertBefore(): Illegal arguments. "before" must be a BrowserDOMElement instance.');var n=this._normalizeChild(t);return this.el.insertBefore(n,e.el),this},this.removeAt=function(t){return this.el.removeChild(this.el.childNodes[t]),this},this.removeChild=function(t){if(!t||!t._isBrowserDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a BrowserDOMElement instance.");return this.el.removeChild(t.el),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isBrowserDOMElement&&t._isBrowserDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");return this.el.replaceChild(e.el,t.el),this},this.empty=function(){for(var t=this.el;t.lastChild;)t.removeChild(t.lastChild);return this},this.remove=function(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this},this.serialize=function(){var t=this.el.outerHTML;if(s(t))return t;var e=new window.XMLSerializer;return e.serializeToString(this.el)},this.isInDocument=function(){for(var t=this.el;t;){if(t.nodeType===window.Node.DOCUMENT_NODE)return!0;t=t.parentNode}},this._replaceNativeEl=function(t){console.assert(t instanceof window.Node,"Expecting a native element.");var e=this.el,n=e.parentNode;n&&n.replaceChild(t,e),this.el=t},this._getChildNodeCount=function(){return this.el.childNodes.length},this.focus=function(){return this.el.focus(),this},this.blur=function(){return this.el.focus(),this},this.click=function(){return this.el.click(),this},this.getWidth=function(){var t=this.el.getClientRects()[0];return t?t.width:0},this.getHeight=function(){var t=this.el.getClientRects()[0];return t?t.height:0},this.getOffset=function(){var t=this.el.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}},this.getPosition=function(){return{left:this.el.offsetLeft,top:this.el.offsetTop}},this.getOuterHeight=function(t){var e=this.el.offsetHeight;if(t){var n=this.getComputedStyle();e+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}return e}},u.extend(i),u._defineProperties(i,u._propertyNames),i.createTextNode=function(t){return window.document.createTextNode(t)},i.createElement=function(t){return window.document.createElement(t)},i.parseMarkup=function(t,e,n){var r,o=[];if(!t)return r="xml"===e?(new window.DOMParser).parseFromString("<dummy/>","text/xml"):(new window.DOMParser).parseFromString("<html></html>","text/html"),new i(r);var s=new window.DOMParser;if("html"===e?(n=t.search(/<\s*html/i)>=0,r=s.parseFromString(t,"text/html")):"xml"===e&&(r=s.parseFromString(t,"text/xml")),!r)throw new Error("Could not parse DOM string.");var a=r.querySelector("parsererror");if(a)throw new Error("ParserError: could not parse "+t);if("html"===e)if(n)o=[r.querySelector("html")];else{var c=r.querySelector("body");o=c.childNodes}else"xml"===e&&(o=n?[r]:r.childNodes);var u=Array.prototype.map.call(o,function(t){return new i(t)});return 1===u.length?u[0]:u},i.wrapNativeElement=function(t){return t?t._wrapper?t._wrapper:t instanceof window.Node?3===t.nodeType?new r(t):new i(t):t===window?i.getBrowserWindow():void 0:null},r.Prototype=function(){this._isBrowserDOMElement=!0,["getParent","getNextSibling","getPreviousSibling","getTextContent","setTextContent","getInnerHTML","setInnerHTML","getOuterHTML","getNativeElement","clone"].forEach(function(t){this[t]=i.prototype[t]}.bind(this))},u.TextNode.extend(r),u._defineProperties(r,["nodeType","textContent","innerHTML","outerHTML","parentNode"]),i.TextNode=r,o.Prototype=function(){var t=i.prototype;this.on=function(){return t.on.apply(this,arguments)},this.off=function(){return t.off.apply(this,arguments)},this.addEventListener=function(){return t.addEventListener.apply(this,arguments)},this.removeEventListener=function(){return t.removeEventListener.apply(this,arguments)},this.getEventListeners=i.prototype.getEventListeners},c.initClass(o),i.getBrowserWindow=function(){return window.__BrowserDOMElementWrapper__?window.__BrowserDOMElementWrapper__:new o(window)};var f,p;i.isReverse=function(t,e,n,i){if(n&&t){f||(f=window.document.createRange(),p=window.document.createRange()),f.setStart(t.getNativeElement(),e),p.setStart(n.getNativeElement(),i);var r=f.compareBoundaryPoints(window.Range.START_TO_START,p);if(1===r)return!0}return!1},i.getWindowSelection=function(){var t=window.getSelection(),e={anchorNode:i.wrapNativeElement(t.anchorNode),anchorOffset:t.anchorOffset,focusNode:i.wrapNativeElement(t.focusNode),focusOffset:t.focusOffset};return e},e.exports=i},{"../util/oo":379,"./DOMElement":326,"./DelegatedEvent":331,"lodash/isNumber":185,"lodash/isString":189}],316:[function(t,e,n){"use strict";function i(t){this.el=t,this.$el=u(t),t._wrapper=this,this.htmlProps={}}var r=t("lodash/isString"),o=t("lodash/last"),s=t("lodash/extend"),a=t("lodash/clone"),c=t("lodash/map"),u=t("../util/cheerio.customized"),h=t("./DOMElement");i.Prototype=function(){this._isCheerioDOMElement=!0,this.getNativeElement=function(){return this.el},this._wrapNativeElement=function(t){return t._wrapper?t._wrapper:new i(t)},this.hasClass=function(t){return this.$el.hasClass(t)},this.addClass=function(t){return this.$el.addClass(t),this},this.removeClass=function(t){return this.$el.removeClass(t),this},this.getClasses=function(){return this.$el.attr("class")},this.setClasses=function(t){return this.$el.attr("class",t),this},this.getAttribute=function(t){return this.$el.attr(t)},this.setAttribute=function(t,e){return this.$el.attr(t,e),this},this.removeAttribute=function(t){return this.$el.removeAttr(t),this},this.getAttributes=function(){var t=a(this.el.attribs);return t},this.getProperty=function(t){return this.$el.prop(t)},this.setProperty=function(t,e){return this.htmlProps[t]=e,this.$el.prop(t,e),this},this.removeProperty=function(t){return delete this.htmlProps[t],delete this.el[t],this},this.getTagName=function(){return"tag"!==this.el.type?"":this.el.name.toLowerCase()},this.setTagName=function(t){var e=u._createElement(t,this.el.root),n=u(e);return n.html(this.$el.html()),e.attribs=s({},this.el.attribs),this._replaceNativeEl(e),this},this.getId=function(){return this.$el.attr("id")},this.setId=function(t){return this.$el.attr("id",t),this},this.getTextContent=function(){return this.$el.text()},this.setTextContent=function(t){return this.$el.text(t),this},this.getInnerHTML=function(){return this.$el.html()},this.setInnerHTML=function(t){return this.$el.html(t),this},this.getOuterHTML=function(){return u._serialize(this.el)},this.getValue=function(){return this.$el.val()},this.setValue=function(t){return this.$el.val(t),this},this.getStyle=function(t){return this.$el.css(t)},this.setStyle=function(t,e){return this.$el.css(t,e),this},this.addEventListener=function(){return this},this.removeEventListener=function(){return this},this.removeAllEventListeners=function(){return this},this.getEventListeners=function(){return[]},this.getChildCount=function(){return this.el.children.length},this.getChildNodes=function(){var t=this.el.children;return t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},this.getChildren=function(){var t=this.el.children;return t=t.filter(function(t){return"tag"===t.type}),t=t.map(function(t){return this._wrapNativeElement(t)}.bind(this))},this.getChildAt=function(t){return this._wrapNativeElement(this.el.children[t])},this.getChildIndex=function(t){if(!t._isCheerioDOMElement)throw new Error("Expecting a CheerioDOMElement instance.");return this.el.children.indexOf(t.el)},this.getFirstChild=function(){var t=this.el.children[0];return t?i.wrapNativeElement(t):null},this.getLastChild=function(){var t=o(this.el.children);return t?i.wrapNativeElement(t):null},this.getNextSibling=function(){var t=this.el.next;return t?i.wrapNativeElement(t):null},this.getPreviousSibling=function(){var t=this.el.previous;return t?i.wrapNativeElement(t):null},this.isTextNode=function(){return"text"===this.el.type},this.isElementNode=function(){return"tag"===this.el.type},this.isCommentNode=function(){return"comment"===this.el.type},this.isDocumentNode=function(){return this.el===this.el.root},this.clone=function(){var t=this.$el.clone()[0];return this._wrapNativeElement(t)},this.createElement=function(t){var e=u._createElement(t,this.el.root);return this._wrapNativeElement(e)},this.createTextNode=function(t){var e=u._createTextNode(t);return this._wrapNativeElement(e)},this.is=function(t){return this.$el.is(t)},this.getParent=function(){var t=this.el.parent;return t?this._wrapNativeElement(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=t.parent;return this._wrapNativeElement(t)},this.find=function(t){var e=this.$el.find(t);return e.length>0?this._wrapNativeElement(e[0]):null},this.findAll=function(t){var e=this.$el.find(t);return e.length>0?c(e,function(t){return this._wrapNativeElement(t)}.bind(this)):[]},this._normalizeChild=function(t){if(r(t)&&(t=this.createTextNode(t)),t._wrapper&&(t=t._wrapper),!t||!t._isCheerioDOMElement)throw new Error("Illegal argument: only String and CheerioDOMElement instances are valid.");return console.assert(t.el._wrapper===t,"Expecting a backlink between native element and CheerioDOMElement"),t.getNativeElement()},this.appendChild=function(t){return t=this._normalizeChild(t),this.el.children.push(t),t.parent=this.el,this},this.insertAt=function(t,e){e=this._normalizeChild(e);var n=this.el.children;return t>=n.length?n.push(e):n.splice(t,0,e),e.parent=this.el,this},this.insertBefore=function(t,e){var n=this.el.children.indexOf(e.el);if(n>-1)return this.insertAt(n,t);throw new Error("insertBefore(): reference node is not a child of this element.")},this.removeAt=function(t){if(0>t||t>=this.el.children.length)throw new Error("removeAt(): Index out of bounds.");var e=this.el.children[t];return e.parent=null,this.el.children.splice(t,1),
this},this.removeChild=function(t){if(!t||!t._isCheerioDOMElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.el.children.indexOf(t.el);if(0>e)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isCheerioDOMElement&&t._isCheerioDOMElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.el.children.indexOf(t.el);return n>-1&&(this.removeAt(n),this.insertAt(n,e.el)),this},this.empty=function(){return this.$el.empty(),this},this.remove=function(){return this.$el.remove(),this},this._replaceNativeEl=function(t){var e=u(t);this.$el.replaceWith(e),this.el=t,this.$el=e},this.isInDocument=function(){for(var t=this.el;t;){if(t===t.root)return!0;t=t.parent}return!1}},h.extend(i),h._defineProperties(i,h._propertyNames),i.createTextNode=function(t){return u._createTextNode(t)},i.createElement=function(t){return u("<"+t+">")[0]},i.parseMarkup=function(t,e){var n,r=[];if(!t)return n="xml"===e?u.parseXML(""):u.parseHTML(""),new i(n);r=u.parseXML(t);var o=r.map(function(t){return new i(t)});return 1===o.length?o[0]:o},i.wrapNativeElement=function(t){return t._wrapper?t._wrapper:new i(t)},e.exports=i},{"../util/cheerio.customized":370,"./DOMElement":326,"lodash/clone":162,"lodash/extend":166,"lodash/isString":189,"lodash/last":195,"lodash/map":196}],317:[function(t,e,n){"use strict";function i(t,e){this.surface=t;var n=t.getDocument(),i=n.getSchema(),r=[];e.converterRegistry&&(r=e.converterRegistry.get("html")||[]);var o={schema:i,DocumentClass:n.constructor,converters:r};this.htmlImporter=new c(o),this.htmlExporter=new u(o)}var r=t("../util/oo"),o=t("../util/platform"),s=t("../util/substanceGlobals"),a=t("../model/documentHelpers"),c=t("./ClipboardImporter"),u=t("./ClipboardExporter");i.Prototype=function(){this.getSurface=function(){return this.surface},this.attach=function(t){t.on("copy",this.onCopy,this),t.on("cut",this.onCut,this),o.isIE&&!o.isEdge?t.on("beforepaste",this.onBeforePasteShim,this):t.on("paste",this.onPaste,this)},this.detach=function(t){t.off(this)},this.onCopy=function(t){var e=this._copy();i.clipboardData=e,s.clipboardData=e,s._clipboardData=t.clipboardData,t.clipboardData&&e.doc&&(t.preventDefault(),t.clipboardData.setData("text/plain",e.text),o.isIE||o.isEdge||t.clipboardData.setData("text/html",e.html))},this.onCut=function(t){t.preventDefault(),this.onCopy(t);var e=this.getSurface();e&&e.transaction(function(t,n){return e["delete"](t,n)})},this.onPaste=function(t){for(var e=t.clipboardData,n={},r=0;r<e.types.length;r++)n[e.types[r]]=!0;t.preventDefault(),t.stopPropagation();var a,c;if(n["text/plain"]&&(a=e.getData("text/plain")),n["text/html"]&&(c=e.getData("text/html")),o.isEdge&&s.clipboardData&&s.clipboardData.text===a?c=s.clipboardData.html:s.clipboardData={text:a,html:c},o.isFF&&!c)return void this._pastePlainText(a);if(c)if(i.NO_CATCH)this._pasteHtml(c,a);else try{this._pasteHtml(c,a)}catch(u){this._pastePlainText(a)}else this._pastePlainText(a)},this._pastePlainText=function(t){var e=this.getSurface();e.transaction(function(n,i){return i.text=t,e.paste(n,i)})},this.onBeforePasteShim=function(){var t=this.getSurface();if(t){var e=this._createPasteBin(),n=e.getNativeElement();n.focus();var i=window.document.createRange();i.setStart(n.firstChild,0),i.setEnd(n.firstChild,1);var r=window.getSelection();r.removeAllRanges(),r.addRange(i)}},this._createPasteBin=function(){var t=this.surface.el.createElement("div").attr("contenteditable",!0).attr("tabindex",-1).css({position:"fixed",opacity:"0.0",bottom:"-1000px"}).append(" ").on("beforepaste",function(t){t.stopPropagation()}).on("paste",function(e){this.onPasteShim(t),e.stopPropagation()}.bind(this));return this.surface.el.appendChild(t),t},this.onPasteShim=function(t){window.setTimeout(function(){var e=t.innerHTML,n=t.textContent;if(t.remove(),s.clipboardData={text:n,html:e},i.NO_CATCH)this._pasteHtml(e,n);else try{this._pasteHtml(e,n)}catch(r){this._pastePlainText(n)}}.bind(this))},this._copy=function(){var t=this.getSurface(),e=t.getSelection(),n=t.getDocument(),i=null,r="",o="";return e.isCollapsed()||(r=a.getTextForSelection(n,e)||"",i=t.copy(n,e),o=this.htmlExporter.exportDocument(i)),{doc:i,html:o,text:r}},this._pasteHtml=function(t,e){var n=this.getSurface();if(n){var i=this.htmlImporter.importDocument(t);return i?(n.transaction(function(t,r){return r.text=e,r.doc=i,n.paste(t,r)}),!0):void 0}}},r.initClass(i),i.clipboardData={doc:null,html:"",text:""},e.exports=i},{"../model/documentHelpers":272,"../util/oo":379,"../util/platform":380,"../util/substanceGlobals":382,"./ClipboardExporter":318,"./ClipboardImporter":319}],318:[function(t,e,n){"use strict";function i(t){i["super"].call(this,t)}var r=t("../model/HTMLExporter"),o=t("./ClipboardImporter"),s=o.CLIPBOARD_CONTAINER_ID,a=o.CLIPBOARD_PROPERTY_ID,c=t("../model/JSONConverter");i.Prototype=function(){this.exportDocument=function(t){this.state.doc=t;var e,n=this.convertDocument(t);e=1===n.length&&n[0].attr("data-id")===a?n[0].innerHTML:n.map(function(t){return t.outerHTML}).join("");var i=new c,r=JSON.stringify(i.exportDocument(t)),o=["<meta name='substance' content='",btoa(r),"'>"].join("");return"<html><head>"+o+"</head><body>"+e+"</body></html>"},this.convertDocument=function(t){var e=t.get(s);if(!e)throw new Error('Illegal clipboard document: could not find container "'+s+'"');return this.convertContainer(e)}},r.extend(i),i.CLIPBOARD_CONTAINER_ID=s,e.exports=i},{"../model/HTMLExporter":240,"../model/JSONConverter":243,"./ClipboardImporter":319}],319:[function(t,e,n){"use strict";function i(t){if(i._addConverters(t),!t.schema)throw new Error("Missing argument: config.schema is required.");this.IGNORE_DEFAULT_WARNINGS=!0,o(t,{trimWhitespaces:!0,REMOVE_INNER_WS:!0}),i["super"].call(this,t),this._isWindows=l.isWindows}var r=t("lodash/isArray"),o=t("lodash/extend"),s=t("lodash/forEach"),a=t("../util/Registry"),c=t("../model/HTMLImporter"),u=t("./DefaultDOMElement"),h=t("../model/JSONConverter"),l=t("../util/platform"),d=t("../model/transform/copySelection").CLIPBOARD_CONTAINER_ID,f=t("../model/transform/copySelection").CLIPBOARD_PROPERTY_ID;i.Prototype=function(){function t(t){if(t){var e=t.find("b");return e&&/^docs-internal/.exec(e.id)?e:t}}this.importDocument=function(e){var n,i;if(this._isWindows){var o=/<!--StartFragment\-->(.*)<!--EndFragment-->/.exec(e);o&&(e=o[1])}if(e.search(/meta name=.substance./)>=0){i=u.parseHTML(e);var s=i.find('meta[name="substance"]');if(s){var a=atob(s.attr("content"));a=decodeURIComponent(a);try{return this.importFromJSON(a)}catch(c){console.error(c)}}}if(i=u.parseHTML(e),r(i)?(n=this._createElement("body"),n.append(i)):n=i.find("body"),n||(n=this._createElement("body"),n.append(i)),n=t(n),!n)return console.warn("Invalid HTML."),null;this.reset(),this.convertBody(n);var h=this.generateDocument();return h},this.importFromJSON=function(t){var e=this.createDocument(),n=JSON.parse(t),i=new h;return i.importDocument(e,n),e},this.convertBody=function(t){this.convertContainer(t.childNodes,d)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("p");t.hasNext();){var n=t.next(),i=this._getConverterForElement(n,"block");if(i){t.back();break}e.append(n.clone())}e.attr("data-id",f);var r=this.defaultConverter(e,this);if(r){if(!r.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.");this._createAndShow(r)}return r},this.createDocument=function(){var t=this._createDocument(this.schema);return t.get(d)||t.create({type:"container",id:d,nodes:[]}),t},this._getUnsupportedNodeConverter=function(){}},c.extend(i),i.CLIPBOARD_CONTAINER_ID=d,i.CLIPBOARD_PROPERTY_ID=f;var p={"catch-all-block":{type:"paragraph",matchElement:function(t){return t.is("div")},"import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])}}};i._addConverters=function(t){if(t.converters){var e=new a;t.converters.forEach(function(t,n){e.add(n,t)}),s(p,function(t,n){e.add(n,t)}),t.converters=e}},e.exports=i},{"../model/HTMLImporter":241,"../model/JSONConverter":243,"../model/transform/copySelection":274,"../util/Registry":368,"../util/platform":380,"./DefaultDOMElement":328,"lodash/extend":166,"lodash/forEach":170,"lodash/isArray":176}],320:[function(t,e,n){"use strict";var i=t("../util/oo"),r=function(){};r.Prototype=function(){this.getName=function(){return this.constructor["static"].name},this.getCommandState=function(t,e){throw new Error("Command.getCommandState() is abstract.")},this.execute=function(t,e){throw new Error("Command.execute() is abstract.")},this._getDocumentSession=function(t,e){var n=t.documentSession||e.documentSession;if(!n)throw new Error("'documentSession' is required.");return n},this._getSelection=function(t){var e=t.selection||t.selectionState.getSelection();if(!e)throw new Error("'selection' is required.");return e}},i.initClass(r),e.exports=r},{"../util/oo":379}],321:[function(t,e,n){"use strict";function i(t,e){if(!t.documentSession)throw new Error("DocumentSession required.");this.documentSession=t.documentSession,this.context=o({},t,{doc:this.documentSession.getDocument()}),this.commandRegistry=new c,s(e,function(t){var e=new t;this.commandRegistry.add(t["static"].name,e)}.bind(this)),this.documentSession.on("update",this.updateCommandStates,this),this.updateCommandStates()}var r=t("../util/oo"),o=t("lodash/extend"),s=t("lodash/forEach"),a=t("lodash/isEqual"),c=t("../util/Registry");i.Prototype=function(){this.dispose=function(){this.documentSession.off(this)},this.getCommandContext=function(){return this.context},this.updateCommandStates=function(){var t={},e=this.getCommandContext(),n=this._getCommandProps();this.commandRegistry.forEach(function(i){t[i.getName()]=i.getCommandState(n,e)}),a(this.commandStates,t)||(this.commandStates=t)},this.getCommandStates=function(){return this.commandStates},this.executeCommand=function(t,e){var n=this.commandRegistry.get(t);if(!n)return void console.warn("command",t,"not registered");var i=this.commandStates[t];e=o(this._getCommandProps(),i,e);var r=n.execute(e,this.getCommandContext());return void 0===r&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled"),r},this._getCommandProps=function(){var t=this.context.documentSession,e=t.getSelectionState(),n=e.getSelection(),i=this.context.surfaceManager.getFocusedSurface();return{documentSession:t,selectionState:e,surface:i,selection:n}}},r.initClass(i),e.exports=i},{"../util/Registry":368,"../util/oo":379,"lodash/extend":166,"lodash/forEach":170,"lodash/isEqual":181}],322:[function(t,e,n){"use strict";function i(t,e){f.call(this),this.__id__=_++,this.parent=t,this.el=null,this.refs={},this.__foreignRefs__={},this._actionHandlers={},this.context=this._getContext()||{},Object.freeze(this.context),this.props=e||{},Object.freeze(this.props),this.state=this.getInitialState()||{},Object.freeze(this.state)}function r(t){return t?t._comp:void 0}function o(t){return console.assert(t._comp,"Expecting a back-link to the component instance."),r(t)}function s(t){return t}function a(t,e){if(!t._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!e._isVirtualHTMLElement)throw new Error("Illegal argument: 'virtualComp' must be a VirtualHTMLElement.");this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)}function c(t,e){if(!t._isComponent)throw new Error("Illegal argument: 'parent' must be a Component.");if(!e._isVirtualTextNode)throw new Error("Illegal argument: 'virtualComp' must be a VirtualTextNode.");this.parent=t}var u=t("lodash/isString"),h=t("lodash/isFunction"),l=t("lodash/extend"),d=t("lodash/each"),f=t("../util/EventEmitter"),p=t("./RenderingEngine"),g=t("./VirtualElement"),m=t("./DOMElement"),v=t("./DefaultDOMElement"),y=t("../util/inBrowser"),_=0;i.Prototype=function(){function t(t){t.triggerDispose(),t._owner&&t._ref&&(console.assert(t._owner.refs[t._ref]===t,"Owner's ref should point to this child instance."),delete t._owner.refs[t._ref])}function e(t,e){t.isMounted()&&e.triggerDidMount(!0),e._owner&&e._ref&&(e._owner.refs[e._ref]=e)}l(this,f.prototype),this._isComponent=!0,this.getChildContext=function(){return this.childContext||{}},this.getInitialState=function(){return{}},this.getParent=function(){return this.parent},this.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},this.getLabel=function(t){var e=this.context.labelProvider;if(!e)throw new Error("Missing labelProvider.");return e.getLabel(t)},this.render=function(t){return t("div")},this.mount=function(t){return this.el||this._render(),t._isDOMElement||(t=v.wrapNativeElement(t)),t.appendChild(this.el),t.isInDocument()&&this.triggerDidMount(!0),this},this.shouldRerender=function(t){return!0},this.rerender=function(){this._rerender(this.props,this.state)},this._rerender=function(t,e){this._render(t,e),this.isMounted()||this.didUpdate(t,e)},this._render=function(t,e){if(this.__isRendering__)throw new Error("Component is rendering already.");this.__isRendering__=!0;try{var n=new p;n._render(this,t,e)}finally{delete this.__isRendering__}},this.triggerDidMount=function(){this.getChildren().forEach(function(t){t.triggerDidMount(!0)}),this.__isMounted__||(this.__isMounted__=!0,this.didMount())},this.didMount=function(){},this.didUpdate=function(){},this.isMounted=function(){return this.__isMounted__},this.triggerDispose=function(){this.getChildren().forEach(function(t){t.triggerDispose()}),this.dispose(),this.__isMounted__=!1},this.dispose=function(){},this._setParent=function(t){this.parent=t,this.context=this._getContext()||{},Object.freeze(this.context)},this.send=function(t){for(var e=this;e;){if(e._actionHandlers&&e._actionHandlers[t])return e._actionHandlers[t].apply(e,Array.prototype.slice.call(arguments,1)),!0;e=e.getParent()}return console.warn("Action",t,"was not handled."),!1},this.handleActions=function(t){return d(t,function(t,e){this.handleAction(e,t)}.bind(this)),this},this.handleAction=function(t,e){if(!t||!e||!h(e))throw new Error("Illegal arguments.");e=e.bind(this),this._actionHandlers[t]=e},this.getState=function(){return this.state},this.setState=function(t){var e=this.props,n=this.state,i=!this.__isSettingProps__&&this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this.state=t||{},Object.freeze(this.state),i?this._rerender(e,n):this.__isSettingProps__||this.didUpdate(e,n)},this.extendState=function(t){t=l({},this.state,t),this.setState(t)},this.willUpdateState=function(t){},this.getProps=function(){return this.props},this.setProps=function(t){var e=this.props,n=this.state,i=this.shouldRerender(t,this.state);this._setProps(t),i?this._rerender(e,n):this.didUpdate(e,n)},this._setProps=function(t){t=t||{},this.__isSettingProps__=!0;try{this.willReceiveProps(t),this.props=t||{},Object.freeze(t)}finally{delete this.__isSettingProps__}},this.extendProps=function(t){var e=l({},this.props,t);this.setProps(e)},this.willReceiveProps=function(t){},this.getChildNodes=function(){if(!this.el)return[];var t=this.el.getChildNodes();return t=t.map(r).filter(s)},this.getChildren=function(){if(!this.el)return[];var t=this.el.getChildren();return t=t.map(r).filter(s)},this.getChildAt=function(t){var e=this.el.getChildAt(t);return o(e)},this.find=function(t){var e=this.el.find(t);return r(e)},this.findAll=function(t){var e=this.el.findAll(t);return e.map(r).filter(s)},this.appendChild=function(t){this.insertAt(this.getChildCount(),t)},this.insertAt=function(t,n){if(u(n)&&(n=new g.TextNode(n)),!n._isVirtualElement)throw new Error('Invalid argument: "child" must be a VirtualElement.');var i=(new p)._renderChild(this,n);this.el.insertAt(t,i.el),e(this,i)},this.removeAt=function(e){var n=this.el.getChildAt(e);if(n){var i=o(n);t(i),this.el.removeAt(e)}},this.removeChild=function(e){if(!e||!e._isComponent)throw new Error("removeChild(): Illegal arguments. Expecting a Component instance.");t(e),this.el.removeChild(e.el)},this.replaceChild=function(e,n){if(!(n&&e&&n._isComponent&&e._isComponent))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");t(e),this.el.replaceChild(n.el,e.el),this.isMounted()&&n.triggerDidMount(!0)},this.empty=function(){return this.el&&(this.getChildNodes().forEach(function(e){t(e)}),this.el.empty()),this},this.remove=function(){t(this),this.el.remove()},this._getContext=function(){var t={},e=this.getParent();return e&&(t=l(t,e.context),e.getChildContext)?l(t,e.getChildContext()):t},this.addEventListener=function(){throw new Error("Not supported.")},this.removeEventListener=function(){throw new Error("Not supported.")},this.insertBefore=function(){throw new Error("Not supported.")}},m.Delegator.extend(i),m._defineProperties(i,m._propertyNames),i.unwrap=r,i["static"].render=function(t){t=t||{};var e=this.__class__,n=new e(null,t);return n._render(),n},i["static"].mount=function(t,e){if(1===arguments.length&&(t={},e=arguments[0]),u(e)){var n=e;if(!y)throw new Error("This selector is not supported on server side.");e=window.document.querySelector(n)}e._isDOMElement||(e=new v.wrapNativeElement(e));var i=this.__class__,r=new i(null,t);return r.mount(e),r},i.mount=function(t,e,n){return 2===arguments.length&&(e={},n=arguments[1]),t["static"].mount(e,n)},a.Prototype=function(){this._isElementComponent=!0},i.extend(a),i.Element=a,c.Prototype=function(){this._isTextNodeComponent=!0,this.setTextContent=function(t){if(!this.el)throw new Error("Component must be rendered first.");if(this.el.textContent!==t){var e=this.el.createTextNode(t);this.el._replaceNativeEl(e.getNativeElement())}}},i.extend(c),i.TextNode=c,Object.defineProperty(i,"$$",{get:function(){throw new Error(["With Substance Beta 4 we introduced a breaking change.","We needed to turn the former static Component.$$ into a contextualized implementation, which is now served via Component.render($$).","FIX: change your signature of 'this.render()' in all your Components to 'this.render($$)"].join("\n"))}}),i.unwrapDOMElement=function(t){return r(t)},e.exports=i},{"../util/EventEmitter":367,"../util/inBrowser":376,"./DOMElement":326,"./DefaultDOMElement":328,"./RenderingEngine":345,"./VirtualElement":363,"lodash/each":164,"lodash/extend":166,"lodash/isFunction":182,"lodash/isString":189}],323:[function(t,e,n){"use strict";function i(t){r.call(this,t,function(t){if(!t.prototype._isComponent)throw new Error("Component registry: wrong type. Expected a ComponentClass. Was: "+String(t))})}var r=t("../util/Registry");r.extend(i),e.exports=i},{"../util/Registry":368}],324:[function(t,e,n){"use strict";function i(t,e){if(e.containerId=e.containerId||e.node.id,e.name=e.name||e.containerId||e.node.id,i["super"].apply(this,arguments),this.containerId=this.props.containerId,!r(this.containerId))throw new Error("Property 'containerId' is mandatory.");var n=this.getDocument();if(this.container=n.get(this.containerId),!this.container)throw new Error("Container with id "+this.containerId+" does not exist.");this.editingBehavior=this.context.editingBehavior||new u,i.prototype._deriveInternalState.call(this,this.props)}var r=t("lodash/isString"),o=t("lodash/last"),s=t("../util/uuid"),a=t("../util/keys"),c=t("../util/platform"),u=t("../model/EditingBehavior"),h=t("../model/transform/breakNode"),l=t("../model/transform/insertNode"),d=t("../model/transform/switchTextType"),f=t("../model/transform/paste"),p=t("./Surface"),g=t("./RenderingEngine"),m=t("./IsolatedNodeComponent");i.Prototype=function(){var t=Object.getPrototypeOf(this);this._isContainerEditor=!0,this.shouldRerender=function(t){return t.disabled!==this.props.disabled},this.willReceiveProps=function(e){t.willReceiveProps.apply(this,arguments),i.prototype._deriveInternalState.call(this,e)},this.didMount=function(){t.didMount.apply(this,arguments),this.container.on("nodes:changed",this.onContainerChange,this)},this.dispose=function(){t.dispose.apply(this,arguments),this.container.off(this)},this.render=function(e){var n=t.render.call(this,e),i=this.getDocument(),r=this.getContainerId(),o=i.get(r);return o||console.warn("No container node found for ",r),n.addClass("sc-container-editor container-node "+r).attr({spellCheck:!1,"data-id":r}),this.isEmpty()?n.append(e("a").attr("href","#").append("Start writing").on("click",this.onCreateText)):o.getNodes().forEach(function(t){n.append(this._renderNode(e,t).ref(t.id))}.bind(this)),this.props.disabled||(n.addClass("sm-enabled"),n.setAttribute("contenteditable",!0)),n},this._renderNode=function(e,n){if(!n)throw new Error("Illegal argument");if(n.isText())return t.renderNode.call(this,e,n);var i=this.context.componentRegistry,r=i.get(n.type);return r.prototype._isIsolatedNodeComponent?e(r,{node:n}).ref(n.id):e(m,{node:n}).ref(n.id)},this._deriveInternalState=function(t){var e=this._state;!t.hasOwnProperty("enabled")||t.enabled?e.enabled=!0:e.enabled=!1},this._handleUpOrDownArrowKey=function(t){t.stopPropagation();var e=t.keyCode===a.UP?"left":"right",n=this.getDocumentSession().getSelectionState(),i=n.getSelection();if(i.isNodeSelection()&&i.isFull()&&!t.shiftKey)this.domSelection.collapse(e);else if(!c.isIE&&!i.isCollapsed()&&!t.shiftKey){var r=this.getDocument();"left"===e?this.setSelection(r.createSelection(i.start.path,i.start.offset)):this.setSelection(r.createSelection(i.end.path,i.end.offset))}window.setTimeout(function(){this.isMounted()&&this._updateModelSelection({direction:e})}.bind(this))},this._handleLeftOrRightArrowKey=function(e){e.stopPropagation();var n=e.keyCode===a.LEFT?"left":"right",i=this.getDocumentSession().getSelectionState(),r=i.getSelection();return r.isNodeSelection()&&r.isFull()&&!e.shiftKey?(e.preventDefault(),void this.setSelection(r.collapse(n))):void t._handleLeftOrRightArrowKey.call(this,e)},this._handleEnterKey=function(e){var n=this.getDocumentSession().getSelection();n.isNodeSelection()&&n.isFull()?(e.preventDefault(),e.stopPropagation()):t._handleEnterKey.apply(this,arguments)},this.isContainerEditor=function(){return!0},this.getContainerId=function(){return this.containerId},this.getContainer=function(){return this.getDocument().get(this.getContainerId())},this.isEmpty=function(){var t=this.getContainer();return t&&0===t.nodes.length},this.isEditable=function(){return t.isEditable.call(this)&&!this.isEmpty()},this.selectFirst=function(){console.warn("TODO: Implement selection of first content to be found.")},this.extendBehavior=function(t){t.register(this.editingBehavior)},this.getTextTypes=function(){return this.textTypes||[]},this.getTextCommands=function(){var t={};return this.commandRegistry.each(function(e){e.constructor["static"].textTypeName&&(t[e.getName()]=e)}),t},this["break"]=function(t,e){return h(t,e)},this.insertNode=function(t,e){return e.selection.isPropertySelection()||e.selection.isContainerSelection()?l(t,e):void 0},this.switchType=function(t,e){return e.selection.isPropertySelection()?d(t,e):void 0},this.selectAll=function(){var t=this.getDocument(),e=t.get(this.getContainerId());if(0!==e.nodes.length){var n=e.nodes[0],i=o(e.nodes),r=t.createSelection({type:"container",containerId:e.id,startPath:[n],startOffset:0,endPath:[i],endOffset:1});this.setSelection(r)}},this.selectFirst=function(){var t=this.getDocument(),e=this.getContainer().nodes;if(0===e.length)return void console.warn("ContainerEditor.selectFirst(): Container is empty.");var n,i=t.get(e[0]);n=i.isText()?t.createSelection(i.getTextPath(),0):t.createSelection(this.getContainerId(),[i.id],0,[i.id],1),this.setSelection(n)},this.paste=function(t,e){return e.selection.isPropertySelection()||e.selection.isContainerSelection()?f(t,e):void 0},this.onContainerChange=function(t){for(var e=this.getDocument(),n=g.createContext(this),i=n.$$,r=this.getContainer(),o=r.getContentPath(),s=0;s<t.ops.length;s++){var a=t.ops[s];if("update"===a.type&&a.path[0]===o[0]){var c=a.diff;if("insert"===c.type){var u,h=c.getValue(),l=e.get(h);u=l?this._renderNode(i,l):i("div"),this.insertAt(c.getOffset(),u)}else"delete"===c.type&&this.removeAt(c.getOffset())}}},this.onCreateText=function(t){t.preventDefault();var e;this.transaction(function(t){var n=t.get(this.props.containerId),i=t.getSchema().getDefaultTextType(),r=t.create({id:s(i),type:i,content:""});n.show(r.id),e=t.createSelection({type:"property",path:[r.id,"content"],startOffset:0,endOffset:0})}.bind(this)),this.rerender(),this.setSelection(e)},this.transaction=function(t,e){var n=this.documentSession,i=this.getId(),r=this.getContainerId();return n.transaction(function(e,n){var o=e.before.selection;o&&!o.isNull()&&(o.containerId=o.containerId||r),e.before.surfaceId=i,n.containerId=this.getContainerId(),n.editingBehavior=this.editingBehavior;var s=t(e,n);return s?(o=s.selection,o&&!o.isNull()&&(o.containerId=r),s):void 0}.bind(this),e)}},p.extend(i),i["static"].isContainerEditor=!0,e.exports=i},{"../model/EditingBehavior":238,"../model/transform/breakNode":273,"../model/transform/insertNode":282,"../model/transform/paste":285,"../model/transform/switchTextType":287,"../util/keys":377,"../util/platform":380,"../util/uuid":383,"./IsolatedNodeComponent":338,"./RenderingEngine":345,"./Surface":352,"lodash/isString":189,"lodash/last":195}],325:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("span").addClass("se-cursor");if(e.append("\ufeff"),e.append(t("div").addClass("se-cursor-inner")),this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e}},r.extend(i),e.exports=i},{"./Component":322}],326:[function(t,e,n){"use strict";function i(){}function r(){this.el=null}function o(t,e,n){if(!l(t)||!u(e))throw new Error("Illegal arguments: 'eventName' must be a String, and 'handler' must be a Function.");n=n||{};var i=e,r=n.context,o=Boolean(n.capture);r&&(e=e.bind(r)),n.once===!0&&(e=s(this,e)),this.eventName=t,this.originalHandler=i,this.handler=e,this.capture=o,this.context=r,this.options=n,this._el=null}function s(t,e){return function(n){e(n),t._el.removeEventListener(t)}}function a(){}var c=t("../util/oo"),u=t("lodash/isFunction"),h=t("lodash/isObject"),l=t("lodash/isString"),d=t("lodash/isArray"),f=t("lodash/findIndex"),p=t("lodash/forEach"),g=t("../util/ArrayIterator");i.Prototype=function(){this._isDOMElement=!0;var t="This method is not implemented.";this.getNativeElement=function(){throw new Error(t)},this.hasClass=function(e){throw new Error(t)},this.addClass=function(e){throw new Error(t)},this.removeClass=function(e){throw new Error(t)},this.attr=function(){if(1===arguments.length){if(l(arguments[0]))return this.getAttribute(arguments[0]);h(arguments[0])&&p(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},this.removeAttr=function(t){var e=t.split(/\s+/);return 1===e.length?this.removeAttribute(t):e.forEach(function(t){this.removeAttribute(t)}.bind(this)),this},this.getAttribute=function(e){throw new Error(t)},this.setAttribute=function(e,n){throw new Error(t)},this.removeAttribute=function(e){throw new Error(t)},this.getAttributes=function(){throw new Error(t)},this.htmlProp=function(){if(1===arguments.length){if(l(arguments[0]))return this.getProperty(arguments[0]);h(arguments[0])&&p(arguments[0],function(t,e){this.setProperty(e,t)}.bind(this))}else 2===arguments.length&&this.setProperty(arguments[0],arguments[1]);return this},this.getProperty=function(e){throw new Error(t)},this.setProperty=function(e,n){throw new Error(t)},this.removeProperty=function(e){throw new Error(t)},this.getTagName=function(){throw new Error(t)},this.setTagName=function(e){throw new Error(t)},this.getId=function(){throw new Error(t)},this.setId=function(e){throw new Error(t)},this.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},this.getValue=function(){throw new Error(t)},this.setValue=function(e){throw new Error(t)},this.css=function(){if(1===arguments.length){if(l(arguments[0]))return this.getStyle(arguments[0]);if(!h(arguments[0]))throw new Error("Illegal arguments.");p(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},this.getStyle=function(e){throw new Error(t)},this.setStyle=function(e,n){throw new Error(t)},this.text=function(t){return 0===arguments.length?this.getTextContent():(this.setTextContent(t),this)},this.getTextContent=function(){throw new Error(t)},this.setTextContent=function(e){throw new Error(t)},this.html=function(t){return 0===arguments.length?this.getInnerHTML():(this.setInnerHTML(t),this)},this.getInnerHTML=function(){throw new Error(t)},this.setInnerHTML=function(e){throw new Error(t)},this.getOuterHTML=function(){throw new Error(t)},this.on=function(t,e,n,i){if(!l(t))throw new Error('Illegal argument: "event" must be a String.');if(i=i||{},n&&(i.context=n),i.selector&&!l(i.selector))throw new Error("Illegal argument: selector must be a string.");if(!e||!u(e))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,i),this},this.off=function(t,e){if(1!==arguments.length||l(t))this.removeEventListener(t,e);else{var n=arguments[0];this.getEventListeners().filter(function(t){return t.context===n}).forEach(function(t){this.removeEventListener(t)}.bind(this))}return this},this.addEventListener=function(e,n,i){throw new Error(t)},this.removeEventListener=function(e,n){throw new Error(t)},this.getEventListeners=function(){throw new Error(t)},this.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},this.getChildCount=function(){throw new Error(t)},this.getChildNodes=function(){throw new Error(t)},this.getChildren=function(){throw new Error(t)},this.getChildAt=function(e){throw new Error(t)},this.getChildIndex=function(e){throw new Error(t)},this.getChildNodeIterator=function(){return new g(this.getChildNodes())},this.getLastChild=function(){throw new Error(t)},this.getFirstChild=function(){throw new Error(t)},this.getNextSibling=function(){throw new Error(t)},this.getPreviousSibling=function(){throw new Error(t)},this.isTextNode=function(){throw new Error(t)},this.isElementNode=function(){throw new Error(t)},this.isCommentNode=function(){throw new Error(t)},this.isDocumentNode=function(){throw new Error(t)},this.clone=function(){throw new Error(t)},this.createElement=function(e){throw new Error(t)},this.createTextNode=function(e){throw new Error(t)},this.is=function(e){throw new Error(t)},this.getParent=function(){throw new Error(t)},this.getRoot=function(){throw new Error(t)},this.find=function(e){throw new Error(t)},this.findAll=function(e){throw new Error(t)},this.append=function(t){var e;if(1===arguments.length){if(!d(t))return this.appendChild(t),this;e=t}else e=arguments;return e&&Array.prototype.forEach.call(e,this.appendChild.bind(this)),this},this.appendChild=function(e){throw new Error(t)},this.insertAt=function(e,n){throw new Error(t)},this.insertBefore=function(e,n){throw new Error(t)},this.removeAt=function(e){throw new Error(t)},this.removeChild=function(e){throw new Error(t)},this.replaceChild=function(e,n){throw new Error(t)},this.remove=function(){var t=this.getParent();t&&t.removeChild(this)},this.empty=function(){throw new Error(t)},this.remove=function(){throw new Error(t)},this.serialize=function(){return this.outerHTML},this.isInDocument=function(){return!1},this.focus=function(){return this},this.blur=function(){return this},this.click=function(){return this},this.getWidth=function(){return 0},
this.getHeight=function(){return 0},this.getOuterHeight=function(t){return 0},this.getOffset=function(){return{top:0,left:0}},this.getPosition=function(){return{top:0,left:0}}},c.initClass(i);var m={id:{configurable:!0,get:function(){return this.getId()},set:function(t){this.setId(t)}},tagName:{configurable:!0,get:function(){return this.getTagName()},set:function(t){this.setTagName(t)}},nodeName:{configurable:!0,get:function(){return this.getTagName()}},nodeType:{configurable:!0,get:function(){return this.getNodeType()},set:function(){throw new Error("ui/DOMElement#nodeType is readonly.")}},textContent:{configurable:!0,get:function(){return this.getTextContent()},set:function(t){this.setTextContent(t)}},innerHTML:{configurable:!0,get:function(){return this.getInnerHTML()},set:function(t){this.setInnerHTML(t)}},outerHTML:{configurable:!0,get:function(){return this.getOuterHTML()},set:function(){throw new Error("ui/DOMElement#outerHTML is readonly.")}},childNodes:{configurable:!0,get:function(){return this.getChildNodes()},set:function(){throw new Error("ui/DOMElement#childNodes is readonly.")}},children:{configurable:!0,get:function(){return this.getChildren()},set:function(){throw new Error("ui/DOMElement#children is readonly.")}},parentNode:{configurable:!0,get:function(){return this.getParent()},set:function(){throw new Error("ui/DOMElement#parentNode is readonly.")}},height:{configurable:!0,get:function(){return this.getHeight()}},width:{configurable:!0,get:function(){return this.getWidth()}}};i._propertyNames=Object.keys(m),i._defineProperties=function(t,e){e=e||i._propertyNames,e.forEach(function(e){var n=m[e];n&&Object.defineProperty(t.prototype,e,n)})},i.parseHTML=function(e){var n=t("./DefaultDOMElement");return n.parseHTML(e)},i.parseXML=function(e){var n=t("./DefaultDOMElement");return n.parseXML(e)},r.Prototype=function(){var t={getNativeElement:null,hasClass:!1,getAttribute:null,getAttributes:{},getProperty:null,getTagName:"throw",getId:"throw",getValue:null,getStyle:null,getTextContent:"",getInnerHTML:"",getOuterHTML:"",getChildCount:0,getChildNodes:[],getChildren:[],getChildAt:null,getParent:null,getRoot:null,getEventListeners:[],find:null,findAll:[],is:!1,isTextNode:!1,isElementNode:!1,isCommentNode:!1,isDocumentNode:!1,isInDocument:!1,position:null};p(t,function(t,e){this[e]=function(){if(!this.el){if("throw"===t)throw new Error("This component has not been rendered yet.");return t}return this.el[e].apply(this.el,arguments)}}.bind(this)),["addClass","removeClass","setAttribute","removeAttribute","setProperty","removeProperty","setTagName","setId","setValue","setStyle","setTextContent","setInnerHTML","addEventListener","removeEventListener","appendChild","insertAt","insertBefore","remove","removeAt","removeChild","replaceChild","empty","focus","blur","click"].forEach(function(t){this[t]=function(){if(!this.el)throw new Error("This component has not been rendered yet.");return this.el[t].apply(this.el,arguments),this}}.bind(this))},i.extend(r),i.Delegator=r,o.prototype._isDOMEventListener=!0,o.matches=function(t,e){return t.eventName===e.eventName&&t.originalHandler===e.originalHandler},i.EventListener=o,i._findEventListenerIndex=function(t,e,n){var i=-1;return i=arguments[1]._isDOMEventListener?t.indexOf(arguments[1]):f(t,o.matches.bind(null,{eventName:e,originalHandler:n}))},a.Prototype=function(){this._isDOMElement=!0,this.isTextNode=function(){return!0},this.getNodeType=function(){return"text"},this.isElementNode=this.isDocumentNode=this.isCommentNode=function(){return!1},["getParent","getNextSibling","getPreviousSibling","text","getTextContent","setTextContent","clone"].forEach(function(t){this[t]=i.prototype[t]}.bind(this))},c.initClass(a),i.TextNode=a,e.exports=i},{"../util/ArrayIterator":365,"../util/oo":379,"./DefaultDOMElement":328,"lodash/findIndex":169,"lodash/forEach":170,"lodash/isArray":176,"lodash/isFunction":182,"lodash/isObject":186,"lodash/isString":189}],327:[function(t,e,n){"use strict";function i(t){this.surface=t,this._wrange=window.document.createRange()}var r=t("lodash/last"),o=t("../util/oo"),s=t("../model/Coordinate"),a=t("../model/Range"),c=t("./DefaultDOMElement"),u=t("./TextPropertyComponent"),h=t("./InlineNodeComponent"),l=t("./IsolatedNodeComponent");i.Prototype=function(){function t(t){if(t._isDOMElement||(t=c.wrapNativeElement(t)),t.isElementNode()){var e=t.getAttribute("data-path");return e.split(".")}throw new Error("Can't get path from element:"+t.outerHTML)}function e(t,e,n,i){if(n){var r=t;t=e,e=r}return new a(t,e,n,i)}function n(t,e){return new a(new s([t],0),new s([t],1),!1,e)}this.getSelection=function(t){var e=this.mapDOMSelection(t),n=this.surface.getDocument();return n.createSelection(e)},this.setSelection=function(t){var e=window.getSelection();if(t.isNull()||t.isCustomSelection())return void this.clear();var n,i;if(t.isPropertySelection()||t.isContainerSelection()){if(n=this._getDOMCoordinate(t.start),!n)return console.warn("FIXME: selection seems to be invalid."),void this.clear();if(t.isCollapsed())i=n;else if(i=this._getDOMCoordinate(t.end),!i)return console.warn("FIXME: selection seems to be invalid."),void this.clear()}else if(t.isNodeSelection()){var r=this.surface.find('*[data-id="'+t.getNodeId()+'"]');if(!r)return console.error("Could not find component with id",t.getNodeId()),void this.clear();if(r._isIsolatedNodeComponent){var o=l.getDOMCoordinates(r);t.isFull()?(n=o.start,i=o.end):n=i=t.isBefore()?o.start:o.end}else{var s=r.el;n={container:s.getNativeElement(),offset:0},i={container:s.getNativeElement(),offset:s.getChildCount()},t.isBefore()?i=n:t.isAfter()&&(n=i)}}var a;if(a=e.rangeCount>0?e.getRangeAt(0):this._wrange,e.removeAllRanges(),t.isCollapsed())a.setStart(n.container,n.offset),a.setEnd(n.container,n.offset),e.addRange(a);else if(t.isReverse()){var c=n;n=i,i=c,a.setStart(n.container,n.offset),a.setEnd(n.container,n.offset),e.addRange(a),e.extend(i.container,i.offset)}else a.setStart(n.container,n.offset),a.setEnd(i.container,i.offset),e.addRange(a)},this._getDOMCoordinate=function(t){var e,n=null;return t.isNodeCoordinate()?(e=this.surface.find('*[data-id="'+t.getNodeId()+'"]'),e&&(n=e._isIsolatedNodeComponent?l.getDOMCoordinate(e,t):{container:e.getNativeElement(),offset:t.offset})):(e=this.surface._getTextPropertyComponent(t.path),e&&(n=e.getDOMCoordinate(t.offset))),n},this.mapDOMRange=function(t){return this._getRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)},this.mapDOMSelection=function(t){var i,r=window.getSelection();if(0===r.rangeCount)return null;var o=c.wrapNativeElement(r.anchorNode);if(r.isCollapsed){var a=this._getCoordinate(o,r.anchorOffset,t);if(!a)return null;i=a.__inIsolatedBlockNode__?n(a.path[0],this.getContainerId()):a.__inInlineNode__?e(new s(a.path,a.__startOffset__),new s(a.path,a.__endOffset__),!1,this.getContainerId()):e(a,a,!1,this.getContainerId())}else if(o.isElementNode()&&o.is(".sc-surface"))i=this._getEnclosingRange(r.getRangeAt(0));else{var u=c.wrapNativeElement(r.focusNode);i=this._getRange(o,r.anchorOffset,u,r.focusOffset)}return i},this.clear=function(){window.getSelection().removeAllRanges()},this.collapse=function(t){var e,n=window.getSelection();n.rangeCount>0&&(e=n.getRangeAt(0),e.collapse("left"===t),n.removeAllRanges(),n.addRange(e))},this.getContainerId=function(){return this.surface.isContainerEditor()?this.surface.getContainerId():null},this._getRange=function(t,n,i,r){var o,s=this._getCoordinate(t,n);o=t===i&&n===r?s:this._getCoordinate(i,r);var a=c.isReverse(t,n,i,r);return s&&o?e(s,o,a,this.getContainerId()):null},this._getCoordinate=function(t,e,n){var i=this.surface.el,r=null;return r||(r=h.getCoordinate(t,e),r&&(r.__inInlineNode__=!0)),r||(r=u.getCoordinate(i,t,e)),r||(r=l.getCoordinate(i,t,e),r&&(r.__inIsolatedBlockNode__=!0)),r||(r=this._searchForCoordinate(t,e,n)),r},this._searchForCoordinate=function(e,n,i){i=i||{},i.direction=i.direction||"right";var o=i.direction;if(e.isElementNode()){var a=e.getChildCount();n=Math.max(0,Math.min(a,n));for(var c=e.getChildAt(n);c;){var u;if("right"===o){if(c.isElementNode()&&(u=c.getAttribute("data-path")?c:c.find("*[data-path]")))return new s(t(u),0);c=c.getNextSibling()}else{if(c.isElementNode()){if(c.getAttribute("data-path"))u=c;else{var h=c.findAll("*[data-path]");u=r(h)}if(u){var l=t(u),d=this.surface.getDocument(),f=d.get(l);return new s(l,f.length)}}c=c.getPreviousSibling()}}}if(e!==this.surface.el){var p=e.getParent(),g=p.getChildIndex(e);return"right"===o&&g++,this._searchForCoordinate(p,g,i)}return null},this._getEnclosingRange=function(e){var n=e.cloneContents(),i=n.querySelectorAll("*[data-path]");if(0===i.length)return null;var r,o=this.surface.getDocument(),c=i[0],u=i[i.length-1],h=t(c);if(c===u)return r=o.get(h),new a(new s(h,0),new s(h,r.length),!1);var l=t(u);return r=o.get(l),new a(new s(h,0),new s(l,r.length),!1)}},o.initClass(i),e.exports=i},{"../model/Coordinate":226,"../model/Range":249,"../util/oo":379,"./DefaultDOMElement":328,"./InlineNodeComponent":337,"./IsolatedNodeComponent":338,"./TextPropertyComponent":357,"lodash/last":195}],328:[function(t,e,n){"use strict";var i,r=t("../util/inBrowser");i=t(r?"./BrowserDOMElement.js":"./CheerioDOMElement.js");var o={};o.createTextNode=function(t){var e=i.createTextNode(t);return new i(e)},o.createElement=function(t){var e=i.createElement(t);return new i(e)},o._create=function(t){return new i(t)},o.getBrowserWindow=function(){return r?i.getBrowserWindow():o.createElement("div")},o.parseHTML=function(t){return i.parseMarkup(t,"html")},o.parseXML=function(t,e){return i.parseMarkup(t,"xml",e)},o.wrapNativeElement=function(e){if(!e)return null;if(r&&(e instanceof window.Node||e===window)){var n=t("./BrowserDOMElement");return n.wrapNativeElement(e)}if(e.root&&"root"===e.root.type){var i=t("./CheerioDOMElement");return i.wrapNativeElement(e)}},o.isReverse=function(e,n,i,o){if(r){var s=t("./BrowserDOMElement");return s.isReverse(e,n,i,o)}throw new Error("Not implemented.")},e.exports=o},{"../util/inBrowser":376,"./BrowserDOMElement":315,"./BrowserDOMElement.js":315,"./CheerioDOMElement":316,"./CheerioDOMElement.js":316}],329:[function(t,e,n){"use strict";function i(t,e){this.lang=e||"en",this.labels=t}var r=t("../util/oo");i.Prototype=function(){this.getLabel=function(t){var e=this.labels[this.lang];return e?e[t]||t:t}},r.initClass(i),e.exports=i},{"../util/oo":379}],330:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass(this.getClassNames()),n=this.props.commandStates,i=this.context.toolRegistry;return i.forEach(function(i){if(i.options.overlay){var r=i.Class["static"].getProps(n);if(r){var o=i.Class["static"].name;e.append(t(i.Class,r).ref(o))}}}),e},this.getClassNames=function(){return"sc-default-overlay"}},r.extend(i),e.exports=i},{"./Component":322}],331:[function(t,e,n){"use strict";function i(t,e,n){this.owner=t,this.target=e,this.originalEvent=n}e.exports=i},{}],332:[function(t,e,n){"use strict";var i=t("../util/oo"),r=function(){};r.Prototype=function(){this.uploadFile=function(t,e){var n=window.URL.createObjectURL(t);e(null,n)}},i.initClass(r),e.exports=r},{"../util/oo":379}],333:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){return t("i").addClass("fa "+this.props.icon)}},r.extend(i),e.exports=i},{"./Component":322}],334:[function(t,e,n){"use strict";function i(t){this.map={},r(t,function(t,e){var n=t.fontawesome;n&&this.addIcon(e,n)}.bind(this))}var r=t("lodash/forEach"),o=t("../util/oo"),s=t("./FontAwesomeIcon");i.Prototype=function(){this.renderIcon=function(t,e){var n=this.map[e];return n?t(s,{icon:n}):void 0},this.addIcon=function(t,e){this.map[t]=e}},o.initClass(i),e.exports=i},{"../util/oo":379,"./FontAwesomeIcon":333,"lodash/forEach":170}],335:[function(t,e,n){"use strict";function i(t,e){this.documentSession=t,this.surfaceManager=e,this.listeners=[],this.initialize()}var r=t("../util/oo"),o=t("../util/inBrowser"),s=t("./DefaultDOMElement"),a=t("./DOMElement");i.Prototype=function(){var t=["keydown","keyup","keypress","mousedown","mouseup","copy"];this.initialize=function(){if(o){var e=s.wrapNativeElement(window.document);t.forEach(function(t){e.on(t,this._dispatch.bind(this,t),this)}.bind(this))}},this.dispose=function(){if(o){var t=s.wrapNativeElement(window.document);t.off(this)}},this.on=a.prototype.on,this.off=a.prototype.off,this.addEventListener=function(t,e,n){if(!n.id)throw new Error("GlobalEventHandler can only be used with option 'id'");var i=new a.EventListener(t,e,n);this.listeners.push(i)},this.removeEventListener=function(t){var e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1)},this.getEventListeners=function(){return this.listeners},this._getActiveListener=function(t){var e=this.documentSession,n=e.getSelection();if(n)for(var i=n.surfaceId,r=0;r<this.listeners.length;r++){var o=this.listeners[r];if(o.eventName===t&&o.options.id===i)return o}},this._dispatch=function(t,e){var n=this._getActiveListener(t);n&&n.handler(e)}},r.initClass(i),e.exports=i},{"../util/inBrowser":376,"../util/oo":379,"./DOMElement":326,"./DefaultDOMElement":328}],336:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Command"),o=t("../model/transform/insertInlineNode");i.Prototype=function(){this.getAnnotationType=function(){var t=this.constructor["static"].annotationType||this.constructor["static"].name;if(t)return t;throw new Error("Contract: AnnotationCommand.static.annotationType should be associated to a document annotation type.")},this.getCommandState=function(t,e){var n=e.documentSession.getSelection(),i={disabled:!0,active:!1,node:void 0};n&&!n.isNull()&&n.isPropertySelection()&&(i.disabled=!1);var r=this._getAnnotationsForSelection(t,e);return 1===r.length&&r[0].getSelection().equals(n)&&(i.active=!0,i.node=r[0]),i},this._getAnnotationsForSelection=function(t){return t.selectionState.getAnnotationsForType(this.getAnnotationType())},this.execute=function(t,e){var n=this.getCommandState(t,e);if(!n.disabled){var i=e.surface||e.surfaceManager.getFocusedSurface();return i&&i.transaction(function(t,e){return this.insertInlineNode(t,e)}.bind(this)),!0}},this.insertInlineNode=function(t,e){return e.node=this.createNodeData(t,e),o(t,e)},this.createNodeData=function(t,e){return{type:this.constructor["static"].name}}},r.extend(i),e.exports=i},{"../model/transform/insertInlineNode":281,"./Command":320}],337:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("lodash/isEqual"),o=t("lodash/startsWith"),s=t("../model/Coordinate"),a=t("./IsolatedNodeComponent");i.Prototype=function(){var t=i["super"].prototype;this._isInlineNodeComponent=!0,this.__elementTag="span",this.__slugChar="\ufeff",this.getClassNames=function(){return"sc-inline-node"},this.render=function(e){var n=t.render.apply(this,arguments);return n.attr("data-inline","1"),n},this._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var i=this.getId(),s=this.props.node,a=this._getSurfaceParent().getId(),c=n===a;if(c){if(e.isPropertySelection()&&!e.isCollapsed()&&r(e.path,s.path)){var u=s.getSelection();if(u.equals(e))return{mode:"selected"};if(e.contains(u))return{mode:"co-selected"}}}else if(o(n,i)){var h=i.split("/"),l=n.split("/");return l.length>=h.length&&l.length<=h.length+1?{mode:"focused"}:{mode:"co-focused"}}}},this._selectNode=function(){var t=this.context.surface,e=t.getDocument(),n=this.props.node;t.setSelection(e.createSelection({type:"property",path:n.path,startOffset:n.startOffset,endOffset:n.endOffset}))}},a.extend(i),i.getCoordinate=function(t){var e=t.getParent();if(t.isTextNode()&&e.is(".se-slug")){var n=e,i=n.getParent();if(i.is(".sc-inline-node")){var r=Number(i.getAttribute("data-offset")),o=Number(i.getAttribute("data-length")),a=r;n.is("sm-after")&&(a+=o);for(var c;i=i.getParent();){var u=i.getAttribute("data-path");if(u){c=u.split(".");var h=new s(c,a);return h.__inInlineNode__=!0,h.__startOffset__=r,h.__endOffset__=r+o,h}}}}return null},e.exports=i},{"../model/Coordinate":226,"./IsolatedNodeComponent":338,"lodash/isEqual":181,"lodash/startsWith":204}],338:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.name=this.props.node.id,this._id=s(this),this._state={selectionFragment:null},this.handleAction("escape",this._escape),this.ContentClass=this._getContentClass(this.props.node)||c}var r=t("lodash/startsWith"),o=t("../util/keys"),s=t("../util/createSurfaceId"),a=t("../model/Coordinate"),c=t("./Component");i.Prototype=function(){var t=i["super"].prototype;this._isIsolatedNodeComponent=!0,this.__elementTag="div",this.__slugChar="|",this.getChildContext=function(){return{surfaceParent:this}},this.getInitialState=function(){var t=this.context.documentSession.getSelectionState();return this._deriveStateFromSelectionState(t)},this.didMount=function(){t.didMount.call(this);var e=this.context.documentSession;e.on("update",this.onSessionUpdate,this)},this.dispose=function(){t.dispose.call(this);var e=this.context.documentSession;e.off(this)},this.getClassNames=function(){return"sc-isolated-node"},this.render=function(e){var n=this.props.node,i=this.ContentClass,r=t.render.apply(this,arguments);r.tagName=this.__elementTag,r.addClass(this.getClassNames()).addClass("sm-"+this.props.node.type).attr("data-id",n.id),this.state.mode?r.addClass("sm-"+this.state.mode):r.addClass("sm-not-selected"),i["static"].noStyle||r.addClass("sm-default-style"),r.on("mousedown",this.onMousedown),r.on("keydown",this.onKeydown).on("keypress",this._stopPropagation).on("keyup",this._stopPropagation).on("compositionstart",this._stopPropagation).on("textInput",this._stopPropagation),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-before").ref("before").append(this.__slugChar));var o=this._getLevel(),s=e(this.__elementTag).addClass("se-container").attr("contenteditable",!1).css({"z-index":2*o});if(i["static"].fullWidth&&s.addClass("sm-full-width"),"cursor"===this.state.mode&&"before"===this.state.position&&s.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-before").attr("contenteditable",!1)),s.append(this.renderContent(e,n)),this.isDisabled()){s.addClass("sm-disabled");var a=e(this.__elementTag).addClass("se-blocker").css({"z-index":2*o+1});s.append(a)}return"cursor"===this.state.mode&&"after"===this.state.position&&s.append(e(this.__elementTag).addClass("se-cursor").addClass("sm-after").attr("contenteditable",!1)),r.append(s),r.append(e(this.__elementTag).addClass("se-slug").addClass("sm-after").ref("after").append(this.__slugChar)),r},this.renderContent=function(t,e){var n=this.ContentClass;if(n){var i={node:e,disabled:this.isDisabled(),isolatedNodeState:this.state.mode};return"focused"===this.state.mode&&(i.focused=!0),t(n,i).ref("content")}return console.error("Could not resolve a component for type: "+e.type),t(this.__elementTag)},this.getId=function(){return this._id},this.getMode=function(){return this.state.mode},this.isNotSelected=function(){return!this.state.mode},this.isSelected=function(){return"selected"===this.state.mode},this.isCoSelected=function(){return"co-selected"===this.state.mode},this.isFocused=function(){return"focused"===this.state.mode},this.isCoFocused=function(){return"co-focused"===this.state.mode},this._getContentClass=function(t){var e=this.context.componentRegistry,n=e.get(t.type);return n},this.isDisabled=function(){return!this.state.mode||["co-selected","cursor"].indexOf(this.state.mode)>-1},this._isDisabled=this.isDisabled,this._getSurfaceParent=function(){return this.context.surface},this._getLevel=function(){for(var t=1,e=this._getSurfaceParent();e;)t++,e=e._getSurfaceParent();return t},this.onSessionUpdate=function(t){if(t.selection){var e=this.context.documentSession,n=this._deriveStateFromSelectionState(e.getSelectionState());!n&&this.state.mode?this.setState({}):n&&n.mode!==this.state.mode&&this.setState(n)}},this._deriveStateFromSelectionState=function(t){var e=t.getSelection(),n=e.surfaceId;if(n){var i=this.getId(),o=this.props.node.id,s=this._getSurfaceParent().getId(),a=n===s;if(a){if(e.isNodeSelection()&&e.getNodeId()===o){if(e.isFull())return{mode:"selected"};if(e.isBefore())return{mode:"cursor",position:"before"};if(e.isAfter())return{mode:"cursor",position:"after"}}if(e.isContainerSelection()&&e.containsNodeFragment(o))return{mode:"co-selected"}}else{if(e.isCustomSelection()&&i===n)return{mode:"focused"};if(r(n,i)){var c=i.split("/"),u=n.split("/"),h=c.length,l=u.length;return l>h&&c[h-1]===u[h-1]?l===h+1?{mode:"focused"}:{mode:"co-focused"}:null}}}},this.onMousedown=function(t){switch(t.stopPropagation(),this.state.mode){case"selected":case"focused":break;default:t.preventDefault(),this._selectNode(),this.setState({mode:"selected"})}},this.onKeydown=function(t){t.stopPropagation(),t.keyCode===o.ESCAPE&&"focused"===this.state.mode&&(t.preventDefault(),this._escape())},this._escape=function(){this._selectNode(),this.setState({mode:"selected"})},this._stopPropagation=function(t){t.stopPropagation()},this._selectNode=function(){var t=this.context.surface,e=t.getDocument(),n=this.props.node.id;t.setSelection(e.createSelection({type:"node",containerId:t.getContainerId(),nodeId:n,mode:"full"}))}},c.extend(i),i.getCoordinate=function(t,e){var n=e.getParent();if(e.isTextNode()&&n.is(".se-slug")){var i=n,r=i.getParent(),o=r.getAttribute("data-id");if(o){var s=i.is("sm-after")?1:0;return new a([o],s)}console.error("FIXME: expecting a data-id attribute on IsolatedNodeComponent")}return null},i.getDOMCoordinate=function(t,e){var n;return n=0===e.offset?{container:t.refs.before.getNativeElement(),offset:0}:{container:t.refs.after.getNativeElement(),offset:1}},i.getDOMCoordinates=function(t){return{start:{container:t.refs.before.getNativeElement(),offset:0},end:{container:t.refs.after.getNativeElement(),offset:1}}},e.exports=i},{"../model/Coordinate":226,"../util/createSurfaceId":372,"../util/keys":377,"./Component":322,"lodash/startsWith":204}],339:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-layout");return e.addClass("sm-width-"+this.props.width),this.props.textAlign&&e.addClass("sm-text-align-"+this.props.textAlign),this.props.noPadding&&e.addClass("sm-no-padding"),e.append(this.props.children),e}},r.extend(i),e.exports=i},{"./Component":322}],340:[function(t,e,n){"use strict";function i(t,e){this.context=t,this.macros=e,this.context.documentSession.on("update",this.onUpdate,this)}var r=t("../util/oo");i.Prototype=function(){this.onUpdate=function(t,e){t.change&&this.executeMacros(t,e)},this.executeMacros=function(t,e){var n=t.change;if(n){var i,r,o,s,a=this.context.documentSession.getDocument();if("type"===e.action){var c=n.ops[0];s=c.path,i=s[0],r=a.get(i),o=a.get(s);for(var u={action:e.action,node:r,path:s,text:o,selection:this.context.documentSession.getSelection()},h=0;h<this.macros.length;h++){var l=this.macros[h],d=l.execute(u,this.context);if(d)break}}}}},r.initClass(i),e.exports=i},{"../util/oo":379}],341:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-modal");return e.on("click",this._closeModal),this.props.width&&e.addClass("sm-width-"+this.props.width),e.append(t("div").addClass("se-body").append(this.props.children)),e},this._closeModal=function(t){var e=t.target.classList.contains("sc-modal");e&&this.send("closeModal")}},r.extend(i),e.exports=i},{"./Component":322}],342:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=this.getTagName(),n=t(e).attr("data-id",this.props.node.id).addClass(this.getClassNames());return n},this.getTagName=function(){return"div"},this.getClassNames=function(){return""}},r.extend(i),e.exports=i},{"./Component":322}],343:[function(t,e,n){"use strict";function i(){r.apply(this,arguments),this.commandStates=this._getCommandStates()}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-overlay sm-hidden"),n=this.context.commandManager.getCommandStates(),i=this.props.overlay;return e.append(t(i,{commandStates:n}).ref("overlayContent")),e},this.didMount=function(){this.context.documentSession.on("didUpdate",this._onSessionDidUpdate,this)},this.dispose=function(){this.context.documentSession.off(this)},this.position=function(t){var e=this.refs.overlayContent;e.childNodes.length>0&&(this._position(t),this.el.removeClass("sm-hidden"))},this._onSessionDidUpdate=function(){this.shouldRerender()&&this.rerender()},this._getCommandStates=function(){return this.context.commandManager.getCommandStates()},this._position=function(t){if(t){var e=this.el.htmlProp("offsetWidth"),n=t.rectangle.width;this.el.css("top",t.rectangle.top+t.rectangle.height);var i=t.rectangle.left+n/2-e/2;i=Math.max(i,0);var r=t.rectangle.left+n+t.rectangle.right-e;i=Math.min(i,r),this.el.css("left",i)}}},r.extend(i),e.exports=i},{"./Component":322}],344:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}function r(){r["super"].apply(this,arguments)}function o(){r["super"].apply(this,arguments)}function s(){s["super"].apply(this,arguments)}function a(){u.apply(this,arguments)}function c(){s["super"].apply(this,arguments)}var u=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-prompt");return e.append(t("div").addClass("se-arrow")),e.append(t("div").addClass("se-content").append(this.props.children)),e}},u.extend(i),r.Prototype=function(){this.render=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.name),n=t("button").attr({title:this.props.title}).addClass("se-action").append(e);return n}},u.extend(r),o.Prototype=function(){this.render=function(t){var e=this.context.iconProvider.renderIcon(t,this.props.name),n=t("a").attr({href:this.props.href,title:this.props.title,target:"blank"}).addClass("se-action").append(e,"\ufeff");return n}},u.extend(o),s.Prototype=function(){this.render=function(t){var e=t("div").addClass("se-label").append(this.props.label);return e}},u.extend(s),a.Prototype=function(){this._onChange=function(){var t=this.context.documentSession,e=this.props.path,n=this.el.val();t.transaction(function(t){t.set(e,n)})},this.render=function(t){var e=this.context.documentSession,n=e.getDocument(),i=n.get(this.props.path),r=t("input").attr({value:i,type:this.props.type||"text",placeholder:this.props.placeholder}).on("change",this._onChange).addClass("se-input");return r}},u.extend(a),c.Prototype=function(){this.render=function(t){return t("div").addClass("se-separator")}},u.extend(c),i.Action=r,i.Label=s,i.Link=o,i.Input=a,i.Separator=c,e.exports=i},{"./Component":322}],345:[function(t,e,n){"use strict";function i(){}function r(t){this.owner=t,this.refs={},this.foreignRefs={},this.elements=[],this.components=[],this.$$=this._createComponent.bind(this),this.$$.capturing=!0}function o(t){var e=new l.Component(t.constructor);return e._comp=t,t.__htmlConfig__&&e._mergeHTMLConfig(t.__htmlConfig__),e}function s(){this.poluted=[],this.id="__"+u()}var a=t("lodash/each"),c=t("../util/oo"),u=t("../util/uuid"),h=t("../util/substanceGlobals"),l=t("./VirtualElement"),d=t("./DefaultDOMElement");i.Prototype=function(){function e(n,i){var r=t("./Component"),o=i._comp;console.assert(!o,"Component instance should not exist when this method is used.");var s=i.parent._comp;return s||(s=e(n,i.parent)),i._isVirtualComponent?(console.assert(s,"A Component should have a parent."),o=new i.ComponentClass(s,i.props),o.__htmlConfig__=i._copyHTMLConfig()):i._isVirtualHTMLElement?o=new r.Element(s,i):i._isVirtualTextNode&&(o=new r.TextNode(s,i)),i._ref&&(o._ref=i._ref),i._owner&&(o._owner=i._owner._comp),i._comp=o,o}function n(t,i,o){if(t.isCaptured(i))return i;var s=i._comp;if(s||(s=e(t,i),t.setNew(i)),i._isVirtualComponent){var a;if(o?a=!0:(a=!s.el||s.shouldRerender(i.props),s.__htmlConfig__=i._copyHTMLConfig(),t.setOldProps(i,s.props),t.setOldState(i,s.state),s._setProps(i.props),t.isNew(i)||t.setUpdated(i)),a){var c=new r(i),u=s.render(c.$$);if(!u||!u._isVirtualHTMLElement)throw new Error("Component.render must return VirtualHTMLElement");if(s.__htmlConfig__&&u._mergeHTMLConfig(s.__htmlConfig__),u._comp=s,i._content=u,!t.isNew(i)&&s.isMounted()&&t.setUpdated(i),y(t,s,u),h.DEBUG_RENDERING){for(var l=u.children.slice(0);l.length;){var d=l.shift();t.isCaptured(d)||d._isVirtualComponent||(d._comp||e(t,d),d._isVirtualHTMLElement&&d.children.length>0&&(l=l.concat(d.children)),t.setCaptured(d))}t.setCaptured(u);for(var f=new E(t,c);f.hasPendingCaptures();)f.reset(),s.render(f.$$)}else n(t,i._content)}else t.setSkipped(i)}else if(i._isVirtualHTMLElement)for(var p=0;p<i.children.length;p++)n(t,i.children[p]);return t.setCaptured(i),i}function s(t,e){if(!t.isSkipped(e)){console.assert(t.isCaptured(e),"VirtualElement must be captured before rendering");var n=e._comp;if(console.assert(n&&n._isComponent,"A captured VirtualElement must have a component instance attached."),e._isVirtualComponent)return void s(t,e._content);if(n.el||(n.el=b(e),n.el._comp=n),C(n,e),e._isVirtualHTMLElement&&!e.hasInnerHTML()){var i,r,o,c=e.children,u=0,h=0,l=[];for(n.el.getChildNodes().forEach(function(e){var i=e._comp;!i||t.isRelocated(i)?n.el.removeChild(e):l.push(i)});u<l.length||h<c.length;){do i=l[u++];while(i&&t.isDetached(i));if(r=c[h++],i&&!r){for(;i;)m(t,n,i),i=l[u++];break}i&&i.el.isTextNode()&&r&&r._isVirtualTextNode&&i.el.textContent===r.text||(t.isRendered(r)||s(t,r),o=r._comp,t.isRelocated(o)&&o._setParent(n),console.assert(o,"Component instance should now be available."),!r||i?t.isMapped(r)?o===i||(t.setDetached(i),m(t,n,i),h--):t.isMapped(i)?(g(t,n,o,i),u--):p(t,n,i,o):f(t,n,o))}}var d={},v={};e._context&&(a(e._context.refs,function(t,e){d[e]=t._comp}),a(e._context.foreignRefs,function(t,e){v[e]=t._comp})),n.refs=d,n.__foreignRefs__=v,t.setRendered(e)}}function u(t,e){e._isVirtualComponent?(t.isSkipped(e)||e._content.children.forEach(u.bind(null,t)),t.isUpdated(e)&&e._comp.didUpdate(t.getOldProps(e),t.getOldState(e))):e._isVirtualHTMLElement&&e.children.forEach(u.bind(null,t))}function f(t,e,n){e.el.appendChild(n.el),v(t,e,n)}function p(t,e,n,i){e.el.replaceChild(n.el,i.el),t.isDetached(n)||n.triggerDispose(),v(t,e,i)}function g(t,e,n,i){e.el.insertBefore(n.el,i.el),v(t,e,n)}function m(t,e,n){e.el.removeChild(n.el),t.isDetached(n)||n.triggerDispose()}function v(t,e,n){t.isDetached(n)||!e.isMounted()||n.isMounted()||n.triggerDidMount(!0)}function y(t,e,n){var i={},r={};n._context&&(i=n._context.refs,r=n._context.foreignRefs);var o=e.refs,s=e.__foreignRefs__;a(i,function(e,n){var i=o[n];i&&_(t,i,e)}),a(r,function(e,n){var i=s[n];i&&_(t,i,e)})}function _(t,e,n){if(!e&&!n)return!0;if(!e||!n)return!1;if(t.isMapped(n)||t.isMapped(e))return n._comp===e;if(n._comp)return n._comp===e?(t.setMapped(n),t.setMapped(e),!0):!1;if(!x(e,n))return!1;n._comp=e,t.setMapped(n),t.setMapped(e);var i,r=e.getParent();if(n.parent)i=_(t,r,n.parent);else if(n._preliminaryParent){for(;r&&r._isElementComponent;)r=r.getParent();i=_(t,r,n._preliminaryParent)}return i||(t.setRelocated(n),t.setRelocated(e)),i}function x(t,e){return t._isElementComponent&&e._isVirtualHTMLElement||t._isComponent&&e._isVirtualComponent&&t.constructor===e.ComponentClass||t._isTextNodeComponent&&e._isVirtualTextNode}function b(t){var e;return e=t._isVirtualTextNode?d.createTextNode(t.text):d.createElement(t.tagName)}function C(t,e){if(t._isTextNodeComponent)return void t.setTextContent(e.text);var n=t.el;console.assert(n,"Component's element should exist at this point.");var i=n.getTagName();if(e.tagName!==i&&n.setTagName(e.tagName),
w({oldHash:n.getAttributes(),newHash:e.getAttributes(),update:function(t,e){n.setAttribute(t,e)},remove:function(t){n.removeAttribute(t)}}),w({oldHash:n.htmlProps,newHash:e.htmlProps,update:function(t,e){n.setProperty(t,e)},remove:function(t){n.removeProperty(t)}}),S({el:n,oldListeners:n.getEventListeners(),newListeners:e.getEventListeners()}),e.hasInnerHTML()){if(n._hasInnerHTML){var r=n.getInnerHTML(),o=e.getInnerHTML();r!==o&&n.setInnerHTML(o)}else n.empty(),n.setInnerHTML(e.getInnerHTML());n._hasInnerHTML=!0}}function w(t){var e,n=t.newHash,i=t.oldHash||{},r={},o=t.update,s=t.remove;for(e in n)if(n.hasOwnProperty(e)){var a=i[e],c=n[e];r[e]=!0,a!==c&&o(e,c)}for(e in i)i.hasOwnProperty(e)&&!r[e]&&s(e)}function S(t){var e=t.el,n=t.newListeners||[];e.removeAllEventListeners();for(var i=0;i<n.length;i++)e.addEventListener(n[i])}function E(t,e){this.state=t,this.owner=e.owner,this.refs={},this.foreignRefs={},this.elements=e.elements,this.pos=0,this.updates=e.components.length,this.remaining=this.updates,this.$$=this._createComponent.bind(this)}this._render=function(t,e,r){var a=o(t),c=new i.State;e&&c.setOldProps(a,e),r&&c.setOldState(a,r);try{n(c,a,"forceCapture"),a._isVirtualComponent?s(c,a._content):s(c,a),u(c,a)}finally{c.dispose()}},this._renderChild=function(t,e){var r=new i.State;e.parent={_comp:t};try{return n(r,e),s(r,e),e._comp}finally{r.dispose()}},E.Prototype=function(){this._createComponent=function(){var t=this.state,e=this.elements[this.pos++];return!t.isCaptured(e)&&e._isVirtualComponent&&e.parent&&t.isCaptured(e.parent)&&(n(t,e),this.updates++,this.remaining--),e=l.createElement.apply(null,arguments),e._context=this,e._owner=this.owner,e._attach=function(){},e._detach=function(){},e},this.hasPendingCaptures=function(){return this.updates>0&&this.remaining>0},this.reset=function(){this.pos=0,this.updates=0},this._ancestorsReady=function(t){for(;t;){if(this.state.isCaptured(t)||t===this.owner||t===this.owner._content)return!0;t=t.parent}return!1}},c.initClass(E),i._internal={_capture:n,_wrap:o}},c.initClass(i),r.prototype._createComponent=function(){var t=l.createElement.apply(null,arguments);return t._context=this,t._owner=this.owner,t._isVirtualComponent&&this.components.push(t),this.elements.push(t),t},i.createContext=function(t){var e=o(t);return new r(e)},s.Prototype=function(){this.dispose=function(){var t=this.id;this.poluted.forEach(function(e){delete e[t]})},this.set=function(t,e,n){var i=t[this.id];i||(i={},t[this.id]=i),i[e]=n},this.get=function(t,e){var n=t[this.id];return n?n[e]:void 0},this.setMapped=function(t){this.set(t,"mapped",!0)},this.isMapped=function(t){return Boolean(this.get(t,"mapped"))},this.setRelocated=function(t){this.set(t,"relocated",!0)},this.isRelocated=function(t){return Boolean(this.get(t,"relocated"))},this.setDetached=function(t){this.set(t,"detached",!0)},this.isDetached=function(t){return Boolean(this.get(t,"detached"))},this.setCaptured=function(t){this.set(t,"captured",!0)},this.isCaptured=function(t){return Boolean(this.get(t,"captured"))},this.setNew=function(t){this.set(t,"created",!0)},this.isNew=function(t){return Boolean(this.get(t,"created"))},this.setUpdated=function(t){this.set(t,"updated",!0)},this.isUpdated=function(t){return Boolean(this.get(t,"updated"))},this.setSkipped=function(t){this.set(t,"skipped",!0)},this.isSkipped=function(t){return Boolean(this.get(t,"skipped"))},this.setRendered=function(t){this.set(t,"rendered",!0)},this.isRendered=function(t){return Boolean(this.get(t,"rendered"))},this.setOldProps=function(t,e){this.set(t,"oldProps",e)},this.getOldProps=function(t){return this.get(t,"oldProps")},this.setOldState=function(t,e){this.set(t,"oldState",e)},this.getOldState=function(t){return this.get(t,"oldState")}},c.initClass(s),i.State=s,e.exports=i},{"../util/oo":379,"../util/substanceGlobals":382,"../util/uuid":383,"./Component":322,"./DefaultDOMElement":328,"./VirtualElement":363,"lodash/each":164}],346:[function(t,e,n){"use strict";function i(){o.apply(this,arguments),this.__isStarted__=!1}var r=t("lodash/each"),o=t("../util/EventEmitter"),s=t("./DefaultDOMElement");i.Prototype=function(){this.start=function(){var t=s.getBrowserWindow();t.on("hashchange",this._onHashChange,this),this.__isStarted__=!0},this.readRoute=function(){return this.__isStarted__||this.start(),this.parseRoute(this.getRouteString())},this.writeRoute=function(t,e){e=e||{};var n=this.stringifyRoute(t);n?this._writeRoute(n,e):this.clearRoute(e)},this.dispose=function(){var t=s.getBrowserWindow();t.off(this)},this.parseRoute=function(t){return i.routeStringToObject(t)},this.stringifyRoute=function(t){return i.objectToRouteString(t)},this.getRouteString=function(){return window.location.hash.slice(1)},this._writeRoute=function(t,e){this.__isSaving__=!0;try{e.replace?window.history.replaceState({},"","#"+t):window.history.pushState({},"","#"+t)}finally{this.__isSaving__=!1}},this.clearRoute=function(t){this._writeRoute("",t)},this._onHashChange=function(){if(!this.__isSaving__){if(this.__isLoading__)return void console.error("FIXME: router is currently applying a route.");this.__isLoading__=!0;try{var t=this.getRouteString(),e=this.parseRoute(t);this.emit("route:changed",e)}finally{this.__isLoading__=!1}}}},o.extend(i),i.objectToRouteString=function(t){var e=[];return r(t,function(t,n){e.push(n+"="+t)}),e.join(",")},i.routeStringToObject=function(t){var e={};if(!t)return e;var n=t.split(",");return n.forEach(function(t){var n=t.split("=");if(2!==n.length)throw new Error("Illegal route.");e[n[0].trim()]=n[1].trim()}),e},e.exports=i},{"../util/EventEmitter":367,"./DefaultDOMElement":328,"lodash/each":164}],347:[function(t,e,n){"use strict";var i=t("../util/oo"),r=function(){};r.Prototype=function(){this.saveDocument=function(t,e,n){console.warn("No SaveHandler provided. Using Stub."),n(null)}},i.initClass(r),e.exports=r},{"../util/oo":379}],348:[function(t,e,n){"use strict";function i(){o.apply(this,arguments)}var r=t("../util/platform"),o=t("./Component"),s=t("./Scrollbar"),a=t("../util/getRelativeBoundingRect");i.Prototype=function(){this.getChildContext=function(){return{scrollPane:this}},this.didMount=function(){this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this),this.refs.scrollbar&&this.context.doc.on("document:changed",this.onDocumentChange,this,{priority:-1}),this.handleActions({updateOverlayHints:this._updateOverlayHints})},this.dispose=function(){this.props.highlights&&this.props.highlights.off(this),this.context.doc.off(this)},this.render=function(t){var e,n=t("div").addClass("sc-scroll-pane");if(r.isFF&&n.addClass("sm-firefox"),"substance"===this.props.scrollbarType&&(n.addClass("sm-substance-scrollbar"),n.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),n.append(t(s,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),n.append(t("div").ref("scanline").addClass("se-scanline"))),this.props.overlay){var i=this.context.componentRegistry,o=i.get("overlay");e=t(o,{overlay:this.props.overlay}).ref("overlay")}return n.append(t("div").ref("scrollable").addClass("se-scrollable").append(t("div").ref("content").addClass("se-content").append(e).append(this.props.children)).on("scroll",this.onScroll)),n},this._updateOverlayHints=function(t){var e=this.refs.overlay;e&&e.position(t)},this.onDocumentChange=function(){this.refs.scrollbar.updatePositions()},this.onHighlightsUpdated=function(t){this.refs.scrollbar.extendProps({highlights:t})},this.onScroll=function(){var t=this.getScrollPosition(),e=this.refs.scrollable;this.props.onScroll&&this.props.onScroll(t,e),this.props.tocProvider&&this.props.tocProvider.markActiveEntry(this),this.emit("scroll",t,e)},this.getHeight=function(){var t=this.getScrollableElement();return t.height},this.getContentHeight=function(){var t=0,e=this.refs.content.el;return e.childNodes.forEach(function(e){t+=e.getOuterHeight()}),t},this.getContentElement=function(){return this.refs.content.el},this.getScrollableElement=function(){return this.refs.scrollable.el},this.getScrollPosition=function(){var t=this.getScrollableElement();return Math.floor(t.getProperty("scrollTop")+1)},this.getPanelOffsetForElement=function(t){var e=t.el,n=this.refs.content.el.el,i=a(e,n);return i.top},this.scrollTo=function(t){var e=this.getScrollableElement(),n=e.find('*[data-id="'+t+'"]');if(n){var i=this.getPanelOffsetForElement(n);e.setProperty("scrollTop",i)}else console.warn(t,"not found in scrollable container")}},o.extend(i),e.exports=i},{"../util/getRelativeBoundingRect":375,"../util/platform":380,"./Component":322,"./Scrollbar":349}],349:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Component"),o=t("lodash/each"),s=t("./DefaultDOMElement");i.Prototype=function(){this.didMount=function(){s.getBrowserWindow().on("resize",this.onResize,this),this.props.scrollPane.on("scroll",this.onScroll,this),setTimeout(function(){this.updatePositions()}.bind(this))},this.dispose=function(){s.getBrowserWindow().off(this),this.props.scrollPane.off(this)},this.didUpdate=function(){this.updatePositions()},this.render=function(t){var e=t("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){var n=[];o(this.props.highlights,function(e,i){o(e,function(e){n.push(t("div").ref(e).addClass("se-highlight sm-"+i))})}),e.append(t("div").ref("highlights").addClass("se-highlights").append(n))}return e.append(t("div").ref("thumb").addClass("se-thumb")),e},this.updatePositions=function(){var t=this.props.scrollPane,e=t.getScrollableElement(),n=t.getContentHeight(),r=t.getHeight(),s=t.getScrollPosition();this.factor=n/r,this.refs.thumb.css({top:s/this.factor,height:r/this.factor}),this.props.highlights&&o(this.props.highlights,function(t){o(t,function(t){var n=e.find('*[data-id="'+t+'"]');if(n){var r=n.getPosition().top/this.factor,o=n.getOuterHeight(!0)/this.factor;o<i.overlayMinHeight&&(o=i.overlayMinHeight);var s=this.refs[t];s?this.refs[t].css({top:r,height:o}):console.warn("no ref found for highlight",t)}}.bind(this))}.bind(this))},this.getScrollableElement=function(){return this.props.scrollPane.getScrollableElement()},this.onResize=function(){this.rerender()},this.onScroll=function(){this.updatePositions()},this.onMouseDown=function(t){t.stopPropagation(),t.preventDefault(),this._mouseDown=!0;var e=s.getBrowserWindow();e.on("mousemove",this.onMouseMove,this),e.on("mouseup",this.onMouseUp,this);var n=this.el.getOffset().top,i=t.pageY-n,r=this.refs.thumb.el;t.target!==r.getNativeElement()?(this.offset=r.height/2,this.onMouseMove(t)):this.offset=i-r.getPosition().top},this.onMouseUp=function(){this._mouseDown=!1;var t=s.getBrowserWindow();t.off("mousemove",this.onMouseMove,this),t.off("mouseup",this.onMouseUp,this)},this.onMouseMove=function(t){if(this._mouseDown){var e=this.props.scrollPane,n=e.getScrollableElement(),i=this.el.getOffset().top,r=t.pageY-i,o=(r-this.offset)*this.factor;n.setProperty("scrollTop",o)}}},r.extend(i),i.overlayMinHeight=2,e.exports=i},{"./Component":322,"./DefaultDOMElement":328,"lodash/each":164}],350:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("span").addClass("se-selection-fragment");if(this.props.collaborator){var n=this.props.collaborator.colorIndex;e.addClass("sm-collaborator-"+n)}else e.addClass("sm-local-user");return e.append(this.props.children),e}},r.extend(i),e.exports=i},{"./Component":322}],351:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");var e=t("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?e.addClass("sm-horizontal"):e.addClass("sm-vertical");var n=this.props.children[0],i=this.props.children[1];return this.props.sizeB?(i.addClass("se-pane sm-sized"),i.css(this.getSizedStyle(this.props.sizeB)),n.addClass("se-pane sm-auto-fill")):(n.addClass("se-pane sm-sized"),n.css(this.getSizedStyle(this.props.sizeA)),i.addClass("se-pane sm-auto-fill")),e.append(n,i),e},this.getSizedStyle=function(t){return t&&"inherit"!==t?"horizontal"===this.props.splitType?{height:t}:{width:t}:{}}},r.extend(i),e.exports=i},{"./Component":322}],352:[function(t,e,n){"use strict";function i(){if(i["super"].apply(this,arguments),this.documentSession=this.props.documentSession||this.context.documentSession,!this.documentSession)throw new Error("No DocumentSession provided");if(this.name=this.props.name,!this.name)throw new Error("Surface must have a name.");if(this.name.indexOf("/")>-1)throw new Error("Surface.name must not contain '/'");this._surfaceId=a(this),this.clipboard=new m(this,{converterRegistry:this.context.converterRegistry}),this.domSelection=null,this.domObserver=null,l&&(this.documentEl=y.wrapNativeElement(window.document)),this.undoEnabled=!0,this.textTypes=this.props.textTypes,this._textProperties={},this._state={skipNextFocusEvent:!1,skipNextObservation:!1,isDirty:!1,dirtyProperties:{},fragments:{},cursorFragment:null},i.prototype._deriveInternalState.call(this,this.props)}var r=t("lodash/forEach"),o=t("lodash/isUndefined"),s=t("lodash/startsWith"),a=t("../util/createSurfaceId"),c=t("../util/getRelativeBoundingRect"),u=t("../util/keys"),h=t("../util/platform"),l=t("../util/inBrowser"),d=t("../model/transform/copySelection"),f=t("../model/transform/deleteSelection"),p=t("../model/transform/deleteCharacter"),g=t("../model/transform/insertText"),m=t("./Clipboard"),v=t("./Component"),y=t("./DefaultDOMElement"),_=t("./DOMSelection"),x=t("./UnsupportedNodeComponent");i.Prototype=function(){function t(t,e){r(t,function(t,n){t.forEach(function(t){e(t,n)})})}function e(t,e){t.isDirty=!0,t.dirtyProperties[e]=!0}this.getChildContext=function(){return{surface:this,surfaceParent:this,doc:this.getDocument()}},this.didMount=function(){this.context.surfaceManager&&this.context.surfaceManager.registerSurface(this),!this.isReadonly()&&l&&(this.domSelection=new _(this)),this.documentSession.on("update",this._onSessionUpdate,this)},this.dispose=function(){this.documentSession.off(this),this.domSelection=null,this.domObserver&&this.domObserver.disconnect(),this.context.surfaceManager&&this.context.surfaceManager.unregisterSurface(this)},this.willReceiveProps=function(t){i.prototype._deriveInternalState.call(this,t)},this.didUpdate=function(t,e){this._update(t,e)},this.render=function(t){var e=this.props.tagName||"div",n=t(e).addClass("sc-surface").attr("spellCheck",!1).attr("tabindex",2);return this.isDisabled()||(this.isEditable()&&(n.on("keydown",this.onKeyDown),h.isIE||n.on("compositionstart",this.onCompositionStart),l&&window.TextEvent&&!h.isIE?n.on("textInput",this.onTextInput):n.on("keypress",this.onTextInputShim)),this.isReadonly()||(n.on("mousedown",this.onMouseDown),n.on("dragstart",this.onDragStart),n.on("focus",this.onNativeFocus),n.on("blur",this.onNativeBlur),this.clipboard.attach(n))),n},this.renderNode=function(t,e){var n=this.getDocument(),i=this.getComponentRegistry(),r=i.get(e.type);return r||(console.error("Could not resolve a component for type: "+e.type),r=x),t(r,{doc:n,node:e}).ref(e.id)},this.getComponentRegistry=function(){return this.context.componentRegistry||this.props.componentRegistry},this.getName=function(){return this.name},this.getId=function(){return this._surfaceId},this.isDisabled=function(){return this.props.disabled},this.isEditable=function(){return"full"===this.props.editing||void 0===this.props.editing},this.isSelectable=function(){return"selection"===this.props.editing||"full"===this.props.editing},this.isReadonly=function(){return"readonly"===this.props.editing},this.getElement=function(){return this.el},this.getController=function(){return this.context.controller},this.getDocument=function(){return this.documentSession.getDocument()},this.getDocumentSession=function(){return this.documentSession},this.isEnabled=function(){return!this.state.disabled},this.isContainerEditor=function(){return!1},this.getContainerId=function(){return null},this.transaction=function(t,e){var n=this.documentSession,i=this.getId();return n.transaction(function(e,n){return e.before.surfaceId=i,t(e,n)},e)},this.getSelection=function(){return this.documentSession.getSelection()},this.setSelection=function(t){t&&!t.isNull()&&(t.surfaceId=this.getId(),t.containerId=t.containerId||this.getContainerId()),this._setSelection(t)},this.blur=function(){this.el&&this.el.blur()},this.focus=function(){this.isDisabled()||(h.isFF&&(this.domSelection.clear(),this.el.getNativeElement().blur()),this._focus())},this.rerenderDOMSelection=function(){if(!this.isDisabled()&&l){var t=this.getSelection();t.surfaceId===this.getId()&&this.domSelection.setSelection(t)}},this.getDomNodeForId=function(t){return this.el.getNativeElement().querySelector('*[data-id="'+t+'"]')},this.selectAll=function(){var t=this.getDocument(),e=this.getSelection();if(e.isPropertySelection()){var n=e.path,i=t.get(n);e=t.createSelection({type:"property",path:n,startOffset:0,endOffset:i.length}),this.setSelection(e)}},this.insertText=function(t,e){var n=e.selection;return n.isPropertySelection()||n.isContainerSelection()?g(t,e):void 0},this["delete"]=function(t,e){var n=e.selection;return n.isCollapsed()?n.isPropertySelection()||n.isNodeSelection()?p(t,e):void 0:f(t,e)},this["break"]=function(t,e){return this.softBreak(t,e)},this.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},this.copy=function(t,e){var n=d(t,{selection:e});return n.doc},this.paste=function(t,e){return e.text?this.insertText(t,e):void 0},this.onKeyDown=function(t){var e=this.context.commandManager;if(229!==t.which){switch(t.keyCode){case u.LEFT:case u.RIGHT:return this._handleLeftOrRightArrowKey(t);case u.UP:case u.DOWN:return this._handleUpOrDownArrowKey(t);case u.ENTER:return this._handleEnterKey(t);case u.SPACE:return this._handleSpaceKey(t);case u.BACKSPACE:case u.DELETE:return this._handleDeleteKey(t);case u.HOME:case u.END:return this._handleHomeOrEndKey(t);case u.PAGEUP:case u.PAGEDOWN:return this._handlePageUpOrDownKey(t)}var n=!1;(t.ctrlKey||t.metaKey)&&65===t.keyCode?(this.selectAll(),n=!0):this.undoEnabled&&90===t.keyCode&&(t.metaKey||t.ctrlKey)?(t.shiftKey?e.executeCommand("redo"):e.executeCommand("undo"),n=!0):66===t.keyCode&&(t.metaKey||t.ctrlKey)?(e.executeCommand("strong"),n=!0):73===t.keyCode&&(t.metaKey||t.ctrlKey)?(e.executeCommand("emphasis"),n=!0):75===t.keyCode&&(t.metaKey||t.ctrlKey)&&(e.executeCommand("link"),n=!0),n&&(t.preventDefault(),t.stopPropagation())}},this.onTextInput=function(t){t.preventDefault(),t.stopPropagation(),t.data&&(this._state.skipNextObservation=!0,this.transaction(function(e,n){return this.domSelection&&this.domSelection.clear(),n.text=t.data,this.insertText(e,n)}.bind(this),{action:"type"}))},this.onCompositionStart=function(){this._state.skipNextObservation=!0},this.onTextInputShim=function(t){if(!(0===t.which||0===t.charCode||t.keyCode===u.TAB||t.keyCode===u.ESCAPE||Boolean(t.metaKey)||Boolean(t.ctrlKey)^Boolean(t.altKey))){var e=String.fromCharCode(t.which);return this._state.skipNextObservation=!0,t.shiftKey||(e=e.toLowerCase()),e.length>0?(this.transaction(function(t,n){return this.domSelection&&this.domSelection.clear(),n.text=e,this.insertText(t,n)}.bind(this),{action:"type"}),t.preventDefault(),void t.stopPropagation()):(t.preventDefault(),void t.stopPropagation())}},this.onMouseDown=function(t){if(t.stopPropagation(),!(h.isIE&&h.version<12)&&t.detail>=3){var e=this.getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}1===t.which&&(this._state.skipNextFocusEvent=!0,h.isIE||(this.domSelection.clear(),setTimeout(function(){if(this.domSelection){var t=this.domSelection.getSelection();this.setSelection(t)}}.bind(this))),this.documentEl&&this.documentEl.on("mouseup",this.onMouseUp,this,{once:!0}))},this.onMouseUp=function(){setTimeout(function(){if(this.domSelection){var t=this.domSelection.getSelection();this.setSelection(t)}}.bind(this))},this.onDomMutations=function(t){return this._state.skipNextObservation?void(this._state.skipNextObservation=!1):void console.info("We want to enable a DOM MutationObserver which catches all changes made by native interfaces (such as spell corrections, etc). Lookout for this message and try to set Surface.skipNextObservation=true when you know that you will mutate the DOM.",t)},this.onDragStart=function(t){t.preventDefault(),t.stopPropagation()},this.onNativeBlur=function(){var t=this._state;t.hasNativeFocus=!1},this.onNativeFocus=function(){var t=this._state;t.hasNativeFocus=!0},this._deriveInternalState=function(t){var n=this._state,i=n.fragments;i&&r(i,function(t,i){this._getComponentForKey(i)&&e(n,i)}.bind(this));var o=t.fragments;o&&this._deriveFragments(o)},this._deriveFragments=function(n){var i=this._state;i.cursorFragment=null;var r={};t(n,function(t,n){var o=t.path.toString();if(t.key=o,this._getComponentForKey(o)){if("cursor"===t.type&&"local-user"===n)return void(i.cursorFragment=t);var s=r[o];s||(s=[],r[o]=s),s.push(t),e(i,o)}}.bind(this)),i.fragments=r},this._checkForUpdates=function(t){var n=this._state;return Object.keys(t.updated).forEach(function(t){this._getComponentForKey(t)&&e(n,t)}.bind(this)),n.isDirty},this._update=function(t,e){this._updateContentEditableState(e),this._updateProperties()},this._updateContentEditableState=function(t){if("co-focused"===t.mode&&this.el.off("mousedown",this._enableContentEditable,this),this.isEditable()){if(this.state.mode!==t.mode)switch(this.state.mode){case"co-focused":this.el.setAttribute("contenteditable",!1),this.el.on("mousedown",this._enableContentEditable,this);break;default:this.el.setAttribute("contenteditable",!0)}}else this.el.setAttribute("contenteditable",!1)},this._enableContentEditable=function(){this.el.setAttribute("contenteditable",!0)},this._updateProperties=function(){for(var t=this._state,e=Object.keys(t.dirtyProperties),n=0;n<e.length;n++)this._updateProperty(e[n]);t.isDirty=!1,t.dirtyProperties={}},this._updateProperty=function(t){var e=this._state,n=this._hasNativeFocus()?null:e.cursorFragment,i=e.fragments[t]||[];n&&n.key===t&&(i=i.concat([n]));var r=this._getComponentForKey(t);r&&r.extendProps({fragments:i})},this._onSessionUpdate=function(t){if(t.selection){var e=this._deriveModeFromSelection(t.selection);this.state.mode!==e&&this.extendState({mode:e})}},this._deriveModeFromSelection=function(t){var e,n=t.surfaceId,i=this.getId();return s(n,i)&&(e=n.length===i.length?"focused":"co-focused"),e},this._getSurfaceParent=function(){return this.context.surfaceParent},this._getComponentForKey=function(t){return this._textProperties[t]},this._focus=function(){this._state.hasNativeFocus=!0,this.el&&!h.isWebkit&&(this._state.skipNextFocusEvent=!0,this.el.focus(),this._state.skipNextFocusEvent=!1)},this._handleLeftOrRightArrowKey=function(t){t.stopPropagation();var e=t.keyCode===u.LEFT?"left":"right",n=this.getDocumentSession().getSelectionState(),i=n.getSelection();return n.isInlineNodeSelection()&&!t.shiftKey?(t.preventDefault(),void this.setSelection(i.collapse(e))):void window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===u.LEFT?"left":"right"};this._updateModelSelection(e)}}.bind(this))},this._handleUpOrDownArrowKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===u.UP?"left":"right"};this._updateModelSelection(e)}}.bind(this))},this._handleHomeOrEndKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===u.HOME?"left":"right"};this._updateModelSelection(e)}}.bind(this))},this._handlePageUpOrDownKey=function(t){t.stopPropagation(),window.setTimeout(function(){if(this.isMounted()){var e={direction:t.keyCode===u.PAGEUP?"left":"right"};this._updateModelSelection(e)}}.bind(this))},this._handleSpaceKey=function(t){t.preventDefault(),t.stopPropagation(),this.transaction(function(t,e){return this.domSelection.clear(),e.text=" ",this.insertText(t,e)}.bind(this),{action:"type"})},this._handleEnterKey=function(t){t.preventDefault(),t.stopPropagation(),t.shiftKey?this.transaction(function(t,e){return this.softBreak(t,e)}.bind(this),{action:"break"}):this.transaction(function(t,e){return this["break"](t,e)}.bind(this),{action:"break"})},this._handleDeleteKey=function(t){t.preventDefault(),t.stopPropagation();var e=t.keyCode===u.BACKSPACE?"left":"right";this.transaction(function(t,n){return n.direction=e,this["delete"](t,n)}.bind(this),{action:"delete"})},this._hasNativeFocus=function(){return Boolean(this._state.hasNativeFocus)},this._setSelection=function(t){!t.isNull()&&t.surfaceId===this.getId()&&h.isFF&&this._focus(),this.documentSession.setSelection(t)},this._updateModelSelection=function(t){var e=this.domSelection.getSelection(t);this.setSelection(e)},this._selectProperty=function(t){var e=this.getDocument(),n=e.get(t);this.setSelection(e.createSelection(t,0,n.length))},this._registerTextProperty=function(t){var e=t.getPath();this._textProperties[e]=t},this._unregisterTextProperty=function(t){var e=t.getPath();this._textProperties[e]===t&&delete this._textProperties[e]},this._getTextPropertyComponent=function(t){return this._textProperties[t]},this._renderNode=function(t,e){var n=this.getDocument(),i=n.get(e),r=this.context.componentRegistry||this.props.componentRegistry,o=r.get(i.type);return o||(console.error("Could not resolve a component for type: "+i.type),o=x),t(o,{doc:n,node:i})},this._prepareArgs=function(t){},this.setSelectionFromEvent=function(t){if(this.domSelection){this._state.skipNextFocusEvent=!0;var e=i.getDOMRangeFromEvent(t),n=this.domSelection.getSelectionFromDOMRange(e),r=this.getDocument().createSelection(n);this.setSelection(r)}},this.getBoundingRectangleForSelection=function(){var t=this.getSelection();if(this.isDisabled()||!t||t.isNull()||t.isNodeSelection()||t.isCustomSelection())return{};var e;e=this.context.scrollPane?this.context.scrollPane.refs.content.el.el:document.body;var n,i=window.getSelection();if(i.rangeCount>0&&(n=i.getRangeAt(0)),n&&n.collapsed){var r=document.createElement("span");this._state.skipNextObservation=!0,r.appendChild(window.document.createTextNode("")),n.insertNode(r);var o=c(r,e),s=r.parentNode;return this._state.skipNextObservation=!0,s.removeChild(r),s.normalize(),h.isFF&&this.rerenderDOMSelection(),o}var a=this.el.el;if(t.isCollapsed()){var u=a.querySelector(".se-cursor");return u?c(u,e):{}}var l=a.querySelectorAll(".se-selection-fragment");return l.length>0?c(l,e):(console.warn("FIXME: there should be a rendered selection fragments element."),{})},this._sendOverlayHints=function(){var t=this.getBoundingRectangleForSelection();this.send("updateOverlayHints",{rectangle:t})}},v.extend(i),i.getDOMRangeFromEvent=function(t){var e,n=t.clientX,i=t.clientY;if(document.body.createTextRange)e=document.body.createTextRange(),e.moveToPoint(n,i);else if(!o(document.createRange))if(o(t.rangeParent))if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(n,i);e=document.createRange(),e.setStart(r.offsetNode,r.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(n,i));else e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);return e},e.exports=i},{"../model/transform/copySelection":274,"../model/transform/deleteCharacter":276,"../model/transform/deleteSelection":278,"../model/transform/insertText":283,"../util/createSurfaceId":372,"../util/getRelativeBoundingRect":375,"../util/inBrowser":376,"../util/keys":377,"../util/platform":380,"./Clipboard":317,"./Component":322,"./DOMSelection":327,"./DefaultDOMElement":328,"./UnsupportedNodeComponent":362,"lodash/forEach":170,"lodash/isUndefined":192,"lodash/startsWith":204}],353:[function(t,e,n){"use strict";function i(t){this.documentSession=t,this.surfaces={},this._state={focusedSurfaceId:null,fragments:{},selection:null,collaborators:{}},this.documentSession.on("update",this.onSessionUpdate,this),this.documentSession.on("didUpdate",this.onSessionDidUpdate,this,{priority:-1e6})}var r=t("lodash/forEach"),o=t("lodash/clone"),s=t("../util/oo"),a=t("../util/inBrowser");i.Prototype=function(){this.dispose=function(){this.documentSession.off(this)},this.getSurface=function(t){return t?this.surfaces[t]:void 0},this.getFocusedSurface=function(){return this._state.focusedSurfaceId?this.getSurface(this._state.focusedSurfaceId):void 0},this.registerSurface=function(t){this.surfaces[t.getId()]=t},this.unregisterSurface=function(t){t.off(this);var e=t.getId(),n=this.surfaces[e];if(n===t){var i=this.getFocusedSurface();delete this.surfaces[e],t&&i===t&&(this._state.focusedSurfaceId=null)}},this.onSessionUpdate=function(t){function e(t){var e=h[t];return e||(e={},h[t]=e),e}function n(t,e){var n=t.getFragments();return e&&(n=n.map(function(t){return t.collaborator=e,t})),n}function i(t,i,r){var o=t?t.surfaceId:null,s=i?i.surfaceId:null,a="local-user";r&&(a=r.collaboratorId),o&&o!==s&&(e(o)[a]=[],c[o]=!0),s&&(e(s)[a]=n(i,r),c[s]=!0)}var s=this._state,c={};if(t.selection){var u=this.surfaces[t.selection.surfaceId];s.focusedSurfaceId=t.selection.surfaceId,u&&!u.isDisabled()?u._focus():t.selection.isCustomSelection()&&a&&(window.getSelection().removeAllRanges(),window.document.activeElement.blur())}t.change&&r(this.surfaces,function(e,n){e._checkForUpdates(t.change)&&(c[n]=!0)});var h=s.fragments||{};t.selection&&(i(s.selection,t.selection),s.selection=t.selection),t.collaborators&&r(t.collaborators,function(t,e){var n,r,o=s.collaborators[e];o&&(n=o.selection),t&&(r=t.selection),n&&n.equals(r)||i(n,r,t),s.collaborators[e]={collaboratorId:e,selection:r}}),c=Object.keys(c),c.forEach(function(t){var e=this.surfaces[t];if(e){var n=h[t];e.extendProps({fragments:o(n)})}}.bind(this))},this.onSessionDidUpdate=function(t,e){if(!e.skipSelection){var n=this.getFocusedSurface();n&&!n.isDisabled()&&(n.focus(),n.rerenderDOMSelection(),n._sendOverlayHints())}}},s.initClass(i),e.exports=i},{"../util/inBrowser":376,"../util/oo":379,"lodash/clone":162,"lodash/forEach":170}],354:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component"),o=t("./ScrollPane"),s=t("./FontAwesomeIcon");i.Prototype=function(){this.didMount=function(){var t=this.context.tocProvider;t.on("toc:updated",this.onTOCUpdated,this)},this.dispose=function(){var t=this.context.tocProvider;t.off(this)},this.render=function(t){for(var e=this.context.tocProvider,n=e.activeEntry,i=t("div").addClass("se-toc-entries").ref("tocEntries"),r=e.getEntries(),a=0;a<r.length;a++){var c=r[a],u=c.level,h=t("a").addClass("se-toc-entry").addClass("sm-level-"+u).attr({href:"#","data-id":c.id}).ref(c.id).on("click",this.handleClick).append(t(s,{icon:"fa-caret-right"}),c.name);n===c.id&&h.addClass("sm-active"),i.append(h)}var l=t("div").addClass("sc-toc-panel").append(t(o).ref("panelEl").append(i));return l},this.getDocument=function(){return this.context.doc},this.onTOCUpdated=function(){this.rerender()},this.handleClick=function(t){var e=t.currentTarget.dataset.id;t.preventDefault(),this.send("tocEntrySelected",e)}},r.extend(i),e.exports=i},{"./Component":322,"./FontAwesomeIcon":333,"./ScrollPane":348}],355:[function(t,e,n){"use strict";function i(t,e){s.apply(this,arguments),this.document=t,this.config=e,this.entries=this.computeEntries(),this.entries.length>0?this.activeEntry=this.entries[0].id:this.activeEntry=null,this.document.on("document:changed",this.handleDocumentChange,this)}var r=t("lodash/each"),o=t("lodash/includes"),s=t("../util/EventEmitter");i.Prototype=function(){this.dispose=function(){var t=this.getDocument();t.disconnect(this);
},this.handleDocumentChange=function(t){for(var e=this.getDocument(),n=!1,i=this.constructor["static"].tocTypes,r=0;r<t.ops.length;r++){var s,a=t.ops[r];if(a.isCreate()||a.isDelete()){var c=a.getValue();if(s=c.type,o(i,s)){n=!0;break}}else{var u=a.path[0],h=e.get(u);if(h&&o(i,h.type)){n=!0;break}}}n&&(this.entries=this.computeEntries(),this.emit("toc:updated"))},this.computeEntries=function(){var t=this.getDocument(),e=this.config,n=[],i=t.get(e.containerId).nodes;return r(i,function(e){var i=t.get(e);"heading"===i.type&&n.push({id:i.id,name:i.content,level:i.level,node:i})}),n},this.getEntries=function(){return this.entries},this.getDocument=function(){return this.document},this.markActiveEntry=function(t){var e=t.getContentElement(),n=t.getContentHeight(),i=t.getHeight(),r=t.getScrollPosition(),o=r+i,s=r,a=2*o-n,c=Math.max(s,a),u=this.computeEntries();if(0!==u.length){for(var h=u[0].id,l=u.length-1;l>=0;l--){var d=u[l],f=e.find('[data-id="'+d.id+'"]');if(!f)return void console.warn("Not found in Content panel",d.id);var p=t.getPanelOffsetForElement(f);if(c>=p){h=d.id;break}}this.activeEntry!==h&&(this.activeEntry=h,this.emit("toc:updated"))}}},s.extend(i),i["static"].tocTypes=["heading"],e.exports=i},{"../util/EventEmitter":367,"lodash/each":164,"lodash/includes":174}],356:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("./NodeComponent"),o=t("./TextPropertyComponent");i.Prototype=function(){var t=i["super"].prototype;this.render=function(e){var n=t.render.call(this,e);return n.append(e(o,{path:[this.props.node.id,"content"]})),n}},r.extend(i),e.exports=i},{"./NodeComponent":342,"./TextPropertyComponent":357}],357:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}function r(t,e,n){for(var i={el:null,path:null,node:e,offset:n};e&&e!==t;){if(e.isElementNode()){var r=e.getAttribute("data-path");if(r)return i.el=e,i.path=r.split("."),i;e.getAttribute("data-inline")&&(i.node=e,n>0&&(i.offset=1))}e=e.getParent()}return null}function o(t,e){var n,i,r=e;if(n=t.getParent(),t.isTextNode())if(t===n.firstChild){var a=n.getAttribute("data-path"),c=n.getAttribute("data-offset");r=a?e:c?parseInt(c,10)+e:o(n,0)+e}else i=n.getChildIndex(t),r=o(n,i)+e;else{if(!t.isElementNode())return null;var u=t.getAttribute("data-path"),h=t.getAttribute("data-offset");u?r=s(t,e):h?(i=n.getChildIndex(t),r=parseInt(h,10)+s(t,e)):(i=n.getChildIndex(t),r=o(n,i)+s(t,e))}return r}function s(t,e){var n=0;if(t.getAttribute("data-inline"))return 0===e?0:1;var i=t.getChildCount();1===arguments.length&&(e=i),e=Math.min(i,e);for(var r=0,o=t.getFirstChild();e>r;o=o.getNextSibling(),r++)if(o.isTextNode())n+=o.getTextContent().length;else if(o.isElementNode()){var a=o.getAttribute("data-length");n+=o.getAttribute("data-inline")?1:a?parseInt(a,10):s(o)}return n}var a=t("lodash/isNumber"),c=t("../model/Coordinate"),u=t("./AnnotatedTextComponent"),h=t("./CursorComponent"),l=t("./SelectionFragmentComponent");i.Prototype=function(){var t=i["super"].prototype;this.didMount=function(){t.didMount.call(this);var e=this.getSurface();e&&e._registerTextProperty(this)},this.dispose=function(){t.dispose.call(this);var e=this.getSurface();e&&e._unregisterTextProperty(this)},this.render=function(t){var e=this.getPath(),n=this._renderContent(t).addClass("sc-text-property").attr({"data-path":e.join("."),spellCheck:!1}).css({"white-space":"pre-wrap"});return this.props.editable&&n.attr("contentEditable",!0),this.props.withoutBreak||n.append(t("br")),n},this._renderFragment=function(e,n){var i,r=n.node,o=r.id;return"cursor"===r.type?i=e(h,{collaborator:r.collaborator}):"selection-fragment"===r.type?i=e(l,{collaborator:r.collaborator}):(i=t._renderFragment.apply(this,arguments),r.constructor["static"].isInline?i.ref(o):this.context.config&&this.context.config.preservativeTextPropertyRendering&&i.ref(o+"@"+n.counter)),i.attr("data-offset",n.pos),i},this.getPath=function(){return this.props.path},this.getText=function(){return this.getDocument().get(this.getPath())},this.getAnnotations=function(){var t=this.getPath(),e=this.getDocument().getIndex("annotations").get(t),n=this.props.fragments;return n&&(e=e.concat(n)),e},this.getDocument=function(){return this.props.doc||this.context.doc},this.getController=function(){return this.props.controller||this.context.controller},this.getSurface=function(){return this.props.surface||this.context.surface},this.isEditable=function(){return this.getSurface().isEditable()},this.isReadonly=function(){return this.getSurface().isReadonly()},this.getDOMCoordinate=function(t){return this._getDOMCoordinate(this.el,t)},this._finishFragment=function(t,e,n){e.attr("data-length",t.length),n.append(e)},this._getDOMCoordinate=function(t,e){var n,i=0;if(0===e)return{container:t.getNativeElement(),offset:0};for(var r=t.getFirstChild();r;r=r.getNextSibling(),i++)if(r.isTextNode()){if(n=r.textContent.length,n>=e)return{container:r.getNativeElement(),offset:e};e-=n}else if(r.isElementNode()){var o=r.getAttribute("data-length");if(!o)return console.error("FIXME: Can not map to DOM coordinates."),null;if(n=parseInt(o,10),n>=e){if(r.attr("data-inline")){var s=r.getNextSibling();return s&&s.isTextNode()?{container:s.getNativeElement(),offset:0}:{container:t.getNativeElement(),offset:t.getChildIndex(r)+1}}return this._getDOMCoordinate(r,e,i)}e-=n}}},u.extend(i),i.getCoordinate=function(t,e,n){var i=r(t,e,n);if(!i)return null;e=i.node,n=i.offset;var s=o(i.node,i.offset);return a(s)?new c(i.path,s):null},e.exports=i},{"../model/Coordinate":226,"./AnnotatedTextComponent":311,"./CursorComponent":325,"./SelectionFragmentComponent":350,"lodash/isNumber":185}],358:[function(t,e,n){"use strict";function i(t,e){if(e.name=e.name||e.path.join("."),r.apply(this,arguments),!e.path)throw new Error("Property 'path' is mandatory.")}var r=t("./Surface"),o=t("./TextPropertyComponent");i.Prototype=function(){var t=i["super"].prototype;this.render=function(e){var n=t.render.apply(this,arguments);return n.addClass("sc-text-property-editor"),this.props.disabled||(n.addClass("sm-enabled"),n.setAttribute("contenteditable",!0)),n.append(e(o,{tagName:this.props.tagName||"div",path:this.props.path,withoutBreak:this.props.withoutBreak})),n},this.selectAll=function(){var t=this.getDocument(),e=this.props.path,n=t.get(e),i=t.createSelection({type:"property",path:e,startOffset:0,endOffset:n.length});this.setSelection(i)}},r.extend(i),e.exports=i},{"./Surface":352,"./TextPropertyComponent":357}],359:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("lodash/capitalize"),o=t("lodash/extend"),s=t("./Component");i.Prototype=function(){this._isTool=!0,this.render=function(t){var e=t("div").addClass("se-tool"),n=this.getClassNames();n&&e.addClass(n);var i=this.getTitle();return i&&(e.attr("title",i),e.attr("aria-label",i)),this.props.disabled&&e.addClass("sm-disabled"),this.props.active&&e.addClass("sm-active"),e.append(this.renderButton(t)),e},this.getClassNames=function(){return""},this.renderButton=function(t){var e=t("button").on("click",this.onClick).append(this.renderIcon(t));return this.props.disabled?e.attr("tabindex",-1).attr("disabled",!0):e.attr("tabindex",1),e},this.renderIcon=function(t){var e=this.getCommandName(),n=this.context.iconProvider.renderIcon(t,e);return n},this.getTitle=function(){var t=this.context.labelProvider,e=this.props.title||t.getLabel(this.getName());return this.props.mode&&(e=[r(this.props.mode),e].join(" ")),e},this.getName=function(){return this.constructor["static"].name},this.getCommandName=function(){return this.constructor["static"].command||this.constructor["static"].name},this.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.props.disabled||this.performAction()},this.performAction=function(t){this.context.commandManager.executeCommand(this.getCommandName(),o({mode:this.props.mode},t))}},s.extend(i),e.exports=i},{"./Component":322,"lodash/capitalize":161,"lodash/extend":166}],360:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-tool-group");return e.append(this.props.children),e}},r.extend(i),e.exports=i},{"./Component":322}],361:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component"),o=t("./ToolGroup");i.Prototype=function(){this.render=function(t){var e=t("div").addClass(this.getClassNames()),n=this.props.commandStates,i=this.context.toolRegistry,r=[];return i.forEach(function(e,i){e.options.overlay||r.push(t(e.Class,n[i]))}),e.append(t(o).append(r)),e},this.getClassNames=function(){return"sc-toolbar"}},r.extend(i),e.exports=i},{"./Component":322,"./ToolGroup":360}],362:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("./Component");i.Prototype=function(){this.render=function(t){return t("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))}},r.extend(i),e.exports=i},{"./Component":322}],363:[function(t,e,n){"use strict";function i(t){this.parent=null,this._owner=t,this._ref=null}function r(t){r["super"].call(this),this._tagName=t,this.classNames=null,this.attributes=null,this.htmlProps=null,this.style=null,this.eventListeners=null,this.children=[]}function o(t,e){o["super"].call(this),e=e||{},this.ComponentClass=t,this.props=e,e.children||(e.children=[]),this.children=e.children}function s(t){this.text=t}var a=t("lodash/isFunction"),c=t("lodash/isString"),u=t("lodash/isArray"),h=t("lodash/map"),l=t("lodash/clone"),d=t("lodash/extend"),f=t("lodash/omit"),p=t("lodash/without"),g=t("./DOMElement");i.Prototype=function(){this._isVirtualElement=!0,this.getParent=function(){return this.parent},this.ref=function(t){if(!t)throw new Error("Illegal argument");return this._ref=t,this._context&&(this._context.refs[t]=this),this}},g.extend(i),g._defineProperties(i,p(g._propertyNames,"children")),r.Prototype=function(){this._isVirtualHTMLElement=!0,this.getTagName=function(){return this._tagName},this.setTagName=function(t){return this._tagName=t,this},this.hasClass=function(t){return this.classNames?this.classNames.indexOf(t)>-1:!1},this.addClass=function(t){return this.classNames||(this.classNames=[]),this.classNames.push(t),this},this.removeClass=function(t){return this.classNames&&(this.classNames=p(this.classNames,t)),this},this.removeAttr=function(t){return this.attributes&&(c(t)?delete this.attributes[t]:this.attributes=f(this.attributes,t)),this},this.getAttribute=function(t){return this.attributes?this.attributes[t]:void 0},this.setAttribute=function(t,e){return this.attributes||(this.attributes={}),this.attributes[t]=e,this},this.getAttributes=function(){var t={};return this.attributes&&d(t,this.attributes),this.classNames&&(t["class"]=this.classNames.join(" ")),this.style&&(t.style=h(this.style,function(t,e){return e+":"+t}).join(";")),t},this.getId=function(){return this.getAttribute("id")},this.setId=function(t){return this.setAttribute("id",t),this},this.setTextContent=function(t){return t=t||"",this.empty(),this.appendChild(t),this},this.setInnerHTML=function(t){return t=t||"",this.empty(),this._innerHTMLString=t,this},this.getInnerHTML=function(){if(this.hasOwnProperty("_innerHTMLString"))return this._innerHTMLString;throw new Error("Not supported.")},this.getValue=function(){return this.htmlProp("value")},this.setValue=function(t){return this.htmlProp("value",t),this},this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},this.isTextNode=function(){return!1},this.isElementNode=function(){return!0},this.isCommentNode=function(){return!1},this.isDocumentNode=function(){return!1},this.append=function(){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._append(this.children,arguments),this},this.appendChild=function(t){if(this._innerHTMLString)throw Error("It is not possible to mix $$.html() with $$.append(). You can call $$.empty() to reset this virtual element.");return this._appendChild(this.children,t),this},this.insertAt=function(t,e){if(e=this._normalizeChild(e),!e)throw new Error("Illegal child: "+e);if(!e._isVirtualElement)throw new Error("Illegal argument for $$.insertAt():"+e);if(0>t||t>this.children.length)throw new Error("insertAt(): index out of bounds.");return this._insertAt(this.children,t,e),this},this.insertBefore=function(t,e){var n=this.children.indexOf(e);if(!(n>-1))throw new Error("insertBefore(): reference node is not a child of this element.");return this.insertAt(n,t),this},this.removeAt=function(t){if(0>t||t>=this.children.length)throw new Error("removeAt(): Index out of bounds.");return this._removeAt(t),this},this.removeChild=function(t){if(!t||!t._isVirtualElement)throw new Error("removeChild(): Illegal arguments. Expecting a CheerioDOMElement instance.");var e=this.children.indexOf(t);if(0>e)throw new Error("removeChild(): element is not a child.");return this.removeAt(e),this},this.replaceChild=function(t,e){if(!(e&&t&&e._isVirtualElement&&t._isVirtualElement))throw new Error("replaceChild(): Illegal arguments. Expecting BrowserDOMElement instances.");var n=this.children.indexOf(t);if(0>n)throw new Error("replaceChild(): element is not a child.");return this.removeAt(n),this.insertAt(n,e),this},this.empty=function(){for(var t=this.children;t.length;){var e=t.pop();e.parent=null}return delete this._innerHTMLString,this},this.getProperty=function(t){return this.htmlProps?this.htmlProps[t]:void 0},this.setProperty=function(t,e){return this.htmlProps||(this.htmlProps={}),this.htmlProps[t]=e,this},this.removeProperty=function(t){return this.htmlProps&&delete this.htmlProps[t],this},this.getStyle=function(t){return this.style?this.style[t]:void 0},this.setStyle=function(t,e){return this.style||(this.style={}),this.style[t]=e,this},this.addEventListener=function(t,e,n){var i;return 1===arguments.length&&arguments[0]._isDOMEventListener?i=arguments[0]:(n=n||{},n.context=n.context||this._owner._comp,i=new g.EventListener(t,e,n)),this.eventListeners||(this.eventListeners=[]),this.eventListeners.push(i),this},this.removeEventListener=function(t,e){return this.eventListeners&&g._findEventListenerIndex(this.eventListeners,t,e),this},this.getEventListeners=function(){return this.eventListeners},this.getNodeType=function(){return"element"},this.hasInnerHTML=function(){return Boolean(this._innerHTMLString)},this._normalizeChild=function(t){return c(t)&&(t=new s(t)),t},this._append=function(t,e){if(1===e.length&&!u(e[0]))return void this._appendChild(t,e[0]);var n;if(u(e[0]))n=e[0];else{if(!(arguments.length>1))return;n=Array.prototype.slice.call(e,0)}n.forEach(this._appendChild.bind(this,t))},this._appendChild=function(t,e){return(e=this._normalizeChild(e))?(t.push(e),this._attach(e),e):void 0},this._insertAt=function(t,e,n){n&&(t.splice(e,0,n),this._attach(n))},this._removeAt=function(t,e){var n=t[e];t.splice(e,1),this._detach(n)},this._attach=function(t){t.parent=this,this._context&&t._owner!==this._owner&&t._ref&&(this._context.foreignRefs[t._ref]=t)},this._detach=function(t){t.parent=null,this._context&&t._owner!==this._owner&&t._ref&&delete this.context.foreignRefs[t._ref]},this._mergeHTMLConfig=function(t){t.classNames&&(this.classNames||(this.classNames=[]),this.classNames=this.classNames.concat(t.classNames)),t.attributes&&(this.attributes||(this.attributes={}),d(this.attributes,t.attributes)),t.htmlProps&&(this.htmlProps||(this.htmlProps={}),d(this.htmlProps,t.htmlProps)),t.style&&(this.style||(this.style={}),d(this.style,t.style)),t.eventListeners&&(this.eventListeners||(this.eventListeners=[]),this.eventListeners=this.eventListeners.concat(t.eventListeners))}},i.extend(r),o.Prototype=function(){function t(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)}this._isVirtualComponent=!0,this.getComponent=function(){return this._comp},this.getChildren=function(){return this.props.children},this.getNodeType=function(){return"component"},this.outlet=function(e){return new t(this,e)},this._attach=function(t){t._preliminaryParent=this},this._detach=function(t){t._preliminaryParent=null},this._copyHTMLConfig=function(){return{classNames:l(this.classNames),attributes:l(this.attributes),htmlProps:l(this.htmlProps),style:l(this.style),eventListeners:l(this.eventListeners)}},t.prototype._getOutlet=function(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t},t.prototype.append=function(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this},t.prototype.empty=function(){var t=this.virtualEl.props[this.name];return t.forEach(function(t){this._detach(t)}.bind(this)),t.splice(0,t.length),this}},r.extend(o),s.Prototype=function(){this._isVirtualTextNode=!0},i.extend(s),i.Component=o,i.TextNode=s,i.createElement=function(){var t=null;if(c(arguments[0])){if(1!==arguments.length)throw new Error("Illegal usage of VirtualElement.createElement()");t=new r(arguments[0])}else{if(!a(arguments[0])||!arguments[0].prototype._isComponent)throw void 0===arguments[0]?new Error("Provided Component was undefined."):new Error("Illegal usage of VirtualElement.createElement()");if(arguments.length<1||arguments.length>2)throw new Error("Illegal usage of VirtualElement.createElement()");var e={};2===arguments.length&&(e=l(arguments[1])),t=new o(arguments[0],e)}return t},e.exports=i},{"./DOMElement":326,"lodash/clone":162,"lodash/extend":166,"lodash/isArray":176,"lodash/isFunction":182,"lodash/isString":189,"lodash/map":196,"lodash/omit":199,"lodash/without":215}],364:[function(t,e,n){"use strict";function i(){this.config={schema:{},styles:[],nodes:{},components:{},converters:{},importers:{},exporters:{},commands:[],tools:[],textTypes:[],editingBehaviors:[],macros:[],icons:{},labels:{},saveHandler:f,fileClient:d,ToolbarClass:null}}var r=t("./oo"),o=t("lodash/forEach"),s=t("lodash/extend"),a=t("lodash/isString"),c=t("../model/DocumentSchema"),u=t("../model/EditingBehavior"),h=t("../util/Registry"),l=t("../ui/ComponentRegistry"),d=t("../ui/FileClientStub"),f=t("../ui/SaveHandlerStub"),p=t("path");i.Prototype=function(){this.defineSchema=function(t){this.config.schema=t},this.addNode=function(t){var e=t["static"].name;if(!e)throw new Error("A NodeClass must have a name.");if(this.config.nodes[e])throw new Error("NodeClass with this name is already registered: "+e);this.config.nodes[e]=t},this.addConverter=function(t,e){var n=this.config.converters[t];if(n||(n={},this.config.converters[t]=n),!e.type)throw new Error("A converter needs an associated type.");n[e.type]=e},this.addImporter=function(t,e){this.config.importers[t]=e},this.addExporter=function(t,e){this.config.exporters[t]=e},this.addStyle=function(){var t=p.join.apply(this,arguments);this.config.styles.push(t)},this.addComponent=function(t,e){if(this.config.components[t])throw new Error(t+" already registered");if(!e||!e.prototype._isComponent)throw new Error("ComponentClass must be a subclass of ui/Component.");this.config.components[t]=e},this.addCommand=function(t,e){this.config.commands.push({Class:t,options:e||{}})},this.addTool=function(t,e){this.config.tools.push({Class:t,options:e||{}})},this.addIcon=function(t,e){var n=this.config.icons[t];n||(n={},this.config.icons[t]=n),s(n,e)},this.addLabel=function(t,e){a(e)?(this.config.labels.en||(this.config.labels.en={}),this.config.labels.en[t]=e):o(e,function(e,n){this.config.labels[n]||(this.config.labels[n]={}),this.config.labels[n][t]=e}.bind(this))},this.addTextType=function(t,e){this.config.textTypes.push({spec:t,options:e||{}})},this.addEditingBehavior=function(t){this.config.editingBehaviors.push(t)},this.addMacro=function(t){this.config.macros.push(t)},this.setSaveHandler=function(t){this.config.saveHandler=t},this.setToolbarClass=function(t){this.config.ToolbarClass=t},this.setFileClient=function(t){this.config.fileClient=t},this["import"]=function(t,e){t.configure(this,e||{})},this.getConfig=function(){return this.config},this.getStyles=function(){return this.config.styles},this.getSchema=function(){var t=this.config.schema,e=new c(t.name,"1.0.0");return e.getDefaultTextType=function(){return t.defaultTextType},e.addNodes(this.config.nodes),e},this.createArticle=function(t){var e=this.config.schema,n=this.getSchema(),i=new e.ArticleClass(n);return t&&t(i),i},this.createImporter=function(t){var e=this.config.importers[t],n={schema:this.getSchema(),converters:this.getConverterRegistry().get(t),DocumentClass:this.config.schema.ArticleClass};return new e(n)},this.createExporter=function(t){var e=this.config.exporters[t],n={schema:this.getSchema(),converters:this.getConverterRegistry().get(t)};return new e(n)},this.getToolRegistry=function(){var t=new h;return o(this.config.tools,function(e){t.add(e.Class["static"].name,e)}),t},this.getComponentRegistry=function(){var t=new l;return o(this.config.components,function(e,n){t.add(n,e)}),t},this.getCommands=function(){var t=this.config.commands,e=t.map(function(t){return t.Class});return e},this.getSurfaceCommandNames=function(){var t=this.getCommands(),e=t.map(function(t){return t["static"].name});return e},this.getConverterRegistry=function(){if(!this.converterRegistry){var t=new h;o(this.config.converters,function(e,n){t.add(n,new h(e))}),this.converterRegistry=t}return this.converterRegistry},this.getFileClient=function(){var t=this.config.fileClient;return new t},this.getSaveHandler=function(){var t=this.config.saveHandler;return new t},this.getIconProvider=function(){throw new Error("This method is abstract")},this.getTextTypes=function(){return this.config.textTypes.map(function(t){return t.spec})},this.getI18nInstance=function(){throw new Error("This method is abstract.")},this.getLabelProvider=function(){throw new Error("This method is abstract.")},this.getEditingBehavior=function(){var t=new u;return this.config.editingBehaviors.forEach(function(e){e.register(t)}),t},this.getMacros=function(){return this.config.macros},this.getToolbarClass=function(){return this.config.ToolbarClass}},r.initClass(i),e.exports=i},{"../model/DocumentSchema":236,"../model/EditingBehavior":238,"../ui/ComponentRegistry":323,"../ui/FileClientStub":332,"../ui/SaveHandlerStub":347,"../util/Registry":368,"./oo":379,"lodash/extend":166,"lodash/forEach":170,"lodash/isString":189,path:6}],365:[function(t,e,n){"use strict";function i(t){this.arr=t,this.pos=-1}var r=t("./oo");i.Prototype=function(){this._isArrayIterator=!0,this.hasNext=function(){return this.pos<this.arr.length-1},this.next=function(){this.pos+=1;var t=this.arr[this.pos];return t},this.back=function(){return this.pos>=0&&(this.pos-=1),this}},r.initClass(i),e.exports=i},{"./oo":379}],366:[function(t,e,n){"use strict";function i(t){r.call(this),t&&this["import"](t)}var r=t("./AbstractConfigurator"),o=t("../ui/FontAwesomeIconProvider"),s=t("../ui/DefaultLabelProvider");i.Prototype=function(){this.getIconProvider=function(){return new o(this.config.icons)},this.getLabelProvider=function(){return new s(this.config.labels)}},r.extend(i),e.exports=i},{"../ui/DefaultLabelProvider":329,"../ui/FontAwesomeIconProvider":334,"./AbstractConfigurator":364}],367:[function(t,e,n){"use strict";function i(){this.__events__={}}var r=t("./oo"),o=t("lodash/forEach"),s=t("lodash/isObject"),a=t("./warn");i.Prototype=function(){function t(t,e){return e.priority-t.priority}function e(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function n(t,n,i,r){var o;return e(n,i),o=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[],o.push({method:n,context:i||null,priority:r}),this}function i(t,n,i){var r,o;if(1===arguments.length)return delete this.__events__[t],this;if(e(n,i),!(t in this.__events__&&this.__events__[t].length))return this;for(arguments.length<3&&(i=null),o=this.__events__[t],r=o.length;r--;)o[r].method===n&&o[r].context===i&&o.splice(r,1);return 0===o.length&&delete this.__events__[t],this}function r(e,i,r){var s=0;return 3===arguments.length&&(s=r.priority||s),o(i,function(i,r){n.call(this,r,i,e,s),this.__events__[r].sort(t)}.bind(this)),this}function c(t){return o(this.__events__,function(e,n){for(var r=e.length-1;r>=0;r--)e[r]&&e[r].context===t&&i.call(this,n,e[r].method,t)}.bind(this)),this}this.emit=function(t){if(t in this.__events__){for(var e=this.__events__[t].slice(),n=Array.prototype.slice.call(arguments,1),i=0,r=e.length;r>i;i++){var o=e[i];o.method.apply(o.context,n)}return!0}return!1},this.connect=function(t,e,n){return a("DEPRECATED: Use EventEmitter.on(event, method, context) instead."),r.apply(this,arguments)},this.disconnect=function(t){return a("DEPRECATED: Use EventEmitter.off(listener) instead."),c.call(this,t)},this.on=function(e,i,r,o){var s=0;4===arguments.length&&(s=o.priority||s),n.call(this,e,i,r,s),this.__events__[e].sort(t)},this.off=function(t,e,n){1===arguments.length&&s(arguments[0])?c.call(this,arguments[0]):i.apply(this,arguments)},this._debugEvents=function(){console.log("### EventEmitter: ",this),o(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)})}},r.initClass(i),e.exports=i},{"./oo":379,"./warn":384,"lodash/forEach":170,"lodash/isObject":186}],368:[function(t,e,n){"use strict";function i(t,e){this.entries={},this.names=[],this.validator=e,t&&r(t,function(t,e){this.add(e,t)}.bind(this))}var r=t("lodash/forEach"),o=t("./oo"),s=t("./warn"),a={};i.Prototype=function(){this._isRegistry=!0,this.contains=function(t){return this.entries.hasOwnProperty(t)},this.add=function(t,e){if(this.validator&&this.validator(e),a[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)},this.remove=function(t){var e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]},this.clear=function(){this.names=[],this.entries={}},this.get=function(t){return this.entries[t]},this.each=function(t,e){return s("DEPRECATED: use Registry.forEach(cb) instead"),this.forEach(t.bind(e))},this.forEach=function(t){for(var e=0;e<this.names.length;e++){var n=this.names[e],i=t(this.entries[n],n);if(i===!1)break}},this.map=function(t){var e=[];return this.forEach(function(n,i){e.push(t(n,i))}),e},this.filter=function(t){var e=[];return this.forEach(function(n,i){t(n,i)&&e.push(n)}),e}},o.initClass(i),e.exports=i},{"./oo":379,"./warn":384,"lodash/forEach":170}],369:[function(t,e,n){"use strict";function i(){}function r(){}var o=t("lodash/isString"),s=t("lodash/isArray"),a=t("lodash/get"),c=t("lodash/setWith"),u=t("./oo"),h=t("./deleteFromArray");r.Prototype=function(){this.get=function(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),o(t)&&(t=[t]),a(this,t)},this.getAll=function(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),o(t)&&(t=[t]),!s(t))throw new Error("Illegal argument for TreeIndex.get()");var e=a(this,t);return this._collectValues(e)},this.set=function(t,e){o(t)&&(t=[t]),c(this,t,e,function(t){return t?void 0:new i})},this["delete"]=function(t){if(o(t))delete this[t];else if(1===t.length)delete this[t[0]];else{var e=t[t.length-1];t=t.slice(0,-1);var n=a(this,t);n&&delete n[e]}},this.clear=function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},this.traverse=function(t){this._traverse(this,[],t)},this.forEach=this.traverse,this._traverse=function(t,e,n){var r;for(r in t)if(t.hasOwnProperty(r)){var o=t[r],s=e.concat([r]);o instanceof i?this._traverse(o,s,n):n(o,s)}},this._collectValues=function(t){var e={};return this._traverse(t,[],function(t,n){var i=n[n.length-1];e[i]=t}),e}},u.initClass(r),r.Arrays=function(){},r.Arrays.Prototype=function(){var t=Object.getPrototypeOf(this);this.get=function(e){var n=t.get.call(this,e);return n instanceof i&&(n=n.__values__||[]),n},this.set=function(){throw new Error("TreeIndex.set() is not supported for array type.")},this.add=function(t,e){if(o(t)&&(t=[t]),!s(t))throw new Error("Illegal arguments.");var n;c(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){return"__values__"===e?(t||(t=[]),n=t):t||(t=new i),t}),delete n.__dummy__,n.push(e)},this.remove=function(t,e){var n=a(this,t);n instanceof i&&h(n.__values__,e)},this._collectValues=function(t){var e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)}},r.extend(r.Arrays),e.exports=r},{"./deleteFromArray":373,"./oo":379,"lodash/get":171,"lodash/isArray":176,"lodash/isString":189,"lodash/setWith":203}],370:[function(t,e,n){"use strict";function i(t){var e={};return t.root&&t.root.options&&(e=t.root.options),r({attribs:{},children:[],parent:null,root:null,options:e,next:null,prev:null},t)}var r=t("lodash/extend"),o=null;if(!o){var s=t("cheerio");if(s.prototype){s.prototype.prop=s.prototype.attr,s.prototype.removeProp=s.prototype.removeAttr,s.prototype.on=function(){},s.prototype.off=function(){},o=s.load("",{decodeEntities:!1}),o._createElement=function(t,e){return i({type:"tag",name:t,root:e})},o._createTextNode=function(t,e){return i({type:"text",data:t,root:e})};var a=function(t,e){var n=o.load(t,e),i=n.root()[0];return i.options||(i.options=e),i.children.slice()};o.parseHTML=function(t){return a(t,{xmlMode:!1})},o.parseXML=function(t){return a(t,{xmlMode:!0})},o._serialize=function(e){var n=t("dom-serializer"),i=e.options||e.root&&e.root.options;return n(e,i)}}}e.exports=o},{cheerio:5,"dom-serializer":5,"lodash/extend":166}],371:[function(t,e,n){"use strict";e.exports=function(){var t={};return function(e){t.hasOwnProperty(e)||(t[e]=1);var n=[e,"-",t[e]++].join("");return n}}},{}],372:[function(t,e,n){"use strict";e.exports=function(t){var e=t._getSurfaceParent();return e?e.getId()+"/"+t.name:t.name}},{}],373:[function(t,e,n){"use strict";function i(t,e){for(var n=0;n<t.length;n++)t[n]===e&&(t.splice(n,1),n--)}e.exports=i},{}],374:[function(t,e,n){"use strict";function i(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}e.exports=i},{}],375:[function(t,e,n){"use strict";function i(t){var e={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,width:Number.NaN,height:Number.NaN};return s(t,function(t){t.left<e.left&&(e.left=t.left),t.top<e.top&&(e.top=t.top),t.left+t.width>e.right&&(e.right=t.left+t.width),t.top+t.height>e.bottom&&(e.bottom=t.top+t.height)}),e.width=e.right-e.left,e.height=e.bottom-e.top,e}function r(t,e){var n=e.getBoundingClientRect(),r=i(t.getClientRects()),o=r.left-n.left,s=r.top-n.top;return{left:o,top:s,right:n.width-o-r.width,bottom:n.height-s-r.height,width:r.width,height:r.height}}function o(t,e){void 0===t.length&&(t=[t]);var n=a(t,function(t){return r(t,e)}),o=i(n),s=e.getBoundingClientRect();return{left:o.left,top:o.top,right:s.width-o.left-o.width,bottom:s.height-o.top-o.height,width:o.width,height:o.height}}var s=t("lodash/forEach"),a=t("lodash/map");e.exports=o},{"lodash/forEach":170,"lodash/map":196}],376:[function(t,e,n){"use strict";var i="undefined"!=typeof window&&!window.process;e.exports=i},{}],377:[function(t,e,n){e.exports={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32}},{}],378:[function(t,e,n){"use strict";e.exports=function(t){return t.reduce(function(t,e){return t[e]=!0,t},{})}},{}],379:[function(t,e,n){"use strict";function i(t){if(!t.__is_initialized__){!t.Prototype||t.prototype instanceof t.Prototype||(t.prototype=new t.Prototype,
t.prototype.constructor=t);var e=u();t["static"]=t["static"]||new e(t),t.__is_initialized__=!0}}function r(t,e){if(t.prototype instanceof e)throw new Error("Target already inherits from origin");var n=t.Prototype;t["super"]=e,n?(n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t.prototype=new n,t.prototype.constructor=t):t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}});var i=u();e["static"]&&(i.prototype=e["static"]),t["static"]=new i(t),t["static"]._makeExtendFunction?t.extend=t["static"]._makeExtendFunction(t):c(t)}function o(t){var e=t.prototype;for(var n in e)"constructor"!==n&&"__class__"!==n&&e.hasOwnProperty(n)&&("static"!==n||h(t["static"],e["static"]))}function s(t){function e(){t.apply(this,arguments),this.initialize&&this.initialize()}var n,i=Array.prototype.slice.call(arguments,1),o=[],s=0;for(d(i[0])?(n=i[0],s++):n=e;s<i.length;s++){if(d(i[s])){if(s!==i.length-1)throw new Error("Illegal use of Class.extend(): Prototype function must be last argument.");if(n.hasOwnProperty("Prototype"))throw new Error("Class "+n.name+" has defined "+n.name+".Prototype which would be overwritten by Class.extend().\nYou provided a prototype function when calling Class.extend().");n.Prototype=i[s];break}if(!l(i[s]))throw new Error("Illegal use of Class.extend");o.push(i[s])}r(n,t);for(var c=o.length-1;c>=0;c--)a(n,o[c]);return n}function a(t,e){var n=t.prototype;for(var i in e)if(e.hasOwnProperty(i)){if("static"===i){h(t["static"],e["static"]);continue}n.hasOwnProperty(i)||(n[i]=e[i])}}function c(t){t["static"]||f.initClass(t),t["static"]._makeExtendFunction=function(e){return s.bind(t,e)},t.extend=t["static"]._makeExtendFunction(t)}function u(){return function(t){this.__class__=t}}function h(t,e){for(var n in e)"constructor"!==n&&"__class__"!==n&&e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}var l=t("lodash/isObject"),d=t("lodash/isFunction"),f={};f.initClass=function(t){i(t),c(t)},f.inherit=function(t,e){t.__is_initialized__||f.initClass(t),r(t,e),o(t)},f.mixin=function(t,e){t.__is_initialized__||f.initClass(t),a(t,e)},f.makeExtensible=c,e.exports=f},{"lodash/isFunction":182,"lodash/isObject":186}],380:[function(t,e,n){"use strict";var i=t("./inBrowser"),r={inBrowser:i,isIE:!1,isFF:!1,isWebkit:!1,version:-1,isWindows:i&&void 0!==window.navigator&&window.navigator.appVersion&&-1!==window.navigator.appVersion.indexOf("Win")};if("undefined"!=typeof window){var o=window.navigator.userAgent,s=o.indexOf("MSIE "),a=o.indexOf("Trident/"),c=o.indexOf("Edge/");s>0?(r.isIE=!0,r.version=10):a>0?(r.isIE=!0,r.version=11,r.isTrident=!0):c>0&&(r.isIE=!0,r.isEdge=!0,r.version=12,parseInt(o.substring(c+5,o.indexOf(".",c)),10)),r.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,r.isWebkit=!r.isFF&&!r.isIE}e.exports=r},{"./inBrowser":376}],381:[function(t,e,n){"use strict";function i(t,e,n,i){var o=new XMLHttpRequest;o.open(t,e,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onload=function(){if(!(o.status>=200&&o.status<400))return i(new Error("Request failed. Returned status: "+o.status));var t=o.responseText;r(t)&&(t=JSON.parse(t)),i(null,t)},n?o.send(JSON.stringify(n)):o.send()}function r(t){try{JSON.parse(t)}catch(e){return!1}return!0}e.exports=i},{}],382:[function(t,e,n){(function(n){"use strict";var i=t("./warn"),r={};n.hasOwnProperty("Substance")?(i("global.Substance is already defined."),r=n.Substance):n.Substance=r,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./warn":384}],383:[function(t,e,n){"use strict";function i(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var n,i="0123456789abcdefghijklmnopqrstuvwxyz".split(""),r=[],o=16;if(e=e||32)for(n=0;e>n;n++)r[n]=i[0|Math.random()*o];else{var s;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;36>n;n++)r[n]||(s=0|16*Math.random(),r[n]=i[19===n?3&s|8:s])}return(t?t:"")+r.join("")}e.exports=i},{}],384:[function(t,e,n){"use strict";e.exports=function(){console.warn.apply(console,arguments)}},{}],385:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("../common/AbstractWriter"),o=t("substance/ui/SplitPane"),s=t("substance/ui/ScrollPane"),a=t("substance/ui/Layout"),c=t("substance/ui/DefaultOverlay"),u=t("./AuthorTOCProvider"),h=t("substance/ui/TOC"),l=t("./JATSTransformer");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-author");return e.append(t(o,{splitType:"vertical",sizeA:"300px"}).append(this._renderContextSection(t),this._renderMainSection(t))),e},this._renderContextSection=function(t){return t("div").addClass("se-context-section").append(t(h))},this._renderMainSection=function(t){var e=t("div").addClass("se-main-sectin"),n=t(o,{splitType:"horizontal"}).append(this._renderToolbar(t),this._renderContentPanel(t));return e.append(n),e},this._renderContentPanel=function(t){var e=this.documentSession.getDocument(),n=t(s,{tocProvider:this.tocProvider,scrollbarType:"substance",scrollbarPosition:"right",overlay:c}).ref("contentPanel"),i=t(a,{width:"large"}),r=this.componentRegistry.get("article"),o=e.get("article");return i.append(t(r,{node:o,bodyId:"bodyFlat",disabled:this.props.disabled,configurator:this.props.configurator})),n.append(i),n},this._scrollTo=function(t){this.refs.contentPanel.scrollTo(t)},this._getExporter=function(){var t=this.props.configurator.createExporter("jats"),e=new l;return{exportDocument:function(n){return n=e.toJATS(n),t.exportDocument(n)}}},this._getTOCProvider=function(){return new u(this.documentSession)}},r.extend(i),e.exports=i},{"../common/AbstractWriter":391,"./AuthorTOCProvider":386,"./JATSTransformer":387,"substance/ui/DefaultOverlay":330,"substance/ui/Layout":339,"substance/ui/ScrollPane":348,"substance/ui/SplitPane":351,"substance/ui/TOC":354}],386:[function(t,e,n){"use strict";function i(t){r.call(this,t.getDocument(),{containerId:"bodyFlat"})}var r=t("substance/ui/TOCProvider");r.extend(i),e.exports=i},{"substance/ui/TOCProvider":355}],387:[function(t,e,n){"use strict";function i(){}var r=t("lodash/last"),o=t("substance/util/oo"),s=t("substance/model/JSONConverter"),a=t("substance/model/annotationHelpers");i.Prototype=function(){function t(e,n,i,r){return n.forEach(function(n){if("section"===n.type){var o="h_"+n.id,s=n.title;e.create({id:o,type:"heading",sectionId:n.id,level:r,content:n.getTitle()}),s&&a.transferAnnotations(e,[s,"content"],0,[o,"content"],0),i.push(o),i=t(e,n.getNodes(),i,r+1),i=i.concat(n.backMatter)}else i.push(n.id)}),i}function e(t,e){function i(e){var n=t.create({type:"title",content:e.node.getText()});return a.transferAnnotations(t,e.node.getTextPath(),0,n.getTextPath(),0),t.create({type:"section",title:n.id,nodes:e.nodes,backMatter:e.backMatter})}for(var o,s,c=[{nodes:[],backMatter:[]}],u=0;u<e.length;u++){var h=e[u];if("heading"===h.type){for(;c.length>=h.level+1;)o=c.pop(),s=i(o),r(c).nodes.push(s.id);c.push({node:h,nodes:[],backMatter:[]})}else n[h.type]?r(c).backMatter.push(h.id):r(c).nodes.push(h.id)}for(;c.length>1;)o=c.pop(),s=i(o),r(c).nodes.push(s.id);return c[0].nodes}this.fromJATS=function(e){var n=new s,i=e.toJSON(),r=e.newInstance();n.importDocument(r,i);var o=e.get("body"),a=o.getNodes(),c=t(r,a,[],1);return r.create({id:"bodyFlat",type:"body",nodes:c}),r},this.toJATS=function(t){var n=new s,i=t.toJSON(),r=t.newInstance();n.importDocument(r,i);var o=r.get("bodyFlat"),a=e(r,o.getNodes());return r.get("body")?r.set(["body","nodes"],a):r.create({id:"body",type:"body",nodes:a}),r};var n={notes:!0,"fn-group":!0,glossary:!0,"ref-list":!0}},o.initClass(i),e.exports=i},{"lodash/last":195,"substance/model/JSONConverter":243,"substance/model/annotationHelpers":257,"substance/util/oo":379}],388:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/TextBlock");r.extend(i),i["static"].name="heading",i["static"].defineSchema({sectionId:{type:"id",optional:!0},level:{type:"number","default":1}}),e.exports=i},{"substance/model/TextBlock":252}],389:[function(t,e,n){(function(n){"use strict";var i=t("./Heading"),r=t("substance/packages/heading/HeadingComponent"),o=t("substance/packages/heading/HeadingHTMLConverter");e.exports={name:"heading",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("html",o),t.addTextType({name:"heading1",data:{type:"heading",level:1}}),t.addTextType({name:"heading2",data:{type:"heading",level:2}}),t.addTextType({name:"heading3",data:{type:"heading",level:3}}),t.addLabel("heading1",{en:"Heading 1",de:"berschrift 1"}),t.addLabel("heading2",{en:"Heading 2",de:"berschrift 2"}),t.addLabel("heading3",{en:"Heading 3",de:"berschrift 3"}),t.addStyle(n+"/_heading.scss")}}}).call(this,"/packages/author/heading")},{"./Heading":388,"substance/packages/heading/HeadingComponent":297,"substance/packages/heading/HeadingHTMLConverter":298}],390:[function(t,e,n){(function(n){"use strict";var i=t("substance/ui/Overlay"),r=t("substance/ui/Toolbar");e.exports={name:"author",configure:function(e){e["import"](t("substance/packages/base/BasePackage")),e["import"](t("substance/packages/persistence/PersistencePackage")),e.addComponent("overlay",i),e.setToolbarClass(r),e["import"](t("../jats/package")),e["import"](t("./heading/package")),e.addStyle(n,"_author"),e["import"](t("../inline-wrapper/InlineWrapperPackage")),e["import"](t("../unsupported/UnsupportedNodePackage"))}}}).call(this,"/packages/author")},{"../inline-wrapper/InlineWrapperPackage":396,"../jats/package":457,"../unsupported/UnsupportedNodePackage":507,"./heading/package":389,"substance/packages/base/BasePackage":290,"substance/packages/persistence/PersistencePackage":305,"substance/ui/Overlay":343,"substance/ui/Toolbar":361}],391:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.handleActions({tocEntrySelected:this.tocEntrySelected})}var r=t("substance/packages/prose-editor/ProseEditor"),o=t("./SaveHandler");i.Prototype=function(){var t=i["super"].prototype;this._initialize=function(){t._initialize.apply(this,arguments),this.exporter=this._getExporter(),this.tocProvider=this._getTOCProvider(),this.saveHandler=this._getSaveHandler(),this.documentSession.setSaveHandler(this.saveHandler)},this.getChildContext=function(){var e=t.getChildContext.apply(this,arguments);return e.tocProvider=this.tocProvider,e},this._renderToolbar=function(e){return t._renderToolbar.apply(this,arguments)},this._renderContentPanel=function(t){throw new Error("This method is abstract.")},this.tocEntrySelected=function(t){return this._scrollTo(t)},this._scrollTo=function(t){throw new Error("This method is abstract.")},this._getExporter=function(){throw new Error("This method is abstract.")},this._getTOCProvider=function(){throw new Error("This method is abstract.")},this._getSaveHandler=function(){return new o({documentId:this.props.documentId,xmlStore:this.context.xmlStore,exporter:this.exporter})}},r.extend(i),e.exports=i},{"./SaveHandler":394,"substance/packages/prose-editor/ProseEditor":308}],392:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/util/Configurator");i.Prototype=function(){this.setXMLStore=function(t){this.config.XMLStoreClass=t},this.getXMLStore=function(){var t=this.config.XMLStoreClass;return new t}},r.extend(i),e.exports=i},{"substance/util/Configurator":366}],393:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.router=new s,this.configurator=new a(this.getConfiguration())}var r=t("lodash/extend"),o=t("substance/ui/Component"),s=t("substance/ui/Router"),a=t("./BaseConfigurator");i.Prototype=function(){this.didMount=function(){this.router.on("route:changed",this.onRouteChange,this),this.router.start()},this.dispose=function(){this.router.off(this),this.router.dispose()},this.getDefaultState=function(){return{}},this.getConfiguration=function(){throw new Error("This method is abstract")},this.getInitialState=function(){this.router=new s;var t=r({},this.getDefaultState(),this.router.readRoute());return t},this.render=function(t){throw new Error("This method is abstract.")},this.onRouteChange=function(t){this.setState(r({},this.getDefaultState(),t))}},o.extend(i),e.exports=i},{"./BaseConfigurator":392,"lodash/extend":166,"substance/ui/Component":322,"substance/ui/Router":346}],394:[function(t,e,n){"use strict";function i(t){this.context=t}var r=t("substance/util/oo");i.Prototype=function(){this.saveDocument=function(t,e,n){var i=this.context.exporter,r=i.exportDocument(t);this.context.xmlStore.writeXML(this.context.documentId,r,n)}},r.initClass(i),e.exports=i},{"substance/util/oo":379}],395:[function(t,e,n){"use strict";e.exports={type:"inline-wrapper",matchElement:function(t,e){var n=e._getConverterForElement(t,"block");return Boolean(n&&"unsupported"!==n.type)},"import":function(t,e,n){e.id=n.nextId("inline-wrapper"),e.wrappedNode=n.convertElement(t).id},"export":function(t,e,n){return n.convertNode(t.wrappedNode)}}},{}],396:[function(t,e,n){"use strict";var i=t("substance/packages/inline-wrapper/InlineWrapperPackage"),r=t("./InlineWrapperJATSConverter");e.exports={name:"inline-wrapper",configure:function(t){t["import"](i),t.addConverter("jats",r)}}},{"./InlineWrapperJATSConverter":395,"substance/packages/inline-wrapper/InlineWrapperPackage":302}],397:[function(t,e,n){"use strict";var i={ACCESS:["alt-text","long-desc"],ADDRESS_LINK:["email","ext-link","uri"],APPEARANCE:["hr"],BLOCK_MATH:["disp-formula","disp-formula-group"],BLOCK_DISPLAY:["address","alternatives","array","boxed-text","chem-struct-wrap","code","fig","fig-group","graphic","media","preformat","supplementary-material","table-wrap","table-wrap-group"],BREAK:["break"],CHEM_STRUCT:["chem-struct-wrap"],CITATION:["citation-alternatives","element-citation","mixed-citation","nlm-citation"],DISLAY_BACK_MATTER:["attrib","permissions"],EMPHASIS:["bold","fixed-case","italic","monospace","overline","overline-start","overline-end","roman","sans-serif","sc","strike","underline","underline-start","underline-end","ruby"],FUNDING:["award-id","funding-source","open-access"],INLINE_DISPLAY:["alternatives","inline-graphic","private-char"],INLINE_MATH:["chem-struct","inline-formula"],INTABLE_PARA:["disp-quote","speech","statement","verse-group"],JUST_PARA:["p"],JUST_TABLE:["table-wrap"],LIST:["def-list","list"],MATH:["tex-math","mml:math"],NOTHING_BUT_PARA:["p"],PHRASE:["abbrev","milestone-end","milestone-start","named-content","styled-content"],RELATED_ARTICLE:["related-article","related-object"],REST_OF_PARA:["ack","disp-quote","speech","statement","verse-group"],SIMPLE_DISPLAY:["alternatives","array","code","graphic","media","preformat"],SIMPLE_LINK:["fn","target","xref"],SUBSUP:["sub","sup"],X:["x"]};i.ARTICLE_LINK=["inline-supplementary-material"].concat(i.RELATED_ARTICLE),i.ALL_PHRASE=i.ADDRESS_LINK.concat(i.ARTICLE_LINK).concat(i.APPEARANCE).concat(i.EMPHASIS).concat(i.INLINE_DISPLAY).concat(i.INLINE_MATH).concat(i.MATH).concat(i.PHRASE).concat(i.SIMPLE_LINK).concat(i.SUBSUP).concat(i.X),i.PARA_LEVEL=i.BLOCK_DISPLAY.concat(i.BLOCK_MATH).concat(i.LIST).concat(i.MATH).concat(i.NOTHING_BUT_PARA).concat(i.RELATED_ARTICLE).concat(i.REST_OF_PARA).concat(i.X),e.exports=i},{}],398:[function(t,e,n){"use strict";function i(t){i["super"].call(this,t)}var r=t("lodash/isString"),o=t("substance/model/XMLExporter");i.Prototype=function(){var t=i["super"].prototype;this.exportDocument=function(t){this.state.doc=t;var e=this.convertNode(t.get("article"));return e.outerHTML},this.convertNode=function(e){var n=t.convertNode.apply(this,arguments);return r(e)&&(e=this.state.doc.get(e)),n.attr(e.attributes),n},this.convertNodes=function(t){var e=[],n=this;if(t._isArrayIterator)for(;t.hasNext();)e.push(n.convertNode(t.next()));else t.forEach(function(t){e.push(n.convertNode(t))});return e}},o.extend(i),e.exports=i},{"lodash/isString":189,"substance/model/XMLExporter":255}],399:[function(t,e,n){"use strict";function i(t){t.enableInlineWrapper=!0,i["super"].call(this,t),this.state=new i.State}var r=t("lodash/last"),o=t("substance/model/DOMImporter"),s=t("substance/model/XMLImporter"),a=t("substance/ui/DefaultDOMElement"),c=t("../unsupported/UnsupportedNodeJATSConverter"),u=t("substance/util/inBrowser");i.Prototype=function(){var t=i["super"].prototype;this.importDocument=function(t){this.reset();var e,n=a.parseXML(t,"fullDoc");if(u)e=n.find("article");else for(var i=0;i<n.length;i++)"article"===n[i].tagName&&(e=n[i]);this.convertDocument(e);var r=this.generateDocument();return r},this.convertDocument=function(t){this.convertElement(t)},this.convertElements=function(t,e,n){arguments.length<2&&(e=0),arguments.length<3&&(n=t.length);for(var i=[],r=e;n>r;r++)i.push(this.convertElement(t[r]));return i},this._converterCanBeApplied=function(t,e){return t.matchElement(e,this)},this._getUnsupportedNodeConverter=function(){return c},this._nodeData=function(e){var n=t._nodeData.apply(this,arguments);return n.attributes=e.getAttributes(),n}},s.extend(i),i.State=function(){i.State["super"].call(this)},i.State.Prototype=function(){var t=i.State["super"].prototype;this.reset=function(){t.reset.call(this),this.lists=[],this.listItemLevel=1},this.getCurrentListItemLevel=function(){return this.listItemLevel},this.increaseListItemLevel=function(){return this.listItemLevel++},this.decreaseListItemLevel=function(){return this.listItemLevel--},this.getCurrentList=function(){return r(this.lists)}},o.State.extend(i.State),e.exports=i},{"../unsupported/UnsupportedNodeJATSConverter":506,"lodash/last":195,"substance/model/DOMImporter":229,"substance/model/XMLImporter":256,"substance/ui/DefaultDOMElement":328,"substance/util/inBrowser":376}],400:[function(t,e,n){"use strict";var i=t("lodash/extend");e.exports={"import":function(t,e,n){e.content=n.annotatedText(t,[e.id,"content"])},"export":function(t,e,n){e.append(n.annotatedText([t.id,"content"]))},extend:function(t){return i({},this,t)}}},{"lodash/extend":166}],401:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("../../../util/renderNodeComponent");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=this.props.configurator,r=t("div").addClass("sc-article").attr("data-id",this.props.node.id),s=n.get("front");if(s){var a=o(this,t,s,{disabled:this.props.disabled,configurator:i});r.append(a)}var c=n.get(this.props.bodyId);if(c){var u=o(this,t,c,{disabled:this.props.disabled,configurator:i});r.append(u)}var h=n.get("back");if(h){var l=o(this,t,h,{disabled:this.props.disabled,configurator:i});r.append(l)}return r}},r.extend(i),e.exports=i},{"../../../util/renderNodeComponent":509,"substance/ui/Component":322}],402:[function(t,e,n){"use strict";var i=t("../../../util/XMLIterator");e.exports={type:"article",tagName:"article","import":function(t,e,n){e.id="article";var r=t.getChildren(),o=new i(r);if(o.required("front",function(t){e.front=n.convertElement(t).id}),o.optional("body",function(t){e.body=n.convertElement(t).id}),o.optional("back",function(t){e.back=n.convertElement(t).id}),o.optional("floats-group",function(t){e.floatsGroup=n.convertElement(t).id}),o.manyOf("sub-article",function(t){e.subArticles||(e.subArticles=[]),e.subArticles.push(n.convertElement(t).id)}),o.manyOf("response",function(t){e.responses||(e.responses=[]),e.responses.push(n.convertElement(t).id)}),o.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){e.append(n.convertNode(t.front)),t.body&&e.append(n.convertNode(t.body)),t.back&&e.append(n.convertNode(t.back)),t.floatsGroup&&e.append(n.convertNode(t.floatsGroup)),t.subArticles&&e.append(n.convertNodes(t.subArticles)),t.responses&&e.append(n.convertNodes(t.responses))}}},{"../../../util/XMLIterator":508}],403:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/DocumentNode");r.extend(i),i["static"].name="article",i["static"].defineSchema({attributes:{type:"object","default":{}},front:{type:"id"},body:{type:"id",optional:!0},back:{type:"id",optional:!0},floatsGroup:{type:"id",optional:!0},subArticles:{type:["id"],optional:!0},responses:{type:["id"],optional:!0}}),e.exports=i},{"substance/model/DocumentNode":234}],404:[function(t,e,n){"use strict";function i(t){i["super"].call(this,t)}var r=t("substance/model/Document");r.extend(i),e.exports=i},{"substance/model/Document":231}],405:[function(t,e,n){"use strict";var i=t("./ArticleNode"),r=t("./ArticleConverter"),o=t("./ScientistArticle"),s=t("./ArticleComponent");e.exports={name:"article",configure:function(t){t.defineSchema({name:"scientist-article",ArticleClass:o,defaultTextType:"paragraph"}),t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,s)}}},{"./ArticleComponent":401,"./ArticleConverter":402,"./ArticleNode":403,"./ScientistArticle":404}],406:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");r.extend(i),i["static"].name="back",i["static"].defineSchema({attributes:{type:"object","default":{}},label:{type:"label",optional:!0},titles:{type:["title"],"default":[]},nodes:{type:["id"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],407:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/ContainerEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=this.props.configurator,i=t("div").addClass("sc-back").attr("data-id",this.props.node.id);return i.append(t(o,{disabled:this.props.disabled,node:e,commands:n.getSurfaceCommandNames(),textTypes:n.getTextTypes()}).ref("back")),i}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/ContainerEditor":324}],408:[function(t,e,n){"use strict";var i=t("../../../util/XMLIterator"),r=["ack","app-group","bio","fn-group","glossary","ref-list","notes","sec"];e.exports={type:"back",tagName:"back","import":function(t,e,n){e.id="back";var o=new i(t.getChildren());if(o.optional("label",function(t){e.label=n.convertElement(t).id}),o.manyOf("title",function(t){e.titles.push(n.convertElement(t).id)}),o.manyOf(r,function(t){e.nodes.push(n.convertElement(t).id)}),o.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){t.label&&e.append(n.convertNode(t.label)),t.titles.forEach(function(t){e.append(n.convertNode(t))}),t.nodes.forEach(function(t){e.append(n.convertNode(t))})}}},{"../../../util/XMLIterator":508}],409:[function(t,e,n){"use strict";var i=t("./Back"),r=t("./BackConverter"),o=t("./BackComponent");e.exports={name:"back",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,o)}}},{"./Back":406,"./BackComponent":407,"./BackConverter":408}],410:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");r.extend(i),i["static"].name="body",i["static"].defineSchema({attributes:{type:"object","default":{}},nodes:{type:["id"],"default":[]},sigBlock:{type:["sig-block"],optional:!0}}),e.exports=i},{"substance/model/Container":221}],411:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/ContainerEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=this.props.configurator,i=t("div").addClass("sc-body").attr("data-id",this.props.node.id);return i.append(t(o,{disabled:this.props.disabled,node:e,commands:n.getSurfaceCommandNames(),textTypes:n.getTextTypes()}).ref("body")),i}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/ContainerEditor":324}],412:[function(t,e,n){"use strict";var i=t("../JATS"),r=t("../../../util/XMLIterator");e.exports={type:"body",tagName:"body","import":function(t,e,n){e.id="body",e.xmlAttributes=t.getAttributes();var o=t.getChildren(),s=new r(o);if(s.manyOf(i.PARA_LEVEL,function(t){e.nodes.push(n.convertElement(t).id)}),s.manyOf("sec",function(t){e.nodes.push(n.convertElement(t).id)}),s.optional("sig-block",function(t){e.sigBlock=n.convertElement(t).id}),s.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){e.attr(t.xmlAttributes),e.append(n.convertNodes(t.nodes)),t.sigBlock&&e.append(n.convertNode(t.sigBlock))}}},{"../../../util/XMLIterator":508,"../JATS":397}],413:[function(t,e,n){"use strict";var i=t("./Body"),r=t("./BodyConverter"),o=t("./BodyComponent");e.exports={name:"body",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,o)}}},{"./Body":410,"./BodyComponent":411,"./BodyConverter":412}],414:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Annotation");r.extend(i),i["static"].name="bold",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Annotation":218}],415:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/AnnotationCommand");r.extend(i),i["static"].name="bold",e.exports=i},{"substance/ui/AnnotationCommand":312}],416:[function(t,e,n){"use strict";e.exports={type:"bold",tagName:"bold"}},{}],417:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/AnnotationTool");r.extend(i),i["static"].name="bold",e.exports=i},{"substance/ui/AnnotationTool":314}],418:[function(t,e,n){(function(n){"use strict";var i=t("./Bold"),r=t("./BoldConverter"),o=t("./BoldTool"),s=t("./BoldCommand");e.exports={name:"bold",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addCommand(s),t.addTool(o),t.addIcon(s["static"].name,{fontawesome:"fa-bold"}),t.addStyle(n,"_bold.scss"),t.addLabel("bold",{en:"Bold"})}}}).call(this,"/packages/jats/bold")},{"./Bold":414,"./BoldCommand":415,"./BoldConverter":416,"./BoldTool":417}],419:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");i.Prototype=function(){this.getTitle=function(){var t=this.getDocument();return t?t.get(this.title):void 0}},r.extend(i),i["static"].name="caption",i["static"].defineSchema({attributes:{type:"object","default":{}},title:{type:"title",optional:!0},nodes:{type:["p"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],420:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyEditor"),s=t("substance/ui/ContainerEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-caption").attr("data-id",e.id);if(e.title){var r=n.get(e.title);i.append(t(o,{disabled:this.props.disabled,path:r.getTextPath()})).ref("title")}var a=t("div").addClass("se-content"),c=t(s,{disabled:this.props.disabled,node:e}).ref("content");return a.append(c),i.append(a),i}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/ContainerEditor":324,"substance/ui/TextPropertyEditor":358}],421:[function(t,e,n){"use strict";var i=t("../../../util/XMLIterator");e.exports={type:"caption",tagName:"caption","import":function(t,e,n){e.xmlAttributes=t.getAttributes();var r=t.getChildren(),o=new i(r);if(o.optional("title",function(t){e.title=n.convertElement(t).id}),o.manyOf("p",function(t){e.nodes.push(n.convertElement(t).id)}),o.hasNext())throw new Error("Invalid JATS:"+t.outerHTML)},"export":function(t,e,n){e.attr(t.xmlAttributes),t.title&&e.append(n.convertNode(t.title)),e.append(n.convertNodes(t.nodes))}}},{"../../../util/XMLIterator":508}],422:[function(t,e,n){"use strict";var i=t("./Caption"),r=t("./CaptionComponent"),o=t("./CaptionConverter");e.exports={name:"caption",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o)}}},{"./Caption":419,"./CaptionComponent":420,"./CaptionConverter":421}],423:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/packages/link/EditLinkTool"),o=t("lodash/clone");i.Prototype=function(){},r.extend(i),i["static"].urlPropertyPath=["attributes","xlink:href"],i["static"].name="edit-ext-link",i["static"].getProps=function(t){return"edit"===t["ext-link"].mode?o(t["ext-link"]):void 0},e.exports=i},{"lodash/clone":162,"substance/packages/link/EditLinkTool":303}],424:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/PropertyAnnotation"),o=t("substance/model/Fragmenter");r.extend(i),i["static"].name="ext-link",i["static"].defineSchema({attributes:{type:"object","default":{}}}),i["static"].fragmentation=o.SHOULD_NOT_SPLIT,e.exports=i},{"substance/model/Fragmenter":239,"substance/model/PropertyAnnotation":247}],425:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/packages/link/LinkCommand");i.Prototype=function(){this.getAnnotationData=function(){return{attributes:{"xlink:href":""}}}},r.extend(i),i["static"].name="ext-link",e.exports=i},{"substance/packages/link/LinkCommand":304}],426:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/AnnotationComponent");i.Prototype=function(){var t=i["super"].prototype;this.didMount=function(){t.didMount.apply(this,arguments);var e=this.props.node;e.on("properties:changed",this.rerender,this)},this.dispose=function(){t.dispose.apply(this,arguments);var e=this.props.node;e.off(this)},this.render=function(e){var n=this.props.node,i=t.render.apply(this,arguments);return i.tagName="a",i.attr("href",n.attributes["xlink:href"]),i}},r.extend(i),e.exports=i},{"substance/ui/AnnotationComponent":313}],427:[function(t,e,n){"use strict";e.exports={type:"ext-link",tagName:"ext-link"}},{}],428:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/AnnotationTool");r.extend(i),i["static"].name="ext-link",e.exports=i},{"substance/ui/AnnotationTool":314}],429:[function(t,e,n){(function(n){"use strict";var i=t("./ExtLink"),r=t("./ExtLinkConverter"),o=t("./ExtLinkComponent"),s=t("./ExtLinkTool"),a=t("./ExtLinkCommand"),c=t("./EditExtLinkTool");e.exports={name:"ext-link",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,o),t.addCommand(a),t.addTool(s),t.addTool(c,{overlay:!0}),t.addIcon(a["static"].name,{fontawesome:"fa-link"}),t.addIcon("open-link",{fontawesome:"fa-external-link"}),t.addLabel("ext-link",{en:"Link"}),t.addStyle(n,"_ext-link.scss")}}}).call(this,"/packages/jats/ext-link")},{"./EditExtLinkTool":423,"./ExtLink":424,"./ExtLinkCommand":425,"./ExtLinkComponent":426,"./ExtLinkConverter":427,"./ExtLinkTool":428}],430:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/DocumentNode");r.extend(i),i["static"].name="figure",i["static"].defineSchema({attributes:{type:"object","default":{}},objectIds:{type:["string"],"default":[]},label:{type:"label",optional:!0},captions:{type:["caption"],"default":[]},abstracts:{type:["abstract"],"default":[]},kwdGroups:{type:["kwd-group"],"default":[]},altTexts:{type:["alt-text"],"default":[]},longDescs:{type:["long-desc"],"default":[]},emails:{type:["email"],"default":[]},extLinks:{type:["ext-link"],"default":[]},uris:{type:["uri"],"default":[]},contentNodes:{type:["id"],"default":[]},attribs:{type:["attrib"],"default":[]},permissions:{type:["permissions"],"default":[]}}),e.exports=i},{"substance/model/DocumentNode":234}],431:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("../../../util/renderNodeComponent");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-figure").attr("data-id",this.props.node.id);if(e.label){var r=n.get(e.label);i.append(o(this,t,r,{disabled:this.props.disabled}).ref("label"))}return e.contentNodes.forEach(function(e){var r=n.get(e);
i.append(o(this,t,r,{disabled:this.props.disabled}))}.bind(this)),e.captions.forEach(function(e){var r=n.get(e);i.append(o(this,t,r,{disabled:this.props.disabled}).ref("caption"))}.bind(this)),i}},r.extend(i),e.exports=i},{"../../../util/renderNodeComponent":509,"substance/ui/Component":322}],432:[function(t,e,n){"use strict";var i=t("../JATS"),r=t("../../../util/XMLIterator"),o=i.ACCESS.concat(i.ADDRESS_LINK),s=i.BLOCK_MATH.concat(i.CHEM_STRUCT).concat(i.INTABLE_PARA).concat(i.JUST_TABLE).concat(i.JUST_PARA).concat(i.LIST).concat(i.SIMPLE_DISPLAY);e.exports={type:"figure",tagName:"fig","import":function(t,e,n){var a=new r(t.getChildren());if(a.manyOf("object-id",function(t){e.objectIds.push(t.textContent)}),a.optional("label",function(t){e.label=n.convertElement(t).id}),a.manyOf("caption",function(t){e.captions.push(n.convertElement(t).id)}),a.manyOf("abstract",function(t){e.abstracts.push(n.convertElement(t).id)}),a.manyOf("kwd-group",function(t){e.kwdGroups.push(n.convertElement(t).id)}),a.manyOf(o,function(t){var i=n.convertElement(t);switch(t.tagName){case"alt-text":e.altTexts.push(i.id);break;case"long-desc":e.longDescs.push(i.id);break;case"ext-link":e.extLinks.push(i.id);break;case"uri":e.uris.push(i.id);break;case"email":e.emails.push(i.id)}}),a.manyOf(s,function(t){e.contentNodes.push(n.convertElement(t).id)}),a.manyOf(i.DISLAY_BACK_MATTER,function(t){var i=n.convertElement(t);switch(t.tagName){case"attrib":e.attribs.push(i.id);break;case"permissions":e.permissions.push(i.id)}}),a.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){var i=n.$$;t.objectIds.forEach(function(t){e.append(i("object-id").text(t))}),t.label&&e.append(n.convertNode(t.label)),e.append(n.convertNodes(t.captions)),e.append(n.convertNodes(t.abstracts)),e.append(n.convertNodes(t.kwdGroups)),t.altTexts&&e.append(n.convertNodes(t.altTexts)),t.longDescs&&e.append(n.convertNodes(t.longDescs)),t.extLinks&&e.append(n.convertNodes(t.extLinks)),t.uris&&e.append(n.convertNodes(t.uris)),t.emails&&e.append(n.convertNodes(t.emails)),e.append(n.convertNodes(t.contentNodes)),e.append(n.convertNodes(t.attribs)),e.append(n.convertNodes(t.permissions))}}},{"../../../util/XMLIterator":508,"../JATS":397}],433:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("../../../util/renderNodeComponent");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-figure-target").attr({"data-id":e.id});if(this.props.selected&&i.addClass("sm-selected"),i.append(this._renderThumb(t)),e.label){var r=n.get(e.label);i.append(o(this,t,r,{disabled:this.props.disabled}))}var s=e.captions[0];return s&&(s=n.get(s),i.append(o(this,t,s,{disabled:this.props.disabled}))),i},this._renderThumb=function(t){var e=this.props.node,n=e.getDocument(),i=e.contentNodes[0],r=t("div").addClass("se-thumbnail");return i?(i=n.get(i),r.append(o(this,t,i))):r.append("No thumb"),r}},r.extend(i),e.exports=i},{"../../../util/renderNodeComponent":509,"substance/ui/Component":322}],434:[function(t,e,n){(function(n){"use strict";var i=t("./Figure"),r=t("./FigureComponent"),o=t("./FigureTarget"),s=t("./FigureConverter");e.exports={name:"figure",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addComponent(i["static"].name+"-target",o),t.addConverter("jats",s),t.addStyle(n,"_figure.scss"),t.addStyle(n,"_figure-target.scss")}}}).call(this,"/packages/jats/figure")},{"./Figure":430,"./FigureComponent":431,"./FigureConverter":432,"./FigureTarget":433}],435:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");r.extend(i),i["static"].name="footnote",i["static"].defineSchema({attributes:{type:"object","default":{}},label:{type:"label",optional:!0},nodes:{type:["p"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],436:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyComponent"),s=t("../../../util/renderNodeComponent");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-footnote").attr("data-id",this.props.node.id);if(e.label){var r=n.get(e.label);i.append(t(o,{path:r.getTextPath()}))}return this.props.node.nodes.forEach(function(e){var r=n.get(e);i.append(s(this,t,r,{disabled:this.props.disabled}))}.bind(this)),i}},r.extend(i),e.exports=i},{"../../../util/renderNodeComponent":509,"substance/ui/Component":322,"substance/ui/TextPropertyComponent":357}],437:[function(t,e,n){"use strict";var i=t("../../../util/XMLIterator");e.exports={type:"footnote",tagName:"fn","import":function(t,e,n){var r=new i(t.getChildren());if(r.optional("label",function(t){e.label=n.convertElement(t).id}),r.oneOrMoreOf("p",function(t){e.nodes.push(n.convertElement(t).id)}),r.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){t.label&&e.append(n.convertNode(t.label)),e.append(n.convertNodes(t.nodes))}}},{"../../../util/XMLIterator":508}],438:[function(t,e,n){(function(n){"use strict";var i=t("./Footnote"),r=t("./FootnoteComponent"),o=t("./FootnoteConverter");e.exports={name:"footnote",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o),t.addStyle(n,"_footnote.scss")}}}).call(this,"/packages/jats/footnote")},{"./Footnote":435,"./FootnoteComponent":436,"./FootnoteConverter":437}],439:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");r.extend(i),i["static"].name="front",i["static"].defineSchema({attributes:{type:"object","default":{}},journalMeta:{type:"journal-meta",optional:!0},articleMeta:{type:"article-meta"},nodes:{type:["id"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],440:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/ContainerEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=this.props.configurator,i=t("div").addClass("sc-front").attr("data-id",this.props.node.id);return e.nodes.length>0&&i.append(t(o,{disabled:this.props.disabled,node:e,commands:n.getSurfaceCommandNames(),textTypes:n.getTextTypes()}).ref("front")),i}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/ContainerEditor":324}],441:[function(t,e,n){"use strict";var i=t("../../../util/XMLIterator"),r=["def-list","list","ack","bio","fn-group","glossary","notes"];e.exports={type:"front",tagName:"front","import":function(t,e,n){e.id="front";var o=new i(t.getChildren());if(o.optional("journal-meta",function(t){e.journalMeta=n.convertElement(t).id}),o.required("article-meta",function(t){e.articleMeta=n.convertElement(t).id}),o.manyOf(r,function(t){e.nodes.push(n.convertElement(t).id)}),o.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){t.journalMeta&&e.append(n.convertNode(t.journalMeta)),e.append(n.convertNode(t.articleMeta)),e.append(n.convertNodes(t.nodes))}}},{"../../../util/XMLIterator":508}],442:[function(t,e,n){"use strict";var i=t("./Front"),r=t("./FrontConverter"),o=t("./FrontComponent");e.exports={name:"front",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,o)}}},{"./Front":439,"./FrontComponent":440,"./FrontConverter":441}],443:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");i.Prototype=function(){this.getHref=function(){return this.attributes["xlink:href"]}},r.extend(i),i["static"].name="graphic",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Container":221}],444:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=t("div").addClass("sc-graphic").attr("data-id",e.id);return n.append(t("img").attr({src:e.getHref()})),n}},r.extend(i),e.exports=i},{"substance/ui/Component":322}],445:[function(t,e,n){"use strict";var i=t("../JATS"),r=t("../../../util/XMLIterator"),o=i.ACCESS.concat(i.ADDRESS_LINK).concat(["caption","object-id","kwd-group","label"]).concat(i.DISPLAY_BACK_MATTER);e.exports={type:"graphic",tagName:"graphic","import":function(t,e,n){var i=new r(t.getChildren());if(i.manyOf(o,function(t){e.nodes.push(n.convertElement(t).id)}),i.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){e.append(n.convertNodes(t.nodes))}}},{"../../../util/XMLIterator":508,"../JATS":397}],446:[function(t,e,n){(function(n){"use strict";var i=t("./Graphic"),r=t("./GraphicComponent"),o=t("./GraphicConverter");e.exports={name:"graphic",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o),t.addStyle(n,"_graphic.scss")}}}).call(this,"/packages/jats/graphic")},{"./Graphic":443,"./GraphicComponent":444,"./GraphicConverter":445}],447:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Annotation");r.extend(i),i["static"].name="italic",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Annotation":218}],448:[function(t,e,n){"use strict";e.exports={type:"italic",tagName:"italic"}},{}],449:[function(t,e,n){(function(n){"use strict";var i=t("./Italic"),r=t("./ItalicConverter");e.exports={name:"italic",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addStyle(n,"_italic.scss")}}}).call(this,"/packages/jats/italic")},{"./Italic":447,"./ItalicConverter":448}],450:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/TextNode");r.extend(i),i["static"].name="label",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/TextNode":253}],451:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyEditor");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-label"),n=this.props.node,i=t(o,{disabled:this.props.disabled,path:n.getTextPath()}).ref("labelEditor");return e.append(i),e}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/TextPropertyEditor":358}],452:[function(t,e,n){"use strict";var i=t("../TextNodeConverter");e.exports=i.extend({type:"label",tagName:"label"})},{"../TextNodeConverter":400}],453:[function(t,e,n){"use strict";var i=t("./Label"),r=t("./LabelConverter"),o=t("./LabelComponent");e.exports={name:"label",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,o),t.addConverter("jats",r)}}},{"./Label":450,"./LabelComponent":451,"./LabelConverter":452}],454:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Annotation");r.extend(i),i["static"].name="monospace",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Annotation":218}],455:[function(t,e,n){"use strict";e.exports={type:"monospace",tagName:"monospace"}},{}],456:[function(t,e,n){(function(n){"use strict";var i=t("./Monospace"),r=t("./MonospaceConverter");e.exports={name:"monospace",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addStyle(n,"_monospace.scss")}}}).call(this,"/packages/jats/monospace")},{"./Monospace":454,"./MonospaceConverter":455}],457:[function(t,e,n){"use strict";var i=t("./JATSImporter"),r=t("./JATSExporter");e.exports={name:"jats",configure:function(e){e["import"](t("./article/package")),e["import"](t("./back/package")),e["import"](t("./body/package")),e["import"](t("./bold/package")),e["import"](t("./caption/package")),e["import"](t("./xref/package")),e["import"](t("./ext-link/package")),e["import"](t("./figure/package")),e["import"](t("./footnote/package")),e["import"](t("./front/package")),e["import"](t("./graphic/package")),e["import"](t("./italic/package")),e["import"](t("./label/package")),e["import"](t("./monospace/package")),e["import"](t("./paragraph/package")),e["import"](t("./ref/package")),e["import"](t("./ref-list/package")),e["import"](t("./section/package")),e["import"](t("./subscript/package")),e["import"](t("./superscript/package")),e["import"](t("./table/package")),e["import"](t("./title/package")),e.addImporter("jats",i),e.addExporter("jats",r)}}},{"./JATSExporter":398,"./JATSImporter":399,"./article/package":405,"./back/package":409,"./body/package":413,"./bold/package":418,"./caption/package":422,"./ext-link/package":429,"./figure/package":434,"./footnote/package":438,"./front/package":442,"./graphic/package":446,"./italic/package":449,"./label/package":453,"./monospace/package":456,"./paragraph/package":461,"./ref-list/package":465,"./ref/package":470,"./section/package":475,"./subscript/package":478,"./superscript/package":481,"./table/package":485,"./title/package":489,"./xref/package":497}],458:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/TextBlock");r.extend(i),i["static"].name="paragraph",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/TextBlock":252}],459:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/TextBlockComponent");i.Prototype=function(){this.getClassNames=function(){return"sc-paragraph"}},r.extend(i),e.exports=i},{"substance/ui/TextBlockComponent":356}],460:[function(t,e,n){"use strict";var i=t("../TextNodeConverter");e.exports=i.extend({type:"paragraph",tagName:"p"})},{"../TextNodeConverter":400}],461:[function(t,e,n){"use strict";var i=t("./Paragraph"),r=t("./ParagraphComponent"),o=t("./ParagraphConverter");e.exports={name:"paragraph",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o),t.addTextType({name:"paragraph",data:{type:"paragraph"}}),t.addLabel("paragraph",{en:"Paragraph",de:"Paragraph"}),t.addLabel("paragraph.content",{en:"Paragraph",de:"Paragraph"})}}},{"./Paragraph":458,"./ParagraphComponent":459,"./ParagraphConverter":460}],462:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");r.extend(i),i["static"].name="ref-list",i["static"].defineSchema({attributes:{type:"object","default":{}},label:{type:"label",optional:!0},title:{type:"title",optional:!0},nodes:{type:["id"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],463:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/ContainerEditor"),s=t("../../../util/renderNodeComponent");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-ref-list");if(e.title){var r=n.get(e.title);i.append(s(this,t,r,{disabled:this.props.disabled}))}return i.append(t(o,{node:e}).ref("contentEditor").addClass("se-content")),i}},r.extend(i),i["static"].fullWidth=!0,i["static"].noStyle=!0,e.exports=i},{"../../../util/renderNodeComponent":509,"substance/ui/Component":322,"substance/ui/ContainerEditor":324}],464:[function(t,e,n){"use strict";var i=t("../JATS"),r=t("../../../util/XMLIterator"),o=["ref","ref-list"].concat(i.PARA_LEVEL);e.exports={type:"ref-list",tagName:"ref-list","import":function(t,e,n){var i=new r(t.getChildren());if(i.optional("label",function(t){e.label=n.convertElement(t).id}),i.optional("title",function(t){e.title=n.convertElement(t).id}),i.manyOf(o,function(t){e.nodes.push(n.convertElement(t).id)}),i.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){t.label&&e.append(n.convertNode(t.label)),t.title&&e.append(n.convertNode(t.title)),e.append(n.convertNodes(t.nodes))}}},{"../../../util/XMLIterator":508,"../JATS":397}],465:[function(t,e,n){(function(n){"use strict";var i=t("./RefList"),r=t("./RefListConverter"),o=t("./RefListComponent");e.exports={name:"ref-list",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,o),t.addConverter("jats",r),t.addStyle(n,"_ref-list.scss")}}}).call(this,"/packages/jats/ref-list")},{"./RefList":462,"./RefListComponent":463,"./RefListConverter":464}],466:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/DocumentNode");r.extend(i),i["static"].name="ref",i["static"].defineSchema({attributes:{type:"object","default":{}},xmlContent:{type:"string","default":""}}),e.exports=i},{"substance/model/DocumentNode":234}],467:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("./refToHTML");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-ref");return e.html(o(this.props.node.xmlContent)),e}},r.extend(i),i["static"].fullWidth=!0,i["static"].noStyle=!0,e.exports=i},{"./refToHTML":471,"substance/ui/Component":322}],468:[function(t,e,n){"use strict";e.exports={type:"ref",tagName:"ref","import":function(t,e,n){e.xmlContent=t.innerHTML},"export":function(t,e,n){e.innerHTML=t.xmlContent}}},{}],469:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("./refToHTML");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-ref-target").attr({"data-id":this.props.node.id});this.props.selected&&e.addClass("sm-selected");var n=this.props.node;return e.html(o(n.xmlContent)),e}},r.extend(i),e.exports=i},{"./refToHTML":471,"substance/ui/Component":322}],470:[function(t,e,n){(function(n){"use strict";var i=t("./Ref"),r=t("./RefComponent"),o=t("./RefTarget"),s=t("./RefConverter");e.exports={name:"ref",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addComponent(i["static"].name+"-target",o),t.addConverter("jats",s),t.addStyle(n,"_ref.scss")}}}).call(this,"/packages/jats/ref")},{"./Ref":466,"./RefComponent":467,"./RefConverter":468,"./RefTarget":469}],471:[function(t,e,n){"use strict";var i=t("substance/ui/DefaultDOMElement"),r=function(t){for(var e=t.findAll("name"),n=[],r=0;r<e.length;r++){var o=e[r],s=i.createElement("span");if(s.addClass("name"),s.text(o.find("surname").text()+" "+o.find("given-names").text()),r>0&&r<e.length){var a=i.createElement("span");a.text(", "),n.push(a)}n.push(s)}return n},o=function(t){var e=t.find("article-title"),n=i.createElement("div");return n.addClass("title"),e?n.text(e.text()+". "):n.text("Untitled. "),n},s=function(t){var e=i.createElement("div");e.addClass("meta");var n="",r=t.find("source");r&&(n+=r.text()+", ");var o=t.find("volume");o&&(n+=o.text()+": ");var s=t.find("fpage");s&&(n+=s.text()+"-");var a=t.find("lpage");a&&(n+=a.text()+", ");var c=t.find("year");return c&&(n+=c.text()),e.text(n),e},a=function(t){var e=i.createElement("div");e.addClass("doi");var n,r=t.find("pub-id[pub-id-type='doi'], ext-link[ext-link-type='doi']"),o=t.find("ext-link[ext-link-type='uri']");return r?n="http://dx.doi.org/"+r.text():o&&(n=o.getAttribute("xlink:href")),e.appendChild(i.createElement("a").setAttribute("href",n).text(n)),e},c=function(t){t=i.parseXML(t),Array.isArray(t)&&(t=t[0]);var e=i.createElement("div");if(t.is("mixed-citation")||t.is("element-citation")){e.appendChild(o(t));for(var n=r(t),c=0;c<n.length;c++)e.appendChild(n[c]);e.appendChild(s(t)),e.appendChild(a(t))}else e.text("Citation type is unsupported");return e.outerHTML};e.exports=c},{"substance/ui/DefaultDOMElement":328}],472:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Container");i.Prototype=function(){this.getTitle=function(){var t=this.getDocument().get(this.title);return t?t.getText():void 0}},r.extend(i),i["static"].name="section",i["static"].defineSchema({attributes:{type:"object","default":{}},meta:{type:"id",optional:!0},label:{type:"id",optional:!0},title:{type:"id",optional:!0},nodes:{type:["id"],"default":[]},backMatter:{type:["id"],"default":[]}}),e.exports=i},{"substance/model/Container":221}],473:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyEditor"),s=t("substance/ui/ContainerEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=e.getDocument(),i=t("div").addClass("sc-section");if(e.title){var r=n.get(e.title);i.append(t(o,{path:r.getTextPath()}).addClass("se-title").ref("titleEditor"))}return i.append(t(s,{node:e}).ref("contentEditor").addClass("se-content")),i}},r.extend(i),i["static"].fullWidth=!0,i["static"].noStyle=!0,e.exports=i},{"substance/ui/Component":322,"substance/ui/ContainerEditor":324,"substance/ui/TextPropertyEditor":358}],474:[function(t,e,n){"use strict";var i=t("../JATS"),r=t("../../../util/XMLIterator");e.exports={type:"section",tagName:"sec","import":function(t,e,n){var o=t.getChildren(),s=new r(o);if(s.optional("sec-meta",function(t){e.meta=n.convertElement(t).id}),s.optional("label",function(t){e.label=n.convertElement(t).id}),s.optional("title",function(t){e.title=n.convertElement(t).id}),s.manyOf(i.PARA_LEVEL,function(t){e.nodes.push(n.convertElement(t).id)}),s.manyOf(["sec"],function(t){e.nodes.push(n.convertElement(t).id)}),s.manyOf(["notes","fn-group","glossary","ref-list"],function(t){e.backMatter.push(n.convertElement(t).id)}),s.hasNext())throw new Error("Illegal JATS: "+t.outerHTML)},"export":function(t,e,n){var i=n.$$;e.attr(t.xmlAttributes),t.meta&&e.append(i("sec-meta").append(n.convertNode(t.meta))),t.label&&e.append(n.convertNode(t.label)),t.title&&e.append(n.convertNode(t.title)),t.nodes.forEach(function(t){e.append(n.convertNode(t))}),t.backMatter.forEach(function(t){e.append(n.convertNode(t))})}}},{"../../../util/XMLIterator":508,"../JATS":397}],475:[function(t,e,n){(function(n){"use strict";var i=t("./Section"),r=t("./SectionComponent"),o=t("./SectionConverter");e.exports={name:"section",configure:function(t){t.addNode(i),t.addComponent("section",r),t.addConverter("jats",o),t.addStyle(n,"_section.scss")}}}).call(this,"/packages/jats/section")},{"./Section":472,"./SectionComponent":473,"./SectionConverter":474}],476:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Annotation");r.extend(i),i["static"].name="subscript",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Annotation":218}],477:[function(t,e,n){"use strict";e.exports={type:"subscript",tagName:"sub"}},{}],478:[function(t,e,n){(function(n){"use strict";var i=t("./Subscript"),r=t("./SubscriptConverter");e.exports={name:"subscript",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addStyle(n,"_subscript.scss")}}}).call(this,"/packages/jats/subscript")},{"./Subscript":476,"./SubscriptConverter":477}],479:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/Annotation");r.extend(i),i["static"].name="superscript",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/Annotation":218}],480:[function(t,e,n){"use strict";e.exports={type:"superscript",tagName:"sup"}},{}],481:[function(t,e,n){(function(n){"use strict";var i=t("./Superscript"),r=t("./SuperscriptConverter");e.exports={name:"superscript",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addStyle(n,"_superscript.scss")}}}).call(this,"/packages/jats/superscript")},{"./Superscript":479,"./SuperscriptConverter":480}],482:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/BlockNode");r.extend(i),i["static"].name="table",i["static"].defineSchema({attributes:{type:"object","default":{}},htmlContent:{type:"string"}}),e.exports=i},{"substance/model/BlockNode":220}],483:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component");i.Prototype=function(){this.render=function(t){var e=t("table").addClass("sc-table").attr("data-id",this.props.node.id).html(this.props.node.htmlContent);return e}},r.extend(i),e.exports=i},{"substance/ui/Component":322}],484:[function(t,e,n){"use strict";e.exports={type:"table",tagName:"table","import":function(t,e){e.htmlContent=t.innerHTML},"export":function(t,e){e.html(t.htmlContent)}}},{}],485:[function(t,e,n){"use strict";var i=t("./Table"),r=t("./TableComponent"),o=t("./TableConverter");e.exports={name:"table",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o)}}},{"./Table":482,"./TableComponent":483,"./TableConverter":484}],486:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/TextNode");r.extend(i),i["static"].name="title",i["static"].defineSchema({attributes:{type:"object","default":{}}}),e.exports=i},{"substance/model/TextNode":253}],487:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyEditor");i.Prototype=function(){this.render=function(t){var e=t("div").addClass("sc-title"),n=this.props.node,i=t(o,{disabled:this.props.disabled,path:n.getTextPath()}).ref("titleEditor");return e.append(i),e}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/TextPropertyEditor":358}],488:[function(t,e,n){"use strict";var i=t("../TextNodeConverter");e.exports=i.extend({type:"title",tagName:"title"})},{"../TextNodeConverter":400}],489:[function(t,e,n){(function(n){"use strict";var i=t("./Title"),r=t("./TitleConverter"),o=t("./TitleComponent");e.exports={name:"title",configure:function(t){t.addNode(i),t.addConverter("jats",r),t.addComponent(i["static"].name,o),t.addStyle(n,"_title.scss")}}}).call(this,"/packages/jats/title")},{"./Title":486,"./TitleComponent":487,"./TitleConverter":488}],490:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/InlineNode"),o=t("substance/model/Fragmenter");r.extend(i),i["static"].name="xref",i["static"].defineSchema({attributes:{type:"object","default":{}},targets:{type:["id"],"default":[]},label:{type:"text",optional:!0}}),Object.defineProperties(i.prototype,{referenceType:{get:function(){return this.attributes["ref-type"]},set:function(t){this.attributes["ref-type"]=t}}}),i["static"].fragmentation=o.SHOULD_NOT_SPLIT,e.exports=i},{"substance/model/Fragmenter":239,"substance/model/InlineNode":242}],491:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/InlineNodeCommand");i.Prototype=function(){},r.extend(i),i["static"].name="xref",e.exports=i},{"substance/ui/InlineNodeCommand":336}],492:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/Component"),o=t("substance/ui/TextPropertyEditor");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=t("span").addClass("sc-xref"),i=t(o,{disabled:this.props.disabled,tagName:"span",path:[e.id,"label"],withoutBreak:!0}).ref("labelEditor");return n.append(i),n.addClass("sm-"+e.referenceType),n}},r.extend(i),e.exports=i},{"substance/ui/Component":322,"substance/ui/TextPropertyEditor":358}],493:[function(t,e,n){"use strict";e.exports={type:"xref",tagName:"xref","import":function(t,e,n){e.targets=t.attr("rid").split(" "),e.label=n.annotatedText(t,[e.id,"label"])},"export":function(t,e,n){e.attr({rid:t.targets.join(" "),"ref-type":t.referenceType}),e.append(n.annotatedText([t.id,"label"]))}}},{}],494:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("lodash/clone"),o=t("lodash/find"),s=t("lodash/without"),a=t("substance/ui/Component"),c=t("./getXRefTargets");i.Prototype=function(){this.getInitialState=function(){return{targets:c(this.props.node)}},this.render=function(t){var e=t("div").addClass("sc-xref-targets"),n=this.context.componentRegistry;return this.state.targets.forEach(function(i){var o=n.get(i.node.type+"-target"),s=r(i);s.disabled=!0,e.append(t(o,s).on("click",this._toggleTarget.bind(this,i.node)))}.bind(this)),e},this._toggleTarget=function(t){var e=this.props.node,n=this.context.surfaceManager.getFocusedSurface(),i=e.targets;i.indexOf(t.id)>0?i=s(i,t.id):i.push(t.id);var r=this.state.targets,a=o(this.state.targets,function(e){return e.node===t});a.selected=!a.selected,this.setState({targets:r}),n.transaction(function(t){t.set([e.id,"targets"],i)})}},a.extend(i),e.exports=i},{"./getXRefTargets":496,"lodash/clone":162,"lodash/find":168,"lodash/without":215,"substance/ui/Component":322}],495:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.handleActions({closeModal:this._doneEditing,doneEditing:this._doneEditing})}var r=t("substance/ui/Component"),o=t("lodash/clone"),s=t("substance/ui/Modal"),a=t("./XRefTargets"),c=t("substance/ui/Prompt"),u=t("substance/model/transform/deleteSelection");i.Prototype=function(){this.render=function(t){var e=this.props.node,n=t("div").addClass("sc-xref-tool");return n.append(t(c).append(t(c.Label,{label:this.getLabel("xref")}),t(c.Separator),t(c.Action,{name:"edit",title:this.getLabel("edit-xref")}).on("click",this._onEdit),t(c.Action,{name:"delete",title:this.getLabel("delete-xref")}).on("click",this._onDelete))),this.state.edit&&n.append(t(s,{width:"large"}).append(t(a,{node:e}).ref("targets"))),n},this._onEdit=function(){this.setState({edit:!0})},this._doneEditing=function(){this.setState({edit:!1})},this._onDelete=function(){var t=this.context.documentSession;t.transaction(function(t,e){return u(t,e)})}},r.extend(i),i["static"].getProps=function(t){return t.xref.active?o(t.xref):void 0},i["static"].name="xref",e.exports=i},{"./XRefTargets":494,"lodash/clone":162,"substance/model/transform/deleteSelection":278,"substance/ui/Component":322,"substance/ui/Modal":341,"substance/ui/Prompt":344}],496:[function(t,e,n){"use strict";function i(t){var e=t.getDocument(),n=t.targets,i=e.getIndex("type"),c=t.referenceType,u=a[c],h=[];return u.forEach(function(t){var e=o(i.get(t));e.forEach(function(t){var e=r(n,t.id);h.push({selected:e,node:t})})}),h=s(h,["selected"],["desc"])}var r=t("lodash/includes"),o=t("lodash/map"),s=t("lodash/orderBy"),a={fig:["figure","fig-group"],bibr:["ref"],table:["table-wrap"]};e.exports=i},{"lodash/includes":174,"lodash/map":196,"lodash/orderBy":200}],497:[function(t,e,n){(function(n){"use strict";var i=t("./XRef"),r=t("./XRefComponent"),o=t("./XRefConverter"),s=t("./XRefCommand"),a=t("./XRefTool");e.exports={name:"xref",configure:function(t){t.addNode(i),t.addComponent(i["static"].name,r),t.addConverter("jats",o),t.addCommand(s),t.addTool(a,{overlay:!0}),t.addStyle(n,"_xref.scss"),t.addLabel("xref",{en:"Cross Reference"}),t.addLabel("edit-xref",{en:"Edit Reference"}),t.addLabel("delete-xref",{en:"Delete Reference"})}}}).call(this,"/packages/jats/xref")},{"./XRef":490,"./XRefCommand":491,"./XRefComponent":492,"./XRefConverter":493,"./XRefTool":495}],498:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component");i.Prototype=function(){this._save=function(){var t=this.refs.xml.val(),e=this.props.path,n=this.context.documentSession;n.transaction(function(n){n.set(e,t)}),this.send("xmlSaved",t)},this.render=function(t){var e=t("div").addClass("sc-edit-xml"),n=this.context.documentSession,i=n.getDocument(),r=i.get(this.props.path);return e.append(t("textarea").ref("xml").append(r)),e.append(t("button").append("Save").on("click",this._save)),e}},r.extend(i),e.exports=i},{"substance/ui/Component":322}],499:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/InlineNode");r.extend(i),i["static"].name="unsupported-inline",i["static"].defineSchema({xml:"string",tagName:"string"}),e.exports=i},{"substance/model/InlineNode":242}],500:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/ui/InlineNodeCommand");r.extend(i),i["static"].name="unsupported-inline",
e.exports=i},{"substance/ui/InlineNodeCommand":336}],501:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component");i.Prototype=function(){this.render=function(t){var e=t("span").addClass("sc-unsupported-inline-node").attr("data-id",this.props.node.id).attr("contenteditable",!1).append("<"+this.props.node.tagName+">");return e}},r.extend(i),e.exports=i},{"substance/ui/Component":322}],502:[function(t,e,n){"use strict";e.exports={type:"unsupported-inline",matchElement:function(){return!0},"import":function(t,e){e.xml=t.outerHTML,e.tagName=t.tagName},"export":function(t,e){return e.innerHTML=t.xml,e.children[0]}}},{}],503:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments),this.handleActions({closeModal:this._closeModal,xmlSaved:this._closeModal})}var r=t("substance/ui/Component"),o=t("lodash/clone"),s=t("substance/ui/Modal"),a=t("substance/ui/Prompt"),c=t("./EditXML"),u=t("substance/model/transform/deleteSelection");i.Prototype=function(){this._closeModal=function(){this.setState({editXML:!1})},this._onEdit=function(){this.setState({editXML:!0})},this._onDelete=function(){var t=this.context.documentSession;t.transaction(function(t,e){return u(t,e)})},this.render=function(t){var e=t("div").addClass("sc-unsupported-node-tool"),n=this.props.node;return e.append(t(a).append(t(a.Label,{label:"Unsupported Element"}),t(a.Separator),t(a.Action,{name:"edit",title:"Edit XML"}).on("click",this._onEdit),t(a.Action,{name:"delete",title:"Delete Element"}).on("click",this._onDelete))),this.state.editXML&&e.append(t(s,{width:"medium"}).append(t(c,{path:[n.id,"xml"]}))),e}},r.extend(i),i["static"].getProps=function(t){return t["unsupported-inline"].active?o(t["unsupported-inline"]):void 0},i["static"].name="unsupported-inline",e.exports=i},{"./EditXML":498,"lodash/clone":162,"substance/model/transform/deleteSelection":278,"substance/ui/Component":322,"substance/ui/Modal":341,"substance/ui/Prompt":344}],504:[function(t,e,n){"use strict";function i(){i["super"].apply(this,arguments)}var r=t("substance/model/BlockNode");r.extend(i),i["static"].name="unsupported",i["static"].defineSchema({xml:"string",tagName:"string"}),e.exports=i},{"substance/model/BlockNode":220}],505:[function(t,e,n){"use strict";function i(){r.apply(this,arguments)}var r=t("substance/ui/Component");i.Prototype=function(){this.render=function(t){var e=t("span").addClass("sc-unsupported-inline-node").attr("data-id",this.props.node.id).attr("contenteditable",!1).append(t("button").addClass("se-toggle").append(t("pre").append(t("code").append(this.props.node.tagName))));return e}},r.extend(i),i["static"].fullWidth=!0,i["static"].noStyle=!0,e.exports=i},{"substance/ui/Component":322}],506:[function(t,e,n){"use strict";e.exports={type:"unsupported",matchElement:function(){return!0},"import":function(t,e){e.xml=t.outerHTML,e.tagName=t.tagName},"export":function(t,e){return e.innerHTML=t.xml,e.children[0]}}},{}],507:[function(t,e,n){"use strict";var i=t("./UnsupportedNode"),r=t("./UnsupportedInlineNode"),o=t("./UnsupportedNodeComponent"),s=t("./UnsupportedInlineNodeComponent"),a=t("./UnsupportedNodeJATSConverter"),c=t("./UnsupportedInlineNodeJATSConverter"),u=t("./UnsupportedInlineNodeCommand"),h=t("./UnsupportedInlineNodeTool");e.exports={name:"unsupported",configure:function(t){t.addNode(i),t.addNode(r),t.addComponent(i["static"].name,o),t.addComponent(r["static"].name,s),t.addCommand(u),t.addTool(h,{overlay:!0}),t.addConverter("jats",a),t.addConverter("jats",c)}}},{"./UnsupportedInlineNode":499,"./UnsupportedInlineNodeCommand":500,"./UnsupportedInlineNodeComponent":501,"./UnsupportedInlineNodeJATSConverter":502,"./UnsupportedInlineNodeTool":503,"./UnsupportedNode":504,"./UnsupportedNodeComponent":505,"./UnsupportedNodeJATSConverter":506}],508:[function(t,e,n){"use strict";function i(t){this.it=new s(t)}var r=t("lodash/isString"),o=t("substance/util/oo"),s=t("substance/util/ArrayIterator"),a=t("substance/util/makeMap");i.Prototype=function(){this.optional=function(t,e){this._one(t,!0,e)},this.required=function(t,e){this._one(t,!1,e)},this._one=function(t,e,n){if(this.it.hasNext()){var i=this.it.next();if(i.tagName===t)return n(i);this.it.back()}if(!e)throw new Error("Expecting element '"+t+"'.")},this._manyOf=function(t,e){r(t)&&(t=[t]);var n=0;for(t=a(t);this.it.hasNext();){var i=this.it.next();if(!t[i.tagName]){this.it.back();break}n++,e(i)}return n},this.manyOf=function(t,e){return this._manyOf(t,e)},this.oneOrMoreOf=function(t,e){var n=this._manyOf(t,e);if(0===n)throw new Error("Expecting at least one element of "+String(t));return n},this.hasNext=function(){return this.it.hasNext()}},o.initClass(i),e.exports=i},{"lodash/isString":189,"substance/util/ArrayIterator":365,"substance/util/makeMap":378,"substance/util/oo":379}],509:[function(t,e,n){"use strict";var i=t("lodash/extend");e.exports=function(t,e,n,r){r=r||{};var o=t.props.componentRegistry||t.context.componentRegistry,s=o.get(n.type);return s||(console.error("Could not resolve a component for node type "+n.type),s=o.get("unsupported")),e(s,i({node:n},r))}},{"lodash/extend":166}]},{},[3]);